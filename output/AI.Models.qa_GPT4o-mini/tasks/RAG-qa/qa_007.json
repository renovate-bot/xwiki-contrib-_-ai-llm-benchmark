{
  "id": "qa_007",
  "prompt": "How do I configure group synchronization between XWiki and my OpenID Connect provider?\nI'm using an OpenID Connect provider that supports group claims, and I want to synchronize these groups with XWiki groups. What's the process for setting this up?",
  "expected_answer": "To configure group synchronization between XWiki and your OpenID Connect provider 1. Locate the `xwiki.properties` file in your XWiki installation directory.\n2. Open the file with a text editor.\n3. Configure the group synchronization by setting the `oidc.groups.claim` property to the name of the claim used by your OpenID Connect provider to send group information. For example:\n```java\n#-# The name of the claim used to get the list of groups the user belong to.\n# oidc.groups.claim=groups\n```\nReplace `groups` with the actual claim name provided by your OpenID Connect provider.\n1. If your OpenID Connect provider sends group memberships as a single value attribute delimited by a specific character (e.g., a comma), configure the `oidc.groups.separator` property with the appropriate character:\n```java\n#-# If the identity provider returns group memberships as a single value attribute delimited with a char, for example:\n# oidc.groups.separator=,\n```\nReplace the comma with the actual separator used by your provider.\n1. If you want to map the synchronized groups to specific XWiki groups, configure the `oidc.groups.mapping` property with the appropriate mappings:\n```java\n# oidc.groups.mapping=XWiki.\"MyXWikiGroup\"=group1\n# oidc.groups.mapping=XWiki.\"MyXWikiGroup2\"=group2\n```\nReplace `MyXWikiGroup` and `MyXWikiGroup2` with the names of the XWiki groups you want to map, and `group1` and `group2` with the actual group names provided by your OpenID Connect provider.\n1. Save the `xwiki.properties` file and restart your XWiki instance for the changes to take effect.",
  "ai_answer": "Sources: https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/ \n\n\nTo configure group synchronization between XWiki and your OpenID Connect provider, follow these steps:\n\n1. **Enable Group Synchronization**:\n   - Add the claim that represents the groups a user belongs to in your OpenID Connect provider to the `oidc.userinfoclaims` property in the `xwiki.properties` file. For example, if the claim is called `xwiki_groups`, you would set it like this:\n     ```properties\n     oidc.userinfoclaims=xwiki_groups\n     ```\n\n2. **Configure Group Claims**:\n   - Specify the claim that contains the group information using the `oidc.groups.claim` property. By default, this is set to `xwiki_groups`, but you can change it if your provider uses a different name:\n     ```properties\n     oidc.groups.claim=xwiki_groups  # or your custom claim\n     ```\n\n3. **Map Groups**:\n   - If the group names in your OpenID Connect provider differ from the group names in XWiki, you need to define mappings. Use the `oidc.groups.mapping` property to set these mappings. For example:\n     ```properties\n     oidc.groups.mapping=MyXWikiGroup=my-oidc-group\n     oidc.groups.mapping=MyXWikiGroup2=my-oidc-group2\n     ```\n   - This allows you to specify which XWiki groups correspond to the groups provided by your OpenID provider.\n\n4. **Optional Configuration**:\n   - If the group memberships are returned as a single value attribute (e.g., a comma-separated list), you can specify the separator using the `oidc.groups.separator` property. If the provider returns them as a multi-valued attribute, this step is not necessary.\n\n5. **Testing the Configuration**:\n   - After configuring these properties, test the authentication process to ensure that users are assigned to the correct XWiki groups based on their OpenID Connect provider group memberships.\n\n6. **Custom Implementations**:\n   - If you need custom behavior, consider implementing a listener. This allows you to execute additional logic during the user profile update process.\n\nBy following these steps, you should be able to successfully synchronize groups between your OpenID Connect provider and XWiki. Make sure to consult the XWiki documentation for any specific details or updates related to your version.",
  "sources": [
    {
      "collection_id": "Eval",
      "document_id": "extensions:Extension.OpenID Connect.OpenID Connect Authenticator.WebHome",
      "url": "https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/",
      "content": "# oidc.groups.mapping=MyXWikiGroup2=my-oidc-group3  \n  \n#-# The groups the user need to belong to be allowed to authenticate.  \n#-# Not taken into account if not set or empty.  \n#-#\u00a0  \n# oidc.groups.allowed=  \n  \n#-# If the user belong to one of these groups it won&#x27;t be allowed to authenticate  \n#-# Not taken into account if not set or empty.  \n#-#\u00a0  \n# oidc.groups.forbidden=  \n  \n#-# If set, only group names with this prefix will be provisioned  \n#-# Not taken into account if not set or empty.  \n#-#\u00a0  \n# oidc.groups.prefix=  \n  \n#-# If the identity provider returns group memberships as a single value attribute delimited with a char, for example:  \n#-# {  \n#-# \u00a0\u00a0&quot;sub&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;248289761001&quot;,  \n#-# \u00a0\u00a0&quot;name&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;Jane Doe&quot;,  \n#-# \u00a0\u00a0&quot;given\\_name&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;Jane&quot;,  \n#-# \u00a0\u00a0&quot;family\\_name&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;Doe&quot;,  \n#-# \u00a0\u00a0&quot;preferred\\_username&quot; : &quot;j.doe&quot;,  \n#-# \u00a0\u00a0&quot;email&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;[[email\u00a0protected]](https://extensions.xwiki.org/cdn-cgi/l/email-protection)&quot;,  \n#-# \u00a0\u00a0&quot;picture&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;http://example.com/janedoe/me.jpg&quot;,  \n#-# \u00a0\u00a0&quot;groups&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;group1,group2&quot;  \n#-# }  \n#-# you can set here the separator char to get the list of groups the user belong to.\u00a0  \n#-# If not set, group memberships are evaluated as a multi valued attribute.  \n#-#\u00a0  \n# oidc.groups.separator=  \n  \n#-# The custom claims to request to the provider for the UserInfo  \n#-#\u00a0  \n#-# The available custom claims are:  \n#-# xwiki\\_groups (or whatever you indicated in oidc.groups.claim): the groups a user belong to in the provider (see &quot;Group synchronization&quot; section for more details)  \n#-# xwiki\\_user\\_&lt;fieldname&gt;: the suffix to use to request any field in the user profile document (generally when the provider is XWiki)\u00a0  \n#-# The default is:  \n",
      "similarity_score": 26.024879455566406,
      "vector": null
    },
    {
      "collection_id": "Eval",
      "document_id": "extensions:Extension.OpenID Connect.OpenID Connect Authenticator.WebHome",
      "url": "https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/",
      "content": "# Group synchronization\n\nThe default group synchronization is enabled by adding the claim xwiki\\_groups to the property oidc.userinfoclaims in the xwiki.properties file.\n\nBy default this synchronization expect to receive the list of group names (without the `wiki:XWiki.` prefix) in which the user should be placed (groups are automatically created when they don&#x27;t exist). You can also define a mapping between the XWiki groups and the provider groups using oidc.groups.mapping property.\n\nIt&#x27;s also possible to implement your own custom group synchronization in a listener. See [Listeners section](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/#HListeners).\n\n# Customization\n\n## Templates\n\nThe authenticator uses a template to ask the user for the target provider when it&#x27;s not provided in the configuration. This template can be overwritten through the standard [template system](https://extensions.xwiki.org/xwiki/bin/view/Extension/Template%20Module).\n\nThe name of the template is oidc/client/provider.vm.\n\n## Listeners\n\nIt&#x27;s possible to implement an event [listener](https://extensions.xwiki.org/xwiki/bin/view/Extension/Observation%20Module%20Local) and be notified during user profile update to add more to this process or do other things after it:\n\n* org.xwiki.contrib.oidc.event.OIDCUserUpdating to modify the user profile before it being saved\n* org.xwiki.contrib.oidc.event.OIDCUserUpdated to do something after the user profile has been saved\n\n# Troubleshooting\n\n## Enable DEBUG log\n\nSee [Logging Admin Guide](https://xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Logging).\n\nThe specific packages to track for OpenID Connect module is org.xwiki.contrib.oidc. There is several ways to enable debug log.\n\n",
      "similarity_score": 0.9211481809616089,
      "vector": null
    },
    {
      "collection_id": "Eval",
      "document_id": "extensions:Extension.OpenID Connect.OpenID Connect Authenticator.WebHome",
      "url": "https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/",
      "content": "* [Prerequisites &amp; Installation Instructions](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/#HPrerequisites26InstallationInstructions)\n* [Dependencies](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/#HDependencies)\n# Description\n\nAllow an XWiki instance to authenticate on an OpenId Connect provider. It also performs automatic synchronization.\n\nSee also [OpenID Connect Provider](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Provider/).\n\n![oidc_client_provider.png](https://extensions.xwiki.org/xwiki/bin/download/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/WebHome/oidc_client_provider.png?rev=1.1)\n\nRelease notes can be found on [OpenID Connect project page](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/#HReleaseNotes).\n\n# Main limitations\n\n* [Automatically authenticate user when coming back](https://jira.xwiki.org/browse/OIDC-16)\n\n# Configuration\n\n## Configuration Guides for specific systems\n\n### Lemon LDAP / Open PAAS\n\nA [configuration guide](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/ConfigurationLemonLDAP/) is available to connect XWiki to LemonLDAP / OpenPAAS using the OpenIDC XWiki client.\n\n### OpenID Authentication with Keycloak\n\nA [configuration example for Keycloak](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/OpenID%20Authentication%20with%20Keycloak/) is available.\n\n### Univention Corporate Server\n\nA [configuration example for Univention Corporate Server (UCS)](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/OpenID%20Authentication%20with%20UCS/) is available.\n\n## Configuration files\n\n### xwiki.cfg\n\n",
      "similarity_score": 0.8954618573188782,
      "vector": null
    },
    {
      "collection_id": "Eval",
      "document_id": "extensions:Extension.OpenID Connect.OpenID Connect Authenticator.WebHome",
      "url": "https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/",
      "content": "#-# The authentication management class.  \nxwiki.authentication.authclass=org.xwiki.contrib.oidc.auth.OIDCAuthServiceImpl### xwiki.properties\n\n#-# The base URL of the OpenId Connect Provider to use as starting point to discover the provider configuration.  \n#-# See following endpoints properties if the provider is does not support OpenID Connect discovery.  \n#-# If not indicated and not custom endpoint is provided, it will be asked to the user.  \n# oidc.provider=https://xwikiorg-node1.xwikisas.com/xwiki/oidc  \n  \n#-# The generic OpenId Connect endpoints to use to communicate with the provider.  \n#-# It&#x27;s generally not needed when providing the provider discovery endpoint (which is supposed to provide those enpoints).  \n# oidc.endpoint.authorization=https://xwikiorg-node1.xwikisas.com/xwiki/oidc/authorization  \n# oidc.endpoint.token=https://xwikiorg-node1.xwikisas.com/xwiki/oidc/token  \n# oidc.endpoint.userinfo=https://xwikiorg-node1.xwikisas.com/xwiki/oidc/userinfo  \n# oidc.endpoint.logout=https://xwikiorg-node1.xwikisas.com/xwiki/oidc/logout  \n  \n#-# It&#x27;s possible to add custom HTTP headers to the endpoint (generally only needed for bad or non-oidc providers)  \n#-# by adding the suffix &quot;.headers&quot; to the endpoint property key and listing the custom headers using key:value format.  \n#-# Note that it&#x27;s not taken into account for the oidc.endpoint.authorization endpoint because it&#x27;s used as a redirect.  \n#-# Here is an example to send &quot;Accept: application/json&quot; and &quot;SomeOtherHeader: header&quot; HTTP headers with the userinfo request.  \n# oidc.endpoint.userinfo.headers=Accept:application/json  \n# oidc.endpoint.userinfo.headers=SomeOtherHeader:header value  \n  \n#-# The scopes to use when redirecting to the provider  \n#-# The standard OpenID Connection scopes are:  \n#-# \\* openid: Informs the authorisation server that the client is making an OpenID Connect request (REQUIRED).  \n",
      "similarity_score": 0.8440494537353516,
      "vector": null
    },
    {
      "collection_id": "Eval",
      "document_id": "extensions:Extension.OpenID Connect.OpenID Connect Authenticator.WebHome",
      "url": "https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/",
      "content": "# Dependencies\n\nDependencies for this extension (org.xwiki.contrib.oidc:oidc-authenticator 2.8.6):\n\n* org.xwiki.platform:xwiki-platform-oldcore 14.10\n* com.nimbusds:oauth2-oidc-sdk 11.10.1\n* [org.xwiki.contrib.oidc:oidc-provider](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Provider/) 2.8.6\n* org.xwiki.contrib.oidc:oidc-authenticator-configuration 2.8.6\n* org.xwiki.contrib.oidc:oidc-authenticator-user 2.8.6\n\n\n",
      "similarity_score": 0.8377125263214111,
      "vector": null
    },
    {
      "collection_id": "Eval",
      "document_id": "extensions:Extension.OpenID Connect.OpenID Connect Authenticator.WebHome",
      "url": "https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/",
      "content": "#-# The default is (user profiles are viewable by all users by default and it&#x27;s possible to edit one own&#x27;s profile):  \n# oidc.user.oidc.user.ownProfileRights=edit  \n  \n#-# The custom claims to request to the provider for id token.  \n#-#  \n#-# The default is:  \n# oidc.idtokenclaims=xwiki\\_instance\\_id  \n  \n#-# The name of the claim used to get the list of groups the user belong to.  \n#-# This claim also need to be listed in oidc.userinfoclaims which control if group membership synchronization is enabled or not.  \n#-#\u00a0  \n#-# It&#x27;s also possible to use a custom property from the userinfo JSON.  \n#-# For example if the provider send the following JSON for the user info:  \n#-# {  \n#-# \u00a0\u00a0&quot;sub&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;248289761001&quot;,  \n#-# \u00a0\u00a0&quot;name&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;Jane Doe&quot;,  \n#-# \u00a0\u00a0&quot;given\\_name&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;Jane&quot;,  \n#-# \u00a0\u00a0&quot;family\\_name&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;Doe&quot;,  \n#-# \u00a0\u00a0&quot;preferred\\_username&quot; : &quot;j.doe&quot;,  \n#-# \u00a0\u00a0&quot;email&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;[[email\u00a0protected]](https://extensions.xwiki.org/cdn-cgi/l/email-protection)&quot;,  \n#-# \u00a0\u00a0&quot;picture&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0: &quot;http://example.com/janedoe/me.jpg&quot;  \n#-# \u00a0\u00a0&quot;customobject&quot; \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0:  \n#-# \u00a0\u00a0{  \n#-# \u00a0\u00a0\u00a0\u00a0&quot;customgroups&quot; \u00a0\u00a0: \u00a0[&quot;group1&quot;, &quot;group2&quot;]  \n#-# \u00a0\u00a0}  \n#-# }  \n#-# you can use:  \n# oidc.groups.claim=customobject.customgroups  \n#-#\u00a0  \n#-# The default is:  \n# oidc.groups.claim=xwiki\\_groups  \n  \n#-# Receiving a groups list is enough to enable group synchronization but you might need to configure XWiki groups names different from the remote groups names.  \n#-# It&#x27;s also required to indicate what&#x27;s the field containing the list of groups (that&#x27;s not an OpenID Connect standard) using oidc.groups.claim property.  \n#-#\u00a0  \n# oidc.groups.mapping=MyXWikiGroup=my-oidc-group  \n# oidc.groups.mapping=MyXWikiGroup2=my-oidc-group2  \n",
      "similarity_score": 0.8206441402435303,
      "vector": null
    }
  ],
  "usage": {
    "prompt_tokens": 3081,
    "completion_tokens": 474,
    "total_tokens": 3555
  },
  "average_power_draw": null,
  "energy_consumption": null,
  "energy_per_input_token": null,
  "energy_per_output_token": null,
  "energy_per_total_token": null
}