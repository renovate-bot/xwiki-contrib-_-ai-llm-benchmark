{
  "id": "qa_026",
  "prompt": "Puis-je personnaliser les champs de profil utilisateur qui sont remplis \u00e0 partir du fournisseur OpenID Connect dans XWiki?\nJe souhaite mapper des champs de profil utilisateur suppl\u00e9mentaires de mon fournisseur OpenID Connect aux propri\u00e9t\u00e9s de l'utilisateur XWiki. Comment puis-je y parvenir?",
  "expected_answer": "Oui, vous pouvez personnaliser les champs de profil utilisateur qui sont remplis \u00e0 partir du fournisseur OpenID Connect en les mappant dans le fichier `xwiki.properties`.\n\nPour mapper des champs de profil utilisateur suppl\u00e9mentaires, utilisez la propri\u00e9t\u00e9 `oidc.user.mapping`. Voici un exemple de la fa\u00e7on de mapper des propri\u00e9t\u00e9s personnalis\u00e9es:\n\n```\n# oidc.user.mapping=myxproperty1=${oidc.user.subject}\n# oidc.user.mapping=myxproperty2=myprefix-${oidc.user.subject}\n```\n\nRemplacez `myxproperty1` et `myxproperty2` par les noms de propri\u00e9t\u00e9 d'utilisateur XWiki r\u00e9els, et `${oidc.user.subject}` par la variable appropri\u00e9e en fonction des donn\u00e9es fournies par votre fournisseur OpenID Connect.\n\nApr\u00e8s avoir configur\u00e9 les mappages, enregistrez le fichier `xwiki.properties` et red\u00e9marrez XWiki pour appliquer les modifications.",
  "ai_answer": "https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/XWikiRESTfulAPI \nhttps://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/ \nhttps://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/XWikiSyntax/ \nhttps://extensions.xwiki.org/xwiki/bin/view/Extension/Model/Validation/UI/ \n\n\nOui, il est possible d'\u00e9tendre les champs du profil de l\u2019identifiant ouvert (OpenID) dans XWiki et de mapper des champs de profil utilisateur suppl\u00e9mentaires \u00e0 partir du fournisseur OpenID Connect. Pour ce faire, vous pouvez suivre ces \u00e9tapes :\n\n1. D\u00e9finissez le champ au niveau d\u2019utilisateurs (Profile Fields)\u00a0: XWiki vous permet de d\u00e9finir des champs personnalis\u00e9s dans la table \u00ab\u00a0users_fields\u00a0\u00bb \u00e0 l'aide du serveur SQL ou directement via les API RESTful, par exemple avec une requ\u00eate CURL :\n```sql\nINSERT INTO users_fields (username, fieldName) VALUES ('johndoe', 'address'); \n```\nLors de la cr\u00e9ation d'un profil utilisateur pour \u00ab\u00a0john@domain.tld\u00a0\u00bb, ces champs personnalis\u00e9s sont ajout\u00e9s et remplis \u00e0 partir des donn\u00e9es de fichiers JSON fourni par le fournisseur OpenID Connect si un champ avec ce nom existe dans le tableau \u00ab\u00a0identifiants_openid\u00a0\u00bb.\n2. Utiliseer XWiki User Editor API RESTful : pour remplir ces champs personnalis\u00e9s en cas de connexion ouvrez une session (si n\u00e9cessaire) et utilisez l'API user editor suivant, par exemple avec la commande CURL: \n```bash\ncurl -k https://myXwiki.com/ui/ws/usereditor --data-urlencode 'edit=true&username=johndoe&profileFields[address]=12345 Street'\n```\nDans ce cas, le champ \u00ab\u00a0address\u00a0\u00bb est rempli avec la valeur fournie (ici \u00ab\u00a012\u02c8Address Street\u2019) pour l'utilisateur nomm\u00e9 \u00ab\u00a0john@domain.tld\u00a0\u00bb. Notez que les champs ne sont modifiables qu\u2019au cours de l\u2019initialisation de profil utilisateur, sinon ils apparaissent comme des variables statiques dans le fichier JSON du serveur OAuth2, qui peuvent \u00eatre vus par tous lors d'une nouvelle connexion avec \u00ab\u00a0openid_connect=true\u201d.\n3. Extraire et utiliser les informations personnalis\u00e9es : apr\u00e8s avoir rempli un profil utilisateur, vous pouvez acc\u00e9der \u00e0 ces champs personnalis\u00e9s via des API RESTful (par exemple /rest/services/users) ou au niveau du code pour votre plugin de session XWiki\u00a0:\n'''java\nString address = String.valueOf(session.getUser().getUserFieldValue(\"address\"));\n'''\n4. D\u00e9signer la propri\u00e9t\u00e9 : il est possible d'assigner ces champs personnalis\u00e9s \u00e0 des propri\u00e9t\u00e9s Xwiki en utilisant le tableau \u00ab\u00a0user_field_to_properties\u00a0\u00bb, qui est g\u00e9r\u00e9 au niveau du code, par exemple avec l\u2019annotation @Property dans votre plugin de session. Par exemple:\n'''java\n@Property(key = \"address\")\npublic String getAddress() {\n    return userFieldValue(\"adresse\");\n}\n'''\nDans cet exemple, la propri\u00e9t\u00e9 \u00ab\u00a0address\u00a0\u00bb est mapp\u00e9e sur le champ personnalis\u00e9 du fournisseur OpenID Connect et peut \u00eatre utilis\u00e9e dans les profils de pages XWiki.\nEn suivant ces \u00e9tapes, vous pouvez ajouter des champs suppl\u00e9mentaires au niveau du profil utilisateur via la table \u00ab\u00a0users_fields\u00a0\u00bb en fonction d'informations personnalis\u00e9es provenant du fournisseur OpenID Connect et mapper ces champs \u00e0 partir du fournisseur dans XWiki.",
  "sources": [
    {
      "collection_id": "Eval",
      "document_id": "xwiki:Documentation.UserGuide.Features.XWikiRESTfulAPI",
      "url": "https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/XWikiRESTfulAPI",
      "content": "* **HTTP BASIC Auth**: You provide your credentials using the Authorization HTTP header\n* **XWiki session**: If you are logged in XWiki and you use the cookies provided by the authentication mechanism, you will also be authenticated to the XWiki RESTful API. This is useful, for example, when you are interacting with the API using the XMLHttpRequest object of a browser using Javascript.\n* **Custom authentication methods:** if you have setup a custom authenticator on your wiki (such as [OIDC](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/), or [Trusted authentication](https://extensions.xwiki.org/xwiki/bin/view/Extension/Trusted%20authentication%20framework) or even your own custom ones), additional authentication methods may be available for the RESTful API, provided by these authenticators.\n\nIf you don&#x27;t provide any credentials the XWiki RESTful API will recognize you as a XWiki.Guest user.\n\nSo if you have, let&#x27;s say a Main.PrivatePage, and you try to do:\u00a0\n\n$ curl -v http://localhost:8080/xwiki/rest/wikis/xwiki/spaces/Main/pages/PrivatePage  \n...  \n&lt; HTTP/1.1 401 Unauthorized  \n...You will get an Unauthorized empty response.\n\nOn the contrary, by specifying Admin credentials you gain access to the actual page:\n\n$ curl -u Admin:admin http://localhost:8080/xwiki/rest/wikis/xwiki/spaces/Main/pages/PrivatePage  \n  \n&lt;page xmlns=&quot;http://www.xwiki.org&quot;&gt;  \n &lt;link rel=&quot;http://www.xwiki.org/rel/space&quot; href=&quot;http://localhost:8080/xwiki/rest/wikis/xwiki/spaces/Main&quot;/&gt;  \n\u00a0...  \n &lt;content&gt;Only admin can see this&lt;/content&gt;  \n&lt;/page&gt;### CSRF Token\n\n",
      "similarity_score": 0.7180049419403076,
      "vector": null
    },
    {
      "collection_id": "Eval",
      "document_id": "extensions:Extension.OpenID Connect.OpenID Connect Authenticator.WebHome",
      "url": "https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/",
      "content": "\n\n\n| openid_connect_16x16.png | **Allow an XWiki instance to authenticate on an OpenID Connect provider** |\n| --- | --- |\n\n**Recommended**\n\n| Type | JAR |\n| --- | --- |\n| Category | Authenticator |\n| Developed by | [Thomas Mortagne](https://xwiki.org/xwiki/bin/view/XWiki/ThomasMortagne) |\n| Active Installs | 146 |\n| Rating | *  * [1](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/ &quot;Poor&quot;) * [2](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/ &quot;Satisfactory&quot;) * [3](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/ &quot;Good&quot;) * [4](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/ &quot;Very good&quot;) * [5](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/ &quot;Excellent&quot;)    1\u00a0Votes |\n| License | GNU Lesser General Public License 2.1 |\n\n\n\n| Compatibility | XWiki 14.10+ is required. |\n| --- | --- |\n\n**Installable with the Extension Manager**\n\n[Download v2.8.6](https://extensions.xwiki.org/xwiki/rest/repository/extensions/org.xwiki.contrib.oidc%3Aoidc-authenticator/versions/2.8.6/file?rid=maven-xwiki)[Sources](https://github.com/xwiki-contrib/oidc/tree/master/oidc-authenticator)[Issues](https://jira.xwiki.org/browse/OIDC)\n\nTable of contents\n\n",
      "similarity_score": 0.7141050100326538,
      "vector": null
    },
    {
      "collection_id": "Eval",
      "document_id": "extensions:Extension.OpenID Connect.OpenID Connect Authenticator.WebHome",
      "url": "https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/",
      "content": "#-# The authentication management class.  \nxwiki.authentication.authclass=org.xwiki.contrib.oidc.auth.OIDCAuthServiceImpl### xwiki.properties\n\n#-# The base URL of the OpenId Connect Provider to use as starting point to discover the provider configuration.  \n#-# See following endpoints properties if the provider is does not support OpenID Connect discovery.  \n#-# If not indicated and not custom endpoint is provided, it will be asked to the user.  \n# oidc.provider=https://xwikiorg-node1.xwikisas.com/xwiki/oidc  \n  \n#-# The generic OpenId Connect endpoints to use to communicate with the provider.  \n#-# It&#x27;s generally not needed when providing the provider discovery endpoint (which is supposed to provide those enpoints).  \n# oidc.endpoint.authorization=https://xwikiorg-node1.xwikisas.com/xwiki/oidc/authorization  \n# oidc.endpoint.token=https://xwikiorg-node1.xwikisas.com/xwiki/oidc/token  \n# oidc.endpoint.userinfo=https://xwikiorg-node1.xwikisas.com/xwiki/oidc/userinfo  \n# oidc.endpoint.logout=https://xwikiorg-node1.xwikisas.com/xwiki/oidc/logout  \n  \n#-# It&#x27;s possible to add custom HTTP headers to the endpoint (generally only needed for bad or non-oidc providers)  \n#-# by adding the suffix &quot;.headers&quot; to the endpoint property key and listing the custom headers using key:value format.  \n#-# Note that it&#x27;s not taken into account for the oidc.endpoint.authorization endpoint because it&#x27;s used as a redirect.  \n#-# Here is an example to send &quot;Accept: application/json&quot; and &quot;SomeOtherHeader: header&quot; HTTP headers with the userinfo request.  \n# oidc.endpoint.userinfo.headers=Accept:application/json  \n# oidc.endpoint.userinfo.headers=SomeOtherHeader:header value  \n  \n#-# The scopes to use when redirecting to the provider  \n#-# The standard OpenID Connection scopes are:  \n#-# \\* openid: Informs the authorisation server that the client is making an OpenID Connect request (REQUIRED).  \n",
      "similarity_score": 0.7084987759590149,
      "vector": null
    },
    {
      "collection_id": "Eval",
      "document_id": "xwiki:Documentation.UserGuide.Features.XWikiSyntax.WebHome",
      "url": "https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/XWikiSyntax/",
      "content": "\t\t- **doc:** An optional string identifying the resource as an XWiki terminal page. A non-terminal page can also be referenced this way, but it must append its .WebHome part (e.g. doc:Sandbox.WebHome).\n\t\t- **wikiName**: An optional string containing the name of a wiki. The link will point to a page inside that wiki. If no wiki is specified, the current wiki is used. Example: mywiki.\n\t\t- **spaceNameList**: An optional dot-separated list of wiki Space names. If no space is specified the current space is used. Examples: Main, A.B, A.B.C\n\t\t- **documentName**: A required string containing the name of the linked wiki page. Example: Welcome\n\t+ **Wiki space**: A reference in the form **space:[(wikiName):](spaceNameList)**. Examples: space:Main, space:mywiki:Main, space:A.B.C\n\t\t- **space:** A required string identifying the resource as an XWiki non-terminal page (i.e. a space).\n\t\t- **wikiName**: An optional string containing the name of a wiki. The link will point to a page inside that wiki. If no wiki is specified, the current wiki is used. Example: mywiki\n\t\t- **spaceNameList**: A required list of dot-separated wiki Space names pointing to the final linked wiki Space (or non-terminal page). Examples: Main, A.B, A.B.C\n\t+ **InterWiki page**: A reference in the form **interwiki:[(interWikiAlias):](pageName)**. Example: interwiki:wikipedia:XWiki\n\t\t- **interwiki:** A required string identifying the resource as an InterWiki link.\n\t\t- **interWikiAlias**: An optional [Inter Wiki](https://en.wikipedia.org/wiki/InterWiki) alias as defined in the InterWiki Map (see the [Admin Guide](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/)). Example: wikipedia\n\t\t- **pageName**: A required string containing the name of the linked page. Example: XWiki\n\t+ **Attachment**: A reference in the form **attach:{{{(wikiName):}(spaceNameList).}(pageName)@}(imageName)**\n\t\t- **attach:** A required string identifying the reference as an XWiki Document attachment.\n",
      "similarity_score": 0.7081129550933838,
      "vector": null
    },
    {
      "collection_id": "Eval",
      "document_id": "extensions:Extension.Model.Validation.UI.WebHome",
      "url": "https://extensions.xwiki.org/xwiki/bin/view/Extension/Model/Validation/UI/",
      "content": "## Current Naming Strategy\n\n\u00a0\n\nYou can select there which name strategy you want to use for the whole wiki.  \nThe different strategies available in XWiki are detailed in [the dedicated section](https://extensions.xwiki.org/xwiki/bin/view/Extension/Model/Validation/UI/#HExistingStrategies).  \nNote that if you don&#x27;t want to use any strategy, you can just disable the two following values to not use transformation or validation.  \nBy default the [Character Replacement Strategy](https://extensions.xwiki.org/xwiki/bin/view/Extension/Model/Validation/UI/#HCharacterReplacementStrategy) is selected.\n\n## Transform Names Automatically\n\n\u00a0\n\nThis option allows you to automatically transform the page names before they are created, in order to comply with the selected strategy.  \nNote that only the page names will be transformed: the page titles will remain untouched.   \nBy default this option is enabled.\n\n## Validate Names Before Saving\n\nThis option allows you to automatically validate a page name when it is created: if the page is not valid, the user will get an error and will be asked to use another name.  \nNote that this concerns the whole path of the page: not only its name, but also the name of its parents.  \nThis validation check is only perform when creating new pages, so even if you enable it you should be able to edit existing documents that don&#x27;t comply with the naming strategy.  \nNevertheless, this feature is still experimental, so it is disabled by default.\n\n## Test the Strategy you selected\n\n\u00a0\n\nThis text input allows you to type any text to check how the name strategy will behave: it will show you if a potential name is valid or not with the currently selected strategy, and how the strategy would transform the names. You don&#x27;t need to save for performing the tests, so you can easily change the strategy and validate it before saving.\u00a0\n\n",
      "similarity_score": 0.7061424255371094,
      "vector": null
    }
  ],
  "usage": {
    "prompt_tokens": 89,
    "completion_tokens": 807,
    "total_tokens": 896
  },
  "average_power_draw": 255.3099096238397,
  "energy_consumption": 2509.855629681054,
  "energy_per_input_token": 1.1914814287591045,
  "energy_per_output_token": 2.9787035718977615,
  "energy_per_total_token": 2.8011781581261763
}