{"id": "dev:IRC.xwikiArchive20110117", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20110117", "title": "IRC Archive for channel #xwiki - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n00:16\u00a0<lpereira>\u00a0has quit  \n01:17\u00a0<Enygma`>\u00a0has quit  \n02:47\u00a0<abusenius>\u00a0has quit  \n03:17\u00a0<SvenDowideit\\_>\u00a0has quit  \n03:17\u00a0<SvenDowideit\\_>\u00a0has joined #xwiki  \n03:17\u00a0<SvenDowideit\\_>\u00a0is now known as <SvenDowideit>  \n05:45\u00a0<venkatna>\u00a0has joined #xwiki  \n05:45\u00a0<venkatna>\u00a0has quit  \n05:45\u00a0<venkatna>\u00a0has joined #xwiki  \n06:24\u00a0<vmassol>\u00a0has joined #xwiki  \n06:30\u00a0<mflorea>\u00a0has joined #xwiki  \n07:54\u00a0<vmassol>\u00a0has quit  \n07:56\u00a0<vmassol>\u00a0has joined #xwiki  \n08:31\u00a0<vmassol>\u00a0has quit  \n08:32\u00a0<vmassol>\u00a0has joined #xwiki  \n08:40\u00a0<vmassol>\u00a0good morning everyone  \n08:40\u00a0<vmassol>\u00a0we have 71 tests failing on trunk and the 3.0M1 release is today\u2026. we need help from everyone to fix them asap: http://hudson.xwiki.org/view/Functional%20Tests/job/xwiki-product-enterprise-tests/lastBuild/testReport/  \n08:41\u00a0<vmassol>\u00a0I'm fixing the xhtml validity ones for the xwikisyntax page  \n08:50\u00a0<jstoldt>\u00a0has joined #xwiki  \n08:50\u00a0<jstoldt>\u00a0good morning :)  \n09:06\u00a0<sburjan>\u00a0has joined #xwiki  \n09:35\u00a0<arkub>\u00a0has joined #xwiki  \n09:43\u00a0<sdumitriu>\u00a0has joined #xwiki  \n09:43\u00a0<rstavro>\u00a0has joined #xwiki  \n10:12\u00a0<+sburjan>\u00a0sdumitriu: hello. Do you have idea at whet version \"Blog Categories\" was removed from XAADMINISTRATION ?  \n10:13\u00a0<@sdumitriu>\u00a0It never was  \n10:13\u00a0<+sburjan>\u00a0because I don't find it anywhere in the Administer Wiki page  \n10:19\u00a0<abusenius>\u00a0has joined #xwiki  \n10:21\u00a0<+sburjan>\u00a0sdumitriu: so I guess the UI moved to the Blog section, right ?  \n10:22\u00a0<@sdumitriu>\u00a0What are you talking about?  \n10:22\u00a0<@sdumitriu>\u00a0Oh  \n10:23\u00a0<@sdumitriu>\u00a0You mean there's no \"Blog Categories\" section in the administration?  \n10:23\u00a0<@sdumitriu>\u00a0That was a long time ago, IIRC  \n10:23\u00a0<+sburjan>\u00a0so it's not anymore (I need it for the Manual Testing plan .. testing and fixing stuff at the same time)  \n10:24\u00a0<+sburjan>\u00a0thank,s I'll remove it from Administer Wiki  \n10:28\u00a0<+sburjan>\u00a0ok.  \n10:28\u00a0<+sburjan>\u00a0starting to test on IE7 (the test machine is BSOD'ing and restarting from 30 to 30 minz, very annoying)  \n10:41\u00a0<@sdumitriu>\u00a0vmassol, mflorea: I don't think the trunk is release-quality today  \n10:42\u00a0<+mflorea>\u00a0sdumitriu: I need to fix 2 wysiwyg bugs before doing the release. what's the problem with the trunk?  \n10:42\u00a0<@sdumitriu>\u00a0Blog still not working  \n10:42\u00a0<+mflorea>\u00a0ok  \n10:43\u00a0<@sdumitriu>\u00a0I'd like XWIKI-5873 fixed  \n10:43\u00a0<@sdumitriu>\u00a0And I didn't have time to commit the new administration  \n10:44\u00a0<arkub>\u00a0has quit  \n10:44\u00a0<@sdumitriu>\u00a0Which I'd like to do before the release  \n10:44\u00a0<arkub>\u00a0has joined #xwiki  \n10:45\u00a0<@sdumitriu>\u00a0But we can start with the release notes  \n10:45\u00a0<@sdumitriu>\u00a0Those take a lot of time  \n10:46\u00a0<evalica>\u00a0has joined #xwiki  \n10:46\u00a0<+mflorea>\u00a0sdumitriu: ok, I'll finish with the wysiwyg and then start the paperwork :)  \n10:46\u00a0<@sdumitriu>\u00a0sburjan: You'll help as well, right?  \n10:46\u00a0<+sburjan>\u00a0I am testing on IE 7 ATM  \n10:47\u00a0<+sburjan>\u00a0http://incubator.myxwiki.org/xwiki/bin/view/Test/30snapshots here is what I've found so far  \n10:47\u00a0<arkub>\u00a0has quit  \n10:49\u00a0<Enygma`>\u00a0has joined #xwiki  \n10:50\u00a0<arkub>\u00a0has joined #xwiki  \n10:52\u00a0<arkub>\u00a0has quit  \n10:53\u00a0<arkub>\u00a0has joined #xwiki  \n10:53\u00a0<vmassol>\u00a0sdumitriu: re XWIKI-5873 I still don't understand what you mean regarding the security issue  \n10:54\u00a0<@sdumitriu>\u00a0Hm, isn't wiki syntax rendered if I put it in the document.title?  \n10:54\u00a0<vmassol>\u00a0what I don't understand is why it's ok to have scripts in the page but not when part of the page is used in the title  \n10:54\u00a0<vmassol>\u00a0no it's not  \n10:54\u00a0<vmassol>\u00a0(at least not right now)  \n10:55\u00a0<vmassol>\u00a0but even if it were I'd still not understand  \n10:55\u00a0<vmassol>\u00a0putting content in the title or in the doc's content requires the same right  \n10:55\u00a0<@sdumitriu>\u00a0vmassol: The problem is that I can have an URL like: http://host/xwiki/bin/Main/<script>alert(\"I got your cookies!\")</script>  \n10:56\u00a0<vmassol>\u00a0you can have this in the content of the page  \n10:56\u00a0<vmassol>\u00a0I'm talking about title not page name  \n10:57\u00a0<fmancinelli>\u00a0has joined #xwiki  \n10:58\u00a0<@sdumitriu>\u00a0Try opening http://localhost:8080/xwiki/bin/save/Main/%3Cscript%3Ealert%28%22I+got+your+cookies!%22%29%3C%2Fscript%3E  \n10:58\u00a0<@sdumitriu>\u00a0I'm talking about Document.getDisplayTitle  \n10:58\u00a0<vmassol>\u00a0what does this have to do with title?  \n10:58\u00a0<@sdumitriu>\u00a0I'm talking about Document.getDisplayTitle  \n10:59\u00a0<@sdumitriu>\u00a0Which doesn't care if that's in the title, in the content, or in the document name  \n10:59\u00a0<@sdumitriu>\u00a0It's all the same  \n10:59\u00a0<vmassol>\u00a0ah ok when no title can be extracted from the content  \n10:59\u00a0<@sdumitriu>\u00a0It ends up in the HTML  \n10:59\u00a0<vmassol>\u00a0you mean the fallback to the doc's name  \n10:59\u00a0<vmassol>\u00a0?  \n10:59\u00a0<@sdumitriu>\u00a0Yes  \n10:59\u00a0<@sdumitriu>\u00a0Read my last comment on the issue, does it seem doable?  \n11:00\u00a0<vmassol>\u00a0there's an if too much I think  \n11:00\u00a0<vmassol>\u00a0maybe not  \n11:00\u00a0<vmassol>\u00a0but I still don't get it  \n11:00\u00a0<fmancinelli>\u00a0has left #xwiki  \n11:01\u00a0<vmassol>\u00a0ah wait hmmm  \n11:01\u00a0<fmancinelli>\u00a0has joined #xwiki  \n11:01\u00a0<vmassol>\u00a0no I still don't get it  \n11:01\u00a0<vmassol>\u00a0view.vm is used to display the current docuemnt's view  \n11:01\u00a0<vmassol>\u00a0so you can have that url on the doc's content  \n11:01\u00a0<vmassol>\u00a0it doesn't make a difference  \n11:01\u00a0<@sdumitriu>\u00a0?  \n11:02\u00a0<vmassol>\u00a0I don't understand why there's a pb with the title and not with the content  \n11:02\u00a0<vmassol>\u00a0since they both require the same rigths to change  \n11:02\u00a0<vmassol>\u00a0and they're both rendered in the same vm (view.vm)  \n11:02\u00a0<vmassol>\u00a0next to each other  \n11:03\u00a0<vmassol>\u00a0I can create [[hello>>http://localhost:8080/xwiki/bin/save/Main/%3Cscript%3Ealert%28%22I+got+your+cookies!%22%29%3C%2Fscript%3E]] in my content (to take your ex)  \n11:03\u00a0<@sdumitriu>\u00a0?  \n11:03\u00a0<@sdumitriu>\u00a0What's with that link?  \n11:03\u00a0<vmassol>\u00a0i don't know  \n11:03\u00a0<vmassol>\u00a0that's the link you gave  \n11:03\u00a0<@sdumitriu>\u00a0Why do you want to put it in the content?  \n11:04\u00a0<vmassol>\u00a0no idea  \n11:04\u00a0<@sdumitriu>\u00a0I'm talking about a hacker trying to take over IBM's private wiki  \n11:04\u00a0<vmassol>\u00a0I'd simply want someone to explain this: \"I don't understand why there's a pb with the title and not with the content\"  \n11:04\u00a0<vmassol>\u00a0in a clear manner  \n11:04\u00a0<arkub>\u00a0has quit  \n11:04\u00a0<@sdumitriu>\u00a0He hacks an employee's IM account  \n11:04\u00a0<@sdumitriu>\u00a0Then he logs in with his IM account  \n11:04\u00a0<@sdumitriu>\u00a0And sends the boss a link:  \n11:05\u00a0<@sdumitriu>\u00a0hey boss, check this funny thing: http://sho.rt/jy3nhs  \n11:05\u00a0<@sdumitriu>\u00a0And that links points to a hacked URL  \n11:05\u00a0<@sdumitriu>\u00a0HE DIDN'T EDIT ANYTHING IN THE WIKI  \n11:05\u00a0<@sdumitriu>\u00a0He just composed an URL  \n11:06\u00a0<@sdumitriu>\u00a0And when the boss opens that URL, his cookies are sent to the attacker's site  \n11:06\u00a0<vmassol>\u00a0ok, I see now, so the if is jsut for the fallback  \n11:06\u00a0<@sdumitriu>\u00a0Through XSS  \n11:06\u00a0<vmassol>\u00a0not when geTitlle() returns something  \n11:06\u00a0<@sdumitriu>\u00a0Even getTitle can be hacked  \n11:06\u00a0<vmassol>\u00a0#if ($titleSource == $doc.title || $titleSource == $doc.name)  \n11:06\u00a0<vmassol>\u00a0should just be $titleSource == $doc.name  \n11:06\u00a0<arkub>\u00a0has joined #xwiki  \n11:06\u00a0<@sdumitriu>\u00a0Instead of /save/Space/fishy-doc-name, he uses /save/Space/Doc?title=fishy-title  \n11:07\u00a0<vmassol>\u00a0that works?  \n11:07\u00a0<@sdumitriu>\u00a0Yes  \n11:07\u00a0<arkub>\u00a0has quit  \n11:07\u00a0<arkub\\_>\u00a0has joined #xwiki  \n11:07\u00a0<arkub>\u00a0has joined #xwiki  \n11:07\u00a0<vmassol>\u00a0(works without edit rights I mean)  \n11:07\u00a0<arkub\\_>\u00a0has quit  \n11:07\u00a0<@sdumitriu>\u00a0The content is a bit more safe, since writing a plain <script> won't work (it's already escaped during rendering)  \n11:08\u00a0<@sdumitriu>\u00a0But it will still be open if I write ={{html clean=\"false\"}}<script...  \n11:08\u00a0<vmassol>\u00a0so should we simply not display the title for a non existing page  \n11:08\u00a0<vmassol>\u00a0?  \n11:09\u00a0<vmassol>\u00a0(and just use the page name)  \n11:09\u00a0<@sdumitriu>\u00a0Or =(% onerror=\"stealCookies()\" %)image:nothere.png=  \n11:09\u00a0<@sdumitriu>\u00a0Vincent, there's no workaround, the escape is needed  \n11:10\u00a0<@sdumitriu>\u00a0Why are you against it?  \n11:10\u00a0<@sdumitriu>\u00a0abusenius: You here?  \n11:10\u00a0<vmassol>\u00a0I'm against breaking things  \n11:10\u00a0<vmassol>\u00a0which is what was done before I reverted part of it  \n11:10\u00a0<@sdumitriu>\u00a0XSS is breaking serious things  \n11:10\u00a0<vmassol>\u00a0I'm not against anything  \n11:11\u00a0<vmassol>\u00a0I just wanted to understand  \n11:11\u00a0<vmassol>\u00a0now I understand a bit more, thanks for that  \n11:11\u00a0<jvelociter>\u00a0has joined #xwiki  \n11:11\u00a0<@sdumitriu>\u00a0I'd rather not allow wiki syntax in the title than let XSS in  \n11:11\u00a0<vmassol>\u00a0what seems to happen is that view.vm is dangerous for non existing pages  \n11:11\u00a0<@sdumitriu>\u00a0Why do you say non-existing?  \n11:11\u00a0<@sdumitriu>\u00a0/save/ creates the page  \n11:11\u00a0<vmassol>\u00a0sdumitriu: not really. Not without telling users you're voluntarily removing a feature  \n11:12\u00a0<vmassol>\u00a0what was done was putting something on the cartpet  \n11:12\u00a0<@sdumitriu>\u00a0And the boss has save rights  \n11:12\u00a0<vmassol>\u00a0hoping that nobody would notice it  \n11:12\u00a0<@sdumitriu>\u00a0Otherwise the attacker wouldn't send him that URL  \n11:13\u00a0<vmassol>\u00a0ah right re save, but if that's the case, the attacker can create anything  \n11:13\u00a0<vmassol>\u00a0using some REST call for ex  \n11:13\u00a0<vmassol>\u00a0if the boss has rights, then he can execute anything  \n11:13\u00a0<vmassol>\u00a0you can tell him \"take this snippet and copy paste it in a page, it's funny you'll see\"  \n11:16\u00a0<vmassol>\u00a0Personally I'm even fine if we say that we don't support generated titles from content anymore  \n11:16\u00a0<+abusenius>\u00a0sdumitriu: I'm here  \n11:16\u00a0<vmassol>\u00a0what I'm not fine is not discussing it nor putting it in the release notes  \n11:16\u00a0<@sdumitriu>\u00a0abusenius: Back me up  \n11:17\u00a0<+abusenius>\u00a0reading log...  \n11:19\u00a0<@sdumitriu>\u00a0There are two options  \n11:19\u00a0<@sdumitriu>\u00a0three  \n11:20\u00a0<@sdumitriu>\u00a01. We use the snippet I wrote, it protects against doc.title and doc.name, and there's a little protection against content, but lets wiki markup in the content  \n11:20\u00a0<@sdumitriu>\u00a02. We also render doc.title and doc.name (in doc.getRenderedTitle), which offers the same little protection everywhere  \n11:21\u00a0<vmassol>\u00a0(side note: I believe we'll need to allow wiki syntax in titles at some point)  \n11:21\u00a0<@sdumitriu>\u00a03. We use getPlainTitle even for the main title display, which offers real protection everywhere  \n11:21\u00a0<+abusenius>\u00a0I was thinking about option 2, this method does the right thing in some cases, so it's possible to fix the others  \n11:21\u00a0<vmassol>\u00a03 is a bit hard to do for dedupliction  \n11:22\u00a0<+abusenius>\u00a0sdumitriu, can you point me to the snippet you are talking about  \n11:22\u00a0<vmassol>\u00a0http://jira.xwiki.org/jira/browse/XWIKI-5873?focusedCommentId=57166&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action\\_57166  \n11:22\u00a0<+abusenius>\u00a0thx  \n11:23\u00a0<jvdrean>\u00a0has joined #xwiki  \n11:24\u00a0<+abusenius>\u00a0isn't it possible to \\*not\\* escape the output of getRenderedTitle() in that one problematic case?  \n11:24\u00a0<+abusenius>\u00a0and then escape in velocity  \n11:25\u00a0<+abusenius>\u00a0(I just don't like producing escaped html in Java in general because it is hard to know from the method name if it is escaped or not)  \n11:31\u00a0<@sdumitriu>\u00a0abusenius: WDYM not escape? Where not to escape, the escapetool.xml done in titlevars.vm?  \n11:31\u00a0<@sdumitriu>\u00a0Or the escape done in the renderer?  \n11:31\u00a0<+abusenius>\u00a0no, in Java, it is rendered in the way that the outcome is html-escaped  \n11:32\u00a0<+abusenius>\u00a0can't we use another renderer (HTML\\_4?) that does the same except escaping?  \n11:33\u00a0<@sdumitriu>\u00a0Are you sure it doesn't escape?  \n11:33\u00a0<@sdumitriu>\u00a0It should  \n11:33\u00a0<+abusenius>\u00a0let me try again (things still compiling)  \n11:35\u00a0<Denis>\u00a0has joined #xwiki  \n11:35\u00a0<+abusenius>\u00a0if I display $doc.displayTitle on 2 pages, where  \n11:35\u00a0<+abusenius>\u00a0on page1: no title, a heading with <script>  \n11:35\u00a0<rstavro>\u00a0has left #xwiki  \n11:36\u00a0<+abusenius>\u00a0on page2: title with <script>  \n11:36\u00a0<+abusenius>\u00a0then the output of $doc.displayTitle is different  \n11:36\u00a0<@sdumitriu>\u00a0Yes  \n11:36\u00a0<+abusenius>\u00a0which makes me think the JAva code sometimes escapes the title \u00a0and sometimes not  \n11:37\u00a0<@sdumitriu>\u00a0Yes  \n11:37\u00a0<@sdumitriu>\u00a0If the title comes from doc.title, it is not escaped  \n11:37\u00a0<@sdumitriu>\u00a0It is simply interpreted (velocity)  \n11:37\u00a0<@sdumitriu>\u00a0If the title comes from the content, it is fully rendered  \n11:38\u00a0<@sdumitriu>\u00a0The XHTML/1.0 output encodes special characters <>&  \n11:38\u00a0<+abusenius>\u00a0yes, in the code of getRenderedTitle it's the call to getRenderedContentTitlethat escapes  \n11:38\u00a0<+abusenius>\u00a0and 2 other cases do not  \n11:39\u00a0<+abusenius>\u00a0imo no matter how we fix this problem, at the end this method should either always escape or always not escape  \n11:40\u00a0<@sdumitriu>\u00a0+1  \n11:40\u00a0<mflorea>\u00a0has quit  \n11:41\u00a0<+abusenius>\u00a0so my question is, is there a renderer that renders XHTML/1.0 without HTML-escaping?  \n11:41\u00a0<@sdumitriu>\u00a0Nope  \n11:41\u00a0<+abusenius>\u00a0ok, well then we need to add escaping to the other 2 cases  \n11:42\u00a0<+abusenius>\u00a0the question is only, will it break something else? :)  \n11:44\u00a0<+abusenius>\u00a0I guess at least if syntax=PLAIN/1.0 it should be escaped  \n11:45\u00a0<@sdumitriu>\u00a0Indeed, that is a problem  \n11:45\u00a0<@sdumitriu>\u00a0Or not?  \n11:46\u00a0<fmancinelli>\u00a0has quit  \n11:47\u00a0<+abusenius>\u00a0well, the new getPlainTitle() uses this method with plain/1.0  \n11:47\u00a0<fmancinelli>\u00a0has joined #xwiki  \n11:47\u00a0<+abusenius>\u00a0for example  \n11:47\u00a0<+abusenius>\u00a0and returns unescaped stuff  \n11:47\u00a0<@sdumitriu>\u00a0And it doesn't seem to output any < or >  \n11:48\u00a0<@sdumitriu>\u00a0Let me check  \n11:48\u00a0<+abusenius>\u00a0hm, at least it is always used with escapetool around  \n11:50\u00a0<@sdumitriu>\u00a0Right, it doesn't escape  \n11:50\u00a0<+abusenius>\u00a0but yes, plain renderer seems to modify the output in some way  \n11:51\u00a0<@sdumitriu>\u00a0It removes stuff inside {{html}} completely  \n11:51\u00a0<@sdumitriu>\u00a0And removes wiki markup  \n11:52\u00a0<+fmancinelli>\u00a0cjdelisle, sdumitriu: I read the saturday's irc log where you were talking about nosql storages...  \n11:53\u00a0<+fmancinelli>\u00a0cjdelisle, sdumitriu: this is a very good timing because we are thinking about it  \n11:58\u00a0<+fmancinelli>\u00a0cjdelisle, sdumitriu: it would interesting to have more people helping us on this topic  \n11:59\u00a0<+abusenius>\u00a0brb  \n12:04\u00a0<@sdumitriu>\u00a0vmassol: So? What do you prefer?  \n12:05\u00a0<vmassol>\u00a0sdumitriu: between what? your 1, 2, 3 above or something else?  \n12:06\u00a0<@sdumitriu>\u00a0Yes  \n12:06\u00a0<@sdumitriu>\u00a02 has the advantage that it allows wiki content in the title  \n12:07\u00a0<@sdumitriu>\u00a0But I'm not sure how to keep parsing velocity in it  \n12:07\u00a0<@sdumitriu>\u00a0We could wrap doc.title in {{velocity}} automatically  \n12:07\u00a0<@sdumitriu>\u00a0Or make this a preference for backwards compatibility  \n12:11\u00a0<vmassol>\u00a0yes 2 requires some vote since it's an important behavior change. Yes the backward compat config is a good idea probably  \n12:11\u00a0<vmassol>\u00a01 is the easiest for the 3.0M1 release though  \n12:11\u00a0<vmassol>\u00a03 is fine for me if we find how to do deduplication  \n12:12\u00a0<@sdumitriu>\u00a0So, start a vote for 2, and I'll commit 1?  \n12:15\u00a0<arkub>\u00a0has quit  \n12:16\u00a0<arkub>\u00a0has joined #xwiki  \n12:16\u00a0<arkub>\u00a0has quit  \n12:17\u00a0<arkub>\u00a0has joined #xwiki  \n12:18\u00a0<arkub>\u00a0has quit  \n12:28\u00a0<vmassol>\u00a0sounds good  \n12:34\u00a0<@sdumitriu>\u00a0I found a bug in the xwiki/2.0 renderer  \n12:35\u00a0<@sdumitriu>\u00a0$doc.getRenderedContent('{{html wiki=false}}<b>a</b>{{/html}}', 'xwiki/2.0', 'xwiki/2.0') ends up as {{html wiki=false}}\\*\\*a\\*\\*{{/html}}  \n12:36\u00a0<@sdumitriu>\u00a0Or not?  \n12:36\u00a0<@sdumitriu>\u00a0Strange  \n12:36\u00a0<@sdumitriu>\u00a0Let me check when exactly this happens  \n12:37\u00a0<arkub>\u00a0has joined #xwiki  \n12:43\u00a0<sburjan>\u00a0has quit  \n12:54\u00a0<jstoldt>\u00a0is there anyone with some MS SQL Server 2008 experience?  \n12:55\u00a0<sburjan>\u00a0has joined #xwiki  \n12:55\u00a0<jstoldt>\u00a0because when trying to connect to the server on port 1433 (TCP) i get a connection error... despite having disabled the firewall  \n12:55\u00a0<jstoldt>\u00a0and on port 1434 i can't login  \n12:56\u00a0<@sdumitriu>\u00a0jvelociter: You could use #setVariable instead  \n12:56\u00a0<+jvelociter>\u00a0sdumitriu: ah yes ?  \n12:56\u00a0<+jvelociter>\u00a0it's a custom macro of ours ?  \n12:56\u00a0<@sdumitriu>\u00a0Yes  \n12:56\u00a0<@sdumitriu>\u00a0I think I did some commits with it  \n12:57\u00a0<@sdumitriu>\u00a0Yes, in ConfigurableClass  \n12:57\u00a0<@sdumitriu>\u00a0- \u00a0#set($hasAccess = $xwiki.hasAccessLevel('edit', $userToCheck, $currentDoc))  \n12:57\u00a0<@sdumitriu>\u00a0+ \u00a0#set ($hasAccess = $util.null)  \n12:57\u00a0<@sdumitriu>\u00a0+ \u00a0#setVariable (\"$hasAccess\" $xwiki.hasAccessLevel('edit', $userToCheck, $currentDoc))  \n12:58\u00a0<+jvelociter>\u00a0ok, I will change it  \n13:13\u00a0<mflorea>\u00a0has joined #xwiki  \n13:14\u00a0<jstoldt>\u00a0wow, is it normal that xwiki uses a lot more memory when using jetty? i just started a plain jetty hightide 7.2.2 with xwiki 2.7 running with a MS server and the memory usage went as high as almost 700 MB and now is at around 640 MB...  \n13:15\u00a0<jstoldt>\u00a0also, does anyone object if i rework http://platform.xwiki.org/xwiki/bin/view/AdminGuide/InstallationMSSQL  \n13:15\u00a0<jstoldt>\u00a0?  \n13:17\u00a0<vmassol>\u00a0jstoldt: go ahead  \n13:17\u00a0<jstoldt>\u00a0cool  \n13:19\u00a0<abusenius>\u00a0has quit  \n13:23\u00a0<jstoldt>\u00a0hmmm anyone got a clue how to use the Import Large XAR snippet on windows?  \n13:24\u00a0<jstoldt>\u00a0ah, i think the trick is just using / instead of \\ in the path \\*lol\\*  \n13:29\u00a0<@cjdelisle>\u00a0howdy folks.  \n13:30\u00a0<@cjdelisle>\u00a0FWIW I don't like this XSS escaping business.  \n13:30\u00a0<@cjdelisle>\u00a0It never ends.  \n13:30\u00a0<@cjdelisle>\u00a0\u00a0/preview/Nonexistent/Doc?content={{html}}<script>...  \n13:31\u00a0<@cjdelisle>\u00a0s/preview/save/  \n13:31\u00a0<@cjdelisle>\u00a0It's not generic.  \n13:31\u00a0<GillesSerasset>\u00a0has joined #xwiki  \n13:31\u00a0<jstoldt>\u00a0vmassol: i think we were talking about the XARDiff application a while ago. i just tested it on jetty as opposed to Tomcat (which I usually use). both on Win7, however. are you using, by any chance, Linux for your tests and might this be related to why it's not working for me here?  \n13:33\u00a0<vmassol>\u00a0jstoldt: I don't recall the XAR diff having anything specific for unix. I'm developing on mac (unix) fwiw  \n13:33\u00a0<@cjdelisle>\u00a0A while back I suggested adding a filter to the ServletOutputStream which trapped unauthorized script but that was nix'd.  \n13:33\u00a0<jstoldt>\u00a0but it works for you on an out of the box installation, right?  \n13:33\u00a0<vmassol>\u00a0jstoldt: no  \n13:33\u00a0<vmassol>\u00a0you need to change the URLs  \n13:33\u00a0<vmassol>\u00a0i haven't coded any UI for it  \n13:34\u00a0<@cjdelisle>\u00a0Only other (sane) option IMO is to just change our specifications to say that running script in the user's browser is ok.  \n13:34\u00a0<jstoldt>\u00a0yeah, i did that. attached two xar to XARDiff.Webhome and entered the according URLs  \n13:34\u00a0<jstoldt>\u00a0but it fails for me already on parsing the groovy pages  \n13:35\u00a0<jstoldt>\u00a0so even if i remove anything after the \".parseGroovyFromPage\" line i get a velocity error  \n13:37\u00a0<GillesSerasset>\u00a0jvdrean and jvelociter could you help me quickly on Meeting Manager App ?  \n13:38\u00a0<@cjdelisle>\u00a0fmancinelli: sdumitriu From what I read, nosql is a general idea rather than an implementation. Which software are you thinking of using? Also it's important to understand that changing the storage engine will break a lot of things IE search.  \n13:38\u00a0<GillesSerasset>\u00a0Meeting Manager is broken since xwiki 2.4 and I'd like to patch it  \n13:39\u00a0<GillesSerasset>\u00a0but I do not really understand the reason why it is broken...  \n13:39\u00a0<GillesSerasset>\u00a0it should be related to changes in the way velocity imports macro and executes imported macros  \n13:50\u00a0<+fmancinelli>\u00a0cjdelisle: personally I am aware that a nosql implementation implies a complete revision of the inner working of XWiki (i.e., no tables, map-reduce instead of joins, etc.). For the implementation maybe we would be constrained by java (i.e., choosing something with a java implementation like Cassandra or HBase, depending ), but there are other interesting non-java alternatives like CouchDB, Redis.  \n13:53\u00a0<+fmancinelli>\u00a0fmancinelli: The first step would be to understand what are our requirements and what we expect from such a kind of storage. A nice blog post about nosql database properties is here: http://blog.nahurst.com/visual-guide-to-nosql-systems?c=1 Yesterday I've also stumbled upon a tutorial on map-reduce that uses CouchDB (http://blog.cloudant.com/39351506) very interesting because a couchDB document can have attachments (i.e., it could be m  \n13:54\u00a0<@cjdelisle>\u00a0I like the way memcached and memcachedb is nothing more than a bit hash table.  \n13:54\u00a0<@cjdelisle>\u00a0\\*big hashtable  \n13:54\u00a0<@cjdelisle>\u00a0But searchDocuments is clearly out.  \n13:55\u00a0<@cjdelisle>\u00a0We have no evidence that XWQL will be compatable because it was only ever implemented on one storage system.  \n13:55\u00a0<@cjdelisle>\u00a0If you take away search then it's a big job but not impossible.  \n13:57\u00a0<@cjdelisle>\u00a0If search is required then it's a matter of either getting lucky and search working or not getting lucky and discovering that a month or 2 into the search implementation.  \n13:58\u00a0<+jvelociter>\u00a0GillesSerasset: which XE version are you trying against ?  \n13:58\u00a0<@cjdelisle>\u00a0And if it doesn't work, it could still be made to work but that will cause subtle (or maybe not so much) API breaks in the search function.  \n14:01\u00a0<lucaa>\u00a0has joined #xwiki  \n14:03\u00a0<venkatna>\u00a0has quit  \n14:04\u00a0<venkatna>\u00a0has joined #xwiki  \n14:06\u00a0<venkatna>\u00a0has quit  \n14:10\u00a0<+fmancinelli>\u00a0cjdelisle: it's sure that with nosql you won't be able to use searchDocuments as before. How to maintain the maximum compatibility for example mapping XWQL to map-reduce is a big challenge that needs to be investigated (I am not (yet) an expert here)  \n14:10\u00a0<GillesSerasset>\u00a0jvelociter: 2.4.30467 on our server, but incubator (XWIKI ENTERPRISE 2.6-SNAPSHOT.33157) shows exactly the same result  \n14:11\u00a0<+jvelociter>\u00a0GillesSerasset: I can send you a XAR that works  \n14:11\u00a0<GillesSerasset>\u00a0ok, thanks, [[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \n14:11\u00a0<+jvelociter>\u00a0unfortunately, I haven't really followed what are the changes needed to make it work  \n14:11\u00a0<+jvelociter>\u00a0so I can't merge it easily on the sources  \n14:12\u00a0<GillesSerasset>\u00a0I'll look at the diff as I patched MM app to add groups as participants  \n14:12\u00a0<GillesSerasset>\u00a0So I'll take care of it...  \n14:14\u00a0<@cjdelisle>\u00a0Making XWQL work is (in the worst case) a harder project than hibernate HQL.  \n14:15\u00a0<jvdrean>\u00a0has quit  \n14:15\u00a0<GillesSerasset>\u00a0jvelociter: thx, I got the XAR, will test it really soon  \n14:17\u00a0<jvdrean>\u00a0has joined #xwiki  \n14:18\u00a0<jstoldt>\u00a0it's fine to change the syntax there, right?  \n14:22\u00a0<+fmancinelli>\u00a0cjdelisle: the general idea, despite the fact of integrating nosql storages, is to make XWQL \"THE\" query language for all kind of queries and, hence, using it everywhere. Then, talking about nosql, the challenge would be to map XWSQL to nosql queries for retrieving data (provided that it is possible)  \n14:24\u00a0<@cjdelisle>\u00a0I wish XWQL had been implemented on a platform other than hibernate because as it is we might have to make some painfull changes to it's behavior to make it work in other places.  \n14:25\u00a0<@cjdelisle>\u00a0One thing which I know has to change is that XWQL allows you to query the underlying schema.  \n14:26\u00a0<@cjdelisle>\u00a0Most HQL queries will work in XWQL with only minor tinkering.  \n14:26\u00a0<@cjdelisle>\u00a0I recall these types of things working in XWQL: obj.id = prop.id and prop.value = 'blah'  \n14:27\u00a0<@cjdelisle>\u00a0Which means there are queries floating around which XWQL considers valid but really they are HQL queries and a new implementation will break them.  \n14:27\u00a0<+fmancinelli>\u00a0cjdelisle: true  \n14:28\u00a0<+fmancinelli>\u00a0cjdelisle: but afaiu this is inevitable  \n14:29\u00a0<@cjdelisle>\u00a0IMO the problem is XWQL (or query languages in general) is a massive project (years of development) so some of the validation was skipped over.  \n14:30\u00a0<lucaa>\u00a0has quit  \n14:31\u00a0<@cjdelisle>\u00a0For what it's worth, I would have opted to move in the direction of making mysql faster and doing pseudo-transactions in myisam.  \n14:34\u00a0<mbryant>\u00a0has joined #xwiki  \n14:35\u00a0<mbryant>\u00a0Good day all, is anyone free to help out with an issue, that I have ran into using a DBList Query  \n14:36\u00a0<@cjdelisle>\u00a0what's the problem?  \n14:36\u00a0<abusenius>\u00a0has joined #xwiki  \n14:37\u00a0<mbryant>\u00a0I created a query to search of another class, the query works more or less, but there is only currently one object of that class, the results of the query returns four instances of the same object  \n14:38\u00a0<mbryant>\u00a0I am getting ready to double check the DB to make sure that there is only one, but at first glance via the xwiki interface, it is only one object of that class type (checked via the class, as well as the page that it is housed on)  \n14:38\u00a0<mbryant>\u00a0ig its any help I have relation select, and multiselect chosen as options  \n14:38\u00a0<@cjdelisle>\u00a0what is the query?  \n14:39\u00a0<mbryant>\u00a0select doc.name from XWikiDocument doc, BaseObject obj, StringProperty prop where doc.fullName = obj.name and obj.className = 'UCoreClasses.OrganizationClass' and prop.id.id = obj.id  \n14:40\u00a0<@cjdelisle>\u00a0And you get 4 of the same document name?  \n14:40\u00a0<mbryant>\u00a0yep  \n14:40\u00a0<@cjdelisle>\u00a0Are there 4 properties in this object?  \n14:41\u00a0<mbryant>\u00a07  \n14:42\u00a0<mbryant>\u00a0though there are 4 string properties... which may actually be an artifact that got carried over when i did the query,  \n14:42\u00a0<mbryant>\u00a0hmm  \n14:42\u00a0<@cjdelisle>\u00a0ahh indeed.  \n14:42\u00a0<mbryant>\u00a0not sure why I declared a string property value there  \n14:42\u00a0<+sburjan>\u00a0it seems we are using some deprecated velocity methods on \u00a0Deprecated usage of method [com.xpn.xwiki.XWiki.copyDocument] .. maybe we'll move to the new version (if we have one)  \n14:43\u00a0<@cjdelisle>\u00a0Why not this? --> select doc.name from XWikiDocument doc, BaseObject obj, BaseProperty prop where doc.fullName = \u00a0obj.name and obj.className = 'UCoreClasses.OrganizationClass' and prop.id.id = obj.id  \n14:43\u00a0<@cjdelisle>\u00a0I'm just curious  \n14:43\u00a0<@cjdelisle>\u00a0StringProperty vs. BaseProperty  \n14:44\u00a0<mbryant>\u00a0Doing it now just a sec  \n14:44\u00a0<@cjdelisle>\u00a0anyway...  \n14:44\u00a0<GillesSerasset>\u00a0jvelociter: thx, it seems to work better, however, I had to delete the class sheet (which I modified previously) or it to be correctly imported...  \n14:44\u00a0<@cjdelisle>\u00a0select unique(doc.name) from XWikiDocument doc, BaseObject obj, BaseProperty prop where doc.fullName = \u00a0obj.name and obj.className = 'UCoreClasses.OrganizationClass' and prop.id.id = obj.id  \n14:44\u00a0<mbryant>\u00a0no I used tring property in another query and i was lazy  \n14:44\u00a0<mbryant>\u00a0so it was more of a copy paste, which could be the error an artifact i forgot to change  \n14:45\u00a0<@cjdelisle>\u00a0unique() should do what you want since you only care about displaying each document once and there cannot be multiple documents with the same name.  \n14:45\u00a0<@cjdelisle>\u00a0correct?  \n14:46\u00a0<mbryant>\u00a0yea...  \n14:46\u00a0<mbryant>\u00a0i just did it without unique and got all 7 results  \n14:46\u00a0<@cjdelisle>\u00a0You're just looking for documents containing objects of that class?  \n14:46\u00a0<mbryant>\u00a0yes  \n14:47\u00a0<@cjdelisle>\u00a0select unique(doc.name) from XWikiDocument doc, BaseObject obj where doc.fullName = obj.name and obj.className = 'UCoreClasses.OrganizationClass'  \n14:47\u00a0<mbryant>\u00a0yea that worked, thanks  \n14:47\u00a0<@cjdelisle>\u00a0no need to bother the database with looking in the BaseProperty table then.  \n14:49\u00a0<mbryant>\u00a0thats a nice little note I am going to stuff on the side..  \n14:49\u00a0<mbryant>\u00a0thanks for your help  \n14:50\u00a0<@cjdelisle>\u00a0no pb  \n15:18\u00a0<+sburjan>\u00a0cjdelisle sdumitriu vmassol : I have latest trunk, as Admin I go to Rights, check the R\"equire unregistered users to solve a captcha when posting a comment on a page\", log-out, and don'tsee any CAPTCHA, nor able to post comments without CAPTCHA. is this normal intended behavior ?  \n15:19\u00a0<@sdumitriu>\u00a0Yes  \n15:19\u00a0<@sdumitriu>\u00a0You also have to allow comment right  \n15:22\u00a0<+sburjan>\u00a0works  \n15:22\u00a0<+sburjan>\u00a0thanks  \n15:34\u00a0<GillesSerasset>\u00a0has quit  \n15:34\u00a0<Enygma`>\u00a0has quit  \n15:43\u00a0<@cjdelisle>\u00a0reference to runIn is ambiguous, both method <U>runIn(org.xwiki.store.TransactionRunnable<U>) in org.xwiki.store.TransactionRunnable<org.xwiki.store.ProvidingTransactionRunnableTest.DBTransaction> and method <U>runIn(org.xwiki.store.ProvidingTransactionRunnable<? super U,U>) in org.xwiki.store.TransactionRunnable<org.xwiki.store.ProvidingTransactionRunnableTest.DBTransaction> match  \n15:43\u00a0<@cjdelisle>\u00a0ProvidingTransactionRunnable extends TransactionRunnable  \n15:44\u00a0<@cjdelisle>\u00a0This should be the same as equals(MyObj o) and equals(Object o) because MyObj extends Object.  \n15:45\u00a0<jstoldt>\u00a0about the usage with MSSQL, i noticed there is currently some talk about changing schemas and what not  \n15:45\u00a0<jstoldt>\u00a0well, i just set up a new database in MSSQL and left it as is  \n15:45\u00a0<jstoldt>\u00a0then started jetty container  \n15:46\u00a0<jstoldt>\u00a0imported the entire wiki i am work on at (around 550 pages, 190 MB xar file), killed the jetty process and then started it anew  \n15:46\u00a0<jstoldt>\u00a0only thing i saw in the log was the usual migration manager logging  \n15:46\u00a0<jstoldt>\u00a0with MS SQL Server 2008 R2, that is  \n15:47\u00a0<jstoldt>\u00a0so what does this tell me? you are working around the change somewhere or the change has been reverted between 2005 and 2008 R2?  \n15:47\u00a0<jstoldt>\u00a0i'm really a little confused  \n15:51\u00a0<Enygma`>\u00a0has joined #xwiki  \n15:57\u00a0<newbie|2>\u00a0has joined #xwiki  \n15:57\u00a0<@cjdelisle>\u00a0maybe this is just too fancy for javac  \n15:57\u00a0<@cjdelisle>\u00a0public <U extends T> TransactionRunnable<U> runIn(final ProvidingTransactionRunnable<? super U, U> parent)  \n15:59\u00a0<mbryant>\u00a0has quit  \n16:00\u00a0<mflorea>\u00a0has quit  \n16:15\u00a0<sburjan`>\u00a0has quit  \n16:45\u00a0<newbie|2>\u00a0has quit  \n17:02\u00a0<+sburjan>\u00a0sdumitriu: quick question. I delete an attachment. I go to Document Index, Deleted Attachments Section. The attachment is there, but when I click on it, I can't see the image. The URL is http://localhost:8080/xwiki/bin/downloadrev/Main/WebHome/InaTech.jpg?rev=1.2&rid=1&srid=0KBJm7oR .Is this normal ?  \n17:03\u00a0<@sdumitriu>\u00a0Yes  \n17:03\u00a0<@sdumitriu>\u00a0I mean, the URL is normal  \n17:03\u00a0<@sdumitriu>\u00a0But you should be able to see it  \n17:04\u00a0<+sburjan>\u00a0okay, I will report it in the manual test plan  \n17:05\u00a0<@sdumitriu>\u00a0sburjan: I just tested it, it works  \n17:06\u00a0<+sburjan>\u00a0yepp.. tried with another attachment  \n17:07\u00a0<+sburjan>\u00a0ok, basically I still have to test on IE8, and tomorrow I'll give you the link with what I've found  \n17:11\u00a0<sburjan>\u00a0has quit  \n17:24\u00a0<mflorea>\u00a0has joined #xwiki  \n17:31\u00a0<evalica>\u00a0has quit  \n17:31\u00a0<@cjdelisle>\u00a0lol, I'm getting an ambiguous method exception right on top of an incompatable types exception.  \n17:32\u00a0<@cjdelisle>\u00a0I'd think javac would figure out that if one method has incompatable types then it's the other method that I want.  \n17:34\u00a0<@cjdelisle>\u00a0I wonder if this is http://bugs.sun.com/bugdatabase/view\\_bug.do?bug\\_id=6356673  \n17:38\u00a0<jstoldt>\u00a0O\\_o has anyone of you evern seen XWiki eating through the entire system memory?  \n17:39\u00a0<jstoldt>\u00a0my instance, which started less than 3 hours ago, is at 2.14 GB or memory and there is a lot of IO going on with the pagefile...  \n17:39\u00a0<jstoldt>\u00a0something is really off...  \n17:40\u00a0<@cjdelisle>\u00a0I've seen that. It goes way over what -Xmx is set in java?  \n17:40\u00a0<jstoldt>\u00a0yep  \n17:40\u00a0<jstoldt>\u00a0totally^^  \n17:41\u00a0<@cjdelisle>\u00a0Looks like someone's going to be digging through java's .cpp code.  \n17:42\u00a0<@cjdelisle>\u00a0wonder if this can be made to do something funny.  \n17:42\u00a0<@cjdelisle>\u00a0ie  \n17:42\u00a0<jstoldt>\u00a0it's really weird, especially because i have not seen this in the last few months  \n17:42\u00a0<@cjdelisle>\u00a0Object[] o = null; while(true) { o = {o}; }  \n17:42\u00a0<@cjdelisle>\u00a0^--> segfault  \n17:42\u00a0<jstoldt>\u00a0it went to the point the memory was full and then suddenly the machine would hang and a lot of IO going on  \n17:43\u00a0<@cjdelisle>\u00a0Probably swapping.  \n17:43\u00a0<jstoldt>\u00a0and when it responded again i saw a drop of around 7GB in memory in the task manager  \n17:43\u00a0<jstoldt>\u00a0exactly  \n17:43\u00a0<jstoldt>\u00a0and i was like WTF and tomcat proceeded to allocate more memory  \n17:43\u00a0<@cjdelisle>\u00a0^tomcat same  \n17:43\u00a0<@cjdelisle>\u00a0Tomcat has a bunch of native functions.  \n17:44\u00a0<@cjdelisle>\u00a0aka written in C.  \n17:44\u00a0<@cjdelisle>\u00a0somewhere in there there's a way to make a high speed memory leak.  \n17:45\u00a0<@cjdelisle>\u00a0hehe yea another way to restart your shared jvm hosting without opening a ticket.  \n17:45\u00a0<jstoldt>\u00a0X-D  \n17:45\u00a0<jstoldt>\u00a0sounds evil  \n17:45\u00a0<jstoldt>\u00a0but i agree  \n17:45\u00a0<@cjdelisle>\u00a0Oracle wonders why people use still php for shared hosting...  \n17:45\u00a0<jstoldt>\u00a0there's got to be something off... and i can't quite put a finger on what was happening before it started  \n17:46\u00a0<jstoldt>\u00a0well, you got an answer to that?  \n17:46\u00a0<@cjdelisle>\u00a0Object[] o = null; while(true) { o = {o}; } <-- there's one.  \n17:46\u00a0<@cjdelisle>\u00a0completely segfaults the whole jvm.  \n17:46\u00a0<jstoldt>\u00a0will overload the memory till you get an automated reboot?  \n17:46\u00a0<@cjdelisle>\u00a0You can do it in an applet too.  \n17:47\u00a0<jstoldt>\u00a0sounds evil  \n17:47\u00a0<@cjdelisle>\u00a0Java has it's place. It's on dedicated boxen in large enterprise.  \n17:48\u00a0<jstoldt>\u00a0yep... it's really not too memory friendly, i must say  \n17:48\u00a0<@cjdelisle>\u00a0It's safe against a lot of issues --> good for financial people.  \n17:48\u00a0<abusenius>\u00a0has quit  \n17:48\u00a0<@cjdelisle>\u00a0Doesn't use the stack at all so everything is a malloc()  \n17:49\u00a0<vmassol>\u00a0has quit  \n17:49\u00a0<jstoldt>\u00a0although i wonder why nobody has bothered to write wiki software with C++, yet... i've seen C# in one project but that's about as far as it goes  \n17:50\u00a0<@cjdelisle>\u00a0buffer overflow  \n17:50\u00a0<jstoldt>\u00a0or the two or three C(++) projects were rather elite... too elite for actual use ;)  \n17:50\u00a0<@cjdelisle>\u00a0lots of buffer overflow vulns to look out for  \n17:50\u00a0<jstoldt>\u00a0true...  \n17:51\u00a0<@cjdelisle>\u00a0Keep your eyes on node.js and V8. Js is very close to C in the way it works so it should be able to be made fast if you try at it.  \n17:52\u00a0<sabageru>\u00a0has joined #xwiki  \n17:53\u00a0<@cjdelisle>\u00a0java could be made fast but you need a different compiler and you don't get .class files  \n17:53\u00a0<jstoldt>\u00a0mhmm  \n17:53\u00a0<vmassol>\u00a0has joined #xwiki  \n17:53\u00a0<@cjdelisle>\u00a0And you get sued for trying ;)  \n17:53\u00a0<@cjdelisle>\u00a0(dalvic)  \n17:55\u00a0<jstoldt>\u00a0and that's why nobody likes oracle these days...  \n17:55\u00a0<@cjdelisle>\u00a0\\*shrug\\* they're funny. They troll IBM.  \n17:55\u00a0<jstoldt>\u00a0lol  \n17:56\u00a0<jstoldt>\u00a0yeah, i like IBM even less... putting aside my new notebook  \n17:56\u00a0<@cjdelisle>\u00a0Also tell everyone they have an \"unbreakable\" database so lols every time someone finds a vuln in it.  \n17:56\u00a0<jstoldt>\u00a0XD  \n17:57\u00a0<@cjdelisle>\u00a02GB binary + \"it's unbreakable\" ---> asking for trouble  \n17:57\u00a0<jstoldt>\u00a0speaking of trolling: http://artoftrolling.memebase.com/tag/updog/  \n17:57\u00a0<jstoldt>\u00a0i certainly lol'ed at that  \n17:58\u00a0<jstoldt>\u00a0^^  \n18:00\u00a0<+Denis>\u00a0cjdelisle: Hi, we are juste looking at TransactionRunnable, what have motivated to separate StartableTR from TR ?  \n18:00\u00a0<@cjdelisle>\u00a0Some TR's are not safe to start on their own.  \n18:00\u00a0<+Denis>\u00a0why ?  \n18:01\u00a0<@cjdelisle>\u00a0Suppose I had a TR which saved things in the database.  \n18:01\u00a0<+Denis>\u00a0if there prerequisite are satisfied, there is no reason  \n18:01\u00a0<@cjdelisle>\u00a0It needs to run inside of a TR which opens and closes the transaction.  \n18:01\u00a0<@cjdelisle>\u00a0Calling new InsertDataTransactionRunnable().start() would be bad.  \n18:02\u00a0<@cjdelisle>\u00a0If your TR is safe to be started on it's own, just extend StartableTR.  \n18:02\u00a0<+Denis>\u00a0Agreed, but since you need access to the context of your transaction, providing such context guarantee that the transaction has been started somehow  \n18:03\u00a0<@cjdelisle>\u00a0My code sitting here returns null for getContext() unless that is overridden.  \n18:03\u00a0<@cjdelisle>\u00a0I was just about to finish the test and commit and I ran head long into this:  \n18:04\u00a0<@cjdelisle>\u00a0http://bugs.sun.com/bugdatabase/view\\_bug.do?bug\\_id=6356673  \n18:04\u00a0<+Denis>\u00a0I am taking for agreed your latest proposal obviously  \n18:04\u00a0<+Denis>\u00a0getTransaction would be getContext  \n18:05\u00a0<@cjdelisle>\u00a0heh, I picked getContext() in my local change.  \n18:05\u00a0<+Denis>\u00a0nice  \n18:05\u00a0<+Denis>\u00a0:)  \n18:05\u00a0<@cjdelisle>\u00a0But no go until I figure a workaround for this error.  \n18:06\u00a0<+Denis>\u00a0what I would have proposed is to have a  \n18:06\u00a0<+Denis>\u00a0public T start(T context) throws TransactionException  \n18:06\u00a0<+Denis>\u00a0on any TR  \n18:06\u00a0<@cjdelisle>\u00a0javac says \"reference to runIn is ambiguous, both method .... and ... match\" and on the next line it says \"incompatable types, expecting...\"  \n18:07\u00a0<+Denis>\u00a0and a getContext() like this http://xwiki.pastebin.com/kikjFd6w  \n18:09\u00a0<@cjdelisle>\u00a0here's my patch in current form  \n18:09\u00a0<@cjdelisle>\u00a0http://xwiki.pastebin.com/H2726iGx  \n18:10\u00a0<@cjdelisle>\u00a0hmm some of that got cut off near the bottom  \n18:11\u00a0<@cjdelisle>\u00a0hang on lemme try that one again.  \n18:13\u00a0<@cjdelisle>\u00a0http://xwiki.pastebin.com/mebREvZZ  \n18:13\u00a0<@cjdelisle>\u00a0had to review each explicit cast a couple times over.  \n18:21\u00a0<abusenius>\u00a0has joined #xwiki  \n18:23\u00a0<jstoldt>\u00a0WOW  \n18:23\u00a0<jstoldt>\u00a0new fucking record  \n18:23\u00a0<jstoldt>\u00a06.8 GB for tomcat  \n18:23\u00a0<jstoldt>\u00a0something is so screwed up...  \n18:23\u00a0<+Denis>\u00a0cjdelisle: we are figthing with your patch for some unknow reason, would you mind to copy/paste ProvidingTransactionRunable.java to pastebin ?  \n18:24\u00a0<@cjdelisle>\u00a0sure  \n18:25\u00a0<@cjdelisle>\u00a0PTR has almost nothing in it. Everything is in the modified version of TR  \n18:25\u00a0<@cjdelisle>\u00a0http://xwiki.pastebin.com/4bAvr0yB <-- PTR  \n18:26\u00a0<jvelociter>\u00a0has quit  \n18:26\u00a0<+Denis>\u00a0sure, thanks, for unknow reason IDEA were unable to retrieve it  \n18:26\u00a0<@cjdelisle>\u00a0http://xwiki.pastebin.com/QAn0G8vv <-- modified TR  \n18:26\u00a0<+Denis>\u00a0there rest we have thanks  \n18:26\u00a0<+Denis>\u00a0-there+the  \n18:27\u00a0<+abusenius>\u00a0jstoldt: what java version are you using? for me xwiki almost aalways runs oom on java 6 but never on 5  \n18:27\u00a0<@cjdelisle>\u00a0http://xwiki.pastebin.com/U6iiFXTR <-- here's the test I'm working on now.  \n18:28\u00a0<jstoldt>\u00a01.6  \n18:28\u00a0<+Denis>\u00a0http://xwiki.pastebin.com/U6iiFXTR  \n18:28\u00a0<+Denis>\u00a0oups  \n18:28\u00a0<+abusenius>\u00a0and 64bit?  \n18:28\u00a0<jstoldt>\u00a0yes  \n18:28\u00a0<+abusenius>\u00a0same for me  \n18:28\u00a0<jstoldt>\u00a0apparently we are back to 350 MB now...  \n18:28\u00a0<jstoldt>\u00a0this is weird shit!  \n18:29\u00a0<@cjdelisle>\u00a0http://xwiki.pastebin.com/MMLqmzJc <-- here's the error message, maybe you can figure out what I'm doing wrong.  \n18:30\u00a0<jstoldt>\u00a0ah, back to 350 MB after a fatal error...  \n18:31\u00a0<@cjdelisle>\u00a0What was the error?  \n18:31\u00a0<jstoldt>\u00a0allocation.cpp:215  \n18:31\u00a0<jstoldt>\u00a0Error: Chunk::new  \n18:31\u00a0<@cjdelisle>\u00a0yup, tomcat.  \n18:32\u00a0<jstoldt>\u00a0out of swap space...  \n18:32\u00a0<@cjdelisle>\u00a0Do you have a stack trace?  \n18:33\u00a0<jstoldt>\u00a0i think so  \n18:33\u00a0<@cjdelisle>\u00a0Might be something like not closing sockets.  \n18:34\u00a0<+Denis>\u00a0cjdelisle: I reproduce, this is obvious, both runin has the same signature, since ProvidingTransactionRunnable<? super U, U> is a TransactionRunnable<U>  \n18:34\u00a0<jstoldt>\u00a0i'm seeing a tiny arrow before CompilerThread0  \n18:34\u00a0<jstoldt>\u00a0...  \n18:34\u00a0<@cjdelisle>\u00a0No, it's a TransactionRunnable<? super U>  \n18:35\u00a0<+abusenius>\u00a0type erasure  \n18:35\u00a0<+abusenius>\u00a0?  \n18:35\u00a0<jstoldt>\u00a0abusenius: you talking to me or somebody else?  \n18:35\u00a0<@cjdelisle>\u00a0if it was a TransactionRunnable<U> then there wouldn't be any \"incompatible types\" error.  \n18:35\u00a0<+abusenius>\u00a0mostly cjdelisle :)  \n18:35\u00a0<jstoldt>\u00a0because i was about to get out... i think i am at my time limit for today...  \n18:35\u00a0<jstoldt>\u00a0ah okay  \n18:35\u00a0<jstoldt>\u00a0well then you guys  \n18:35\u00a0<jstoldt>\u00a0have a good night!  \n18:35\u00a0<jstoldt>\u00a0bye bye  \n18:36\u00a0<@cjdelisle>\u00a0gnight  \n18:36\u00a0<jstoldt>\u00a0has quit  \n18:36\u00a0<+abusenius>\u00a0bye  \n18:36\u00a0<@cjdelisle>\u00a0type erasure does not happen in a number of cases and they can all be abused to make java do things which seem impossible.  \n18:38\u00a0<@cjdelisle>\u00a0there's a stackoverflow page which details all of the hats which actually contain rabbits.  \n18:38\u00a0<+abusenius>\u00a0ProvidingTransactionRunnable extends TransactionRunnable ?  \n18:41\u00a0<@cjdelisle>\u00a0http://stackoverflow.com/questions/2320658/why-are-not-all-type-information-erased-in-java-at-runtime/2320766#2320766  \n18:41\u00a0<@cjdelisle>\u00a0ProvidingTransactionRunnable<R, P extends R> extends TransactionRunnable<R>  \n18:41\u00a0<@cjdelisle>\u00a0and  \n18:41\u00a0<@cjdelisle>\u00a0public <U extends T> TransactionRunnable<U> runIn(final TransactionRunnable<U> parentRunnable)  \n18:42\u00a0<@cjdelisle>\u00a0public <U extends T> TransactionRunnable<U> runIn(final TransactionRunnable<U> parentRunnable)  \n18:42\u00a0<@cjdelisle>\u00a0umm also...  \n18:42\u00a0<@cjdelisle>\u00a0public <U extends T> TransactionRunnable<U> runIn(final ProvidingTransactionRunnable<? super U, U> parent)  \n18:42\u00a0<@cjdelisle>\u00a0^yes, the .java file with those 2 methods does compile.  \n18:43\u00a0<+abusenius>\u00a0horrible :)  \n18:43\u00a0<@cjdelisle>\u00a0It's in class TransactionRunnable<T>  \n18:44\u00a0<@cjdelisle>\u00a0yea: \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Superclasses referencing their subclasses is a mess but it makes common use cases  \n18:44\u00a0<@cjdelisle>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// so much easier that I judge it to be worthwhile.  \n18:44\u00a0<@cjdelisle>\u00a0Everything works except the test.  \n18:44\u00a0<+abusenius>\u00a0funny thing is that I am currently formalizing Java with generics (a variant of them actually) and still don't know all details :)  \n18:45\u00a0<@cjdelisle>\u00a0one sec, I have a page which outlines exactly what you can do.  \n18:45\u00a0<+Denis>\u00a0cjdelisle: isn't it ProvidingTransactionRunnable<R, P extends R> extends TransactionRunnable<P> and not ProvidingTransactionRunnable<R, P extends R> extends TransactionRunnable<R> !!!  \n18:45\u00a0<+abusenius>\u00a0have you tried to cast the argument to something? (just guessing)  \n18:46\u00a0<+Denis>\u00a0cjdelisle: We got your test working now  \n18:46\u00a0<@cjdelisle>\u00a0http://www.angelikalanger.com/GenericsFAQ/FAQSections/TypeArguments.html  \n18:46\u00a0<+Denis>\u00a0removed the second runin, fix the declaration of PTR and add a throws exception on your test  \n18:48\u00a0<@cjdelisle>\u00a0PTR \\_should\\_ extend TR<R> because it needs to be able to runIn() anything which provides what it requires, not what it provides.  \n18:49\u00a0<@cjdelisle>\u00a0trying that change now. Maybe I messed something else up.  \n18:51\u00a0<@cjdelisle>\u00a0I need another cup of tea and try to understand why that works. It looks like I have introduced a bug which takes away the security guarantee.  \n18:52\u00a0<+Denis>\u00a0cjdelisle: \u00a0I do not agree your statement above, PTR represent what it provide, not what it require  \n18:53\u00a0<@cjdelisle>\u00a0It can represent either, I tried to make it represent what it provided but ran into semi overlapping runIn methods and I had to scrap that approach.  \n18:53\u00a0<@cjdelisle>\u00a0I \\_tried\\_ to make it not ugly.  \n18:53\u00a0<@cjdelisle>\u00a0brb  \n19:02\u00a0<@cjdelisle>\u00a0I tried the change you made and the line which was failing works but the commented line above it starts failing.  \n19:03\u00a0<@cjdelisle>\u00a0ProvidingTransactionRunnable<DBTransaction, MyInterfaceWithDataA1> tr1 = new TR1(); tr1.runIn(run);  \n19:04\u00a0<@cjdelisle>\u00a0What needs to be true is:  \n19:04\u00a0<@cjdelisle>\u00a0PTR<A, B>.runIn(TR<A>) works  \n19:05\u00a0<@cjdelisle>\u00a0PTR<A, B>.runIn(PTR<?, A>) works  \n19:05\u00a0<@cjdelisle>\u00a0TR<A>.runIn(PTR<?, A>) works  \n19:05\u00a0<@cjdelisle>\u00a0TR<A>.runIn(TR<A>) works  \n19:05\u00a0<@cjdelisle>\u00a0actually TR<A>.runIn(TR<? extends A>)  \n19:06\u00a0<@cjdelisle>\u00a0but if one works thenthe other works.  \n19:07\u00a0<@cjdelisle>\u00a0The way that code was \\_supposed\\_ to work was:  \n19:08\u00a0<@cjdelisle>\u00a0PTR<A, B>.runIn(PTR<?, A>) uses \u00a0<U extends T> runIn(PTR<? super U, U>)  \n19:08\u00a0<@cjdelisle>\u00a0PTR<A, B>.runIn(TR<A>) uses \u00a0<U extends T> runIn(TR<U>)  \n19:08\u00a0<@cjdelisle>\u00a0TR<A>.runIn(PTR<?, A>) uses <U extends T> runIn(PTR<? super U, U>)  \n19:08\u00a0<@cjdelisle>\u00a0and  \n19:09\u00a0<@cjdelisle>\u00a0TR<A>.runIn(TR<A>) uses <U extends T> runIn(TR<U>)  \n19:10\u00a0<@cjdelisle>\u00a0TR.runIn(PTR) is the reason why runIn(PTR) had to be put in TR.java  \n19:10\u00a0<mflorea>\u00a0has quit  \n19:14\u00a0<@cjdelisle>\u00a0When PTR represents what it provides instead of what it requires (extends TransactionRunnable<P>)  \n19:14\u00a0<@cjdelisle>\u00a0PTR<A, B>.runIn(TR<A>) fails  \n19:16\u00a0<@cjdelisle>\u00a0if you try to override runIn() in the PTR class, it's not a valid override because it takes a different range of generic.  \n19:16\u00a0<@cjdelisle>\u00a0But the range overlaps the TR.runIn(TR) so it won't compile.  \n19:18\u00a0<vmassol>\u00a0has quit  \n19:19\u00a0<@cjdelisle>\u00a0Denis: ^^that's the ratinale for the current implementation.  \n19:20\u00a0<@cjdelisle>\u00a0ratinale, rationale, ratinal, retnil? doesn't look right ;)  \n19:25\u00a0<fmancinelli>\u00a0has quit  \n19:41\u00a0<sabageru>\u00a0has quit  \n19:46\u00a0<+Denis>\u00a0cjdelisle: not sure there is a way out  \n19:46\u00a0<+Denis>\u00a0we leave for today...  \n19:46\u00a0<@cjdelisle>\u00a0My code should be working  \n19:47\u00a0<@cjdelisle>\u00a0It's rather scitzophrenic to say \"both methods match\" then in the next line \"type mismatch\"  \n19:47\u00a0<sabageru>\u00a0has joined #xwiki  \n19:47\u00a0<@cjdelisle>\u00a0I'll keep poking at it. If it's a true javac bug then the workaround might be trivial once discovered.  \n19:48\u00a0<@cjdelisle>\u00a0I'm pretty sure making ProvidingTransactionRunnable<R, P extends R>  \n19:48\u00a0<@cjdelisle>\u00a0P not extend R  \n19:48\u00a0<@cjdelisle>\u00a0would fix but that would be a shame.  \n19:51\u00a0<evalica>\u00a0has joined #xwiki  \n20:03\u00a0<sabageru>\u00a0has quit  \n20:08\u00a0<evalica>\u00a0has quit  \n20:17\u00a0<arkub>\u00a0has quit  \n20:17\u00a0<jvdrean>\u00a0has quit  \n20:24\u00a0<rrodriguez>\u00a0has joined #xwiki  \n21:24\u00a0<vmassol>\u00a0has joined #xwiki  \n21:55\u00a0<polx\\_>\u00a0has joined #xwiki  \n22:00\u00a0<mflorea>\u00a0has joined #xwiki  \n22:21\u00a0<polx\\_>\u00a0is now known as <polx>  \n22:30\u00a0<vmassol>\u00a0has quit  \n22:35\u00a0<BLOBO>\u00a0has quit  \n22:39\u00a0<jvdrean>\u00a0has joined #xwiki  \n22:43\u00a0<jvdrean>\u00a0has quit  \n22:48\u00a0<polx>\u00a0has quit  \n22:55\u00a0<sburjan`>\u00a0has joined #xwiki  \n23:01\u00a0<Enygma`>\u00a0has quit  \n23:22\u00a0<mflorea>\u00a0has quit  \n\n"}