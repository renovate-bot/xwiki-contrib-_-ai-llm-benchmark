{
  "id": "xwiki:Documentation.AdminGuide.Upgrade.WebHome",
  "url": "https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/",
  "title": "Upgrading",
  "collection": "Eval_fr",
  "mimetype": "text/markdown",
  "language": "fr",
  "content": "**Contenu*** [Mise à niveau](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HUpgrading)\n\t+ [Partie 1 Mise à niveau de la distribution](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HPart1Upgradingthedistribution)\n\t\t- [Méthode 1.A Mise à niveau à partir du paquet Debian .DEB](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HMethod1.AUpgradingfromtheDebianpackage.DEB)\n\t\t- [Méthode 1.B Mise à niveau à partir de Docker .Docker](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HMethod1.BUpgradingfromDocker.Docker)\n\t\t- [Méthode 1.C Mise à niveau du WAR .WAR](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HMethod1.CUpgradingtheWAR.WAR)\n\t\t- [Méthode 1.D Mise à niveau du paquet de démonstration .ZIP](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HMethod1.DUpgradingthedemopackage.ZIP)\n\t+ [Partie 2 Mise à niveau du flavor](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HPart2Upgradingtheflavor)\n\t\t- [Utilisation de l'assistant de distribution](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HUsingDistributionWizard)\n\t+ [Alternative Démarrer à neuf, puis exporter et réimporter vos données](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HAlternativeStartfresh2CplusExportandReimportyourdata)\n* [Rétrogradation](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HDowngrading)\n* [Dépannage](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HTroubleshooting)\n\t+ [XWiki ne démarre pas sans aucune erreur dans le journal et reste bloqué sur l'initialisation de Solr](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/#HXWikiwon27tstartwithoutanyerrorinthelogandstaystuckonSolrinitialization)\nNote 1 XWiki fournit des chemins de migration pour mettre à niveau depuis n'importe quelle version antérieure vers n'importe quelle version plus récente. Vous n'avez pas besoin de mettre à niveau vers des versions intermédiaires.\n\nNote 2 Il est également bon de vérifier les [Notes de version](https://www.xwiki.org/xwiki/bin/view/ReleaseNotes/) pour les versions entre votre ancienne version et la nouvelle version vers laquelle vous mettez à niveau. Vous devez porter une attention particulière à la section des notes de version intitulée \"Problèmes spécifiques à XWiki <version>\". Par exemple, il est important de vérifier si la nouvelle version de XWiki que vous mettez à niveau a de nouvelles [exigences matérielles ou logicielles](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Installation/#HHardwareandSoftwarerequirements).\n\nSauvegarde Avant de continuer, assurez-vous de [sauvegarder](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Backup) toutes vos données, au cas où quelque chose tournerait mal avec la mise à jour / rétrogradation. En fonction de votre utilisation, vous devriez sauvegarder vos informations régulièrement.\n\nExtensions Avant de mettre à niveau XWiki lui-même, il est généralement bon de s'assurer que toutes vos extensions sont à jour, car de nouvelles versions peuvent contenir des correctifs de compatibilité qui auraient autrement empêché la nouvelle version de démarrer complètement.\n\n# Mise à niveau\n\nGardez votre instance XWiki à jour pour bénéficier des meilleures nouvelles fonctionnalités et protéger vos données contre les menaces de sécurité. Il existe plusieurs méthodes pour mettre à niveau XWiki en fonction de la quantité de données que vous devez migrer ou de votre expérience avec différents outils.\n\nDans la majorité des cas, une mise à niveau se compose de deux parties :\n\n* Partie 1 : Mise à niveau de la *distribution* sur le *serveur / système de fichiers* et\n* Partie 2 : Mise à niveau du *flavor (pages wiki)* depuis un *navigateur*.\n\n\n\n---\n\n## Partie 1 Mise à niveau de la distribution\n\n### Méthode 1.A Mise à niveau à partir du paquet Debian .DEB\n\n* Mettre à jour l'index des paquets : sudo apt update\n* Mise à niveau des paquets : sudo apt upgrade Cela mettra à niveau tous les paquets, pas seulement XWiki. Si vous souhaitez éviter tous les autres paquets et ne mettre à jour que XWiki, vous pouvez utiliser sudo apt install xwiki-tomcat9-mariadb (changez xwiki-tomcat9-mariadb pour le paquet de niveau supérieur que vous avez installé si vous avez installé autre chose).\n\nLors de la mise à niveau à partir d'une version antérieure à 9.5, apt upgrade ne trouvera rien car le nom du paquet a changé ([XWiki Enterprise n'existe plus](https://www.xwiki.org/xwiki/bin/view/Blog/XWiki%20Enterprise%20is%20dead%2C%20long%20live%20XWiki%21)).\n\nTout ce que vous avez à faire dans ce cas est d'installer le paquet xwiki-tomcat\\* correspondant au paquet de niveau supérieur xwiki-enterprise-tomcat\\* que vous avez installé précédemment. Par exemple, si vous aviez xwiki-enterprise-tomcat8-mysql 9.4, vous devriez faire sudo apt install xwiki-tomcat8-mysql.\n* Mise à niveau des pages : Cependant, après la mise à niveau, vous devez toujours installer la nouvelle interface utilisateur ; voir l'étape suivante [Mise à niveau du flavor](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Upgrade/UpgradeDebian/#HPart2Upgradingtheflavor) ci-dessous.\n\n### Méthode 1.B Mise à niveau à partir de Docker .Docker\n\n* Si vous avez installé XWiki en utilisant l'image Docker officielle de XWiki, [suivez les instructions ici](https://github.com/xwiki-contrib/docker-xwiki/blob/master/README.md#upgrading-xwiki) pour le mettre à niveau.\n\n### Méthode 1.C Mise à niveau du WAR .WAR\n\n* La stratégie générale consiste à [télécharger la nouvelle distribution WAR](https://www.xwiki.org/xwiki/bin/view/Main/Download) et à remplacer votre WAR installé actuel par celle-ci. Cependant, assurez-vous de ne pas copier par-dessus car cela pourrait laisser des fichiers anciens qui feraient échouer XWiki (comme si des anciens JAR traînaient dans WEB-INF/lib). De plus, vous écraseriez certains fichiers de configuration XWiki situés dans WEB-INF (xwiki.properties et xwiki.cfg pour n'en nommer que deux).\n* Ainsi, avant de remplacer votre WAR actuel, assurez-vous de [le sauvegarder, y compris les fichiers de configuration et de données](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Backup).\n* Vous devez également vous assurer que vous utilisez le même répertoire permanent XWiki (configuré dans WEB-INF/xwiki.properties en utilisant la propriété environment.permanentDirectory).\n* Certaines opérations supplémentaires peuvent être nécessaires pour la mise à niveau et vous devez vérifier les [notes de version](https://www.xwiki.org/xwiki/bin/view/ReleaseNotes/) pour toutes les versions depuis celle que vous mettez à niveau jusqu'à la nouvelle version que vous installez. Il est également possible que de nouvelles fonctionnalités soient disponibles et que certains fichiers de configuration doivent être modifiés. Si tel est le cas, cela sera spécifié dans les notes de version.\n* Notez que le schéma de la base de données est automatiquement mis à niveau si nécessaire. Tout ce que vous avez à faire est de vous assurer que votre fichier xwiki.cfg est correctement configuré pour effectuer la migration. Voici un extrait pertinent du fichier xwiki.cfg :\n\n#-# Si les migrations sont activées ou non. Devrait être activé lors de la mise à niveau, mais pour un meilleur temps de démarrage, il est préférable de  \n#-# les désactiver en production.  \nxwiki.store.migration=1  \n  \n#-# Si l'on doit quitter après la migration. Utile lorsqu'un serveur doit gérer des migrations pour une grande base de données, sans aller  \n#-# en production par la suite.  \n# xwiki.store.migration.exitAfterEnd=0  \n  \n#-# Indiquer la liste des bases de données à migrer.  \n#-# pour mettre à niveau toutes les bases de données wikis, définissez xwiki.store.migration.databases=all  \n#-# pour mettre à niveau uniquement certaines bases de données wikis, définissez xwiki.store.migration.databases=xwiki,wiki1,wiki2  \n#-# Remarque : le wiki principal est toujours migré quelle que soit la configuration.  \n# xwiki.store.migration.databases=À partir d'une migration échouée, les tables de base de données **DATABASECHANGELOG** et **DATABASECHANGELOGLOCK** peuvent rester.  \nAssurez-vous que ces tables sont supprimées avant de redémarrer une migration échouée.\n* **Extensions invalides**\n\nNotez également que lorsque vous mettez à niveau, certaines extensions qui étaient auparavant valides peuvent devenir invalides (par exemple, elles peuvent avoir été renommées, supprimées ou avoir des versions qui ne correspondent pas à la version du WAR que vous avez installée comme c'est le cas dans l'exemple ci-dessous). Dans ce cas, vous verrez dans les messages de la console des messages tels que :\n\n2013-12-02 11:43:01,688 [localhost-startStop-1] WARN  ltInstalledExtensionRepository - Extension invalide [org.xwiki.enterprise:xwiki-enterprise-ui-common-5.2.1] sur l'espace de noms [wiki:xwiki]  \n2013-12-02 11:43:01,688 [localhost-startStop-1] WARN  ltInstalledExtensionRepository - Extension invalide [org.xwiki.platform:xwiki-platform-workspace-ui-5.2.1] sur l'espace de noms [wiki:xwiki]  \n2013-12-02 11:43:01,688 [localhost-startStop-1] WARN  ltInstalledExtensionRepository - Extension invalide [org.xwiki.enterprise:xwiki-enterprise-ui-mainwiki-5.2.1] sur l'espace de noms [wiki:xwiki]  \n2013-12-02 11:43:01,689 [localhost-startStop-1] WARN  ltInstalledExtensionRepository - Extension invalide [org.xwiki.enterprise:xwiki-enterprise-ui-wiki-all-5.2.1] sur l'espace de noms [wiki:workspacetemplate]Ce ne sont que des avertissements et n'affectent pas la stabilité de votre instance. En fait, l'assistant de distribution que vous obtenez (voir la section suivante sur \"Mise à niveau des documents wiki\") vous demandera de mettre à niveau ces extensions invalides et supprimera les anciennes versions devenues invalides.\n\n### Méthode 1.D Mise à niveau du paquet de démonstration .ZIP\n\n* Si vous avez installé la distribution standard (distribution zip ou jar) et que vous souhaitez la mettre à niveau, le plus simple est de [télécharger](https://www.xwiki.org/xwiki/bin/view/Main/Download) la nouvelle version et de l'installer comme vous l'avez fait la première fois. Assurez-vous simplement de ne pas installer la nouvelle version par-dessus l'ancienne (les deux installations doivent exister).\n* Ensuite, copiez [les fichiers de configuration et le répertoire permanent](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Backup) de l'ancienne installation vers la nouvelle. Idéalement, vous ne devriez pas copier exactement les fichiers de configuration car la nouvelle version pourrait avoir ajouté de nouvelles options de configuration et donc idéalement, vous devriez faire une fusion au lieu d'une copie pure. Une autre stratégie consiste à utiliser les nouveaux fichiers de configuration, à ne pas copier les anciens fichiers de configuration et à modifier manuellement la nouvelle configuration pour apporter les mêmes modifications que vous avez pu faire auparavant (si vous n'avez jamais touché aux fichiers de configuration, il n'y a évidemment rien à faire !).\n* Si vous êtes sur un système Unix, voici quelques commandes qui peuvent vous aider à faire la fusion au lieu de le faire entièrement manuellement :\n\n## Remarque : Nous supposons que \"xwiki.new\" est un lien symbolique qui pointe vers l'emplacement   \n## où se trouve la nouvelle version de xwiki et que \"xwiki\" est l'emplacement de l'installation précédente   \n## de xwiki.  \nmv xwiki.new/WEB-INF/web.xml xwiki.new/WEB-INF/web.xml.ori; sudo sdiff xwiki/WEB-INF/web.xml xwiki.new/WEB-INF/web.xml.ori -B -W -E -o xwiki.new/WEB-INF/web.xml  \nmv xwiki.new/WEB-INF/xwiki.cfg xwiki.new/WEB-INF/xwiki.cfg.ori; sudo sdiff xwiki/WEB-INF/xwiki.cfg xwiki.new/WEB-INF/xwiki.cfg.ori -B -W -E -o xwiki.new/WEB-INF/xwiki.cfg  \nmv xwiki.new/WEB-INF/xwiki.properties xwiki.new/WEB-INF/xwiki.properties.ori; sudo sdiff xwiki/WEB-INF/xwiki.properties xwiki.new/WEB-INF/xwiki.properties.ori -B -W -E -o xwiki.new/WEB-INF/xwiki.properties  \nmv xwiki.new/WEB-INF/struts-config.xml xwiki.new/WEB-INF/struts-config.xml.ori; sudo sdiff xwiki/WEB-INF/struts-config.xml xwiki.new/WEB-INF/struts-config.xml.ori -B -W -E -o xwiki.new/WEB-INF/struts-config.xml  \nmv xwiki.new/WEB-INF/classes/logback.xml xwiki.new/WEB-INF/classes/logback.xml.ori; sudo sdiff xwiki/WEB-INF/classes/logback.xml xwiki.new/WEB-INF/classes/logback.xml.ori -B -W -E -o xwiki.new/WEB-INF/classes/logback.xml\n* Notez que le schéma de la base de données est automatiquement mis à niveau si nécessaire. Tout ce que vous avez à faire est de vous assurer que votre fichier xwiki.cfg est correctement configuré pour effectuer la migration. Voici un extrait pertinent du fichier xwiki.cfg :\n\n#-# Si les migrations sont activées ou non. Devrait être activé lors de la mise à niveau, mais pour un meilleur temps de démarrage, il est préférable de  \n#-# les désactiver en production.  \nxwiki.store.migration=1  \n  \n#-# Si l'on doit quitter après la migration. Utile lorsqu'un serveur doit gérer des migrations pour une grande base de données, sans aller  \n#-# en production par la suite.  \n# xwiki.store.migration.exitAfterEnd=0  \n  \n#-# Indiquer la liste des bases de données à migrer.  \n#-# pour mettre à niveau toutes les bases de données wikis, définissez xwiki.store.migration.databases=all  \n#-# pour mettre à niveau uniquement certaines bases de données wikis, définissez xwiki.store.migration.databases=xwiki,wiki1,wiki2  \n#-# Remarque : le wiki principal est toujours migré quelle que soit la configuration.  \n# xwiki.store.migration.databases=À partir d'une migration échouée, les tables de base de données **DATABASECHANGELOG** et **DATABASECHANGELOGLOCK** peuvent rester.  \nAssurez-vous que ces tables sont supprimées avant de redémarrer une migration échouée.\n\n\n\n---\n\n## Partie 2 Mise à niveau du flavor\n\n### Utilisation de l'assistant de distribution\n\nRecommandé La méthode recommandée pour mettre à niveau une installation XWiki est d'utiliser l'[assistant de distribution](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/DistributionWizard) qui est automatiquement déclenché après la mise à niveau du WAR XWiki (vous devez être connecté avec un utilisateur ayant des droits d'administrateur). Il vous permet de mettre à niveau automatiquement les extensions installées dans votre wiki, en prenant en charge les fusions automatiques et la résolution des conflits.\n\nSi vous mettez à niveau un XWiki étendu (c'est-à-dire un wiki avec plusieurs sous-wikis), vous devrez naviguer vers chaque sous-wiki. Vous serez alors présenté avec l'assistant de distribution pour chaque wiki nécessitant une mise à niveau.\n\nAssurez-vous de lancer l'assistant de distribution (DW) avec un utilisateur ayant des droits de programmation. Les pages suivantes nécessitent d'être enregistrées par un utilisateur ayant des droits de programmation pour fonctionner correctement et elles peuvent avoir été modifiées et donc le DW peut avoir besoin de les modifier :\n\n* AppWithinMinutes.DynamicMessageTool (conservé pour la compatibilité ascendante, non utilisé)\n* AnnotationCode.Style\n* AppWithinMinutes.LiveTableEditSheet\n* AppWithinMinutes.ClassEditSheet\n* AnnotationCode.Script\n* XWiki.OfficeImporterAdmin\n* Filter.WebHome\n* WikiManager.Translations\n\nSi vous avez déjà effectué la mise à niveau avec un utilisateur n'ayant pas de droits de programmation, connectez-vous avec un utilisateur ayant ces permissions (ou demandez à quelqu'un qui les a), [naviguez vers ces pages](https://www.xwiki.org/xwiki/bin/view/FAQ/How%20can%20I%20navigate%20to%20a%20given%20page), éditez-les (de préférence en utilisant l'éditeur wiki) et enregistrez-les sans aucune modification.\n\n\n\n---\n\n## Alternative Démarrer à neuf, puis exporter et réimporter vos données\n\nIl existe des cas où tout ce que vous pouvez faire est [d'exporter votre contenu actuel en tant que XAR](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/ImportExport) et de [le réimporter](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/ImportExport) dans [une nouvelle instance](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Installation/). Vous devez utiliser cette méthode lorsque vous savez exactement quel contenu vous avez créé et que vous vérifiez manuellement de ne rien oublier sur l'ancienne instance.\n\nCe n'est généralement pas recommandé car cela signifie contourner complètement la migration automatique des données, ce qui n'est souvent pas une bonne idée car cela pourrait rendre certaines données inaccessibles car elles doivent être modifiées pour une raison quelconque (les pièces jointes du système de fichiers sont stockées dans un chemin différent, certaines données sont passées de String à List, etc.).\n\nSi votre cas d'utilisation est que vous souhaitez déplacer XWiki vers un autre serveur et le mettre à niveau, vous devez le faire en deux étapes :\n\n* déplacer XWiki vers la nouvelle version dans la même version exacte et s'assurer que tout fonctionne comme prévu\n* mettre à niveau XWiki comme expliqué dans les sections précédentes\nQuelques conseils"
}