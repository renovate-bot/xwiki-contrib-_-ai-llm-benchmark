{"id": "dev:IRC.xwikiArchive20140623", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20140623", "title": "IRC Archive for channel #xwiki on 23 June 2014 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<abusenius>\u00a0has quit  \n03:49\u00a0<Inge-\\_>\u00a0has joined #xwiki  \n03:49\u00a0<Inge->\u00a0has quit  \n05:05\u00a0<polx>\u00a0has joined #xwiki  \n05:08\u00a0<polx>\u00a0has quit  \n05:56\u00a0<polx>\u00a0has joined #xwiki  \n06:02\u00a0<polx>\u00a0has quit  \n06:07\u00a0<polx>\u00a0has joined #xwiki  \n06:14\u00a0<polx>\u00a0has quit  \n06:19\u00a0<polx>\u00a0has joined #xwiki  \n06:21\u00a0<polx>\u00a0has quit  \n06:44\u00a0<polx>\u00a0has joined #xwiki  \n07:06\u00a0<polx>\u00a0has quit  \n07:08\u00a0<polx>\u00a0has joined #xwiki  \n07:09\u00a0<polx>\u00a0has quit  \n07:34\u00a0<Lyes>\u00a0has joined #xwiki  \n07:40\u00a0<evalica>\u00a0has joined #xwiki  \n07:42\u00a0<Enygma`>\u00a0has joined #xwiki  \n07:50\u00a0<Enygma`>\u00a0has quit  \n07:58\u00a0<Enygma`>\u00a0has joined #xwiki  \n08:00\u00a0<Enygma`>\u00a0has quit  \n08:04\u00a0<Enygma`>\u00a0has joined #xwiki  \n08:10\u00a0<msmeria>\u00a0has joined #xwiki  \n08:21\u00a0<msmeria>\u00a0has quit  \n08:22\u00a0<msmeria>\u00a0has joined #xwiki  \n08:29\u00a0<tmortagne>\u00a0has joined #xwiki  \n08:36\u00a0<Denis>\u00a0has joined #xwiki  \n08:41\u00a0<vmassol>\u00a0has joined #xwiki  \n08:42\u00a0<Enygma`>\u00a0has quit  \n08:45\u00a0<Enygma`>\u00a0has joined #xwiki  \n08:57\u00a0<vmassol>\u00a0good morning  \n08:57\u00a0<vmassol>\u00a0so today is release day for 6.1RC1  \n08:57\u00a0<vmassol>\u00a0do we have a RM? :)  \n08:58\u00a0<vmassol>\u00a0BTW and FTR I'm leaving early this afternoon to travel to do a training in the south of France till Wednesday night so I won't be much available at all during this time  \n09:01\u00a0<woshilapin>\u00a0has joined #xwiki  \n09:04\u00a0<mflorea>\u00a0has joined #xwiki  \n09:09\u00a0<gdelhumeau>\u00a0has joined #xwiki  \n09:15\u00a0<ClemensR>\u00a0has joined #xwiki  \n09:17\u00a0<tmortagne>\u00a0vmassol: looks like we have 2 blockers on 6.1RC1  \n09:18\u00a0<vmassol>\u00a0ok, we still need a RM to make things progress and ensure the release is done ASAP  \n09:19\u00a0<tmortagne>\u00a0ClemensR: don't forget to put N/A in documentation filed when closing bug jira issue that don't really need to be documented  \n09:19\u00a0<ClemensR>\u00a0ah, yes, I forgot ... have not been sure if I should document it and where, and then I forgot ..  \n09:20\u00a0<tmortagne>\u00a0vmassol: I can take case of this if there is nobody else I guess  \n09:20\u00a0<ClemensR>\u00a0ah, no, it's in the bugs - there I plain forgot it, sorry  \n09:21\u00a0<vmassol>\u00a0thanks tmortagne, if someone has the time to do it, let us know. So I guess you're on FTM :) Thanks  \n09:22\u00a0<tmortagne>\u00a0but someone will need to look at XWIKI-10497  \n09:22\u00a0<tmortagne>\u00a0as for XWIKI-10446 IMO we can't really do much than waiting for signing all that  \n09:22\u00a0<tmortagne>\u00a0it's not like it was a 6.1 regression  \n09:23\u00a0<tmortagne>\u00a0we should not be far from it since Denis implemented lots of stuff already  \n09:34\u00a0<evalica>\u00a0tmortagne: pls let me know when you're starting the release, maybe I still have time to commit something, if not it will go in the next release. Ty :)  \n09:35\u00a0<tmortagne>\u00a0evalica: the release is stuck for now, need someone to look at XWIKI-10497  \n09:35\u00a0<tmortagne>\u00a0so you can go  \n09:35\u00a0<tmortagne>\u00a0jenkins is in a better shape than usually before a release :)  \n09:37\u00a0<tmortagne>\u00a0checking init.vm related complains of escaping tests  \n09:53\u00a0<gdelhumeau>\u00a0guys  \n09:54\u00a0<gdelhumeau>\u00a0I have a very strange problem  \n09:54\u00a0<gdelhumeau>\u00a0I have modified annotations-ui recently  \n09:54\u00a0<gdelhumeau>\u00a0when I build a new XE, annotations are not displayed anymore by default  \n09:54\u00a0<gdelhumeau>\u00a0If i re-import annotatiouns-ui.xar, it works again  \n09:56\u00a0<tmortagne>\u00a0gdelhumeau: you mean if you take latest jetty/hsqldb snapshot ans start it annotations \u00a0don't work ?  \n09:56\u00a0<tmortagne>\u00a0s/ans/and/  \n09:56\u00a0<gdelhumeau>\u00a0the annotations button isn't displayed at all  \n09:57\u00a0<gdelhumeau>\u00a0I think it is because .Script needs ProgramlAnnotationCodeming Rights  \n09:57\u00a0<gdelhumeau>\u00a0I think it is because AnnotationCode.Script needs Programing Rights  \n09:58\u00a0<gdelhumeau>\u00a0If I just re-save the page, it's ok  \n09:58\u00a0<tmortagne>\u00a0gdelhumeau: id you updated recently ? Denis broke standard PR and then fixed it last week  \n09:58\u00a0<tmortagne>\u00a0s/id/did/  \n09:58\u00a0<gdelhumeau>\u00a0last thursday  \n09:58\u00a0<gdelhumeau>\u00a0and sorry, I have built XE this morning  \n09:59\u00a0<tmortagne>\u00a0I just downloaded latest jetty/hsqldb, lets see  \n10:00\u00a0<tmortagne>\u00a0note that annotations tests (if any but I think there is a few) don't fail on jenkins  \n10:00\u00a0<gdelhumeau>\u00a0yes, it is strange indeed  \n10:02\u00a0<tmortagne>\u00a0gdelhumeau: I reproduce on last jenkins  \n10:02\u00a0<gdelhumeau>\u00a0good  \n10:02\u00a0<tmortagne>\u00a0I mean last snapshot  \n10:02\u00a0<gdelhumeau>\u00a0now, just resave AnnotationCode.Script  \n10:03\u00a0<tmortagne>\u00a0yes I did and now it works  \n10:03\u00a0<gdelhumeau>\u00a0what could be the cause?  \n10:03\u00a0<Denis>\u00a0should be my fault, for sure  \n10:03\u00a0<tmortagne>\u00a0but that seems to be the only document that lost PR  \n10:03\u00a0<tmortagne>\u00a0other documents requiring PR that I can think of are working well  \n10:04\u00a0<Denis>\u00a0when I look the content author of that document, I see XWiki.superadmin (I have not the latest snapshot)  \n10:04\u00a0<tmortagne>\u00a0and there is no way the content of this document is anything else than Admin at startup  \n10:04\u00a0<tmortagne>\u00a0you mean in the xml ?  \n10:04\u00a0<Denis>\u00a0yes  \n10:04\u00a0<tmortagne>\u00a0I don't think this is supposed to be taken into account  \n10:05\u00a0<tmortagne>\u00a0but if that it then it means superdamin lost PR I guess  \n10:05\u00a0<gdelhumeau>\u00a0it can't be related to the commit I just pushed?  \n10:06\u00a0<tmortagne>\u00a0gdelhumeau: I doubt it since it really seems related to the document author  \n10:06\u00a0<tmortagne>\u00a0bu I don't understand why jenkins does not have any issue  \n10:06\u00a0<tmortagne>\u00a0I'm pretty sure there is annotations tests  \n10:07\u00a0<tmortagne>\u00a0testing some stuff with superadmin  \n10:09\u00a0<tmortagne>\u00a0hmm $hasProgramming gives me true in a document saved with superadmin  \n10:09\u00a0<tmortagne>\u00a0maybe an init bug then  \n10:10\u00a0<tmortagne>\u00a0gdelhumeau: any idea where this button come from ? jsx ? uix ?  \n10:10\u00a0<gdelhumeau>\u00a0the annotations button: jsx  \n10:10\u00a0<tmortagne>\u00a0so that would be a not registered jsx  \n10:11\u00a0<gdelhumeau>\u00a0yes, because the JSX is \"always on the wiki\"  \n10:11\u00a0<tmortagne>\u00a0I tough registered jsx for a whole wiki was only requiring admin right  \n10:11\u00a0<gdelhumeau>\u00a0it is  \n10:11\u00a0<gdelhumeau>\u00a0ah sorry  \n10:11\u00a0<gdelhumeau>\u00a0read to fast  \n10:11\u00a0<gdelhumeau>\u00a0\\*too  \n10:12\u00a0<tmortagne>\u00a0if none of the jsx were registered pretty much nothing would work I guess so I doubt that that's the real issue  \n10:12\u00a0<lucaa>\u00a0has joined #xwiki  \n10:12\u00a0<Denis>\u00a0there is a small change in the way PR are tested now  \n10:13\u00a0<tmortagne>\u00a0Denis: I just saved the document with superadmin and I still have the button so I don't think it's a superadmin/PR issue  \n10:13\u00a0<Denis>\u00a0before, we were asking PR on the wiki  \n10:13\u00a0<Denis>\u00a0now we are asking PR on the document itself  \n10:14\u00a0<Denis>\u00a0for superadmin, this should not have any impact  \n10:14\u00a0<tmortagne>\u00a0restarting the wiki  \n10:15\u00a0<tmortagne>\u00a0yep it's something at init  \n10:15\u00a0<tmortagne>\u00a0after restarting the wiki, the button is not there anymore  \n10:17\u00a0<Denis>\u00a0let me check without this small diff  \n10:18\u00a0<tmortagne>\u00a0(and whatever the author at init, I tried with both superadmin and Admin as content author at init)  \n10:18\u00a0<tmortagne>\u00a0gdelhumeau: any jsx in mind that would work ?  \n10:18\u00a0<tmortagne>\u00a0to see if there is something special about the annotation one  \n10:19\u00a0<vmassol>\u00a0bb in 10mn  \n10:24\u00a0<tmortagne>\u00a0Denis: I cnofirm that the problem does not exist in 6.1M2 at least  \n10:24\u00a0<tmortagne>\u00a0so it's only in snapshot  \n10:24\u00a0<gdelhumeau>\u00a0tmortagne: only annotations use JSX with \"always on the wiki'  \n10:24\u00a0<Denis>\u00a0could be that small diff, I am in the meeting now, I try to check that in //  \n10:24\u00a0<gdelhumeau>\u00a0but AnnotationCode.Settings too  \n10:25\u00a0<tmortagne>\u00a0gdelhumeau: really ? everything else is on demand ?  \n10:25\u00a0<gdelhumeau>\u00a0http://hastebin.com/uyiyuxedig.vm  \n10:26\u00a0<tmortagne>\u00a0ok so that could be a general \"always on wiki\" issue at init then indeed  \n10:26\u00a0<gdelhumeau>\u00a0yes  \n10:26\u00a0<tmortagne>\u00a0checking what skinx does at init  \n10:33\u00a0<tmortagne>\u00a0Denis: I think there is something wrong with XWikiCachingRightService#hasProgrammingRights  \n10:34\u00a0<tmortagne>\u00a0contextualAuthorizationManager.hasAccess(Right.PROGRAM, doc.getDocumentReference());  \n10:34\u00a0<tmortagne>\u00a0means testing context user, rigth ?  \n10:34\u00a0<tmortagne>\u00a0which it should test document user in this method  \n10:34\u00a0<tmortagne>\u00a0document content author I mean  \n10:35\u00a0<tmortagne>\u00a0(that's what XWikiRightServiceImpl is doing)  \n10:35\u00a0<tmortagne>\u00a0and what skinx is expecting from what I understand in the code  \n10:36\u00a0<Denis>\u00a0no  \n10:36\u00a0<Denis>\u00a0the backward compatibility check is done in the contextual manager  \n10:38\u00a0<tmortagne>\u00a0ok  \n10:39\u00a0<Denis>\u00a0I have initially only done it there, but it was wrong  \n10:39\u00a0<Denis>\u00a0(there = in the caching right service)  \n10:40\u00a0<Denis>\u00a0I have check fixing the small diff mention above, but it does not really fix the issue  \n10:41\u00a0<tmortagne>\u00a0hmm I don't reproduce the issue anymore  \n10:41\u00a0<tmortagne>\u00a0testing several times  \n10:41\u00a0<Denis>\u00a0?!?  \n10:42\u00a0<Slashman>\u00a0has joined #xwiki  \n10:42\u00a0<tmortagne>\u00a0forget that, I'm still on M2..  \n10:44\u00a0<tmortagne>\u00a0Denis: where is that hack for PR done exactly ?  \n10:45\u00a0<tmortagne>\u00a0ha it's in getCurrentUser  \n10:45\u00a0<Denis>\u00a0in org.xwiki.security.authorization.internal.DefaultContextualAuthorizationManager#getCurrentUser  \n10:46\u00a0<Denis>\u00a0but there is also other aspects  \n10:46\u00a0<tmortagne>\u00a0in any case not sure what wrong in details but the issue is that context.getWiki().getRightService().hasProgrammingRights(doc, context) return false  \n10:46\u00a0<Denis>\u00a0I am testing some stuff manually, let me some time  \n10:47\u00a0<tmortagne>\u00a0comes from checkPreAccess(right)  \n10:47\u00a0<tmortagne>\u00a0hmm xcontextProvider.get().hasDroppedPermissions() return true  \n10:47\u00a0<tmortagne>\u00a0so the issue is not excatly in context.getWiki().getRightService().hasProgrammingRights(doc, context) but before that it seems  \n10:49\u00a0<Denis>\u00a0it is an issue in the stubcontext ?  \n10:49\u00a0<KermitTheFragger>\u00a0has joined #xwiki  \n10:50\u00a0<tmortagne>\u00a0DefaultXWikiStubContextProvider does not call dropPermission no  \n10:51\u00a0<tmortagne>\u00a0it's called by:  \n10:51\u00a0<tmortagne>\u00a0\\* contentview.vm  \n10:52\u00a0<tmortagne>\u00a0and that's all  \n10:53\u00a0<tmortagne>\u00a0maybe some order changed in view.vm  \n10:53\u00a0<tmortagne>\u00a0like registering jsx after rendering the content  \n10:53\u00a0<tmortagne>\u00a0gdelhumeau: any idea related to that ?  \n10:53\u00a0<tmortagne>\u00a0when you save a jsx it's automatically added to some map for later so that's why resaving it works  \n10:54\u00a0<tmortagne>\u00a0so it's not exactly an init issue  \n10:54\u00a0<lucaa>\u00a0has quit  \n10:56\u00a0<lucaa>\u00a0has joined #xwiki  \n10:56\u00a0<vfzevaze>\u00a0has joined #xwiki  \n10:57\u00a0<Enygma`>\u00a0has quit  \n10:59\u00a0<tmortagne>\u00a0I confirm that dropPermission is called before first call to getAlwaysUsedExtensions()  \n11:00\u00a0<gdelhumeau>\u00a0dropPermission is here for age  \n11:00\u00a0<gdelhumeau>\u00a0hmm  \n11:00\u00a0<gdelhumeau>\u00a0haven't changed view.vm of colibri recently  \n11:00\u00a0<tmortagne>\u00a0(by the way it does not make any sense that something like getAlwaysUsedExtensions() is influenced by dropPermission, it should directly test right for the content author using and bypass the context)  \n11:01\u00a0<tmortagne>\u00a0gdelhumeau: yes I know dropPersmission is old but now it's executed before initializing jsx  \n11:01\u00a0<Denis>\u00a0in fact  \n11:01\u00a0<Denis>\u00a0before hasProgrammingRight(context) called it  \n11:01\u00a0<Inge-\\_>\u00a0is now known as <Inge->  \n11:01\u00a0<Denis>\u00a0but hasProgrammingRight(doc, context) does not  \n11:02\u00a0<tmortagne>\u00a0Denis: I'm not talking about security API  \n11:02\u00a0<tmortagne>\u00a0hasProgrammingRight should take care of the droppermission  \n11:02\u00a0<tmortagne>\u00a0but getAlwaysUsedExtensions() should not use contextual auth  \n11:02\u00a0<Denis>\u00a0this explains why it works before  \n11:03\u00a0<tmortagne>\u00a0because getAlwaysUsedExtensions does not care about the context, it olny care about the jsx content author  \n11:03\u00a0<tmortagne>\u00a0ok  \n11:03\u00a0<tmortagne>\u00a0fixing getAlwaysUsedExtensions then  \n11:05\u00a0<Denis>\u00a0so it should not use the contextual auth manager, but the auth manager directly  \n11:05\u00a0<tmortagne>\u00a0Denis: that's what I said yes  \n11:05\u00a0<Denis>\u00a0just wanted to be sure (I am on a meeting in //)  \n11:05\u00a0<tmortagne>\u00a0I guess we will have to review all calls to hasProgrammingRight(doc, context) if its behavior changed  \n11:06\u00a0<Denis>\u00a0that was on my todo  \n11:06\u00a0<tmortagne>\u00a0it's probably not the only think that was broken since it was the only way to test PR or an existing document o old code  \n11:06\u00a0<tmortagne>\u00a0might have broke quite some code  \n11:06\u00a0<tmortagne>\u00a0hope it's not going to be a massacre for others  \n11:06\u00a0<Denis>\u00a0I got disturbed by other projects, as you know  \n11:07\u00a0<Denis>\u00a0there was no clear diff between contextual and not contextual stuff before  \n11:07\u00a0<tmortagne>\u00a0Denis: sure but we can't release without checking all uses of hasProgrammingRight(doc, context)  \n11:07\u00a0<Denis>\u00a0I see it more as a bug IMO  \n11:07\u00a0<Denis>\u00a0this could also break user code  \n11:08\u00a0<Denis>\u00a0maybe, we could do a better approach  \n11:08\u00a0<tmortagne>\u00a0I did not suggested to revert your fix but again that could break many code that only had this API before  \n11:08\u00a0<Denis>\u00a0change the right service to use the \u00a0non-contextual auth manager on the second method  \n11:08\u00a0<evalica>\u00a0has quit  \n11:08\u00a0<Denis>\u00a0this would ensure, right service is stable  \n11:08\u00a0<evalica1>\u00a0has joined #xwiki  \n11:09\u00a0<Denis>\u00a0until we review all use cas  \n11:09\u00a0<Denis>\u00a0e  \n11:09\u00a0<tmortagne>\u00a0we probably don't have a choice for right service yes  \n11:09\u00a0<Denis>\u00a0and only get that change applied when the right service is deprecated  \n11:10\u00a0<tmortagne>\u00a0but no reason to change contextual auth  \n11:12\u00a0<tmortagne>\u00a0also probably make it clear in XWikiRightService javadoc  \n11:12\u00a0<Denis>\u00a0sure, contextualAuthMan is perfectly ok  \n11:13\u00a0<Denis>\u00a0this is more a compatibility issue  \n11:13\u00a0<Denis>\u00a0do you want me to do the fix ?  \n11:13\u00a0<tmortagne>\u00a0Denis: as you prefer, if you don't have time I can take care of it  \n11:14\u00a0<Denis>\u00a0I will  \n11:14\u00a0<Denis>\u00a0it is easy  \n11:15\u00a0<tmortagne>\u00a0still fixing the skinx, better anyway  \n11:17\u00a0<tmortagne>\u00a0will avoid putting back the regression when we fix deprecated API calls ;)  \n11:17\u00a0<vmassol>\u00a0guys, yes please try to make sure that our extensions contributed externally will still work (it's possible some are calling hasProgramminhRight I guess)  \n11:17\u00a0<Denis>\u00a0maybe, should I only use the non contextual when the doc is not null  \n11:17\u00a0<Denis>\u00a0wdyt ?  \n11:18\u00a0<Denis>\u00a0vmassol: we are fixing right service to be backward compatible  \n11:19\u00a0<vmassol>\u00a0cool  \n11:20\u00a0<tmortagne>\u00a0Denis: IMO the safest is to have the exact same behavior than old hasProgrammingRights  \n11:21\u00a0<tmortagne>\u00a0so never testing droppermission on matter what  \n11:21\u00a0<tmortagne>\u00a0s/on/no/  \n11:21\u00a0<tmortagne>\u00a0old hasProgrammingRights(XWikiDocument doc, XWikiContext context) that is  \n11:21\u00a0<Denis>\u00a0the question is, doesn't we have an issue when hasProgrammingRights(context) != hasProgrammingRights(null, context)  \n11:21\u00a0<tmortagne>\u00a0they were different before  \n11:22\u00a0<Denis>\u00a0but isn't it a bug  \n11:22\u00a0<tmortagne>\u00a0not testing droppermission in hasProgrammingRights(XWikiDocument doc, XWikiContext context) is a bug also IMO  \n11:22\u00a0<tmortagne>\u00a0but it's too late  \n11:22\u00a0<Denis>\u00a0not necessarily  \n11:22\u00a0<tmortagne>\u00a0since we have a new component let keep it the same behavior it always had  \n11:23\u00a0<tmortagne>\u00a0if someone wan't the right behavior he can move to new SS or component  \n11:23\u00a0<Denis>\u00a0when using not null document, nothing is taken from context, so it is badly documented but it is consistant  \n11:24\u00a0<tmortagne>\u00a0changing the behavior now is a bad idea IMO  \n11:26\u00a0<tmortagne>\u00a0since we have a new API lets not take any risk with the old one  \n11:28\u00a0<vmassol>\u00a0+1 for no risk :)  \n11:30\u00a0<vmassol>\u00a0\" Used to API\" == Use new API?  \n11:30\u00a0<vmassol>\u00a0:)  \n11:31\u00a0<tmortagne>\u00a0yes written too quickly  \n11:38\u00a0<tmortagne>\u00a0any taker for XWIKI-10497 ?  \n11:38\u00a0<tmortagne>\u00a0gdelhumeau, mflorea ?  \n11:39\u00a0<gdelhumeau>\u00a0could try  \n11:42\u00a0<tmortagne>\u00a0great thanks  \n11:44\u00a0<Denis>\u00a0tmortagne: fixed  \n11:45\u00a0<tmortagne>\u00a0Denis: thanks :)  \n11:46\u00a0<Denis>\u00a0it solve the issue obviously, I got the annotation button back :)  \n11:47\u00a0<gdelhumeau>\u00a0good  \n11:47\u00a0<tmortagne>\u00a0probably solve a few others too :)  \n11:59\u00a0<Denis>\u00a0tmortagne: it was mainly a revert in that case. I am now looking at the first method which also have a few minor change, but that should also be considered  \n12:01\u00a0<Denis>\u00a0as I said earlier, the check is done at document level instead of wiki level, but it should not have any impact AFAIK  \n12:03\u00a0<Denis>\u00a0the other difference is that we now check the rendering context restriction  \n12:03\u00a0<Denis>\u00a0if we don't want those diff, I need to also revert the change in the first method  \n12:04\u00a0<Lyes>\u00a0has quit  \n12:12\u00a0<Lyes>\u00a0has joined #xwiki  \n12:37\u00a0<evalica1>\u00a0is now known as <evalica>  \n12:55\u00a0<lucaa>\u00a0has quit  \n12:57\u00a0<woshilapin>\u00a0has quit  \n12:57\u00a0<DarkKnightCZ>\u00a0has joined #xwiki  \n13:01\u00a0<polx>\u00a0has joined #xwiki  \n13:03\u00a0<ClemensR>\u00a0gdelhumeau: as you are looking for XWIKI-10497 \u00a0... I remember I changed something in the livetable macro in XWIKI-10418 \u00a0... I am looking if that could possibly have caused the issue, but so far did not find anything  \n13:04\u00a0<gdelhumeau>\u00a0actually, if I write \"alert('hello')\" in the script tag of the #livetable macro, it is not displayed with IE inside the modal box  \n13:11\u00a0<gdelhumeau>\u00a0ClemensR: I have reverted your commit and it seems it does not fix the issue  \n13:11\u00a0<gdelhumeau>\u00a0(locally)  \n13:11\u00a0<gdelhumeau>\u00a0but the weird thing is that it worked in 6.0.1  \n13:12\u00a0<gdelhumeau>\u00a0lunch time  \n13:12\u00a0<polx>\u00a0has quit  \n13:20\u00a0<DarkKnightCZ>\u00a0what piece of code is handling adding / modifying objects in app within minutes? (currently, date field ignores user timezone, which is not desirable, especially with applications like calendar)  \n13:25\u00a0<ClemensR>\u00a0gdelhumeau: yes, same here, the IE9 (and only IE9, in IE9-mode) does not execute the script  \n13:29\u00a0<Lyes1>\u00a0has joined #xwiki  \n13:31\u00a0<Lyes>\u00a0has quit  \n13:32\u00a0<ClemensR>\u00a0I copied over the complete \"template\" folder from 6.0.1 to 6.1-milestone-2 and the problem remains  \n13:34\u00a0<Enygma`>\u00a0has joined #xwiki  \n13:39\u00a0<woshilapin>\u00a0has joined #xwiki  \n13:55\u00a0<polx>\u00a0has joined #xwiki  \n13:57\u00a0<ClemensR>\u00a0gdelhumeau: \u00a0there is one difference I found between 6.0.1 and \u00a06.1.-SNAP ad that is script tags seem to get prefixed by /\\*<![CDATA[\\*/ \u00a0automatically in 6.1-SNAP, but not in 6.0.1. No idea where this comes from (or if I am hunting ghosts).  \n13:57\u00a0<ClemensR>\u00a0I have admit I'll leave it at that  \n14:01\u00a0<Slashman\\_>\u00a0has joined #xwiki  \n14:04\u00a0<Slashman>\u00a0has quit  \n14:09\u00a0<cjd>\u00a0has joined #xwiki  \n14:21\u00a0<vmassol>\u00a0has quit  \n14:26\u00a0<gdelhumeau>\u00a0ClemensR: indeed, removing CDATA and put {{html clean=\"false\"}} fix the problem  \n14:27\u00a0<ClemensR>\u00a0oh, odd ... no idea why it worked in 6.0.1 then ..  \n14:28\u00a0<GuillaumeF>\u00a0has joined #xwiki  \n14:29\u00a0<gdelhumeau>\u00a0/<![CDATA[ is in macros.vm for many years  \n14:29\u00a0<gdelhumeau>\u00a0but maybe the problem comes from the HTML Cleaner  \n14:30\u00a0<gdelhumeau>\u00a0which replaces it by \u00a0/\\*<![CDATA[\\*/  \n14:30\u00a0<lucaa>\u00a0has joined #xwiki  \n14:32\u00a0<tmortagne>\u00a0gdelhumeau: so that would be a regression caused by a htmlcleaner upgrade  \n14:33\u00a0<gdelhumeau>\u00a0actually it does not replace it  \n14:33\u00a0<gdelhumeau>\u00a0but web inspector played with me  \n14:33\u00a0<tmortagne>\u00a0hmm we did not upgraded htmlcleaner in 6.1 it seems  \n14:35\u00a0<tmortagne>\u00a0was in 6.0M2...  \n14:35\u00a0<tmortagne>\u00a0so 6.0.1 and 6.1-SNAPSHOT should have the same htmlcleaner version  \n14:36\u00a0<gdelhumeau>\u00a0{{html clean=false}} fixes the issue. I'm gonna compare the generated code with and without the cleane  \n14:37\u00a0<ClemensR>\u00a0yes, 6.1-SNAPSHOT and 6.0.1 have the same htmlcleaner-2.8.jar \u00a0\u00a0(at least over here ;)  \n14:37\u00a0<gdelhumeau>\u00a0clean=false AND removing <![CDATA fixes the issue  \n14:39\u00a0<ClemensR>\u00a0but if I \u00a0use wget to fetch i.e. WikiManager.WebHome (no js / ajax stuff or login needed to get that page) I get //<![CDATA[ \u00a0\u00a0in the livetable script tag with 6.0.1, and a /\\* <![CDATA[ \\*/ \u00a0with 6.1-SNAPSHOT ... maybe it is possible to configure this somewhere ?  \n14:41\u00a0<gdelhumeau>\u00a0yes it replaces it by /\\*<![CDATA[\\*/  \n14:41\u00a0<gdelhumeau>\u00a0so there is definitively something there  \n14:43\u00a0<tmortagne>\u00a0gdelhumeau, ClemensR: you end up with /\\*<![CDATA[\\*/ even with clean =false ?  \n14:43\u00a0<ClemensR>\u00a0no  \n14:43\u00a0<gdelhumeau>\u00a0no  \n14:43\u00a0<tmortagne>\u00a0so why \"clean=false AND removing <![CDATA\" is required ?  \n14:43\u00a0<ClemensR>\u00a0I am only still trying to figure out what introduced the difference ...  \n14:44\u00a0<tmortagne>\u00a0clean=false is not enough to have the same than 6.0.1 ?  \n14:45\u00a0<tmortagne>\u00a0anyway it's weird than the exact same version of htmlcleaner can have different behavior  \n14:47\u00a0<tmortagne>\u00a0gdelhumeau: https://github.com/xwiki/xwiki-commons/commit/4908f99341673af2776ff5866c05a7db82d8b489 ?  \n14:47\u00a0<gdelhumeau>\u00a0yep  \n14:47\u00a0<tmortagne>\u00a0did not check all the details but seems to be adding /\\* \\*/  \n14:47\u00a0<gdelhumeau>\u00a0it looks like this!  \n14:47\u00a0<tmortagne>\u00a0and it's recent  \n14:48\u00a0<gdelhumeau>\u00a0yes it must be this issue  \n14:48\u00a0<tmortagne>\u00a0not sure how this change can be related to css  \n14:48\u00a0<gdelhumeau>\u00a0because in CSS the comments are /\\* \\*/, not //  \n14:48\u00a0<ClemensR>\u00a0ah, ys, that is correct for inline CSS, but seemingly not for script (and IE9)...  \n14:49\u00a0<tmortagne>\u00a0very nice, so a change only valid for css in the default htmlcleaner ?  \n14:50\u00a0<ClemensR>\u00a0yes, I would say so  \n14:52\u00a0<gdelhumeau>\u00a0hmm I have a cache issue with IE so I have troubles when checking what is wrong  \n14:52\u00a0<gdelhumeau>\u00a0but logically, only the commit introduced by Sergiu could be the origin of this issue  \n14:53\u00a0<gdelhumeau>\u00a0tmortagne: it's not normal that IE have problems with /\\* CDATA \\*/ instead of // CDATA  \n14:53\u00a0<gdelhumeau>\u00a0again it's an IE stupid issue  \n14:54\u00a0<tmortagne>\u00a0the comment say all that is for IE6, does we need it at all now ?  \n14:54\u00a0<gdelhumeau>\u00a0so they only way to fix it is to have a new parameters for the HTML cleaner...  \n14:54\u00a0<tmortagne>\u00a0(since we don't support IE6 anymore)  \n14:54\u00a0<tmortagne>\u00a0shouldn't we simply stop commenting CDATA ?  \n14:56\u00a0<tmortagne>\u00a0if it's really only for IE6 there is no reason to keep doing it  \n14:56\u00a0<gdelhumeau>\u00a0http://stackoverflow.com/questions/66837/when-is-a-cdata-section-necessary-within-a-script-tag  \n14:56\u00a0<ClemensR>\u00a0ftr: here just using clean=\"false\" does not work, too ... the commented CDATA seens to be the prpbnlem, no mater if // or \\*/ ... \\*/  \n14:57\u00a0<ClemensR>\u00a0(modulo typos ...)  \n14:57\u00a0<gdelhumeau>\u00a0ClemensR: try to clean your browser cache  \n14:57\u00a0<gdelhumeau>\u00a0I don't know how to do it with IE  \n14:57\u00a0<gdelhumeau>\u00a0but when I go to an other page that have a livetable, it works with //CDATA  \n14:57\u00a0<ClemensR>\u00a0gdelhumeau: \u00a0I checked with dev-tools that the HTML has a //<![CDATA[ \u00a0with clean=\"false\"  \n15:01\u00a0<gdelhumeau>\u00a0http://dorward.me.uk/www/comments-cdata/#trumpet  \n15:01\u00a0<tmortagne>\u00a0gdelhumeau, ClemensR: any comment on my lets remove all that suggestion ?  \n15:01\u00a0<gdelhumeau>\u00a0I don't understand  \n15:01\u00a0<tmortagne>\u00a0by the way according to the that has been applied to 5.4 branch too so it's probably in 5.4.5  \n15:01\u00a0<ClemensR>\u00a0aty least in this case it seems to be the change that fixed the bug, the CDATA scrapping, I mean  \n15:02\u00a0<ClemensR>\u00a0I am hesitating as I have no idea what else might break  \n15:02\u00a0<tmortagne>\u00a0gdelhumeau: the code say that CDATA is commented for IE6 only  \n15:02\u00a0<Enygma`>\u00a0has quit  \n15:02\u00a0<tmortagne>\u00a0either the code is not true or we don't need to do that anymore  \n15:03\u00a0<gdelhumeau>\u00a0or we improve XWikiDOMSerializer#flushContent()  \n15:04\u00a0<gdelhumeau>\u00a0trivial to improve actually  \n15:04\u00a0<ClemensR>\u00a0I am 95% confident we do not need this anymore, but the remaining 5% bother me - such a change is a good way to blow up a release in my experience (please dont ask for details ...)  \n15:04\u00a0<tmortagne>\u00a0I don't really see the point in supporting something useless  \n15:04\u00a0<tmortagne>\u00a0it's making the code more complex and so more bug prone for nothing  \n15:04\u00a0<ClemensR>\u00a0for me it is that there is 5% chance it is notuseless  \n15:04\u00a0<Enygma`>\u00a0has joined #xwiki  \n15:05\u00a0<gdelhumeau>\u00a0\"The comment syntax is helpful only to user agents that you are extremely unlikely to encounter and, as such, are not worth worrying about.\"  \n15:05\u00a0<gdelhumeau>\u00a0he doesn't say explictly which ones  \n15:06\u00a0<tmortagne>\u00a0\"user agents that you are extremely unlikely to encounter\" is enough for me  \n15:06\u00a0<tmortagne>\u00a0we have an explicit list of supported browsers so it should not be too hard to simple test them at worst  \n15:06\u00a0<tmortagne>\u00a0s/simple/simply/  \n15:07\u00a0<gdelhumeau>\u00a0Ok it looks the smartest choice then  \n15:07\u00a0<gdelhumeau>\u00a0XWIki does not support old stupid browsers!  \n15:08\u00a0<ClemensR>\u00a0\"extremely unlikely\" even back in 2009 actually :)  \n15:09\u00a0<gdelhumeau>\u00a0should I create a new issue in XCOMMONS?  \n15:16\u00a0<evalica>\u00a0sorry for the spam :) but I still have work to do  \n15:16\u00a0<tmortagne>\u00a0gdelhumeau: you can move XWIKI-10497 I guess since there is nothing to do at platform level, right ?  \n15:17\u00a0<gdelhumeau>\u00a0tmortagne: nothing to do but it is good to keep the description of the bug to avoid having it reported twice?  \n15:17\u00a0<tmortagne>\u00a0you can keep the same description IMO it's ok  \n15:18\u00a0<tmortagne>\u00a0(you can create another issue if you really prefer :))  \n15:18\u00a0<gdelhumeau>\u00a0yes :)  \n15:19\u00a0<Enygma`>\u00a0has quit  \n15:20\u00a0<Enygma`>\u00a0has joined #xwiki  \n15:20\u00a0<Enygma`>\u00a0has quit  \n15:20\u00a0<Enygma`>\u00a0has joined #xwiki  \n15:21\u00a0<Enygma`>\u00a0has quit  \n15:21\u00a0<Enygma`>\u00a0has joined #xwiki  \n15:24\u00a0<gdelhumeau>\u00a0XCOMMONS-611  \n15:26\u00a0<Enygma`>\u00a0has quit  \n15:27\u00a0<Enygma`>\u00a0has joined #xwiki  \n15:30\u00a0<Enygma`>\u00a0has quit  \n15:44\u00a0<lucaa>\u00a0has quit  \n15:50\u00a0<tmortagne>\u00a0gdelhumeau: seems to me you can also remove COMMENT\\_START and COMMENT\\_END  \n15:57\u00a0<msmeria>\u00a0has quit  \n15:59\u00a0<lucaa>\u00a0has joined #xwiki  \n16:10\u00a0<vfzevaze>\u00a0has quit  \n16:12\u00a0<tmortagne>\u00a0gdelhumeau: there is also a few tests to modify in rendering  \n16:16\u00a0<DarkKnightCZ>\u00a0has quit  \n16:29\u00a0<gdelhumeau>\u00a0ok, handling it  \n16:29\u00a0<lucaa>\u00a0has quit  \n16:31\u00a0<evalica>\u00a0has quit  \n16:32\u00a0<lucaa>\u00a0has joined #xwiki  \n16:47\u00a0<gdelhumeau>\u00a0shit  \n16:47\u00a0<gdelhumeau>\u00a0now IE9 says syntax error about <!CDATA  \n16:48\u00a0<gdelhumeau>\u00a0this is so stupid...  \n16:48\u00a0<gdelhumeau>\u00a0actually, IE9 needs the // comment on the CDATA  \n16:48\u00a0<gdelhumeau>\u00a0actually, IE9 needs the // comment on the CDATA tag  \n16:48\u00a0<tmortagne>\u00a0in script ?  \n16:48\u00a0<gdelhumeau>\u00a0yes -\\_-  \n16:49\u00a0<gdelhumeau>\u00a0now I'm gonna revert my modifications and improve escapeXML  \n16:49\u00a0<tmortagne>\u00a0so much for the \"user agents that you are extremely unlikely to encounter\"  \n16:50\u00a0<ClemensR>\u00a0I guess the issue is that we are \"in HTML mode\", not \"in XHTML mode\"  \n16:50\u00a0<ClemensR>\u00a0maybe it helps having spaces around the CDATA (just for IE9?)  \n16:51\u00a0<tmortagne>\u00a0right that's the over hack about IE6, not really declaring xhtml  \n16:59\u00a0<tmortagne>\u00a0looks like it's really not clear that milestones are beta versions...  \n17:02\u00a0<tmortagne>\u00a0we should maybe use \"beta\" instead of \"milestone\"  \n17:22\u00a0<Lyes1>\u00a0has quit  \n17:22\u00a0<DarkKnightCZ>\u00a0has joined #xwiki  \n17:24\u00a0<gdelhumeau>\u00a0this time I have a the good fix  \n17:26\u00a0<ClemensR>\u00a0ah, ok, phew  \n17:29\u00a0<tmortagne>\u00a0gdelhumeau: great :)  \n17:37\u00a0<ClemensR>\u00a0has quit  \n17:39\u00a0<gdelhumeau>\u00a0fixing rendering  \n17:46\u00a0<polx>\u00a0has quit  \n17:53\u00a0<sdumitriu>\u00a0has quit  \n17:53\u00a0<sdumitriu>\u00a0has joined #xwiki  \n17:55\u00a0<Denis>\u00a0has quit  \n17:56\u00a0<tmortagne>\u00a0has quit  \n18:05\u00a0<gdelhumeau>\u00a0has quit  \n18:05\u00a0<mflorea>\u00a0has quit  \n18:13\u00a0<Slashman\\_>\u00a0has quit  \n18:14\u00a0<Slashman>\u00a0has joined #xwiki  \n18:20\u00a0<polx>\u00a0has joined #xwiki  \n18:20\u00a0<KermitTheFragger>\u00a0has quit  \n18:25\u00a0<polx>\u00a0has quit  \n18:30\u00a0<cjd>\u00a0has quit  \n18:32\u00a0<polx>\u00a0has joined #xwiki  \n18:40\u00a0<woshilapin>\u00a0has quit  \n18:42\u00a0<GuillaumeF>\u00a0has quit  \n18:45\u00a0<abusenius>\u00a0has joined #xwiki  \n18:54\u00a0<abusenius>\u00a0has quit  \n19:05\u00a0<polx>\u00a0has quit  \n19:08\u00a0<polx>\u00a0has joined #xwiki  \n19:25\u00a0<Slashman>\u00a0has quit  \n19:31\u00a0<polx>\u00a0has quit  \n19:32\u00a0<Lyes>\u00a0has joined #xwiki  \n19:36\u00a0<lucaa>\u00a0has quit  \n19:41\u00a0<Lyes>\u00a0has quit  \n19:52\u00a0<polx>\u00a0has joined #xwiki  \n20:17\u00a0<abusenius>\u00a0has joined #xwiki  \n20:27\u00a0<polx>\u00a0has quit  \n20:27\u00a0<polx>\u00a0has joined #xwiki  \n20:32\u00a0<Lyes>\u00a0has joined #xwiki  \n20:35\u00a0<Lyes>\u00a0has quit  \n20:37\u00a0<OSIMasson>\u00a0has joined #xwiki  \n22:36\u00a0<vmassol>\u00a0has joined #xwiki  \n22:36\u00a0<Denis>\u00a0has joined #xwiki  \n22:49\u00a0<DarkKnightCZ>\u00a0has quit  \n22:50\u00a0<vmassol>\u00a0has quit  \n23:07\u00a0<Denis>\u00a0has quit  \n23:21\u00a0<polx>\u00a0has quit\n"}