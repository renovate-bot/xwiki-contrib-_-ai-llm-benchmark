{"id": "dev:IRC.xwikiArchive20121212", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20121212", "title": "IRC Archive for channel #xwiki on 12 December 2012 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<fmancinelli>\u00a0has quit  \n00:30\u00a0<vmassol>\u00a0has joined #xwiki  \n00:31\u00a0<abusenius>\u00a0has quit  \n00:35\u00a0<vmassol>\u00a0has quit  \n00:46\u00a0<mrvanes>\u00a0has quit  \n01:08\u00a0<jvdrean>\u00a0has quit  \n01:31\u00a0<vmassol>\u00a0has joined #xwiki  \n01:36\u00a0<vmassol>\u00a0has quit  \n01:46\u00a0<cjd>\u00a0has quit  \n02:32\u00a0<vmassol>\u00a0has joined #xwiki  \n02:36\u00a0<vmassol>\u00a0has quit  \n03:27\u00a0<tekzilla>\u00a0has quit  \n03:29\u00a0<tekzilla>\u00a0has joined #xwiki  \n03:32\u00a0<vmassol>\u00a0has joined #xwiki  \n03:37\u00a0<vmassol>\u00a0has quit  \n04:01\u00a0<Slashman>\u00a0has quit  \n04:29\u00a0<cjd>\u00a0has joined #xwiki  \n04:31\u00a0<Denis>\u00a0has joined #xwiki  \n04:33\u00a0<vmassol>\u00a0has joined #xwiki  \n04:38\u00a0<vmassol>\u00a0has quit  \n04:42\u00a0<cjd>\u00a0has quit  \n04:43\u00a0<cjd>\u00a0has joined #xwiki  \n05:33\u00a0<vmassol>\u00a0has joined #xwiki  \n05:38\u00a0<vmassol>\u00a0has quit  \n06:01\u00a0<Denis>\u00a0has quit  \n06:33\u00a0<vmassol>\u00a0has joined #xwiki  \n06:38\u00a0<vmassol>\u00a0has quit  \n07:22\u00a0<npm>\u00a0has quit  \n07:22\u00a0<npm>\u00a0has joined #xwiki  \n07:34\u00a0<vmassol>\u00a0has joined #xwiki  \n07:39\u00a0<vmassol>\u00a0has quit  \n07:56\u00a0<mflorea>\u00a0has joined #xwiki  \n07:59\u00a0<vmassol>\u00a0has joined #xwiki  \n08:08\u00a0<vmassol>\u00a0has quit  \n08:09\u00a0<mrvanes>\u00a0has joined #xwiki  \n08:29\u00a0<Denis>\u00a0has joined #xwiki  \n08:41\u00a0<zykes->\u00a0how can I easily take https://github.com/xwiki-contrib/xwiki-platform-cloud and use it ?  \n08:50\u00a0<Denis>\u00a0zykes-: looks http://blog.fabio.mancinelli.me/2012/04/06/XWiki\\_in\\_the\\_cloud.html  \n08:52\u00a0<Inge->\u00a0Good morning.  \n09:23\u00a0<msmeria>\u00a0has joined #xwiki  \n09:33\u00a0<vmassol>\u00a0has joined #xwiki  \n09:37\u00a0<msmeria>\u00a0has quit  \n09:39\u00a0<msmeria>\u00a0has joined #xwiki  \n09:51\u00a0<tdelafosse>\u00a0has joined #xwiki  \n10:18\u00a0<SvenDowideit>\u00a0has quit  \n10:21\u00a0<vmassol1>\u00a0has joined #xwiki  \n10:21\u00a0<vmassol>\u00a0has quit  \n10:33\u00a0<jvdrean>\u00a0has joined #xwiki  \n10:33\u00a0<vmassol1>\u00a0guys the build is failing on commons. I'm in a meeting now but I'll look at it after  \n10:34\u00a0<vmassol1>\u00a0s/commons/platform  \n10:37\u00a0<fmancinelli>\u00a0has joined #xwiki  \n10:51\u00a0<vmassol1>\u00a0has quit  \n11:01\u00a0<jvdrean1>\u00a0has joined #xwiki  \n11:05\u00a0<jvdrean>\u00a0has quit  \n11:13\u00a0<evalica>\u00a0has joined #xwiki  \n11:17\u00a0<Enygma`>\u00a0has joined #xwiki  \n11:22\u00a0<SvenDowideit>\u00a0has joined #xwiki  \n11:31\u00a0<msmeria>\u00a0has quit  \n11:31\u00a0<vmassol>\u00a0has joined #xwiki  \n11:32\u00a0<msmeria>\u00a0has joined #xwiki  \n12:01\u00a0<Enygma`>\u00a0vmassol: it seems that you have moved some of the testing framework`s classes (to .jmock package) but did not update the tests that were using them. http://ci.xwiki.org/job/xwiki-enterprise-test-rest/2005/console and http://ci.xwiki.org/job/xwiki-platform/org.xwiki.platform$xwiki-platform-extension-handler-xar/3040/testReport/junit/org.xwiki.extension.xar/XarExtensionHandlerTest/testInstallOnWiki/ seem to be failing because of this. There are probably other   \n12:02\u00a0<vmassol>\u00a0yes, sorry I'm in a meeting ATM  \n12:02\u00a0<vmassol>\u00a0I don't understand why since locally it's passing  \n12:02\u00a0<vmassol>\u00a0I've logged on a6  \n12:02\u00a0<vmassol>\u00a0got to go, bbl  \n12:02\u00a0<Enygma`>\u00a0k  \n12:04\u00a0<vmassol>\u00a0Enygma`: if you look at RepositoryUtil from extension tests, do you have the right import?  \n12:05\u00a0<cjd>\u00a0just ran it locally here, passes for me too.. probably maven went and trashed it's local cache on the ci agent again  \n12:17\u00a0<cjd>\u00a0going to try building on the agent manually  \n12:18\u00a0<vmassol>\u00a0it's failing  \n12:18\u00a0<vmassol>\u00a0just tried  \n12:18\u00a0<vmassol>\u00a0if you look on a6:  \n12:19\u00a0<vmassol>\u00a0[hudsonagent@agent-6 xwiki-commons-extension]$ more ./xwiki-commons-extension-api/src/test/java/org/xwiki/extension/test/RepositoryUtil.java  \n12:19\u00a0<vmassol>\u00a0you'll see:  \n12:19\u00a0<vmassol>\u00a0import org.xwiki.test.MockConfigurationSource;  \n12:19\u00a0<vmassol>\u00a0instead of:  \n12:19\u00a0<vmassol>\u00a0import org.xwiki.test.internal.MockConfigurationSource;  \n12:19\u00a0<Enygma`>\u00a0builds on my machine (extension-handler-xar)  \n12:19\u00a0<vmassol>\u00a0hmm but that's normal actually  \n12:19\u00a0<vmassol>\u00a0if commons has not been built on a6  \n12:20\u00a0<vmassol>\u00a0then there has been no git pull  \n12:20\u00a0<Enygma`>\u00a0so the agent had the old sources  \n12:20\u00a0<vmassol>\u00a0does it mean our CI strategy is broken?  \n12:20\u00a0<vmassol>\u00a0ah no  \n12:20\u00a0<vmassol>\u00a0my bad  \n12:20\u00a0<Enygma`>\u00a0at built time, the remote builds are also checked and downloaded (if newer exist)  \n12:20\u00a0<Enygma`>\u00a0:)  \n12:21\u00a0<vmassol>\u00a0it should get the commons jars from the maven repo  \n12:21\u00a0<vmassol>\u00a0not from the sources  \n12:21\u00a0<Enygma`>\u00a0exactly  \n12:21\u00a0<Enygma`>\u00a0maybe it was a bad synchronization  \n12:21\u00a0<Enygma`>\u00a0and the build was not yet ready  \n12:21\u00a0<Enygma`>\u00a0and it was using new sources with old builds  \n12:22\u00a0<Enygma`>\u00a0new sources of platform with old commons builds  \n12:22\u00a0<Enygma`>\u00a0I think this can happen (if the new commons build is in progress and not yet published)  \n12:22\u00a0<mflorea>\u00a0has quit  \n12:23\u00a0<Enygma`>\u00a0actually, when using multiple agents, this situation should be relatively common...  \n12:23\u00a0<vmassol>\u00a0brb  \n12:33\u00a0<Slashman>\u00a0has joined #xwiki  \n12:41\u00a0<vmassol>\u00a0has quit  \n12:42\u00a0<cjd>\u00a0https://ezcrypt.it/eG5n#oyetroaIIrtDTzWyEI5eoQYl <-- lol  \n12:49\u00a0<vmassol>\u00a0has joined #xwiki  \n12:50\u00a0<tdelafosse>\u00a0has quit  \n12:58\u00a0<cjd>\u00a0well it doesn't seem to be doing any versioning of it's test jars  \n12:59\u00a0<cjd>\u00a0https://ezcrypt.it/fG5n#mEOSVT62hwZDAqNKpKIuBHb3  \n13:01\u00a0<cjd>\u00a0and xwiki-commons-extension-api-4.4-SNAPSHOT-tests.jar does indeed have the offending inclusion  \n13:02\u00a0<tdelafosse>\u00a0has joined #xwiki  \n13:10\u00a0<vmassol>\u00a0has quit  \n13:23\u00a0<vmassol>\u00a0has joined #xwiki  \n13:34\u00a0<Slashman>\u00a0has quit  \n13:37\u00a0<Slashman>\u00a0has joined #xwiki  \n13:40\u00a0<Slashman\\_>\u00a0has joined #xwiki  \n13:43\u00a0<Slashman>\u00a0has quit  \n13:43\u00a0<Slash\\_\\_>\u00a0has joined #xwiki  \n13:46\u00a0<Slashman\\_>\u00a0has quit  \n13:54\u00a0<Denis>\u00a0has quit  \n13:58\u00a0<sburjan>\u00a0has joined #xwiki  \n13:58\u00a0<Denis>\u00a0has joined #xwiki  \n14:05\u00a0<mflorea>\u00a0has joined #xwiki  \n14:16\u00a0<Slash\\_\\_>\u00a0has quit  \n14:20\u00a0<vmassol>\u00a0back  \n14:20\u00a0<vmassol>\u00a0I see platform is passing now  \n14:20\u00a0<vmassol>\u00a0has anything been done?  \n14:20\u00a0<vmassol>\u00a0do we know what was the problem?  \n14:24\u00a0<cjd>\u00a0problem was poison in the ~/.m2/ dir  \n14:24\u00a0<cjd>\u00a0https://ezcrypt.it/fG5n#mEOSVT62hwZDAqNKpKIuBHb3  \n14:25\u00a0<cjd>\u00a0there's the dir structure, you can see it has snapshot versions of the main jar but not the test jar  \n14:25\u00a0<cjd>\u00a0only a single instance  \n14:25\u00a0<vmassol>\u00a0ok...  \n14:25\u00a0<vmassol>\u00a0so we don't know how it came to be, right?  \n14:25\u00a0<cjd>\u00a0maven messed up :)  \n14:26\u00a0<vmassol>\u00a0fixing rest tests  \n14:29\u00a0<Slash\\_\\_>\u00a0has joined #xwiki  \n14:34\u00a0<Denis>\u00a0has quit  \n14:39\u00a0<Enygma`>\u00a0AndreasJonsson: Hi, are you available?  \n14:40\u00a0<Enygma`>\u00a0AndreasJonsson: I`d need your help on fixing XWIKI-8598 which is caused by https://github.com/xwiki/xwiki-platform/commit/55aed0b3e17557f6da4a97580489302d8bc7bba6#L7R126  \n14:43\u00a0<Slash\\_\\_>\u00a0is now known as <Slashman>  \n14:43\u00a0<Slashman>\u00a0has quit  \n14:44\u00a0<Slashman>\u00a0has joined #xwiki  \n15:08\u00a0<vmassol>\u00a0I'm really sorry about this guys and I apologize  \n15:09\u00a0<vmassol>\u00a0I've made a mess refactoring the test module  \n15:09\u00a0<vmassol>\u00a0I just realized I had forgotten to push several commits  \n15:09\u00a0<vmassol>\u00a0in enterprise and manager  \n15:09\u00a0<vmassol>\u00a0should be ok now  \n15:10\u00a0<vmassol>\u00a0mflorea: how are you progressing on the static list bug + sergiu's bug?  \n15:10\u00a0<vmassol>\u00a0just like to know when I can release (provided the test pass fine otherwise)  \n15:11\u00a0<mflorea>\u00a0vmassol: I have the static list bug fix locally but I want to fix the double escaping bug Denis described in his last comment on http://jira.xwiki.org/browse/XWIKI-8575  \n15:12\u00a0<vmassol>\u00a0ok so you should have it in the coming hours I guess, I think realistically we nee dto stabilize the build by end of day today  \n15:12\u00a0<vmassol>\u00a0so that I can cut the release tomorrw  \n15:12\u00a0<mflorea>\u00a0yes  \n15:12\u00a0<vmassol>\u00a0this failing test is really annoying me: http://ci.xwiki.org/view/Functional%20Tests/job/xwiki-enterprise-test-extension/  \n15:13\u00a0<mflorea>\u00a0by \"sergiu's bug\" you mean http://jira.xwiki.org/browse/XWIKI-8599 ?  \n15:13\u00a0<vmassol>\u00a0(it's a flicker from what you told me, which is why it's annoying)  \n15:13\u00a0<vmassol>\u00a0not sure, you said yesterday that sergiu committed something that made extesion test fail  \n15:13\u00a0<vmassol>\u00a0right?  \n15:13\u00a0<mflorea>\u00a0yes, that is the one failing now on http://ci.xwiki.org/view/Functional%20Tests/job/xwiki-enterprise-test-extension/  \n15:14\u00a0<mflorea>\u00a0it's not a flicker  \n15:14\u00a0<vmassol>\u00a0yep  \n15:14\u00a0<mflorea>\u00a0and it's not a bug, I just need to update the test  \n15:14\u00a0<vmassol>\u00a0the flicekr was the other one  \n15:14\u00a0<vmassol>\u00a0ok  \n15:14\u00a0<mflorea>\u00a0I'll take care of it after I commit my fix for http://jira.xwiki.org/browse/XWIKI-8575  \n15:16\u00a0<vmassol>\u00a0k  \n15:19\u00a0<vmassol>\u00a0mflorea: your lucky day!  \n15:19\u00a0<vmassol>\u00a0http://jira.xwiki.org/browse/XWIKI-8600  \n15:20\u00a0<mflorea>\u00a0well, that is really by design, it's really minor  \n15:31\u00a0<vmassol>\u00a0are you sure it's happening only for AWM?  \n15:32\u00a0<vmassol>\u00a0and not when using template= in the URL  \n15:32\u00a0<vmassol>\u00a0(ie when creating a new page based on a template)  \n15:32\u00a0<vmassol>\u00a0(mflorea)  \n15:33\u00a0<mflorea>\u00a0let me check something (I remember I pass the template param only if the document is new, that's why I said above this behavior is \"by design\")  \n15:36\u00a0<mflorea>\u00a0vmassol: no, I don't test is the document is new, so yes the template parameter is passed  \n15:37\u00a0<mflorea>\u00a0but I think it's normal because the action is not create but edit  \n15:39\u00a0<mrvanes>\u00a0has quit  \n15:42\u00a0<mrvanes>\u00a0has joined #xwiki  \n15:51\u00a0<mrvanes>\u00a0has quit  \n16:09\u00a0<Enygma`>\u00a0vmassol: any idea what`s with these errors of failure to start XWiki in tests http://ci.xwiki.org/job/xwiki-enterprise-test-xmlrpc-4.3/org.xwiki.enterprise$xwiki-enterprise-test-xmlrpc/207/testReport/org.xwiki.test.integration/XWikiTestSetup/junit\\_framework\\_TestSuite\\_2eb1074a/ ?  \n16:10\u00a0<Enygma`>\u00a0it seems that they appear on agent-10  \n16:10\u00a0<Enygma`>\u00a0could there be an XWiki instance stuck on it, making the tests fail to start a new instance?  \n16:31\u00a0<vmassol>\u00a0Enygma`: was in a meeting  \n16:32\u00a0<vmassol>\u00a0Enygma`: yesterday I put agent 5 offline to analyze http://ci.xwiki.org/view/Functional%20Tests/job/xwiki-enterprise-test-extension/org.xwiki.enterprise$xwiki-enterprise-test-extension/1288/testReport/org.apache.maven.surefire.junit4/JUnit4Provider/org\\_xwiki\\_test\\_ui\\_AllTests/  \n16:32\u00a0<vmassol>\u00a0which seems to be very similar  \n16:33\u00a0<Enygma`>\u00a0yep, seems to be the same thing  \n16:33\u00a0<Enygma`>\u00a0no zombie java process?  \n16:33\u00a0<vmassol>\u00a0basically the problem is that an xwiki instance is started  \n16:33\u00a0<vmassol>\u00a0so it's on port 8080  \n16:33\u00a0<vmassol>\u00a0but when you ping it it doesn't answer  \n16:33\u00a0<vmassol>\u00a0so the test starts a new xwiki instance  \n16:33\u00a0<vmassol>\u00a0and fails since port 8080 is already used  \n16:34\u00a0<vmassol>\u00a0now  \n16:34\u00a0<vmassol>\u00a0the test stop the instance and the end  \n16:34\u00a0<vmassol>\u00a0but it doesn't succeed in practice  \n16:34\u00a0<vmassol>\u00a0I've tried manually on the agent to call stop\\_xwiki.sh  \n16:34\u00a0<vmassol>\u00a0and it fails to stop it  \n16:34\u00a0<vmassol>\u00a0so basically we have a stuck instance and we don't know why:  \n16:34\u00a0<vmassol>\u00a01) it wasn't stopped properly initially  \n16:35\u00a0<vmassol>\u00a02) it doesn't answer to ping  \n16:35\u00a0<vmassol>\u00a0I've retrieved some thread stack  \n16:35\u00a0<cjd>\u00a0is it consuming cpu?  \n16:35\u00a0<vmassol>\u00a0yes  \n16:35\u00a0<vmassol>\u00a0100%  \n16:35\u00a0<cjd>\u00a0paste stack dump?  \n16:36\u00a0<vmassol>\u00a0https://gist.github.com/4260413  \n16:36\u00a0<vmassol>\u00a0and https://gist.github.com/4260396  \n16:36\u00a0<vmassol>\u00a0taken at a few seconds of intervalls  \n16:36\u00a0<vmassol>\u00a0I couldn't figure out yet what's the problem  \n16:36\u00a0<vmassol>\u00a0what I'd like to do  \n16:36\u00a0<vmassol>\u00a0is modify start/stop\\_xwiki.sh to do the following  \n16:36\u00a0<vmassol>\u00a0save the pid when starting java  \n16:37\u00a0<vmassol>\u00a0and in stop\\_xwiki.sh  \n16:37\u00a0<vmassol>\u00a0kill the server if it cannot stop normally  \n16:37\u00a0<vmassol>\u00a0first trying with a normal gentle kill  \n16:37\u00a0<cjd>\u00a0hit it again  \n16:37\u00a0<vmassol>\u00a0and following that by a kill ?9 if it still doesn't stop  \n16:37\u00a0<cjd>\u00a0I want to see 2 traces  \n16:37\u00a0<vmassol>\u00a0let me get a new trace  \n16:37\u00a0<vmassol>\u00a0I haven't stopped it voluntarily on gaent5  \n16:38\u00a0<vmassol>\u00a0it's not agent5 it's agent2 btw  \n16:38\u00a0<cjd>\u00a0this looks like my fault but I don't see exactly what's happening  \n16:39\u00a0<vmassol>\u00a0new stack: https://gist.github.com/4268783  \n16:39\u00a0<vmassol>\u00a0your fault?  \n16:40\u00a0<cjd>\u00a0yeah, I must have broke something in the image resizer  \n16:40\u00a0<cjd>\u00a0\"DestroyJavaVM\" prio=10 tid=0x00007fc3b4007000 nid=0x19a waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE <-- interesting  \n16:41\u00a0<cjd>\u00a0mind if I jump on the machine and have a look?  \n16:41\u00a0<vmassol>\u00a0go ahead  \n16:41\u00a0<cjd>\u00a0maybe there are other factors at play  \n16:41\u00a0<vmassol>\u00a0if possible don't stop the java process  \n16:41\u00a0<vmassol>\u00a0so that we can find out what's wrong with it  \n16:41\u00a0<cjd>\u00a0indeed  \n16:41\u00a0<vmassol>\u00a0log on maven.xwiki.org and then a2  \n16:42\u00a0<vmassol>\u00a0(connection to agent-2.maven.xwiki.org will go to the wrong agent\u2026 ;))  \n16:42\u00a0<cjd>\u00a0oh weird  \n16:42\u00a0<vmassol>\u00a0yeah I've pinged infra  \n16:42\u00a0<vmassol>\u00a0but they hav\"n't answered  \n16:45\u00a0<cjd>\u00a0maven@maven:~$ ssh [[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \n16:45\u00a0<cjd>\u00a0?  \n16:46\u00a0<cjd>\u00a0I'm still getting the wrong server  \n16:47\u00a0<cjd>\u00a0hudsonagent@ks201485:~$  \n16:52\u00a0<cjd>\u00a0vmassol: /sbin/ip addr show | grep eth0  \n16:52\u00a0<cjd>\u00a0I seem not to be able to get on the right server  \n16:58\u00a0<vmassol>\u00a0cjd  \n16:58\u00a0<vmassol>\u00a0you must log on maven.xwiki.org as maven first  \n16:58\u00a0<vmassol>\u00a0then type: \"a2\"  \n16:58\u00a0<cjd>\u00a0ahh a2  \n16:59\u00a0<msmeria>\u00a0has quit  \n16:59\u00a0<cjd>\u00a0that's weird, \"which a2\" doesn't tell where it is  \n17:00\u00a0<vmassol>\u00a0it's an alias  \n17:00\u00a0<cjd>\u00a0I see  \n17:00\u00a0<cjd>\u00a0too bad linux doesn't have DTrace  \n17:06\u00a0<vmassol>\u00a0Enygma`: btw we have the same problem on http://ci.xwiki.org/view/Functional%20Tests/job/xwiki-enterprise-test-ldap-4.3/org.xwiki.enterprise$xwiki-enterprise-test-ldap/188/testReport/junit/org.xwiki.test.ldap.framework/XWikiLDAPTestSetup/junit\\_framework\\_TestSuite\\_6c0267a/  \n17:06\u00a0<vmassol>\u00a0seems it's a general problem  \n17:07\u00a0<cjd>\u00a0do you know where the working directory for this test executable is?  \n17:07\u00a0<vmassol>\u00a0hmm this one is interesting: http://ci.xwiki.org/view/Functional%20Tests/job/xwiki-enterprise-test-storage/org.xwiki.enterprise$xwiki-enterprise-test-storage/2007/testReport/junit/org.apache.maven.surefire.junit4/JUnit4Provider/org\\_xwiki\\_test\\_storage\\_AllTests/  \n17:07\u00a0<vmassol>\u00a0it starts the server, no error  \n17:08\u00a0<vmassol>\u00a0but the ping fails  \n17:08\u00a0<vmassol>\u00a015:26:03.219 [main] INFO \u00a0o.x.test.integration.XWikiExecutor - No server is responding on [http://localhost:8080/xwiki/bin/view/Main?xpage=plain%5D after [120] seconds  \n17:08\u00a0<Enygma`>\u00a0vmassol: yes, I know  \n17:08\u00a0<cjd>\u00a0oop nvm found it  \n17:08\u00a0<cjd>\u00a0409: \u00a0(deleted)/home/hudsonagent/hudson\\_root/workspace/xwiki-enterprise-test-extension-4.3/xwiki-enterprise-test/xwiki-enterprise-test-extension/target/xwiki-enterprise-jetty-hsqldb-4.3-SNAPSHOT  \n17:09\u00a0<vmassol>\u00a0cjd: \u00a0ls -l /proc/409/fd | more ?  \n17:09\u00a0<vmassol>\u00a0:)  \n17:09\u00a0<vmassol>\u00a0cjd: you won't any log  \n17:10\u00a0<vmassol>\u00a0there aren't any because we don't save logs in any file with the default appender  \n17:10\u00a0<vmassol>\u00a0it all goes to stdout  \n17:10\u00a0<vmassol>\u00a0which is probably lost, right?  \n17:10\u00a0<vmassol>\u00a0s/you won't/you won't find/  \n17:10\u00a0<cjd>\u00a0ahh I see  \n17:11\u00a0<cjd>\u00a0how did you get the logs on your end?  \n17:11\u00a0<vmassol>\u00a0nope  \n17:11\u00a0<vmassol>\u00a0hehe  \n17:11\u00a0<vmassol>\u00a0jstack 509  \n17:11\u00a0<vmassol>\u00a0oops  \n17:11\u00a0<vmassol>\u00a0jstack 409  \n17:11\u00a0<vmassol>\u00a0:)  \n17:11\u00a0<cjd>\u00a0ahh ok  \n17:14\u00a0<cjd>\u00a0oops lost it  \n17:15\u00a0<vmassol>\u00a0triggering escaping tests manually  \n17:15\u00a0<cjd>\u00a0tried attaching to it with gdb to get the log output  \n17:15\u00a0<cjd>\u00a0Program received signal SIGSEGV, Segmentation fault.  \n17:15\u00a0<cjd>\u00a0[Switching to Thread 0x7fc3b2812700 (LWP 427)]  \n17:16\u00a0<vmassol>\u00a0cjd: do you think I should kill ?9 the stuck java process on the other agents or should we look at htem too?  \n17:16\u00a0<vmassol>\u00a0in other words, it is enough to keep the stuck one on agent2?  \n17:16\u00a0<vmassol>\u00a0cause I'd like to get the build progressing  \n17:17\u00a0<cjd>\u00a0no I killed the one on agent 2  \n17:17\u00a0<cjd>\u00a0tried to attach to it and it segfaulted  \n17:17\u00a0<vmassol>\u00a0arf  \n17:17\u00a0<cjd>\u00a0http://etbe.coker.com.au/2008/02/27/redirecting-output-from-a-running-process/ <-- I was trying this  \n17:17\u00a0<cjd>\u00a0and java doesn't like being paused bty a debugger  \n17:18\u00a0<vmassol>\u00a0ok I've put agent9 offline  \n17:18\u00a0<vmassol>\u00a0cjd: I'm going to put agent2 online again, ok?  \n17:18\u00a0<vmassol>\u00a0hmm why is the java prcoess still up on a2?  \n17:19\u00a0<vmassol>\u00a0it's still there!  \n17:19\u00a0<vmassol>\u00a0and still not responding to wget http://localhost:8080/  \n17:19\u00a0<cjd>\u00a0o\\_O  \n17:19\u00a0<cjd>\u00a0indeed 409  \n17:20\u00a0<cjd>\u00a0I thought it was another one starting up  \n17:21\u00a0<cjd>\u00a0http://stackoverflow.com/questions/9746018/gdb-attach-to-a-process-without-stop <-- wonder if this will work  \n17:21\u00a0<cjd>\u00a0first I'll get 10 thread dumps in a loop and see if I can make sense of the problem  \n17:21\u00a0<vmassol>\u00a0cjd: I'm going to kill the stray java process on agent10  \n17:22\u00a0<vmassol>\u00a0so that this agent can continue to run functional tests  \n17:22\u00a0<vmassol>\u00a0ok?  \n17:22\u00a0<cjd>\u00a0sure  \n17:22\u00a0<cjd>\u00a0this seems pretty repeatable so I'm not worried about it going away  \n17:22\u00a0<vmassol>\u00a0:)  \n17:22\u00a0<vmassol>\u00a0unfortunately  \n17:22\u00a0<cjd>\u00a0IMO that's good  \n17:22\u00a0<cjd>\u00a0the evil ones are the ones which happen once a week  \n17:23\u00a0<vmassol>\u00a0cjd: if you're interested this is on agent10: https://gist.github.com/4269224  \n17:23\u00a0<vmassol>\u00a0(same issue as on agent2)  \n17:23\u00a0<cjd>\u00a0at sun.reflect.MethodAccessorGenerator.emitInvoke(MethodAccessorGenerator.java:560) <-- blocked in a jni function call?  \n17:24\u00a0<vmassol>\u00a0btw fyi cjd  \n17:24\u00a0<vmassol>\u00a0yesterday I tried to kill 409  \n17:24\u00a0<vmassol>\u00a0and it doesn't answer  \n17:25\u00a0<vmassol>\u00a0s/doesn't/didn't/  \n17:25\u00a0<cjd>\u00a0mmm looks like something jniish  \n17:26\u00a0<cjd>\u00a0I promise I have not been writing any C in XWiki :)  \n17:26\u00a0<vmassol>\u00a0hehe  \n17:26\u00a0<vmassol>\u00a0not sure if I'm trusting you on this! ahah  \n17:26\u00a0<vmassol>\u00a0:)  \n17:26\u00a0<cjd>\u00a0heh  \n17:28\u00a0<cjd>\u00a0https://ezcrypt.it/iG5n#8OaY8TliMxyMtpZAQGfux3eU <-- seems to be here, slf4j failing to write a log entry?  \n17:30\u00a0<cjd>\u00a0http://grepcode.com/file/repo1.maven.org/maven2/org.jboss.logging/jboss-logging/3.1.0.GA/org/jboss/logging/Slf4jLocationAwareLogger.java#93  \n17:32\u00a0<vmassol>\u00a0errr  \n17:32\u00a0<vmassol>\u00a0where do you see a problem?  \n17:32\u00a0<vmassol>\u00a0you've taken several threadshots every 2 minutes for 10 minutes  \n17:33\u00a0<vmassol>\u00a0and this thread is always there doinfg the same thing?  \n17:33\u00a0<vmassol>\u00a0OTOH this thread is not locking anything  \n17:33\u00a0<vmassol>\u00a0so it should block any other thread  \n17:33\u00a0<vmassol>\u00a0(cjd)  \n17:34\u00a0<cjd>\u00a0I took 3 and it's in the same location, I'll start a loop and grab a snack  \n17:34\u00a0<vmassol>\u00a0but still cjd  \n17:34\u00a0<vmassol>\u00a0it doesn't lock anything  \n17:34\u00a0<vmassol>\u00a0so I doubt it's \"THE\" problem  \n17:35\u00a0<cjd>\u00a0it's the only one that's not idling and if it refuses to stop then I think that can hold the jvm from ending  \n17:35\u00a0<vmassol>\u00a0cjd: do you understand how this process can still be up btw?  \n17:36\u00a0<cjd>\u00a0if there's a \u00a0\u00a0\u00a0for(;;) { } \u00a0\u00a0somewhere in the jvm's C++, I don't know if you can stop that.  \n17:36\u00a0<vmassol>\u00a0cjd: from ending ok but from serving requests?  \n17:36\u00a0<vmassol>\u00a0do you understand how this process can still be up btw? what I mean is:  \n17:36\u00a0<vmassol>\u00a0slave.jar runs and spawns a mavne process  \n17:36\u00a0<vmassol>\u00a0which itself spawns another process to start xwiki  \n17:37\u00a0<vmassol>\u00a0when the first process spawned by slave.jar stops it should also stop the process spawned from it right?  \n17:37\u00a0<cjd>\u00a0only if they're in the same process group setpgid(), otherwise the child process can outlive it's parent  \n17:38\u00a0<cjd>\u00a0got jdb connected woot  \n17:38\u00a0<vmassol>\u00a0cool  \n17:51\u00a0<vmassol>\u00a0Enygma`: seems there's a problem with workspaces on 4.3  \n17:51\u00a0<vmassol>\u00a0I'm with Nicolas L and I tried the following:  \n17:51\u00a0<vmassol>\u00a0- download xE 4.3 jetty/hsqldb  \n17:52\u00a0<vmassol>\u00a0- set virtual=1 in xwiki.cfg  \n17:52\u00a0<vmassol>\u00a0- install workspaces UI extension from EM  \n17:53\u00a0<vmassol>\u00a0when going to the WorkspaceManager/CreateNewWorkspace  \n17:53\u00a0<vmassol>\u00a0it generates NPEs in the console  \n17:53\u00a0<vmassol>\u00a0do you know about this?  \n17:53\u00a0<vmassol>\u00a0(without even filling any field on that page, just viewing it)  \n17:53\u00a0<Enygma`>\u00a0vmassol: trying to reproduce something he reported some time ago, but got stuck along the way with a bug in EM  \n17:54\u00a0<Enygma`>\u00a0so I`m investigating this right now  \n17:54\u00a0<vmassol>\u00a0this one is very easy to reproduce  \n17:54\u00a0<vmassol>\u00a0(on 4.3)  \n17:54\u00a0<cjd>\u00a0It's an OOM issue and someone's catching Throwable  \n17:54\u00a0<Enygma`>\u00a0(I am trying now on 4.4-snapshot)  \n17:54\u00a0<cjd>\u00a0now to verify :)  \n17:55\u00a0<vmassol>\u00a0cjd: hmm OOM on a short running instance, that's not good!  \n17:55\u00a0<vmassol>\u00a0Enygma`: I wanted to know if you knew about it and if it's fixed after 4.3  \n18:00\u00a0<vmassol>\u00a0Enygma`: XWIKI-8603  \n18:01\u00a0<Enygma`>\u00a0vmassol: my current conclusion (on 4.4-snapshot) is that you can not install workspaces on XE in one step because of the wikiManager and applicationManager plugins  \n18:02\u00a0<vmassol>\u00a0actually I installed  \n18:02\u00a0<vmassol>\u00a0wiki manager UI extensiopn first  \n18:02\u00a0<vmassol>\u00a0and the only workspace UI extension  \n18:02\u00a0<vmassol>\u00a0fixing the issue desc  \n18:03\u00a0<vmassol>\u00a0done  \n18:04\u00a0<Enygma`>\u00a0I have tried to install workspace ui on 4.4-snapshot and it failed: java.lang.NoClassDefFoundError: Failed to get fields for class [org.xwiki.workspace.internal.DefaultWorkspaceManager] because the class [com/xpn/xwiki/plugin/applicationmanager/core/plugin/XWikiPluginMessageTool] couldn't be found in the ClassLoader.  \n18:04\u00a0<Enygma`>\u00a0basically, I was installing the workspace component that was depending on the plugins, but the plugins were not registered in xwiki.cfg so the classloader did not know about them  \n18:05\u00a0<vmassol>\u00a0that looks like serious blockers  \n18:05\u00a0<Enygma`>\u00a0I had to install manually and separately, first ApplicationManager, then WikiManager  \n18:05\u00a0<Enygma`>\u00a0add the plugins in xwiki.cfg  \n18:05\u00a0<Enygma`>\u00a0and then install workspaceManager  \n18:05\u00a0<vmassol>\u00a0how come this is not in the release notes of 4.3, or is it?  \n18:05\u00a0<Enygma`>\u00a0this is so beacause of the way EM works  \n18:05\u00a0<vmassol>\u00a0and?  \n18:06\u00a0<Enygma`>\u00a0plugins need to be registered in xwiki.cfg  \n18:06\u00a0<Enygma`>\u00a0EM can not do that  \n18:06\u00a0<Enygma`>\u00a0it's just a 2 step process  \n18:06\u00a0<vmassol>\u00a0yes that's documented  \n18:06\u00a0<vmassol>\u00a0AFAIK  \n18:06\u00a0<Enygma`>\u00a0so you can not directly install workspace UI in one step  \n18:06\u00a0<vmassol>\u00a0let me check the doc  \n18:06\u00a0<Enygma`>\u00a0IDK if it`s documented or not  \n18:07\u00a0<Enygma`>\u00a0I did not know about it :)  \n18:07\u00a0<Enygma`>\u00a0you`re saying that you did not have this problem?  \n18:07\u00a0<Enygma`>\u00a0and directly installed WorkspaceUI in one step on XE?  \n18:07\u00a0<vmassol>\u00a0no  \n18:07\u00a0<vmassol>\u00a0see XWIKI-8603  \n18:07\u00a0<vmassol>\u00a0it describes what I did  \n18:09\u00a0<cjd>\u00a0https://ezcrypt.it/jG5n#SVORl0K1qE8WxWr3b6qjJItF  \n18:09\u00a0<cjd>\u00a0there it is  \n18:09\u00a0<cjd>\u00a0line 640 is the looping thread  \n18:10\u00a0<cjd>\u00a0blocked on an allocation  \n18:10\u00a0<cjd>\u00a0line 52 is the garbage collector  \n18:10\u00a0<cjd>\u00a0everything else is sleeping  \n18:11\u00a0<Enygma`>\u00a0\"install wiki manager UI extension from EM\" implies registering the plugins and restarting, right?  \n18:11\u00a0<vmassol>\u00a0hmm good point, I haven't restarted  \n18:12\u00a0<vmassol>\u00a0I'll try to restart now  \n18:12\u00a0<vmassol>\u00a0still we shoudn't have a NPE  \n18:12\u00a0<Enygma`>\u00a0right, otherwise your plugins won`t work  \n18:12\u00a0<vmassol>\u00a0if the plugins are not htere it shoudl'nt fail that bad  \n18:12\u00a0<vmassol>\u00a0you can have a nice message  \n18:12\u00a0<Enygma`>\u00a0AFAIK there should be some messages about missing plugins  \n18:12\u00a0<Enygma`>\u00a0wonder why they were not triggered  \n18:13\u00a0<vmassol>\u00a0wait  \n18:13\u00a0<vmassol>\u00a0that's not correcet  \n18:14\u00a0<vmassol>\u00a0we don't need to restart  \n18:14\u00a0<vmassol>\u00a0and there's no need to edit the plugins in xwiki.cfg  \n18:14\u00a0<vmassol>\u00a0thomas changed that a while ago  \n18:14\u00a0<vmassol>\u00a0making wiki manager and app manager components  \n18:14\u00a0<vmassol>\u00a0I'm just not 100% that we don't need the restart but i'm sure we don't need to edit xwiki.cfg  \n18:16\u00a0<Enygma`>\u00a0aaah... I think you`re right about that one  \n18:16\u00a0<Enygma`>\u00a0he made a bridge that auto-registers the 2 plugins if they are not registered manually  \n18:17\u00a0<Enygma`>\u00a0checking  \n18:17\u00a0<vmassol>\u00a0yep  \n18:17\u00a0<vmassol>\u00a0I've had nico restart the wiki  \n18:18\u00a0<vmassol>\u00a0and he got the CL issue  \n18:18\u00a0<vmassol>\u00a0he's adding it to the jira issue  \n18:19\u00a0<Enygma`>\u00a0actually, what Thomas did was to add a script service that uses the plugin behind the scenes  \n18:19\u00a0<Enygma`>\u00a0if the plugin is not initialized, it initializez it on the spot  \n18:20\u00a0<Enygma`>\u00a0so that you don`t have to add it to xwiki.cfg anymore  \n18:20\u00a0<vmassol>\u00a0yep so no need to restart  \n18:20\u00a0<Enygma`>\u00a0yes, but this is not enough  \n18:20\u00a0<Enygma`>\u00a0if you have java code (component) that depends on the plugin, the plugin will not be initialized  \n18:21\u00a0<vmassol>\u00a0indeed, good point  \n18:21\u00a0<Enygma`>\u00a0though it was working before on XEM  \n18:21\u00a0<Enygma`>\u00a0wonder why it's not working on XE  \n18:22\u00a0<Enygma`>\u00a0hmm  \n18:22\u00a0<Enygma`>\u00a0so.. on XEM, everything is in the lib directory  \n18:22\u00a0<Enygma`>\u00a0and the web app class loader takes care of loading all those classes  \n18:22\u00a0<Enygma`>\u00a0however, on the XE/EM usecase  \n18:22\u00a0<Enygma`>\u00a0the classloader that should initialize the plugins is the EM classloader  \n18:22\u00a0<vmassol>\u00a0it could be that you're not using the Context CL in your workspaces code  \n18:22\u00a0<vmassol>\u00a0context CM  \n18:23\u00a0<vmassol>\u00a0(not context CL)  \n18:23\u00a0<vmassol>\u00a0(which is not correct)  \n18:23\u00a0<vmassol>\u00a0basically all code need to get injected the ContextComponentManager  \n18:23\u00a0<vmassol>\u00a0as otehrwise they won't see components registred by EM  \n18:24\u00a0<vmassol>\u00a0at least components installed for a given wiki  \n18:24\u00a0<vmassol>\u00a0which is what happens here  \n18:24\u00a0<vmassol>\u00a0(I installed worksapces UI on the main wiki nly)  \n18:25\u00a0<vmassol>\u00a0(just added that to the jira issue)  \n18:25\u00a0<vmassol>\u00a0it's easy to veirfy  \n18:26\u00a0<vmassol>\u00a0we just need to install workspace UI on the whole farm  \n18:26\u00a0<vmassol>\u00a0that will register stuff in the root CM  \n18:26\u00a0<Slashman>\u00a0has quit  \n18:28\u00a0<Enygma`>\u00a0but I`m talking about plugins  \n18:28\u00a0<Enygma`>\u00a0which don`t use the CM  \n18:28\u00a0<Enygma`>\u00a0and my workspace component does not use the CM to get the plugins  \n18:29\u00a0<Enygma`>\u00a0vmassol: see https://github.com/xwiki/xwiki-platform/blob/master/xwiki-platform-core/xwiki-platform-workspace/xwiki-platform-workspace-api/src/main/java/org/xwiki/workspace/internal/DefaultWorkspaceManager.java#L104 and the below initialize() method  \n18:30\u00a0<Enygma`>\u00a0the only dynamic stuff is getWikiManager() that uses the plugin manager API to get an instance of the plugin's API (that I use in 2-3 places)  \n18:36\u00a0<vmassol>\u00a0yes forget about the CM it's something else  \n18:45\u00a0<vmassol>\u00a0Enygma`: I havesome idea  \n18:45\u00a0<vmassol>\u00a0when you start xwiki  \n18:45\u00a0<vmassol>\u00a0the xwiki servlet context listener is called  \n18:45\u00a0<vmassol>\u00a0(by the webapp)  \n18:46\u00a0<vmassol>\u00a0and it registers all components against the CM  \n18:46\u00a0<vmassol>\u00a0it seems some workspace component is initializable  \n18:46\u00a0<vmassol>\u00a0and needs the appmanager or wikimanager plugins  \n18:46\u00a0<Enygma`>\u00a0right  \n18:46\u00a0<vmassol>\u00a0but they're not yet initialized since they're plugins  \n18:46\u00a0<vmassol>\u00a0the plugin init comes after  \n18:46\u00a0<vmassol>\u00a0later o  \n18:46\u00a0<vmassol>\u00a0later on  \n18:46\u00a0<vmassol>\u00a0after the first request  \n18:46\u00a0<Enygma`>\u00a0or rather since they are extensions  \n18:47\u00a0<vmassol>\u00a0cjd: grr\u2026 escaping tests failed again: http://ci.xwiki.org/view/Functional%20Tests/job/xwiki-enterprise-test-escaping-4.3/org.xwiki.enterprise$xwiki-enterprise-test-escaping/208/testReport/junit/org.xwiki.test.escaping/AllTests/org\\_xwiki\\_test\\_escaping\\_AllTests/  \n18:48\u00a0<Enygma`>\u00a0what you say is basically execution order, but the problem seems to be at class loader level. Even if the order was right, the classes \"do not exist\" as far as the current class loader is concerned  \n18:48\u00a0<Enygma`>\u00a0vmassol: it's not about NPEs because plugins are not initialized  \n18:50\u00a0<Enygma`>\u00a0so if the CM is doing something special and is aware of the EM's ClassLoader and uses that to inspect and load components installed with the EM, then so should any java code in the webapp(default) class loader if it wants to use code that is installed with the EM  \n18:50\u00a0<Enygma`>\u00a0which is kind of weird  \n18:50\u00a0<cjd>\u00a0same bug?  \n18:50\u00a0<vmassol>\u00a0cjd: I don't think so  \n18:50\u00a0<vmassol>\u00a0cjd: xwiki started in 1 minute which is already verys low  \n18:50\u00a0<vmassol>\u00a0but it still had 1 more minute before timiing out  \n18:50\u00a0<vmassol>\u00a0I don't understand why it didn't answer to the ping during that time  \n18:52\u00a0<cjd>\u00a0I'm going to need sleep very soon but AFAICT either someone's catching and swollowing an OOM error or there's a finally block which is looping back into some bad code.  \n18:52\u00a0<cjd>\u00a0Alternatively it could be a finalize() function which is allocating memory  \n18:53\u00a0<evalica>\u00a0has quit  \n18:57\u00a0<vmassol>\u00a0cjd: I'll find it, take some rest now! :)  \n18:58\u00a0<cjd>\u00a0heh I'm surprised it's so obvious I've been up since forever  \n18:59\u00a0<cjd>\u00a0what I'd do, (short of loading it on an Illumos machine to play with dtrace) is turn on debugging officially, I had a read only connection to it so I could print stack traces but I couldn't break and step  \n18:59\u00a0<cjd>\u00a0but yeah, I'll be back later after a nap :)  \n19:00\u00a0<Enygma`>\u00a0vmassol: gtg... we`ll see more tomorrow  \n19:04\u00a0<mflorea>\u00a0has quit  \n19:05\u00a0<sburjan>\u00a0has quit  \n19:05\u00a0<Enygma`>\u00a0has quit  \n20:32\u00a0<mrvanes>\u00a0has joined #xwiki  \n20:48\u00a0<abusenius>\u00a0has joined #xwiki  \n21:31\u00a0<vmassol>\u00a0has quit  \n21:49\u00a0<tdelafosse>\u00a0has quit  \n22:01\u00a0<jvdrean1>\u00a0has quit  \n22:02\u00a0<mflorea>\u00a0has joined #xwiki  \n22:05\u00a0<fmancinelli>\u00a0has quit  \n22:25\u00a0<mrvanes>\u00a0has quit  \n22:39\u00a0<jvdrean>\u00a0has joined #xwiki  \n23:33\u00a0<mflorea>\u00a0has quit  \n23:59\u00a0<abusenius>\u00a0has quit\n"}