{"id": "dev:IRC.xwikiArchive20150213", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20150213", "title": "IRC Archive for channel #xwiki on 13 February 2015 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<momomomomo>\u00a0has quit  \n00:22\u00a0<momomomomo>\u00a0has joined #xwiki  \n00:57\u00a0<momomomomo>\u00a0has quit  \n02:17\u00a0<sburjan>\u00a0has quit  \n06:02\u00a0<Denis1>\u00a0has joined #xwiki  \n06:04\u00a0<Denis>\u00a0has quit  \n06:31\u00a0<mflorea>\u00a0has joined #xwiki  \n07:12\u00a0<msmeria>\u00a0has joined #xwiki  \n07:15\u00a0<msmeria1>\u00a0has joined #xwiki  \n07:16\u00a0<msmeria2>\u00a0has joined #xwiki  \n07:19\u00a0<msmeria>\u00a0has quit  \n07:20\u00a0<msmeria1>\u00a0has quit  \n07:59\u00a0<gsmeria>\u00a0has joined #xwiki  \n08:10\u00a0<gsmeria>\u00a0has quit  \n08:11\u00a0<gsmeria>\u00a0has joined #xwiki  \n08:13\u00a0<ClemensR>\u00a0has joined #xwiki  \n08:33\u00a0<KermitTheFragger>\u00a0has joined #xwiki  \n09:11\u00a0<mflorea>\u00a0has quit  \n09:18\u00a0<cjd>\u00a0has joined #xwiki  \n09:30\u00a0<tmortagne>\u00a0has joined #xwiki  \n09:36\u00a0<woshilapin>\u00a0has joined #xwiki  \n09:38\u00a0<mflorea>\u00a0has joined #xwiki  \n09:42\u00a0<mflorea>\u00a0has quit  \n09:43\u00a0<mflorea1>\u00a0has joined #xwiki  \n09:45\u00a0<Enygma`>\u00a0has joined #xwiki  \n10:07\u00a0<fmancinelli>\u00a0has joined #xwiki  \n10:14\u00a0<tmortagne1>\u00a0has joined #xwiki  \n10:14\u00a0<tmortagne>\u00a0has quit  \n10:28\u00a0<evalica>\u00a0has joined #xwiki  \n10:34\u00a0<vmassol>\u00a0has joined #xwiki  \n10:35\u00a0<vmassol>\u00a0good morning, sorry I had to attend to some stuff at home and I'm very late today\u2026 apologies  \n10:39\u00a0<Pbas>\u00a0Yes you sleeping well after JNDI headache ;-)  \n10:39\u00a0<vmassol>\u00a0:)  \n10:40\u00a0<vmassol>\u00a0I've started debugging inside the JDK and Tomcat yesterday...  \n10:40\u00a0<vmassol>\u00a0but not found the culprit yet  \n10:40\u00a0<Pbas>\u00a0Probably a tiny silly things  \n12:09\u00a0<Slashman>\u00a0has joined #xwiki  \n12:54\u00a0<vmassol>\u00a0(otp lcc recording)  \n14:07\u00a0<vmassol>\u00a0recording done, going to eat now, bbiab  \n14:28\u00a0<vmassol>\u00a0going back to debugging the JNDI issue\u2026  \n14:44\u00a0<xwikibot>\u00a0has joined #xwiki  \n14:44\u00a0<vmassol>\u00a0xwiki.org just rebooted  \n14:55\u00a0<tmortagne1>\u00a0[WARN] Restarting myxwiki.org on 6.4.1 in 15min  \n14:55\u00a0<tmortagne1>\u00a0has left #xwiki  \n14:56\u00a0<tmortagne1>\u00a0has joined #xwiki  \n14:56\u00a0<tmortagne1>\u00a0has quit  \n14:56\u00a0<tmortagne>\u00a0has joined #xwiki  \n15:02\u00a0<mflorea1>\u00a0vmassol: I'm getting \"The entity \"nbsp\" was referenced, but not declared.\" when parsing some HTML (from CKEditor) with the \"xhtml/1.0\" parser. Does it ring a bell?  \n15:03\u00a0<vmassol>\u00a0missing some DTD?  \n15:03\u00a0<vmassol>\u00a0DTD or schema  \n15:03\u00a0<vmassol>\u00a0AFAIR we add the correct ones normally in the cleaner  \n15:04\u00a0<vmassol>\u00a0but maybe you're not going through it and don't have the declarations in your input  \n15:04\u00a0<tmortagne>\u00a0xhtml/1.0 parser need everything as part of the content  \n15:04\u00a0<msmeria2>\u00a0has quit  \n15:04\u00a0<tmortagne>\u00a0so entity declaration etc  \n15:05\u00a0<tmortagne>\u00a0(the test framework is cheating and add them automatically)  \n15:06\u00a0<mflorea1>\u00a0yeah, I thought so, I have <!DOCTYPE html>, so HTML5, this is coming from our side (htmlheader.vm)  \n15:06\u00a0<mflorea1>\u00a0do we have an HTML5 parser?  \n15:07\u00a0<tmortagne>\u00a0I know guillaume introduced a renderer but not sure for the parser  \n15:07\u00a0<tmortagne>\u00a0if not we need one I think  \n15:07\u00a0<mflorea1>\u00a0otherwise I'll just use my HTML \"template\" with XHTML header  \n15:08\u00a0<mflorea1>\u00a0for now  \n15:08\u00a0<tmortagne>\u00a0only parser in xwiki-rendering-syntax-annotatedhtml5 it seems  \n15:08\u00a0<tmortagne>\u00a0I mean xwiki-rendering-syntax-html5  \n15:08\u00a0<tmortagne>\u00a0and renderer not parser  \n15:09\u00a0<tmortagne>\u00a0so much for clear answer  \n15:09\u00a0<mflorea1>\u00a0ok, I'll just use the XHTML header for now. But we need a HTML5 parser  \n15:09\u00a0<mflorea1>\u00a0in the future  \n15:09\u00a0<tmortagne>\u00a0yes  \n15:09\u00a0<tmortagne>\u00a0I think there is a pull request with one, I indicated it to Guillaume  \n15:10\u00a0<tmortagne>\u00a0https://github.com/xwiki/xwiki-rendering/pull/3  \n15:13\u00a0<tmortagne>\u00a0[WARNING] Restarting myxwiki.org on 6.4.1  \n15:16\u00a0<vmassol>\u00a0Pbas: put your name in the snippet author so that I don't have to support your changes alone ;)  \n15:19\u00a0<Pbas>\u00a0Year I understand : my code is a little bit ugly (erase everything and add some right) :-)  \n15:19\u00a0<Pbas>\u00a0More seriously  \n15:19\u00a0<Pbas>\u00a0Have you got a way to get index object?  \n15:19\u00a0<Pbas>\u00a0If there are some.  \n15:20\u00a0<vmassol>\u00a0note: I haven't read your snippet  \n15:27\u00a0<fmancinelli>\u00a0has quit  \n15:29\u00a0<vmassol>\u00a0getting closer for the jndi issue :)  \n15:30\u00a0<Pbas>\u00a0Yepee :-)  \n15:31\u00a0<vmassol>\u00a0I know the general cause now  \n15:31\u00a0<vmassol>\u00a0(still need to find precise details)  \n15:32\u00a0<vmassol>\u00a0the reason is because the JNDI context is initialized by Tomcat and when it's initialization it's actually bound to a thread  \n15:32\u00a0<vmassol>\u00a0and when we init xwiki, this thread doesn't have the initialized JNDI NamingContext bound to it  \n15:32\u00a0<vmassol>\u00a0and thus a new JNDI context is created  \n15:32\u00a0<vmassol>\u00a0so my guess is that between 6.2.x and 6.3+ we have added the init thread  \n15:33\u00a0<vmassol>\u00a0which has caused this regression  \n15:33\u00a0<vmassol>\u00a0s/init thread/xwiki init thread  \n15:33\u00a0<vmassol>\u00a0(didn't hceck yet when we added that thread)  \n15:33\u00a0<vmassol>\u00a0\"XWiki Initialization\" thread  \n15:33\u00a0<vmassol>\u00a0(tmortagne)  \n15:33\u00a0<Pbas>\u00a0between 6.3 and 6.4 I think  \n15:34\u00a0<vmassol>\u00a0fun stuff...  \n15:34\u00a0<vmassol>\u00a0I had to go deep in the tomcat JNDI implementation  \n15:34\u00a0<vmassol>\u00a0there are actually two checks:  \n15:34\u00a0<vmassol>\u00a0- one to verify if the current thread is bound to an existing NamingContext  \n15:35\u00a0<vmassol>\u00a0- another that verifies if the context classloader is bound to an existing NamingContext  \n15:36\u00a0<vmassol>\u00a0so it's also possible that we change the context classloader  \n15:36\u00a0<vmassol>\u00a0they test for one of the other:  \n15:36\u00a0<vmassol>\u00a0if (ContextBindings.isThreadBound() ||  \n15:36\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0(ContextBindings.isClassLoaderBound())) {  \n15:36\u00a0<vmassol>\u00a0if one is found true then the existing NamingContext is used  \n15:36\u00a0<vmassol>\u00a0otherwise a new one (empty!) is created  \n15:38\u00a0<vmassol>\u00a0so my guess goes to the fact that we introduced a new xwiki init thread  \n15:38\u00a0<tmortagne>\u00a0vmassol: XWIKI-10327  \n15:38\u00a0<Pbas>\u00a0ok thxs you for your explanation  \n15:38\u00a0<vmassol>\u00a0hmm 6.1M1  \n15:38\u00a0<vmassol>\u00a0it's working for me on 6.2.5 and failing on master  \n15:39\u00a0<vmassol>\u00a0I'll continue debugging to get more details  \n15:39\u00a0<tmortagne>\u00a0vmassol: is it the same jetty version ?  \n15:39\u00a0<vmassol>\u00a0yes  \n15:39\u00a0<vmassol>\u00a0I'm using tomcat  \n15:39\u00a0<vmassol>\u00a0same tomcat  \n15:39\u00a0<tmortagne>\u00a0right  \n15:40\u00a0<vmassol>\u00a0(side note: it's awfully slow to debug in the NamingContext class as it's used a lot and slow down\u2026 each time it takes over 20mn)  \n15:40\u00a0<tmortagne>\u00a0the last change to the initialization job was XWIKI-10655, still before 6.2  \n15:41\u00a0<Pbas>\u00a0FYI JNDI working well with my 6.3 version  \n15:41\u00a0<vmassol>\u00a0I'll debug, could the CL  \n15:41\u00a0<vmassol>\u00a0I shall know soon (in 1 hour or so)  \n15:43\u00a0<fmancinelli>\u00a0has joined #xwiki  \n15:50\u00a0<tmortagne>\u00a0[BTW/ANN] myxwiki.org uppgrade done  \n15:58\u00a0<fmancinelli>\u00a0has quit  \n16:01\u00a0<fmancinelli>\u00a0has joined #xwiki  \n16:05\u00a0<momomomomo>\u00a0has joined #xwiki  \n16:15\u00a0<fmancinelli>\u00a0has quit  \n16:18\u00a0<fmancinelli>\u00a0has joined #xwiki  \n16:20\u00a0<Bugen\\_do>\u00a0has joined #xwiki  \n16:21\u00a0<momomomomo>\u00a0has quit  \n16:21\u00a0<gsmeria>\u00a0has quit  \n16:26\u00a0<fmancinelli>\u00a0has quit  \n16:27\u00a0<fmancinelli>\u00a0has joined #xwiki  \n16:37\u00a0<vmassol>\u00a0ok found the problem  \n16:37\u00a0<vmassol>\u00a0:)  \n16:37\u00a0<vmassol>\u00a0commenting in the issue  \n16:40\u00a0<vmassol>\u00a0if you're curious: http://jira.xwiki.org/browse/XWIKI-11706?focusedCommentId=85394&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-85394  \n16:40\u00a0<vmassol>\u00a0now fixing  \n16:43\u00a0<Pbas>\u00a0I'm curious. Thanks you  \n16:46\u00a0<Bugendolf>\u00a0has quit  \n16:46\u00a0<vmassol>\u00a0tmortagne: http://jira.xwiki.org/browse/XWIKI-11706?focusedCommentId=85395&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-85395  \n16:47\u00a0<Bugendolf>\u00a0has joined #xwiki  \n16:48\u00a0<vmassol>\u00a0pfew, took me a full day all in all :)  \n16:48\u00a0<Enygma`>\u00a0does anyone know if I can use requirejs synchroneously? e.g. require(['xwiki-meta']).space ? mflorea1 cjd ?  \n16:49\u00a0<cjd>\u00a0no  \n16:49\u00a0<tmortagne>\u00a0vmassol: ContextNamespaceURLClassLoader is just a wrapper to call the right classloader, it's parent is not used  \n16:49\u00a0<cjd>\u00a0because javascript does not allow you to \"stop the world\" until something has been loaded  \n16:50\u00a0<vmassol>\u00a0tmortagne: that's what you thought apparently :)  \n16:50\u00a0<vmassol>\u00a0it's set a the context CL  \n16:50\u00a0<vmassol>\u00a0\\*as  \n16:50\u00a0<tmortagne>\u00a0that's it's job, if it's parent is used then it mean something is going trough some not overwritten API  \n16:50\u00a0<Enygma`>\u00a0cjd: then I don`t get this example (the print part)  \n16:50\u00a0<Enygma`>\u00a0https://github.com/volojs/create-template/blob/master/www/app/main.js  \n16:50\u00a0<vmassol>\u00a0we set it as the context CL and thus we loose the container CL  \n16:51\u00a0<mflorea1>\u00a0cjd: https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Synchronous\\_and\\_Asynchronous\\_Requests#Synchronous\\_request  \n16:51\u00a0<vmassol>\u00a0tmortagne: this is what caused the XWIKI-11706 regression  \n16:51\u00a0<mflorea1>\u00a0but that's not how require loads the js  \n16:51\u00a0<cjd>\u00a0point taken but actually using it might be dangerous for your health ;)  \n16:52\u00a0<mflorea1>\u00a0sure, I wouldn't use it  \n16:52\u00a0<tmortagne>\u00a0vmassol: yes I saw the issue but again the parent is not supposed to be used so the issue is not that it's set to null in the constructor  \n16:52\u00a0<tmortagne>\u00a0it's somewhere else  \n16:52\u00a0<Enygma`>\u00a0so if I am in say a piece of regular JS (Prototype or not) and I want to use a module usable with require, can I use it or not?  \n16:53\u00a0<cjd>\u00a0you can  \n16:53\u00a0<tmortagne>\u00a0vmassol: \u00a0the current classloade has getSystemClassLoader() as parent, is this not the container classloader ?  \n16:53\u00a0<vmassol>\u00a0no  \n16:53\u00a0<tmortagne>\u00a0then this is the issue  \n16:53\u00a0<cjd>\u00a0you do require(['lib\\_which\\_does\\_not\\_support\\_require'], function () { window.whateverLib.doStuff(); });  \n16:54\u00a0<vmassol>\u00a0the context CL is ContextNameSpaceURLClassloader when I debug  \n16:54\u00a0<tmortagne>\u00a0but I don't see how anything would work if this claslaoder was not contaiing any XWiki class  \n16:54\u00a0<cjd>\u00a0note it's put on the window global because that's what the lib does, requirejs can't help that fact  \n16:54\u00a0<Enygma`>\u00a0cjd: yeah, but I need to use it now, not when the planets align  \n16:54\u00a0<cjd>\u00a0\"now\" is relative, you'll have it when it downloads  \n16:54\u00a0<tmortagne>\u00a0unless the container classloader is not what contain WEB-INF/lib stuff  \n16:55\u00a0<Enygma`>\u00a0that does not make much sense  \n16:55\u00a0<Enygma`>\u00a0actually, it would if the entire code I am modifying was written using require  \n16:55\u00a0<cjd>\u00a0wrap the whole thing  \n16:56\u00a0<cjd>\u00a0require(['stuff','that','i','need'], function () { \u00a0\u00a0\u00a0\u00a0<evertything> \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0});// Done, now lets go to the bar.  \n16:56\u00a0<Enygma`>\u00a0that`s how Frankenstein was born :/  \n16:57\u00a0<cjd>\u00a0google has a 50% annual code turnover rate, whatever you're hacking now will (or should) be deleted and rewritten soon :)  \n16:57\u00a0<cjd>\u00a0yes, we're not google, we should be  \n16:58\u00a0<Enygma`>\u00a0yeah, our refactoring power is, to say the least, limited  \n16:59\u00a0<fmancinelli>\u00a0has quit  \n17:02\u00a0<evalica>\u00a0has quit  \n17:02\u00a0<momomomomo>\u00a0has joined #xwiki  \n17:09\u00a0<evalica>\u00a0has joined #xwiki  \n17:09\u00a0<evalica>\u00a0has left #xwiki  \n17:11\u00a0<momomomomo>\u00a0has quit  \n17:13\u00a0<fmancinelli>\u00a0has joined #xwiki  \n17:24\u00a0<vmassol>\u00a0yeah works now :) committing  \n17:26\u00a0<momomomomo>\u00a0has joined #xwiki  \n17:32\u00a0<vmassol>\u00a0Pbas: should be ok now :)  \n17:33\u00a0<vmassol>\u00a0(all details in http://jira.xwiki.org/browse/XWIKI-11706# )  \n17:33\u00a0<tmortagne>\u00a0has quit  \n17:33\u00a0<vmassol>\u00a0thanks for noticing it!  \n17:34\u00a0<Pbas>\u00a0Thanks to you: you did all the job! :)  \n17:34\u00a0<vmassol>\u00a0was a tricky one!  \n17:35\u00a0<Pbas>\u00a0like usually, no?  \n17:35\u00a0<vmassol>\u00a0when you can, please confirm it works fine for you  \n17:35\u00a0<vmassol>\u00a0no :)  \n17:35\u00a0<vmassol>\u00a0luckily not all problems are so complex  \n17:35\u00a0<vmassol>\u00a0what's hard here is that to fix this you had to understand the implementation of Apache Naming library  \n17:37\u00a0<Pbas>\u00a0I will certainly upgrade 6.4.0 because HTML export issue and another issues. \u00a0I will use 6.4.2 then.  \n17:37\u00a0<Pbas>\u00a0I will update XWIKI-11706 at this moment  \n17:38\u00a0<vmassol>\u00a0ok so I hope I really fixed it then  \n17:38\u00a0<vmassol>\u00a0because if not I'll discover it too late  \n17:38\u00a0<vmassol>\u00a0and we'll need a 6.4.3  \n17:38\u00a0<vmassol>\u00a0:)  \n17:38\u00a0<Pbas>\u00a0:-D  \n17:40\u00a0<fmancinelli>\u00a0has quit  \n17:42\u00a0<fmancinelli>\u00a0has joined #xwiki  \n17:55\u00a0<momomomomo>\u00a0has quit  \n17:58\u00a0<woshilapin>\u00a0has quit  \n18:06\u00a0<cjd>\u00a0has quit  \n18:12\u00a0<KermitTheFragger>\u00a0has quit  \n18:19\u00a0<ClemensR>\u00a0has quit  \n18:37\u00a0<Denis1>\u00a0is now known as <Denis>  \n19:14\u00a0<fmancinelli>\u00a0has quit  \n19:15\u00a0<vmassol>\u00a0has quit  \n19:24\u00a0<mflorea1>\u00a0has quit  \n19:29\u00a0<sburjan>\u00a0has joined #xwiki  \n19:40\u00a0<Pbas>\u00a0has quit  \n19:55\u00a0<Slashman>\u00a0has quit  \n21:22\u00a0<woshilapin>\u00a0has joined #xwiki  \n21:40\u00a0<Denis>\u00a0has quit  \n21:44\u00a0<Denis>\u00a0has joined #xwiki  \n21:55\u00a0<woshilapin>\u00a0has quit  \n22:27\u00a0<woshilapin>\u00a0has joined #xwiki\n"}