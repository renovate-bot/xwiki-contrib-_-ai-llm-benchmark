{"id": "dev:IRC.xwikiArchive20170116", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20170116", "title": "IRC Archive for channel #xwiki on 16 January 2017 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<sdumitriu>\u00a0has quit  \n02:00\u00a0<sdumitriu>\u00a0has joined #xwiki  \n06:24\u00a0<mflorea>\u00a0has joined #xwiki  \n07:34\u00a0<msmeria>\u00a0has joined #xwiki  \n08:02\u00a0<raphael29\\_>\u00a0has joined #xwiki  \n08:53\u00a0<vmassol>\u00a0has joined #xwiki  \n08:53\u00a0<ImRG>\u00a0has joined #xwiki  \n08:57\u00a0<acotiuga>\u00a0has joined #xwiki  \n08:58\u00a0<acotiuga>\u00a0has quit  \n08:59\u00a0<acotiuga>\u00a0has joined #xwiki  \n09:07\u00a0<edvorg>\u00a0has joined #xwiki  \n09:12\u00a0<vmassol>\u00a0has quit  \n09:13\u00a0<mflorea>\u00a0has quit  \n09:14\u00a0<vmassol>\u00a0has joined #xwiki  \n09:24\u00a0<vmassol>\u00a0has quit  \n09:28\u00a0<gdelhumeau>\u00a0has joined #xwiki  \n09:28\u00a0<vmassol>\u00a0has joined #xwiki  \n09:39\u00a0<mflorea>\u00a0has joined #xwiki  \n09:40\u00a0<vmassol>\u00a0has quit  \n09:48\u00a0<vmassol>\u00a0has joined #xwiki  \n09:51\u00a0<vmassol>\u00a0has quit  \n09:51\u00a0<vmassol>\u00a0has joined #xwiki  \n10:39\u00a0<Pbas>\u00a0has joined #xwiki  \n10:47\u00a0<Slashman>\u00a0has joined #xwiki  \n11:04\u00a0<Enygma`>\u00a0has joined #xwiki  \n11:06\u00a0<evalica>\u00a0has joined #xwiki  \n11:30\u00a0<vmassol>\u00a0has quit  \n11:31\u00a0<vmassol>\u00a0has joined #xwiki  \n11:34\u00a0<tmortagne>\u00a0has joined #xwiki  \n11:34\u00a0<edvorg>\u00a0has quit  \n11:49\u00a0<raphael29\\_>\u00a0has quit  \n12:20\u00a0<gdelhumeau>\u00a0has quit  \n12:21\u00a0<gdelhumeau\\_>\u00a0has joined #xwiki  \n12:28\u00a0<martinus\\_\\_>\u00a0tmortagne, hi ! We are using xwiki 6.4.4 : do you remember any issue with ldap group maping cache ? It seems the cache delay settings doesn't act. We need to do a manual \"reset cache\" each time a user is added/removed in a LDAP group (I don't find anything about this in Jira)  \n12:30\u00a0<LMNTRIX>\u00a0has joined #xwiki  \n12:38\u00a0<LMNTRIX>\u00a0has quit  \n12:41\u00a0<vmassol>\u00a0has quit  \n12:56\u00a0<vmassol>\u00a0has joined #xwiki  \n13:00\u00a0<msmeria1>\u00a0has joined #xwiki  \n13:03\u00a0<msmeria>\u00a0has quit  \n13:40\u00a0<tmortagne>\u00a0martinus\\_\\_: it's not exactly a bug, in 6.4.4 the value is not really a time to live but more a timeout (the start date for the cache is the last time it was USED, not when it was ADDED to the cache)  \n13:40\u00a0<tmortagne>\u00a0I changed that recently when I added some API to allow different kind of caches  \n13:42\u00a0<tmortagne>\u00a0(changed in 7.4)  \n13:44\u00a0<tmortagne>\u00a0martinus\\_\\_: http://jira.xwiki.org/browse/XWIKI-12868  \n13:52\u00a0<martinus\\_\\_>\u00a0tmortagne, I have a running 8.3 test instance here. I'm doing an LDAP group mapping. I've set the cache expiration to 10s for the sake of the test. When the userA which is part of that group logs in, it is added to the xwiki group (like expected). Now I updated the ldap group and swap the membership to userB (replacing userA), and try to login in xwiki : the xwiki group still has userA. Is it expected ?  \n13:53\u00a0<martinus\\_\\_>\u00a0I would expect to have userB in the xwiki group  \n13:53\u00a0<tmortagne>\u00a0martinus\\_\\_: the cache cannot know that something changed on LDAP server side  \n13:53\u00a0<martinus\\_\\_>\u00a0tmortagne, isn't expect to retrieve the group membership on login ?  \n13:54\u00a0<martinus\\_\\_>\u00a0on every login I mean  \n13:54\u00a0<tmortagne>\u00a0if the group membership is already in the cache it's using it  \n13:54\u00a0<tmortagne>\u00a0otherwise the cache would be useless  \n13:54\u00a0<martinus\\_\\_>\u00a0\"Time in seconds after which the list of members in a group is refreshed from LDAP.\" => 10s  \n13:56\u00a0<tmortagne>\u00a0is the user only in both group or only in the old/wrong one ?  \n13:56\u00a0<tmortagne>\u00a0s/only//  \n13:57\u00a0<tmortagne>\u00a0does it work as you expect when you force reset the cache ?  \n14:00\u00a0<martinus\\_\\_>\u00a0tmortagne, kind of.  \n14:00\u00a0<martinus\\_\\_>\u00a0tmortagne, sorry for the vague answer but it's pretty tricky to tests every cases  \n14:00\u00a0<martinus\\_\\_>\u00a0the specific case with only one user in the ldap group, and swap that user to another one doesn't work  \n14:01\u00a0<martinus\\_\\_>\u00a0it is never refreshed it seems  \n14:02\u00a0<tmortagne>\u00a0martinus\\_\\_: you sure xwiki.authentication.ldap.mode\\_group\\_sync is not set to \"create\" ? in xwiki.cfg or in the UI if you use the UI  \n14:03\u00a0<tmortagne>\u00a0(that would mean it set membership only when the user is created)  \n14:03\u00a0<martinus\\_\\_>\u00a0not it's on \"at each auth of a user\"  \n14:04\u00a0<martinus\\_\\_>\u00a0(indeed if it was on \"upon creation\" it would explain it)  \n14:04\u00a0<martinus\\_\\_>\u00a0I have not ldap settings in xwiki.cfg but the authclass  \n14:05\u00a0<martinus\\_\\_>\u00a0what would happen if I remove the ldap group ??  \n14:05\u00a0<martinus\\_\\_>\u00a0tmortagne, in the end my goal is pretty simple: having the xwiki group in sync with the ldap one :)  \n14:05\u00a0<martinus\\_\\_>\u00a0easy said  \n14:06\u00a0<tmortagne>\u00a0AFAIK if the group cache is empty when authenticating there is no reason the membership does not change  \n14:08\u00a0<martinus\\_\\_>\u00a0tmortagne, agree  \n14:09\u00a0<tmortagne>\u00a0if you can reproduce as will the best is usually to enable debug log and see what you get (does it get the members from the cache or does it request it from LDAP, does it try to modify XWiki users, etc.)  \n14:09\u00a0<martinus\\_\\_>\u00a0I guess the logging in user has to be in that ldap group for the sync to happen ?  \n14:10\u00a0<tmortagne>\u00a0what the authenticator does is look at the configured mapping you have, load all the member for each LDAP group in there and add or remove the user from associated XWiki groups depending on the user being in the LDAP group or not  \n14:14\u00a0<martinus\\_\\_>\u00a0tmortagne, it does this on every users login, right ?  \n14:14\u00a0<tmortagne>\u00a0yes  \n14:15\u00a0<tmortagne>\u00a0if the LDAP authenticator is called and mode\\_group\\_sync is always (or not set)  \n14:16\u00a0<martinus\\_\\_>\u00a0tmortagne, if I look on my ldap logs, I see no search on the group DN  \n14:16\u00a0<martinus\\_\\_>\u00a0upon login  \n14:17\u00a0<tmortagne>\u00a0XWiki LDAP debug log would give you more information  \n14:17\u00a0<martinus\\_\\_>\u00a0tmortagne, I'm going to enable debugging then  \n14:18\u00a0<martinus\\_\\_>\u00a0tmortagne, <logger name=\"org.xwiki.contrib.ldap\" level=\"trace\"/> should be ok ?  \n14:18\u00a0<tmortagne>\u00a0martinus\\_\\_: you have logging UI in admin to change loggers level  \n14:18\u00a0<tmortagne>\u00a0which does not require restart  \n14:18\u00a0<martinus\\_\\_>\u00a0tmortagne, good  \n14:19\u00a0<tmortagne>\u00a0see http://extensions.xwiki.org/xwiki/bin/view/Extension/LDAP/Authenticator/#HEnableLDAPdebuglog  \n14:20\u00a0<martinus\\_\\_>\u00a0tmortagne, weird it's already set to TRACE in logging app  \n14:20\u00a0<martinus\\_\\_>\u00a0org.xwiki.contrib.ldap and sub nodes  \n14:21\u00a0<tmortagne>\u00a0make sure you are looking at \"level\" column  \n14:21\u00a0<tmortagne>\u00a0it should be empty  \n14:22\u00a0<martinus\\_\\_>\u00a0tmortagne, udnerstood...  \n14:22\u00a0<tmortagne>\u00a0then in the action column yes you have TRACE selected by default  \n14:22\u00a0<martinus\\_\\_>\u00a0tmortagne, I'll keep you informed  \n14:23\u00a0<tmortagne>\u00a0ok thanks, write a new integration test as close as possible to you use case in the meantime  \n14:26\u00a0<martinus\\_\\_>\u00a0tmortagne, that's strange. I the logging UI, when I hit \"set\" the value is not being set in the \"value\" column  \n14:27\u00a0<tmortagne>\u00a0martinus\\_\\_: hmm actually it's possible there is an issue in 8.3 with this UI  \n14:27\u00a0<martinus\\_\\_>\u00a0tmortagne, I'm doomed  \n14:27\u00a0<martinus\\_\\_>\u00a0:D  \n14:29\u00a0<tmortagne>\u00a0martinus\\_\\_: go to page XWiki.LoggingAdmin  \n14:29\u00a0<tmortagne>\u00a0that's the actual page which is included in the admin  \n14:29\u00a0<tmortagne>\u00a0but there was an issue with the include  \n14:31\u00a0<martinus\\_\\_>\u00a0I'm on XWiki.LoggingAdmin  \n14:31\u00a0<martinus\\_\\_>\u00a0then ?  \n14:32\u00a0<martinus\\_\\_>\u00a0ah  \n14:32\u00a0<martinus\\_\\_>\u00a0it works  \n14:38\u00a0<martinus\\_\\_>\u00a0I'm going in PM  \n14:39\u00a0<martinus\\_\\_>\u00a0tmortagne, I pasted log entries to you  \n14:39\u00a0<martinus\\_\\_>\u00a0members are well retrieved but somehow not added to the local xwiki group  \n14:40\u00a0<tmortagne>\u00a0according to the log it definitely access the LDAP server, it's weird you don't see it in server side  \n14:40\u00a0<martinus\\_\\_>\u00a0tmortagne, I see it server side this time  \n14:40\u00a0<tmortagne>\u00a0ok  \n14:41\u00a0<martinus\\_\\_>\u00a0but still, my \"testgroup\" contains only one member  \n14:41\u00a0<martinus\\_\\_>\u00a0in xwiki  \n14:41\u00a0<tmortagne>\u00a0what in your membership configuration ?  \n14:41\u00a0<msmeria>\u00a0has joined #xwiki  \n14:41\u00a0<martinus\\_\\_>\u00a0tmortagne, what do you mean ?  \n14:42\u00a0<tmortagne>\u00a0what group mapping did you set in the LDAP configuration  \n14:42\u00a0<martinus\\_\\_>\u00a0testGroup => cn=testgroup,ou=groups,dc=xxx,dc=org  \n14:43\u00a0<tmortagne>\u00a0no other group ? just this pair ?  \n14:43\u00a0<tmortagne>\u00a0hmm  \n14:43\u00a0<tmortagne>\u00a0\"testGroup\" looks wrong  \n14:43\u00a0<msmeria1>\u00a0has quit  \n14:43\u00a0<martinus\\_\\_>\u00a0yes just that pair  \n14:44\u00a0<tmortagne>\u00a0try with \"XWiki.testGroup\" instead  \n14:44\u00a0<martinus\\_\\_>\u00a0tmortagne, ahem it could be this  \n14:45\u00a0<tmortagne>\u00a0looks under \"The user belongs to following XWiki groups\"  \n14:45\u00a0<tmortagne>\u00a0testGroup is resolved as Main.testGroup instead of XWiki.testGroup, might be the source of your issue  \n14:46\u00a0<martinus\\_\\_>\u00a0tmortagne, now I have two xwiki groups : Main.testGroup and XWiki.testGroup with a single user in there  \n14:47\u00a0<tmortagne>\u00a0Main.testGroup was automatically created because of your mapping  \n14:47\u00a0<tmortagne>\u00a0you should get rid of it  \n14:49\u00a0<martinus\\_\\_>\u00a0tmortagne, ok removed both and the system recreated XWiki.testGroup as expected BUT with only one member  \n14:49\u00a0<martinus\\_\\_>\u00a0it's expected ?  \n14:50\u00a0<tmortagne>\u00a0authenticator only deal with authenticating user  \n14:50\u00a0<tmortagne>\u00a0so yes only one  \n14:51\u00a0<tmortagne>\u00a0in other words it does not synchronize the groups but only the current user membership  \n14:53\u00a0<martinus\\_\\_>\u00a0tmortagne, ok... so now if I remove that authenticating user from the ldap group...  \n14:54\u00a0<martinus\\_\\_>\u00a0it's removed.  \n14:54\u00a0<martinus\\_\\_>\u00a0so that's it ?  \n14:55\u00a0<martinus\\_\\_>\u00a0:S  \n14:58\u00a0<tmortagne>\u00a0martinus\\_\\_: cool :)  \n14:58\u00a0<martinus\\_\\_>\u00a0tmortagne, so since I replace testGroup by XWiki.testGroup , the specific case when swaping the user works  \n14:58\u00a0<martinus\\_\\_>\u00a0I'm gonna remove XWiki. from the group name a reproduce from the start  \n15:01\u00a0<tmortagne>\u00a0some part of the code takes the input literally and prefix it with default space and some other automatically add \"XWiki\" assuming that's where group are located  \n15:01\u00a0<tmortagne>\u00a0in general you should always indicate the complete group name  \n15:04\u00a0<martinus\\_\\_>\u00a0tmortagne, I did the testing without 'XWiki.', it doesn't remove the user from the xwiki group when the user get swaped/removed from the ldap group. Which thing happen when you specify the space name.  \n15:06\u00a0<tmortagne>\u00a0you should not remove the \"XWiki.\", if you do then you don't indicate the right group  \n15:09\u00a0<martinus\\_\\_>\u00a0tmortagne, why ? It could be 'Main.' by default for example  \n15:10\u00a0<martinus\\_\\_>\u00a0tmortagne, that's what is being done currently, for adding  \n15:10\u00a0<tmortagne>\u00a0martinus\\_\\_: because as you can see from the log and the issue you have groups don't really work in space Main in practice, there is still many places in XWiki that expect they all to be in XWiki space  \n15:11\u00a0<tmortagne>\u00a0same for the users  \n15:11\u00a0<martinus\\_\\_>\u00a0tmortagne, when, the user should not be added in Main.UserName in the first place then maybe  \n15:11\u00a0<tmortagne>\u00a0anyway even if you wanted it to be in Main space, again testGroup is not the full name  \n15:11\u00a0<martinus\\_\\_>\u00a0the group I mean  \n15:11\u00a0<tmortagne>\u00a0and you should put the full name  \n15:12\u00a0<martinus\\_\\_>\u00a0tmortagne, I understand, but if it's not the full name, it should not work at all ?  \n15:12\u00a0<tmortagne>\u00a0the LDAP authenticator take a string and expect it to be the full name, that's all  \n15:12\u00a0<D-Spair>\u00a0has quit  \n15:12\u00a0<D-Spair>\u00a0has joined #xwiki  \n15:14\u00a0<ClemensR>\u00a0has joined #xwiki  \n15:15\u00a0<martinus\\_\\_>\u00a0tmortagne, well. I can hear the group has been mispelled by my side, but I consider being misleaded when the user is well added to the group Main.something but not removed. So it does the work halfway. I hear the mispelling btw.  \n15:17\u00a0<tmortagne>\u00a0I understood your point, just telling you the authenticator just don't expect to get partial name which is why you get this result  \n15:18\u00a0<martinus\\_\\_>\u00a0tmortagne, ok, thanks for your help then. Sorry to have wasted hours with that one :/  \n15:19\u00a0<martinus\\_\\_>\u00a0tmortagne, I would ask explicit group naming in the UI. \u00a0Or enforce a bit more the thing up  \n15:20\u00a0<tmortagne>\u00a0yes the UI would need some love but I don't think anybody have it very high in his todo list  \n15:24\u00a0<aloisdg[m]>\u00a0has quit  \n15:24\u00a0<M-cjd>\u00a0has quit  \n15:24\u00a0<jayaura>\u00a0has quit  \n15:26\u00a0<martinus\\_\\_>\u00a0tmortagne, I have another WIP regarding SSO and my current issue is there is no UI for header or saml extension (on the top of that, you can't use two authclasses at the same time, so I can't combine feature from one and other)  \n15:28\u00a0<tmortagne>\u00a0martinus\\_\\_: biggest contributors on XWiki authenticators are more configuration files guys ;)  \n15:28\u00a0<martinus\\_\\_>\u00a0for sure  \n15:30\u00a0<martinus\\_\\_>\u00a0tmortagne, but I'm unsure those same file guys are using group mapping because they would need to restart their instance every time  \n15:30\u00a0<tmortagne>\u00a0I try to not make mistake in the mapping :D  \n15:31\u00a0<martinus\\_\\_>\u00a0not only a \"mistake\" thing btw  \n15:46\u00a0<martinus\\_\\_>\u00a0tmortagne, I've opened http://jira.xwiki.org/browse/XWIKI-13973 for the record  \n15:55\u00a0<martinus\\_\\_>\u00a0tmortagne, I checked on our 6.4.4 instance it works as expected only when \"reset cache\" is hit so I guess we'd need to upgrade it  \n15:57\u00a0<aloisdg[m]>\u00a0has joined #xwiki  \n16:00\u00a0<tmortagne>\u00a0martinus\\_\\_: or patch it but it's not a one liner to change the cache bahavior  \n16:00\u00a0<tmortagne>\u00a0s/bahavior/behavior/  \n16:01\u00a0<tmortagne>\u00a0anyway it's a good excuse to upgrade and 6.4.x is starting to be old :)  \n16:02\u00a0<martinus\\_\\_>\u00a0tmortagne, i've been testing the group mapping on 6.4.4 before we decided to migrate our ldap server, but not far enough unfortunately  \n16:03\u00a0<martinus\\_\\_>\u00a0tmortagne, well, in fact there are a lot of excuses to upgrade  \n16:03\u00a0<martinus\\_\\_>\u00a0as well as not to ugprade :D  \n16:08\u00a0<martinus\\_\\_>\u00a0tmortagne, ldap group mapping like it is in xwiki is a killer feature (when it works ;:D)  \n16:08\u00a0<martinus\\_\\_>\u00a0not every apps can handle this properly  \n16:09\u00a0<tmortagne>\u00a0still not perfect for huge groups  \n16:15\u00a0<Guest14133>\u00a0has joined #xwiki  \n16:15\u00a0<M-cjd>\u00a0has joined #xwiki  \n16:26\u00a0<msmeria>\u00a0has quit  \n16:42\u00a0<acotiuga>\u00a0has left #xwiki  \n17:29\u00a0<vmassol1>\u00a0has joined #xwiki  \n17:29\u00a0<vmassol>\u00a0has joined #xwiki  \n17:29\u00a0<vmassol1>\u00a0has quit  \n17:32\u00a0<gdelhumeau\\_>\u00a0has quit  \n17:39\u00a0<gdelhumeau>\u00a0has joined #xwiki  \n17:59\u00a0<ImRG>\u00a0has quit  \n18:14\u00a0<evalica>\u00a0has quit  \n18:17\u00a0<Enygma`>\u00a0has quit  \n18:35\u00a0<mflorea>\u00a0has quit  \n18:53\u00a0<ClemensR>\u00a0has quit  \n18:57\u00a0<tmortagne>\u00a0has quit  \n18:57\u00a0<vmassol>\u00a0has quit  \n18:58\u00a0<vmassol>\u00a0has joined #xwiki  \n18:58\u00a0<vmassol>\u00a0has quit  \n18:59\u00a0<vmassol>\u00a0has joined #xwiki  \n19:03\u00a0<vmassol>\u00a0has quit  \n19:06\u00a0<vmassol>\u00a0has joined #xwiki  \n19:21\u00a0<vmassol>\u00a0has quit  \n20:02\u00a0<Slashman>\u00a0has quit  \n20:18\u00a0<vmassol>\u00a0has joined #xwiki  \n20:33\u00a0<vmassol1>\u00a0has joined #xwiki  \n20:33\u00a0<vmassol>\u00a0has quit  \n21:49\u00a0<gdelhumeau>\u00a0has quit  \n21:51\u00a0<vmassol1>\u00a0has quit  \n22:35\u00a0<vmassol>\u00a0has joined #xwiki  \n22:38\u00a0<vmassol>\u00a0has quit\n"}