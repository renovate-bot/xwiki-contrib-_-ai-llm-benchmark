{"id": "dev:IRC.xwikiArchive20101127", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20101127", "title": "IRC Archive for channel #xwiki - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\njvdrean joined #xwiki at 00:01  \njvdrean left at 00:08 (Quit: Leaving.  \njvdrean joined #xwiki at 00:11  \njvdrean left at 00:13 (Client Quit  \ncjdelisle` - (00:22): Think I found it. http://www.xwiki.org/xwiki/bin/edit/XWiki/AdminFieldsDisplaySheet?editor=wiki  \nrrodriguez left at 00:37 (Quit: rrodriguez  \nflorinciu1 left at 01:09 (Read error: Connection reset by peer  \nSvenDowideit\\_ joined #xwiki at 01:14  \nSvenDowideit left at 01:14 (Ping timeout: 264 seconds  \nSvenDowideit\\_ is now known as SvenDowideit ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \njvelociter left at 01:27 (Remote host closed the connection  \njvelociter joined #xwiki at 01:28  \nsdumitriu left at 01:45 (Ping timeout: 240 seconds  \nsdumitriu joined #xwiki at 02:03  \nsdumitriu left at 02:18 (Ping timeout: 255 seconds  \nlucaa joined #xwiki at 03:24  \nlucaa left at 03:31 (Ping timeout: 272 seconds  \nnpm joined #xwiki at 05:34  \nSvenDowideit left at 05:39 (Changing host  \nSvenDowideit joined #xwiki at 05:39  \nabusenius left at 05:40 (Ping timeout: 264 seconds  \nDenis left at 06:01 (Read error: Connection reset by peer  \nDenis joined #xwiki at 06:09  \nnpm left at 06:30 (Remote host closed the connection  \nnpm joined #xwiki at 06:37  \nxwikibot joined #xwiki at 08:48  \nrrodriguez joined #xwiki at 08:49  \nvmassol left at 09:53 (Quit: Leaving.  \nxipe left at 10:01 (Remote host closed the connection  \njbrBridge - (10:40): [dirk] vmassol: I reported some days ago a way to get a whole tomcat stuck. See my last comment on XWIKI-4771. \u00a0As I read you have migrated a bunch of pages to the 2.0 syntax ;-)  \nmflorea joined #xwiki at 11:01  \nlucaa joined #xwiki at 11:18  \nvmassol joined #xwiki at 11:37  \nlucaa left at 11:44 (Quit: Leaving.  \nrrodriguez\\_ joined #xwiki at 11:55  \nrrodriguez left at 11:55 (Read error: Connection reset by peer  \nrrodriguez\\_ is now known as rrodriguez ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nmflorea left at 12:18 (Quit: Leaving.  \nfmancinelli joined #xwiki at 12:42  \nsburjan` left at 12:54 (  \nsburjan` joined #xwiki at 12:55  \nsburjan` left at 12:59 (Client Quit  \nsburjan` joined #xwiki at 13:01  \nvmassol left at 13:08 (Quit: Leaving.  \nEnygma` joined #xwiki at 13:19  \nsburjan` left at 13:22 (  \nsburjan` joined #xwiki at 13:24  \nsburjan\\_ joined #xwiki at 13:38  \nsburjan` left at 13:38 (Ping timeout: 260 seconds  \nsburjan\\_ is now known as sburjan` ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nsburjan` left at 13:44 (Ping timeout: 265 seconds  \nsburjan` joined #xwiki at 13:49  \nsburjan` left at 13:53 (Client Quit  \nsburjan` joined #xwiki at 13:53  \nvmassol joined #xwiki at 13:54  \nrrodriguez left at 13:59 (Read error: Connection reset by peer  \nrrodriguez joined #xwiki at 14:00  \nsdumitriu joined #xwiki at 14:19  \nabusenius joined #xwiki at 14:21  \nvenkatna joined #xwiki at 14:27  \nvenkatna left at 14:32 (Ping timeout: 240 seconds  \nsburjan` left at 15:01 (  \nsburjan` joined #xwiki at 15:02  \nsburjan` left at 15:36 (Read error: No route to host  \nsburjan\\_ joined #xwiki at 15:37  \nsburjan\\_ is now known as sburjan` ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nflorinciu joined #xwiki at 16:21  \nsdumitriu left at 16:23 (Ping timeout: 240 seconds  \nsdumitriu joined #xwiki at 16:36  \njvdrean joined #xwiki at 16:46  \njvdrean left #xwiki at 16:46  \nfmancinelli left at 17:10 (Ping timeout: 245 seconds  \nEnygma` left at 17:26 (Ping timeout: 240 seconds  \nabusenius left at 17:28 (Ping timeout: 276 seconds  \nabusenius joined #xwiki at 17:28  \ncjdelisle` - (17:36): The entityRef api is really annoying me. I'm trying to store attachments in the filesystem in a directory structure under /storage/<wikiname>/<docFullname>/attachments/<filename>  \ncjdelisle` - (17:37): Getting that information used to be trivial but the new ref api has made it into a big project.  \ncjdelisle` - (17:40): Getting the wiki name is not that difficult, it used to be doc.getWiki(); but now is doc.getDocumentReference().getWikiReference().getName();  \ncjdelisle` - (17:41): Getting the full name without the wiki is not so easy. AFAICT the only way to get the unprefixed full name is to use LocalReferenceEntityReferenceSerializer which is deprecated.  \ncjdelisle` - (17:42): ``This is an implementation use for backward compatibility only and it should be dropped in the future since there's no reason to remove the wiki name''  \ncjdelisle` - (17:42): ^ huge assumption  \nsdumitriu - (17:44): Why do you want to remove it?  \ncjdelisle` - (17:46): Because I want a dir for the wiki, then under that a dir for the document name.  \ncjdelisle` - (17:46): I suppose there's no reason not to have /storage/xwiki/xwiki:Main.WebHome/attachments/myfile.jpg  \ncjdelisle` - (17:47): I had imagined it would look like /storage/xwiki/Main.WebHome/attachments/myfile.jpg  \nsdumitriu - (17:48): Why not storage/xwiki/Main/WebHome/attachments/myfile.png?  \nsdumitriu - (17:49): It would be so much simpler and more generic  \nsdumitriu - (17:49): while (ref still has parent)  \nsdumitriu - (17:49): pop folder name  \nsdumitriu - (17:49): ref = ref.parentRef  \ncjdelisle` - (17:49): When do you expect to start using nested spaces?  \nsdumitriu - (17:49): cjdelisle`: I'd like to give you what I did last summer for fs att storage  \nsdumitriu - (17:50): Since it seems that I'll never find the time to clean it up  \nsdumitriu - (17:50): Nested spaces? Two years ago? :D  \ncjdelisle` - (17:50): Great, email it.  \ncjdelisle` - (17:50): So that means we can expect them within 2 more years.  \ncjdelisle` - (17:50): ;)  \ncjdelisle` - (17:51): Here's the problem: storage/xwiki/Main/WebHome/attachments/myfile.png  \ncjdelisle` - (17:51): suppose you had a document called Main.WebHome.attachments?  \ncjdelisle` - (17:52): Or worse a document called Main.WebHome.attachments.myfile\\.png  \ncjdelisle` - (17:53): Solution1 is to use an escaping hack so that subdirectories will never collide with \"things\".  \ncjdelisle` - (17:53): Solution2 is to make sure the depth is always the same.  \ncjdelisle` - (17:54): I am working on solution2 at the moment because in the current model, the space is fundamentally a part of the document's name.  \ncjdelisle` - (17:55): I will pose the problem in the next proposal but I want to have something functional first.  \nsdumitriu - (17:55): cjdelisle`: Sent, I have to go now  \ncjdelisle` - (17:55): Ok, thank.  \ncjdelisle` - (17:55): s  \nsdumitriu - (17:57): I think there was another change somewhere, in HibernateBaseStore or something, but I can't find it  \ncjdelisle` - (17:59): There looks to be a custom reference serializer.  \ncjdelisle` - (18:04): That's good stuff, The only thing I can see that's necessary is to return a custom XWikiAttachmentContent so that the content isn't constantly copied back and forth.  \njvelociter\\_ joined #xwiki at 18:56  \njvelociter left at 19:00 (Ping timeout: 240 seconds  \njvelociter\\_ is now known as jvelociter ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nsburjan\\_ joined #xwiki at 19:36  \nflorinciu1 joined #xwiki at 19:39  \nsburjan` left at 19:39 (Ping timeout: 264 seconds  \nsburjan\\_ is now known as sburjan` ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \njvelociter left at 19:40 (\\*.net \\*.split  \nsdumitriu left at 19:40 (Ping timeout: 240 seconds  \nflorinciu left at 19:40 (Read error: Connection reset by peer  \nsdumitriu joined #xwiki at 19:40  \njvelociter joined #xwiki at 19:41  \nvmassol left at 19:44 (Quit: Leaving.  \nsburjan` left at 19:46 (  \nsburjan` joined #xwiki at 19:47  \nsburjan` left at 19:48 (Client Quit  \nsburjan` joined #xwiki at 19:49  \nproyvind\\_ joined #xwiki at 19:49  \nproyvind left at 19:50 (Ping timeout: 245 seconds  \nabusenius\\_ joined #xwiki at 20:01  \nabusenius left at 20:05 (Ping timeout: 324 seconds  \nsdumitriu - (20:13): cjdelisle`: I'm back  \nsdumitriu - (20:13): Did you find anything useful in that code?  \ncjdelisle` - (20:13): Do you have @Requirement(\"path\")  \ncjdelisle` - (20:13): \u00a0\u00a0\u00a0\u00a0private EntityReferenceSerializer<String>?  \nsdumitriu - (20:13): Yes, let me get it  \ncjdelisle` - (20:14): It looks pretty good, I will probably integrate the hibernate end.  \ncjdelisle` - (20:14): I see a couple issues eg: documents with ../../../../ in the name.  \ncjdelisle` - (20:16): oh hah, that depends on the serializer so I don't know if it's right or wrong.  \nsdumitriu - (20:16): Sent  \nsdumitriu - (20:16): Yes, I took care of that in the serializer  \nsdumitriu - (20:16): IIRC  \nsdumitriu - (20:16): Yep  \nsdumitriu - (20:16): URLEncoder.encode(currentReference.getName(), \"UTF-8\").replace(\".\", \"%2E\")  \ncjdelisle` - (20:18): Why replace .?  \ncjdelisle` - (20:18): risk of making hidden files?  \nsdumitriu - (20:18): No  \nsdumitriu - (20:18): I don't remember  \ncjdelisle` - (20:18): Oh I suppose one might make a dir called ..  \nsdumitriu - (20:18): I'll look at the code  \nsdumitriu - (20:18): Ah, right  \ncjdelisle` - (20:18): What do you propose to do about nested spaces?  \nsdumitriu - (20:19): I think the current code works well  \nsdumitriu - (20:19): For each space segment it creates a folder  \ncjdelisle` - (20:20): The problem as I imagine it is this:  \nsdumitriu - (20:20): I have to stop saying \"folder\"  \nsdumitriu - (20:20): Directory  \ncjdelisle` - (20:20): user creates a document called Main.WebHome and attaches a file called 'hello'.  \ncjdelisle` - (20:21): User creates another document called Main.WebHome.hello  \ncjdelisle` - (20:21): /xwiki/Main/WebHome/hello will want to be both an attachment and a directory.  \ncjdelisle` - (20:23): perhaps: /xwiki/Main/WebHome/~this/attachments/hello ?  \ncjdelisle` - (20:24): or \u00a0/xwiki/Main/WebHome/~this/hello if you don't want a specific attachments dir.  \ncjdelisle` - (20:29): ping when back  \nsburjan` left at 20:30 (Read error: Connection reset by peer  \nsburjan` joined #xwiki at 20:30  \njvelociter left at 20:33 (Ping timeout: 245 seconds  \nproyvind joined #xwiki at 20:33  \nproyvind\\_ left at 20:36 (Ping timeout: 264 seconds  \nfmancinelli joined #xwiki at 21:03  \nfmancinelli left at 22:54 (Ping timeout: 255 seconds  \n\n"}