{"id": "dev:IRC.xwikiArchive20111213", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20111213", "title": "IRC Archive for channel #xwiki on 13 December 2011 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n00:23\u00a0<jvelociter>\u00a0has quit  \n01:00\u00a0<jvdrean>\u00a0has quit  \n03:22\u00a0<tekzilla>\u00a0has quit  \n03:24\u00a0<tekzilla>\u00a0has joined #xwiki  \n05:55\u00a0<DrLou>\u00a0has quit  \n06:01\u00a0<Denis>\u00a0has quit  \n06:01\u00a0<Denis>\u00a0has joined #xwiki  \n07:42\u00a0<vmassol>\u00a0has joined #xwiki  \n08:00\u00a0<mflorea>\u00a0has joined #xwiki  \n08:04\u00a0<vmassol>\u00a0has quit  \n08:46\u00a0<vmassol>\u00a0has joined #xwiki  \n08:52\u00a0<vmassol>\u00a0hmm I don't have right anymore on xwiki.org  \n08:52\u00a0<vmassol>\u00a0(PR rights apparently)  \n08:56\u00a0<vmassol>\u00a0seems something is wrong on xwiki.org  \n08:56\u00a0<vmassol>\u00a0I've checked the rights and I'm still int the admin group  \n08:58\u00a0<vmassol>\u00a0can someone else try to preview/save http://platform.xwiki.org/xwiki/bin/view/Main/XWikiSyntax ?  \n09:00\u00a0<+sburjan`>\u00a0let me save with a minor edition  \n09:00\u00a0<vmassol>\u00a0sburjan`: try preview  \n09:00\u00a0<vmassol>\u00a0I don't remember if preview sets the rigths though but it should I think  \n09:00\u00a0<+sburjan`>\u00a0locked by cjdelisle :)  \n09:01\u00a0<vmassol>\u00a0sburjan`: you have PR on the farm?  \n09:01\u00a0<+sburjan`>\u00a0I might have, because I'm also an Admin  \n09:02\u00a0<@cjdelisle>\u00a0it might be a dropPermissions() call which was added somewhere...  \n09:02\u00a0<+sburjan`>\u00a0ok, heading for the office, talk when I get there  \n09:04\u00a0<@cjdelisle>\u00a0nope, not a dropPermissions() issue  \n09:06\u00a0<@cjdelisle>\u00a0$xcontext.hasProgrammingRights() == false  \n09:19\u00a0<@cjdelisle>\u00a0$xwiki.parseGroovyFromPage('xwiki:XWiki.XWikiPreferences', '') --> groovy\\_missingrights  \n09:20\u00a0<@cjdelisle>\u00a0so hasProgrammingRights(doc, context) is returning false all the time  \n09:21\u00a0<@cjdelisle>\u00a0hasAccessLevel(\"programming\", username, docname, context) <-- returns true  \n09:22\u00a0<@cjdelisle>\u00a0so something goes wrong between lines 964 and 993 in XWikiRightServiceImpl  \n09:23\u00a0<@cjdelisle>\u00a0tail -n 1000 <logs> | grep 'Faile to check programming right for document'  \n09:25\u00a0<@cjdelisle>\u00a0heh log viewer has no PR anymore either  \n09:41\u00a0<vmassol>\u00a0we should try to restart xwii.org to see if it has any effect  \n09:41\u00a0<vmassol>\u00a0or call flush cache maybe first  \n09:41\u00a0<vmassol>\u00a0trying to call flush cache now  \n09:43\u00a0<vmassol>\u00a0I can't since I don't have PR ;)  \n09:43\u00a0<vmassol>\u00a0need a restart  \n09:43\u00a0<@cjdelisle>\u00a0hasProgrammingRights() calls hasAccessLevel()  \n09:44\u00a0<@cjdelisle>\u00a0hasAccessLevel is working right so it's a pretty narrow band of code that's to blame.  \n09:44\u00a0<@cjdelisle>\u00a0I can't really see how it can be failing unless something in there is throwing a rogue exception  \n09:45\u00a0<@cjdelisle>\u00a0https://github.com/xwiki/xwiki-platform/blob/master/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/user/impl/xwiki/XWikiRightServiceImpl.java#L961  \n09:53\u00a0<sburjan>\u00a0has joined #xwiki  \n10:00\u00a0<+sburjan>\u00a0ok, we definetely have a rights issue  \n10:01\u00a0<+sburjan>\u00a0jiraMacro is also broken  \n10:01\u00a0<vmassol>\u00a0guys you don't want to try restarting, just to test?  \n10:01\u00a0<tmortagne>\u00a0has joined #xwiki  \n10:01\u00a0<+sburjan>\u00a0still not working. so vmassol , we're in the same boat  \n10:01\u00a0<Keph>\u00a0has joined #xwiki  \n10:02\u00a0<@cjdelisle>\u00a0if someone has ssh access on the box, I suspect the logs will show some of \"Faile to check programming right for document\"  \n10:07\u00a0<vmassol>\u00a0has quit  \n10:08\u00a0<+tmortagne>\u00a0note: vmassol lost power  \n10:09\u00a0<+sburjan>\u00a0ok, so maybe there is a connection between 13th and Tuesday :)  \n10:12\u00a0<+tmortagne>\u00a0sdumitriu: the issue reported by vmassol yesterday is actually only when installed an extension on subwiki which is not supposed to be possible with the current UI, Vincent was unable to reproduce it this morning (and I don't understand how he did it yesterday)  \n10:12\u00a0<+tmortagne>\u00a0XWIKI-7282  \n10:13\u00a0<+tmortagne>\u00a0so it's ok for 3.3 since you can't have the issue with the current UI, in the meantime I found XWIKI-7286, i'm looking at it  \n10:22\u00a0<vmassol>\u00a0has joined #xwiki  \n10:36\u00a0<+tmortagne>\u00a0sdumitriu: actually looks like there is a difference between 3.4 and 3.3  \n10:40\u00a0<jvdrean>\u00a0has joined #xwiki  \n11:07\u00a0<CIA-115>\u00a0Vincent Massol\u000f stable-3.3.x\u000f \\* r4605242\u000f \u000f/ xwiki-commons-core/xwiki-commons-component/xwiki-commons-component-default/src/main/java/org/xwiki/component/embed/EmbeddableComponentManager.java :\u000f XCOMMONS-68: EmbeddableComponentManager sends the ComponentAddedEvent Event before registering the Component - http://git.io/6xtpYw  \n11:13\u00a0<vmassol>\u00a0cjdelisle: I'm back. I can check the logs \u00a0on xwiki.org  \n11:16\u00a0<@cjdelisle>\u00a0if this shows up recently: \u00a0\"Faile to check programming right for document\" (typo and all) any stack traces surrounding it are interesting.  \n11:19\u00a0<jvelociter>\u00a0has joined #xwiki  \n11:21\u00a0<vmassol>\u00a0cjdelisle: grep \"to check programming right\" catalina.out \u00a0<\u2014 gives empty result  \n11:21\u00a0<vmassol>\u00a0there are lots of errors of permissions in the log though  \n11:21\u00a0<vmassol>\u00a0the ircbot scheduler job fails every minute  \n11:21\u00a0<vmassol>\u00a0saying that the user xwiki:XWiki.VincentMassol didn't have PR when the job was scheduled  \n11:22\u00a0<@cjdelisle>\u00a0hmm  \n11:23\u00a0<vmassol>\u00a0restarting xwiki.org jsut to see  \n11:25\u00a0<xwikibot>\u00a0has joined #xwiki  \n11:26\u00a0<vmassol>\u00a0cjdelisle: works now  \n11:26\u00a0<vmassol>\u00a0the restar fixed the issue  \n11:26\u00a0<vmassol>\u00a0now we need to find out what happened :)  \n11:28\u00a0<@cjdelisle>\u00a0I'm going to tentitively blame a cache.  \n11:28\u00a0<vmassol>\u00a0nice guess! :)  \n11:28\u00a0<vmassol>\u00a0arf  \n11:44\u00a0<evalica>\u00a0has joined #xwiki  \n11:51\u00a0<vmassol>\u00a0links are broken again on xwiki.org  \n11:51\u00a0<vmassol>\u00a0seems we have a serious bug  \n11:52\u00a0<@cjdelisle>\u00a0internal links with [?]  \n11:52\u00a0<vmassol>\u00a0- http://www.xwiki.org/xwiki/bin/view/WikiManager/  \n11:52\u00a0<vmassol>\u00a0- top menu  \n11:53\u00a0<vmassol>\u00a0check the projects top menu  \n11:53\u00a0<vmassol>\u00a0all links point to the main wiki  \n11:53\u00a0<vmassol>\u00a0and http://platform.xwiki.org/xwiki/bin/view/Main/XWikiSyntax is broken again  \n11:53\u00a0<vmassol>\u00a0so the PR issue is back too  \n11:53\u00a0<vmassol>\u00a0did'nt take long....  \n11:54\u00a0<CIA-115>\u00a0Jerome Velociter\u000f master\u000f \\* r445e057\u000f \u000f/ xwiki-enterprise-test/xwiki-enterprise-test-selenium/src/test/it/org/xwiki/test/selenium/AdministrationTest.java :\u000f Adapt test to new section naming strategy : when the i18n key does not ...  \n11:58\u00a0<vmassol>\u00a0has quit  \n12:02\u00a0<Enygma`>\u00a0has joined #xwiki  \n12:04\u00a0<CIA-115>\u00a0tmortagne\u000f master\u000f \\* r0e6d650\u000f \u000f/ (5 files in 5 dirs):\u000f XCOMMONS-69: Can't register listener on a subwiki component manager - http://git.io/IfRvjQ  \n12:04\u00a0<CIA-115>\u00a0tmortagne\u000f master\u000f \\* r6498164\u000f \u000f/ xwiki-commons-core/pom.xml :\u000f Exclude until 3.3 is released - http://git.io/HlSq8Q  \n12:04\u00a0<CIA-115>\u00a0tmortagne\u000f stable-3.3.x\u000f \\* rde32bf0\u000f \u000f/ (5 files in 5 dirs):\u000f XCOMMONS-69: Can't register listener on a subwiki component manager(cherry picked from commit 0e6d6503d55e6a0b3a0067bc4a7ee12c1551fdcd) ...  \n12:07\u00a0<CIA-115>\u00a0tmortagne\u000f stable-3.3.x\u000f \\* r89f53b5\u000f \u000f/ xwiki-commons-core/pom.xml :\u000f XCOMMONS-69: Can't register listener on a subwiki component manager ...  \n12:08\u00a0<Enygma`>\u00a0has quit  \n12:09\u00a0<Enygma`>\u00a0has joined #xwiki  \n12:10\u00a0<Enygma`>\u00a0has quit  \n12:10\u00a0<Enygma`>\u00a0has joined #xwiki  \n12:10\u00a0<Enygma`>\u00a0has quit  \n12:11\u00a0<Enygma`>\u00a0has joined #xwiki  \n12:15\u00a0<@cjdelisle>\u00a0hmm I'd like to know the value of XWiki.getDatabase() but there's no way to get it from API  \n12:15\u00a0<@cjdelisle>\u00a0and there's no way I know to get script to run at this point.  \n12:16\u00a0<CIA-115>\u00a0tmortagne\u000f stable-3.3.x\u000f \\* r08ae162\u000f \u000f/ (10 files in 10 dirs):\u000f XWIKI-7287: Jar hanlder should allow components in any order in the component.txt file ...  \n12:16\u00a0<CIA-115>\u00a0tmortagne\u000f master\u000f \\* r5d91d97\u000f \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-script/src/main/java/org/xwiki/extension/script/internal/ExtensionManagerScriptService.java :\u000f Fix javadoc - http://git.io/GXYYVg  \n12:16\u00a0<CIA-115>\u00a0tmortagne\u000f master\u000f \\* r17abab6\u000f \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-script/src/main/java/org/xwiki/extension/script/internal/ExtensionManagerScriptService.java :\u000f Add javadoc - http://git.io/8f5qcQ  \n12:17\u00a0<CIA-115>\u00a0tmortagne\u000f master\u000f \\* r3bd2da6\u000f \u000f/ (10 files in 10 dirs):\u000f XWIKI-7287: Jar hanlder should allow components in any order in the component.txt file ...  \n12:19\u00a0<+tmortagne>\u00a0cjdelisle: pretty sure XWiki#database is always \"xwiki\"  \n12:20\u00a0<@cjdelisle>\u00a0if somehow it has been nulled, that would explain the permissions problem.  \n12:21\u00a0<+tmortagne>\u00a0but there is no code calling setDatabase except the XWiki init  \n12:22\u00a0<@cjdelisle>\u00a0I can prove that XWikiRightServiceImpl#hasProgrammingRights(XWikiDocument doc, XWikiContext context) returns false  \n12:23\u00a0<+tmortagne>\u00a0and getDatabase is not much use, generally it's context.getMainXWiki  \n12:23\u00a0<@cjdelisle>\u00a0and XWikiRightServiceImpl#hasProgrammingRights(XWikiDocument doc, XWikiContext context) calls XWikiRightServiceImpl#hasAccessLevel(String right, String username, String docname, XWikiContext context)  \n12:23\u00a0<@cjdelisle>\u00a0which returns true  \n12:24\u00a0<@cjdelisle>\u00a0you can check these through the api using parseGroovyFromPage() and hasAccessLevel  \n12:24\u00a0<@cjdelisle>\u00a0parseGroovyFromPage() calls hasProgrammingRights(XWikiDocument doc, XWikiContext context) directly, bypassing the dropPermissions code.  \n12:25\u00a0<+tmortagne>\u00a0cjdelisle: can you test doc.getContentAuthor() ?  \n12:26\u00a0<+tmortagne>\u00a0at least that way we will be sure the issue is with XWiki#getDatabase() (even if that would make it even weirder)  \n12:26\u00a0<@cjdelisle>\u00a0hmm good call, I assumed that Document called strait through  \n12:30\u00a0<@cjdelisle>\u00a0comparing Document#getContentAuthor() and XWikiDocument#getContentAuthor() shows exactly the same code duplicated in 2 places :( \u00a0the only difference is that Document uses the Document compactWikiEntityReferenceSerializer whereas XWikiDocument uses it's.  \n12:37\u00a0<+tmortagne>\u00a0cjdelisle: yep that's because someone tough it was better to duplicate that using deprecated method...  \n12:38\u00a0<@cjdelisle>\u00a0/nod  \n12:39\u00a0<vmassol>\u00a0has joined #xwiki  \n12:39\u00a0<@cjdelisle>\u00a0So I think it's relitively safe to assume that Document#getContentAuthor() is returning the same value  \n12:39\u00a0<+tmortagne>\u00a0sure but is the value right ?  \n12:39\u00a0<+tmortagne>\u00a0that was my initial question actually  \n12:39\u00a0<@cjdelisle>\u00a0I checked for one page and it was.  \n12:40\u00a0<+tmortagne>\u00a0ok  \n12:40\u00a0<@cjdelisle>\u00a0I wouldn't be surprised if there was a piece of nasty code (script?) somewhere that was nulling the XWiki#database  \n12:40\u00a0<+tmortagne>\u00a0so it's indeed getDatabase given the result of your tests but don't understand how it could change during runtime  \n12:41\u00a0<@cjdelisle>\u00a0actually it wouldn't have to be nulled, any value would do as long as it's not \"xwiki\"  \n12:41\u00a0<+tmortagne>\u00a0would be a script using the non API XWiki  \n12:41\u00a0<@cjdelisle>\u00a0yeap, PR only  \n12:42\u00a0<+tmortagne>\u00a0not the kind of thing you can do by mistake  \n12:42\u00a0<+tmortagne>\u00a0I have to go, back in 1h  \n12:42\u00a0<@cjdelisle>\u00a0true  \n12:50\u00a0<vmassol>\u00a0cjdelisle: do you need/want access to xwiki.org? I can get you an account there  \n12:50\u00a0<@cjdelisle>\u00a0I don't think there's anything I could do from the box that I can't do here asside from perhaps a heap dump.  \n12:51\u00a0<vmassol>\u00a0ok  \n12:51\u00a0<vmassol>\u00a0cjdelisle: actually even that is possibme  \n12:51\u00a0<vmassol>\u00a0:)  \n12:51\u00a0<vmassol>\u00a0here:  \n12:51\u00a0<vmassol>\u00a0http://www.xwiki.org/xwiki/monitoring?  \n12:52\u00a0<vmassol>\u00a0you can see the threads there  \n12:52\u00a0<vmassol>\u00a0and generate a thread dump  \n12:52\u00a0<vmassol>\u00a0there's even a \"dump thread as text\" here: http://www.xwiki.org/xwiki/monitoring?part=threadsDump  \n12:54\u00a0<@cjdelisle>\u00a0I was thinking of a dump of the entire heap so I could try to sort through it to see what the state if the machine is but that's a pain...  \n12:54\u00a0<vmassol>\u00a0you can even see the memory usage with javamelody  \n12:54\u00a0<vmassol>\u00a0ie what java objects is taking what space  \n12:55\u00a0<vmassol>\u00a0(and # of instances)  \n12:55\u00a0<mflorea>\u00a0has quit  \n12:57\u00a0<@cjdelisle>\u00a0I'm almost certain it has to be if ((maindb == null) || (!username.startsWith(maindb))) {  \n13:01\u00a0<vmassol1>\u00a0has joined #xwiki  \n13:01\u00a0<@cjdelisle>\u00a0heh I know how we can add a backdoor which will stay open after permissions are lost...  \n13:03\u00a0<vmassol>\u00a0has quit  \n13:04\u00a0<vmassol1>\u00a0:)  \n13:05\u00a0<@cjdelisle>\u00a0I can patch the bot to add a hook for !dbase which will return the value of XWiki#getDatabase()  \n13:06\u00a0<vmassol1>\u00a0you can just add a botlet for that  \n13:06\u00a0<@cjdelisle>\u00a0I could patch the bot to backdoor the system but cryptographic security is tricky, perhaps something to think about later  \n13:07\u00a0<vmassol1>\u00a0anyway asking for XWiki.getDB() is easy from the web interface  \n13:07\u00a0<@cjdelisle>\u00a0The point of using the bot is it's already running so when PR is lost, it's still privileged code  \n13:07\u00a0<vmassol1>\u00a0indeed  \n13:08\u00a0<vmassol1>\u00a0getDB is privileged?  \n13:08\u00a0<@cjdelisle>\u00a0yes  \n13:08\u00a0<vmassol1>\u00a0I can see it in Context  \n13:08\u00a0<@cjdelisle>\u00a0it's in the internal XWiki ovj  \n13:08\u00a0<vmassol1>\u00a0which is public api  \n13:08\u00a0<@cjdelisle>\u00a0there are a whole bunch of getDatabase(), the interesting one is c.x.x.XWiki#getDatabase()  \n13:09\u00a0<vmassol1>\u00a0ok  \n13:09\u00a0<@cjdelisle>\u00a0XWIKI-1234  \n13:09\u00a0<@cjdelisle>\u00a0!search test  \n13:10\u00a0<@cjdelisle>\u00a0hmm quickest way to add a hook  \n13:12\u00a0<vmassol>\u00a0has joined #xwiki  \n13:13\u00a0<vmassol1>\u00a0has quit  \n13:13\u00a0<@cjdelisle>\u00a0if (message.indexOf(\"!getdb\") > -1) { return [context.getWiki().getDatabase()]; }  \n13:13\u00a0<@cjdelisle>\u00a0that should do it  \n13:13\u00a0<@cjdelisle>\u00a0ofc I'm famous for typos  \n13:14\u00a0<vmassol>\u00a0please add a new botlet instead of hacking an existing one since it'll be removed when we upgragde the ircbot app (unless you want that ofc)  \n13:14\u00a0<@cjdelisle>\u00a0I do want it removed, it's really just a 1 minute hack to get this piece of info without PR  \n13:15\u00a0<@cjdelisle>\u00a0In fact as soon as I have the info, I will remove it myself since there is no reason to access the getDatabase() command normally.  \n13:17\u00a0<vmassol>\u00a0cjdelisle: you need a restart of xwiki.org?  \n13:17\u00a0<@cjdelisle>\u00a0!getdb  \n13:17\u00a0<@cjdelisle>\u00a0yes please  \n13:18\u00a0<@cjdelisle>\u00a0I think PR is lost when you save it  \n13:18\u00a0<vmassol>\u00a0ok restarting  \n13:20\u00a0<xwikibot>\u00a0has joined #xwiki  \n13:20\u00a0<@cjdelisle>\u00a0!getdb  \n13:20\u00a0<@cjdelisle>\u00a0:)  \n13:20\u00a0<@cjdelisle>\u00a0now we wait till it blows up  \n13:21\u00a0<vmassol>\u00a0(stopped)  \n13:22\u00a0<@cjdelisle>\u00a0Watch as it doesn't fail and we have to decide how long to leave that little hack there.  \n13:27\u00a0<vmassol>\u00a0murphy\u2026.  \n13:36\u00a0<silviar>\u00a0has joined #xwiki  \n13:46\u00a0<vmassol>\u00a0ok I'm done for oracle. Going to rebuild XE 3.3snap to test installing the wiki manager ui ext again  \n13:50\u00a0<+sburjan>\u00a0managed to create subwikis in oracle ?  \n13:50\u00a0<vmassol>\u00a0yes  \n13:50\u00a0<vmassol>\u00a0with templates  \n13:51\u00a0<vmassol>\u00a0would be good if you could try too at some point  \n13:51\u00a0<+sburjan>\u00a0I will  \n13:51\u00a0<vmassol>\u00a0I'm now testing thomas' latest fixes  \n13:51\u00a0<vmassol>\u00a0for installing the wiki manager ui extension  \n13:52\u00a0<+sburjan>\u00a0I'm not working on platform ATM  \n14:00\u00a0<mflorea>\u00a0has joined #xwiki  \n14:14\u00a0<DrLou>\u00a0has joined #xwiki  \n14:16\u00a0<@cjdelisle>\u00a0!getdb  \n14:16\u00a0<@cjdelisle>\u00a0haha  \n14:16\u00a0<@cjdelisle>\u00a0I was right  \n14:16\u00a0<@cjdelisle>\u00a0now what does it mean?!  \n14:17\u00a0<+tmortagne>\u00a0that the issue is probably some code in extensions.xwiki.org  \n14:17\u00a0<+tmortagne>\u00a0which put the current database in setDatabase  \n14:17\u00a0<vmassol>\u00a0tmortagne: your skype crashed i think  \n14:17\u00a0<+tmortagne>\u00a0but can't imagine why  \n14:17\u00a0<+tmortagne>\u00a0indeed  \n14:19\u00a0<vmassol>\u00a0sdumitriu: how are the tests going? Found that search doesn't work anymore  \n14:19\u00a0<vmassol>\u00a0(tests for EM UI)  \n14:24\u00a0<@cjdelisle>\u00a0nowhere in oldcore does setDatabase() get called except on init  \n14:25\u00a0<@cjdelisle>\u00a0so it has to be script making an explicit call to xcontext.getContext().getWiki().setDatabase()  \n14:26\u00a0<Denis>\u00a0has quit  \n14:33\u00a0<vmassol>\u00a0tmortagne is fixing the search issue (it's a special case)  \n14:34\u00a0<+sburjan>\u00a0did we figured out the PR issue on xwiki.org ?  \n14:35\u00a0<@cjdelisle>\u00a0a variable which is supposed to always be \"xwiki\" is being changed to \"extensions\"  \n14:35\u00a0<@cjdelisle>\u00a0and it can only be happening because of some piece of script, there's nothing in the codebase which alters that variable  \n14:38\u00a0<CIA-115>\u00a0tmortagne\u000f master\u000f \\* r0b98111\u000f \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-api/src/main/java/org/xwiki/extension/repository/internal/DefaultExtensionRepositoryManager.java :\u000f XWIKI-7288: nullpointerexception when searching without any repository ...  \n14:38\u00a0<CIA-115>\u00a0tmortagne\u000f stable-3.3.x\u000f \\* rc38d8b6\u000f \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-api/src/main/java/org/xwiki/extension/repository/internal/DefaultExtensionRepositoryManager.java :\u000f XWIKI-7288: nullpointerexception when searching without any repository ...  \n14:44\u00a0<CIA-115>\u00a0tmortagne\u000f master\u000f \\* r75deeb8\u000f \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-ui/src/main/resources/XWiki/AddExtensions.xml :\u000f Better wording - http://git.io/SwkyLA  \n14:44\u00a0<CIA-115>\u00a0tmortagne\u000f stable-3.3.x\u000f \\* r7f17475\u000f \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-ui/src/main/resources/XWiki/AddExtensions.xml :\u000f Better wording(cherry picked from commit 75deeb8130949cb71d7528785240153f4a9e6308) - http://git.io/ampLHQ  \n14:45\u00a0<sburjan`>\u00a0has quit  \n14:49\u00a0<@cjdelisle>\u00a0It's too bad there isn't a way to hook functions, I don't see any code which appears to be calling setDatabase()  \n14:50\u00a0<@cjdelisle>\u00a0I would be tempted to build oldcore with it removed or nonfunctional and install that  \n14:51\u00a0<@cjdelisle>\u00a0there are some good reasons to remove it including the fact that you pretty much never want to change it and it looks just like something that you want to change all of the time.  \n14:52\u00a0<vmassol>\u00a0cjdelisle: there's a way  \n14:52\u00a0<vmassol>\u00a0it's called aspects  \n14:52\u00a0<vmassol>\u00a0(AOP)  \n14:52\u00a0<vmassol>\u00a0and you can weave against a jar  \n14:52\u00a0<vmassol>\u00a0(bytecode)  \n14:53\u00a0<@cjdelisle>\u00a0hmm  \n14:53\u00a0<@cjdelisle>\u00a0it would be really cool if we used that to provide hooking functionality via groovy script  \n14:54\u00a0<vmassol>\u00a0yep  \n14:54\u00a0<@cjdelisle>\u00a0hook(\"someInsecureFunction\", doNothingFunction);  \n14:54\u00a0<vmassol>\u00a0it's possible to bundle the aspectj compiler I guess  \n14:54\u00a0<vmassol>\u00a0would need to play a bit with classloaders  \n14:55\u00a0<@cjdelisle>\u00a0+1 more thing on the gigabyte express :/  \n14:55\u00a0<@cjdelisle>\u00a0although bigO is 2 gigs and people don't seem to mind  \n14:56\u00a0<vmassol>\u00a0if you want me to patch xwiki.org I can do it if you give me the modified jar  \n14:57\u00a0<@cjdelisle>\u00a0let me get the version and I'll stash what I have and build one  \n14:57\u00a0<@cjdelisle>\u00a0oh it's the trunk  \n14:58\u00a0<vmassol>\u00a0tmortagne: ?  \n14:59\u00a0<vmassol>\u00a0(can you tell cjdelisle the composition of xwiki.org)  \n15:00\u00a0<+tmortagne>\u00a0http://www.xwiki.org/xwiki/bin/view/XWiki/UpgradesLog + almost latest 3.3-SNAPSHOT for XR jars  \n15:05\u00a0<@cjdelisle>\u00a0unfortunately I can't really do much about ease of reflection with groovy  \n15:05\u00a0<@cjdelisle>\u00a0(xcontext.context.getWiki().database = 'haha')  \n15:06\u00a0<@cjdelisle>\u00a0only way I know to deal with that is making it final  \n15:09\u00a0<@cjdelisle>\u00a0Running com.xpn.xwiki.web.XWikiServletURLFactoryTest  \n15:09\u00a0<@cjdelisle>\u00a009:19:27.105 [main] ERROR com.xpn.xwiki.XWiki - Someone tried to set the database in c.x.x.XWiki, this is not allowed.  \n15:09\u00a0<@cjdelisle>\u00a0hmm  \n15:14\u00a0<Denis>\u00a0has joined #xwiki  \n15:20\u00a0<xwikibot>\u00a0has joined #xwiki  \n15:25\u00a0<@cjdelisle>\u00a0that one is built against trunk, the function is there but it logs an error and throws an error too.  \n15:26\u00a0<@cjdelisle>\u00a0all of the tests pass with no obvious issues...  \n15:26\u00a0<@cjdelisle>\u00a0the ServletURLFactoryTest was using the function in it's setUp()  \n15:32\u00a0<vmassol>\u00a0sounds a bit dangerous to install  \n15:32\u00a0<vmassol>\u00a0since xwiki.org is on 3.3  \n15:32\u00a0<vmassol>\u00a0could you just provide a class file which we can put in WEB-INF/classes?  \n15:32\u00a0<vmassol>\u00a0(cjdelisle)  \n15:33\u00a0<+tmortagne>\u00a0cjdelisle: what did you modified ? would probably be safer to put the .class than the whole oldcore for now  \n15:33\u00a0<@cjdelisle>\u00a0could do that, I didn't notice it was 3.4 until after but the 3.3 build looks to be from 12 days ago  \n15:34\u00a0<@cjdelisle>\u00a0am I correct that we can just extract the .class file from the .jar and use that or is there some other problem with doing that?  \n15:36\u00a0<vmassol>\u00a0cjdelisle: I just want to be sure that we modify only what you modify and not other thingfs  \n15:36\u00a0<vmassol>\u00a0the current oldcore on xwiki.org is from 1st of december  \n15:37\u00a0<vmassol>\u00a0which means 12 days ago  \n15:37\u00a0<vmassol>\u00a0a lot of stuff have been since then  \n15:37\u00a0<vmassol>\u00a0s/been/happened/  \n15:37\u00a0<@cjdelisle>\u00a0I can revert to that day and reapply if you want.  \n15:37\u00a0<vmassol>\u00a0I think that's safer  \n15:38\u00a0<vmassol>\u00a0what are you changing btw?  \n15:38\u00a0<@cjdelisle>\u00a0making the function not do anything except put an error message in the logs and throw an InvalidArgumentException  \n15:39\u00a0<vmassol>\u00a0so this method is never needed?  \n15:39\u00a0<@cjdelisle>\u00a0According to find-grep, there's no place in the codebase which calls it  \n15:39\u00a0<vmassol>\u00a0I thought you said it was called at init time?  \n15:39\u00a0<@cjdelisle>\u00a0It is called in init, I replaced that with a this.database = ...  \n15:40\u00a0<vmassol>\u00a0I see it called in several places  \n15:40\u00a0<@cjdelisle>\u00a0and added a LOGGER.info which says XWiki is initializing so that we'll know if init is called multiple times.  \n15:40\u00a0<vmassol>\u00a0it's called in other places  \n15:45\u00a0<xwikibot>\u00a0has joined #xwiki  \n15:45\u00a0<vmassol>\u00a0hmmm http://www.xwiki.org/xwiki/bin/view/WikiManager/ still has the wrong links so maybe it wasn't restarted  \n15:46\u00a0<vmassol>\u00a0hmm cjdelisle, did you stop the bot?  \n15:46\u00a0<@cjdelisle>\u00a0no  \n15:46\u00a0<@cjdelisle>\u00a0public class ClassResource extends XWikiResource <-- that is almost certainly wrong  \n15:46\u00a0<vmassol>\u00a0the fact that it extends XWikiResources?  \n15:46\u00a0<@cjdelisle>\u00a0no, the content of that class  \n15:47\u00a0<vmassol>\u00a0same for the other 3 resources  \n15:47\u00a0<vmassol>\u00a0ClassPropertiesResource  \n15:47\u00a0<vmassol>\u00a0ClassPropertyResource  \n15:47\u00a0<vmassol>\u00a0ClassResource  \n15:47\u00a0<vmassol>\u00a0ClassesResource  \n15:47\u00a0<@cjdelisle>\u00a0it looks like it's trying to swap db then swap back, but the finally class calls the bad function  \n15:47\u00a0<vmassol>\u00a0yep  \n15:47\u00a0<@cjdelisle>\u00a0err finally \\*clause  \n15:48\u00a0<+sburjan>\u00a0this sounds very serious  \n15:48\u00a0<vmassol>\u00a0IMO this could well be our culprit  \n15:49\u00a0<@cjdelisle>\u00a0hmm looks like it was a copy/pasted error, the types I'm famous for.  \n15:51\u00a0<vmassol>\u00a0so maybe you could provide a modified rest-server jar with this fixed so that we test it on xwiki.org?  \n15:51\u00a0<+sburjan>\u00a0;)  \n15:52\u00a0<@cjdelisle>\u00a0sure  \n15:56\u00a0<CIA-115>\u00a0tmortagne\u000f master\u000f \\* r8bfc117\u000f \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-ui/src/main/resources/XWiki/ExtensionManagerMacros.xml :\u000f XWIKI-7248: Display status information when \"uninstalling\" an extension - http://git.io/Ncg9AQ  \n15:56\u00a0<CIA-115>\u00a0tmortagne\u000f stable-3.3.x\u000f \\* rcaa9618\u000f \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-ui/src/main/resources/XWiki/ExtensionManagerMacros.xml :\u000f XWIKI-7248: Display status information when \"uninstalling\" an extension(cherry picked from commit 8bfc1173ac532018bab9e6154908075b3b3babe5) - http://git.io/nbo41g  \n16:34\u00a0<CIA-115>\u00a0tmortagne\u000f master\u000f \\* r1da7827\u000f \u000f/ (3 files in 3 dirs):\u000f XWIKI-7291: Impossible to fully uninstall an extension with core ...  \n16:34\u00a0<CIA-115>\u00a0tmortagne\u000f stable-3.3.x\u000f \\* r0858853\u000f \u000f/ (3 files in 3 dirs):\u000f XWIKI-7291: Impossible to fully uninstall an extension with core ...  \n16:41\u00a0<vmassol>\u00a0cjdelisle: just seen this tweet and thought about you: http://bit.ly/w2XkII ;)  \n16:44\u00a0<@cjdelisle>\u00a0nice  \n16:44\u00a0<@cjdelisle>\u00a0sounds like it brings some of the advantages of php/python to the java world  \n16:52\u00a0<vmassol>\u00a0cjdelisle: how is it going with the patched rest server jar?  \n16:52\u00a0<@cjdelisle>\u00a0I'm compiling platform now  \n16:52\u00a0<vmassol>\u00a0(just received a mail from someone complaining that xwiki.org is broken wrt the links)  \n16:52\u00a0<CIA-115>\u00a0tmortagne\u000f master\u000f \\* redd7a10\u000f \u000f/ (3 files in 3 dirs):\u000f XWIKI-7291: Impossible to fully uninstall an extension with core ...  \n16:52\u00a0<CIA-115>\u00a0tmortagne\u000f stable-3.3.x\u000f \\* r0460f81\u000f \u000f/ (3 files in 3 dirs):\u000f XWIKI-7291: Impossible to fully uninstall an extension with core ...  \n16:57\u00a0<+tmortagne>\u00a0vmassol: good catch, did not seen it either in Eclipse  \n16:58\u00a0<silviar>\u00a0has quit  \n16:58\u00a0<vmassol>\u00a0that's thanks to IDEA ;)  \n16:58\u00a0<vmassol>\u00a0(find usage)  \n16:59\u00a0<vmassol>\u00a0I have all projects opened  \n17:00\u00a0<@cjdelisle>\u00a0hrm  \n17:00\u00a0<@cjdelisle>\u00a0find usage  \n17:00\u00a0<@cjdelisle>\u00a0that might be a killer app for installing a monster like that  \n17:04\u00a0<Enygma`>\u00a0has quit  \n17:06\u00a0<Keph>\u00a0It seems the 'design ' space on xwiki.org is empty. How can I reach this content: http://www.xwiki.org/xwiki/bin/view/Design/XWiki+Query+Language ?  \n17:07\u00a0<vmassol>\u00a0Keph: the wiki is dev  \n17:07\u00a0<vmassol>\u00a0dev.xwiki.org  \n17:07\u00a0<vmassol>\u00a0how did you get there?  \n17:07\u00a0<vmassol>\u00a0(so that we fix the link)  \n17:07\u00a0<vmassol>\u00a0oh I know  \n17:07\u00a0<vmassol>\u00a0our links are all broken now  \n17:07\u00a0<vmassol>\u00a0:(  \n17:07\u00a0<Keph>\u00a0from platform wiki  \n17:08\u00a0<vmassol>\u00a0restarting xwiki.org to win some time  \n17:09\u00a0<xwikibot>\u00a0has joined #xwiki  \n17:09\u00a0<Keph>\u00a0is now known as <gdelhumeau>  \n17:09\u00a0<vmassol>\u00a0there's no other guillaume here btw, you could call yourself gdelhumeau to follow our naming strategy  \n17:09\u00a0<vmassol>\u00a0yep  \n17:09\u00a0<vmassol>\u00a0:)  \n17:11\u00a0<gdelhumeau>\u00a0has quit  \n17:12\u00a0<gdelhumeau>\u00a0has joined #xwiki  \n17:13\u00a0<silviar>\u00a0has joined #xwiki  \n17:13\u00a0<vmassol>\u00a0cjdelisle: I have to leave in 15 minutes (I'm talking at a conference tonight). Maybe tmortagne can help you deploy the patched jar to xwiki.org. We really need to fix those broken links asap since people are hitting the issue all the time as we speak  \n17:13\u00a0<vmassol>\u00a0tmortagne: btw I believe we're good to release XE 3.3 final,right?  \n17:14\u00a0<@cjdelisle>\u00a0I'm finding the jars as we speek  \n17:14\u00a0<vmassol>\u00a0mflorea: seems there are wysiwyg tests failures  \n17:14\u00a0<vmassol>\u00a0http://ci.xwiki.org/job/xwiki-enterprise-test-wysiwyg/670/#showFailuresLink  \n17:15\u00a0<vmassol>\u00a0could you check what they are about?  \n17:15\u00a0<+mflorea>\u00a0ok (I haven't touched the editor. Did we upgrade the FF version on CI agents?)  \n17:16\u00a0<vmassol>\u00a0ui tests are failing too: http://ci.xwiki.org/view/Functional%20Tests/job/xwiki-enterprise-test-ui-3.3/org.xwiki.enterprise$xwiki-enterprise-test-ui/12/testReport/org.apache.maven.surefire.junit4/JUnit4Provider/org\\_xwiki\\_test\\_ui\\_AllTests/  \n17:16\u00a0<vmassol>\u00a0org.openqa.selenium.firefox.NotConnectedException: Unable to connect to host 127.0.0.2 on port 7055 after 45000 ms. Firefox console output:  \n17:16\u00a0<vmassol>\u00a0Xlib: \u00a0extension \"RANDR\" missing on display \":1.0\".  \n17:16\u00a0<vmassol>\u00a0display issue it seems  \n17:21\u00a0<@cjdelisle>\u00a0oh btw, classes.tar.gz should be the classes which need to be overridden  \n17:22\u00a0<vmassol>\u00a0got to go, I hope tmortagne can install them  \n17:23\u00a0<vmassol>\u00a0jvelociter also has access to the machine\u2026  \n17:24\u00a0<lucaa>\u00a0has joined #xwiki  \n17:24\u00a0<vmassol>\u00a0has quit  \n17:52\u00a0<Enygma`>\u00a0has joined #xwiki  \n17:52\u00a0<Enygma`>\u00a0has quit  \n17:52\u00a0<Enygma`>\u00a0has joined #xwiki  \n18:12\u00a0<+tmortagne>\u00a0cjdelisle: looking  \n18:14\u00a0<+tmortagne>\u00a0cjdelisle: should they be in the right folder ? or it's ok tomcat find the package in the .class itself ?  \n18:15\u00a0<@cjdelisle>\u00a0I don't know that much about overrides  \n18:15\u00a0<+tmortagne>\u00a0will put them in proper follder to be safe  \n18:15\u00a0<+tmortagne>\u00a0unless there is a way to see right away if they are loaded ?  \n18:15\u00a0<+tmortagne>\u00a0like a log or something  \n18:16\u00a0<+tmortagne>\u00a0you talked about a log at init  \n18:16\u00a0<@cjdelisle>\u00a0yes, XWiki#init() causes a log.info message  \n18:17\u00a0<+tmortagne>\u00a0ok so lets try in root and see if we have the log  \n18:17\u00a0<+tmortagne>\u00a0restarting xwiki.org  \n18:19\u00a0<xwikibot>\u00a0has joined #xwiki  \n18:19\u00a0<@cjdelisle>\u00a0I see in the class that it contains it's fully qualified name  \n18:19\u00a0<+tmortagne>\u00a0hmm don't see to produce any log  \n18:20\u00a0<+tmortagne>\u00a0trying with proper folders  \n18:20\u00a0<@cjdelisle>\u00a0the classes go in org/xwiki/rest/resources/classes/  \n18:20\u00a0<+tmortagne>\u00a0unlmess it's too late for me, here is the init log http://pastebin.com/YvhfHZZY  \n18:22\u00a0<@cjdelisle>\u00a0should say Initializing XWiki.  \n18:22\u00a0<@cjdelisle>\u00a0info level  \n18:22\u00a0<+tmortagne>\u00a0restarting with the classes in proper folders  \n18:26\u00a0<xwikibot>\u00a0has joined #xwiki  \n18:28\u00a0<+tmortagne>\u00a0xwiki.org seems to work now  \n18:28\u00a0<+tmortagne>\u00a0didn't change anything  \n18:28\u00a0<@cjdelisle>\u00a0files are still there?  \n18:28\u00a0<+tmortagne>\u00a0yes in prroper folder  \n18:29\u00a0<+tmortagne>\u00a0trying to find the init lof  \n18:29\u00a0<+tmortagne>\u00a0log  \n18:29\u00a0<@cjdelisle>\u00a0I was going to suggest that perhaps newer versions of some dependenct were pulled in...  \n18:29\u00a0<@cjdelisle>\u00a0or we could try to set database to 'xwiki'  \n18:30\u00a0<@cjdelisle>\u00a0it should fail loudly  \n18:30\u00a0<+tmortagne>\u00a0can't find the log  \n18:31\u00a0<+tmortagne>\u00a0didn't put XWiki in the right folder  \n18:32\u00a0<+tmortagne>\u00a0org.xwiki instead of com.xpn.xwiki  \n18:32\u00a0<@cjdelisle>\u00a0ahh  \n18:32\u00a0<@cjdelisle>\u00a0a folder called com.xpn.xwiki or you mean com/xpn/xwiki?  \n18:37\u00a0<xwikibot>\u00a0has joined #xwiki  \n18:37\u00a0<@cjdelisle>\u00a0hmm no it wouldn't be a dependency since the apis of dependencies haven't changed...  \n18:37\u00a0<+tmortagne>\u00a0cjdelisle: is it supposed to be printed before or after cache related warnings ?  \n18:38\u00a0<@cjdelisle>\u00a0it should be when the XWiki() constructor is called which is early.  \n18:39\u00a0<@cjdelisle>\u00a0in case info is not enabled for that class, I'll try this  \n18:39\u00a0<@cjdelisle>\u00a0{{groovy}}xcontext.getContext().getWiki().setDatabase('xwiki');{{/groovy}}  \n18:39\u00a0<@cjdelisle>\u00a0which should throw an exception  \n18:40\u00a0<@cjdelisle>\u00a0Caused by: javax.script.ScriptException: javax.script.ScriptException: java.lang.IllegalArgumentException: calling this function is not allowed.  \n18:40\u00a0<+tmortagne>\u00a0ok lets try it, the classes are here and in the right folder can't see why they wouldn't be loaded  \n18:40\u00a0<+tmortagne>\u00a0how do you log ?  \n18:40\u00a0<+tmortagne>\u00a0in XWiki  \n18:41\u00a0<@cjdelisle>\u00a0It does LOGGER.warn in XWiki  \n18:41\u00a0<+tmortagne>\u00a0so it's a warn, not an info ?  \n18:42\u00a0<@cjdelisle>\u00a02011-12-13 18:40:07,313 [http://www.xwiki.org/xwiki/bin/preview/XWiki/CalebJamesDeLisle] WARN \u00a0c.x.x.XWiki \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0- Someone tried to set the database in c.x.x.XWiki, this is not allowed.  \n18:42\u00a0<+tmortagne>\u00a0was talking abouut the init log  \n18:42\u00a0<@cjdelisle>\u00a0ahh, that is info level  \n18:43\u00a0<@cjdelisle>\u00a0LOGGER.info(\"Initializing XWiki.\");  \n18:43\u00a0<+tmortagne>\u00a0maybe XWiki has a special log conf which start at warn level  \n18:43\u00a0<+tmortagne>\u00a0rechecking the log again  \n18:44\u00a0<@cjdelisle>\u00a0here's the entire diff http://pastebin.com/b0y5hje1  \n18:45\u00a0<+tmortagne>\u00a0can't find \"Initializing XWiki\" anywhere in catalina.out but I see \"Someone tried to set the database...\"  \n18:46\u00a0<+tmortagne>\u00a0looking at logback conf  \n18:46\u00a0<@cjdelisle>\u00a0probably info level is disabled  \n18:46\u00a0<@cjdelisle>\u00a0what we can do is grep the logs for that \"not allowed\" line and if we see it, we'll know there's broken code  \n18:46\u00a0<+tmortagne>\u00a0that's it  \n18:46\u00a0<+tmortagne>\u00a0<logger name=\"com.xpn.xwiki\" level=\"warn\"/>  \n18:47\u00a0<+tmortagne>\u00a0don't see why  \n18:51\u00a0<jvdrean>\u00a0has quit  \n18:52\u00a0<sburjan>\u00a0has quit  \n18:56\u00a0<mflorea>\u00a0has quit  \n19:04\u00a0<gdelhumeau>\u00a0Where can I find the Hibernate mapping files?  \n19:05\u00a0<gdelhumeau>\u00a0since xwiki-core.jar does not exists anymore  \n19:10\u00a0<+Denis>\u00a0gdelhumeau: in xwiki-platform-oldcore  \n19:12\u00a0<gdelhumeau>\u00a0Denis> thx a lot :)  \n19:13\u00a0<gdelhumeau>\u00a0I'm leaving, good night to all of you :)  \n19:13\u00a0<gdelhumeau>\u00a0has quit  \n19:29\u00a0<@cjdelisle>\u00a0stopping the broken links botlet  \n19:47\u00a0<@sdumitriu>\u00a0tmortagne: Good morning, what's the status with the bug you were mentining yesterday?  \n19:47\u00a0<@sdumitriu>\u00a0Didn  \n19:47\u00a0<@sdumitriu>\u00a0't read all the logs yet  \n19:47\u00a0<+tmortagne>\u00a0sdumitriu: fixed  \n19:47\u00a0<+tmortagne>\u00a0even found and fixed new ones while debuging thoses  \n19:47\u00a0<+tmortagne>\u00a0nothing left that I know of  \n19:48\u00a0<@sdumitriu>\u00a0OK  \n19:58\u00a0<tmortagne>\u00a0has quit  \n20:09\u00a0<jvdrean>\u00a0has joined #xwiki  \n20:26\u00a0<silviar>\u00a0has quit  \n20:27\u00a0<lucaa>\u00a0has quit  \n20:48\u00a0<abusenius>\u00a0has joined #xwiki  \n20:54\u00a0<mflorea>\u00a0has joined #xwiki  \n21:11\u00a0<sburjan`>\u00a0has joined #xwiki  \n21:12\u00a0<sburjan`>\u00a0has quit  \n21:12\u00a0<sburjan`>\u00a0has joined #xwiki  \n21:54\u00a0<silviar>\u00a0has joined #xwiki  \n23:03\u00a0<silviar>\u00a0has quit  \n23:03\u00a0<sburjan`>\u00a0has quit  \n23:04\u00a0<mflorea>\u00a0has quit  \n23:54\u00a0<evalica>\u00a0has quit  \n\n"}