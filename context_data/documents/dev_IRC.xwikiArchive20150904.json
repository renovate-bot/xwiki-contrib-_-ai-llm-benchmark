{"id": "dev:IRC.xwikiArchive20150904", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20150904", "title": "IRC Archive for channel #xwiki on 04 September 2015 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<abusenius\\_>\u00a0has quit  \n00:22\u00a0<OSIMasson>\u00a0has joined #xwiki  \n00:35\u00a0<Denis1>\u00a0has quit  \n01:08\u00a0<woshilapin>\u00a0has quit  \n03:49\u00a0<Denis>\u00a0has joined #xwiki  \n04:00\u00a0<Denis>\u00a0has quit  \n04:20\u00a0<cpe\\_>\u00a0has joined #xwiki  \n04:23\u00a0<cpe>\u00a0has quit  \n04:23\u00a0<cpe\\_>\u00a0is now known as <cpe>  \n04:40\u00a0<MasterPiece>\u00a0has quit  \n06:50\u00a0<mflorea>\u00a0has joined #xwiki  \n07:02\u00a0<msmeria>\u00a0has joined #xwiki  \n07:15\u00a0<Ramona1>\u00a0has joined #xwiki  \n08:01\u00a0<MasterPiece>\u00a0has joined #xwiki  \n08:23\u00a0<mflorea>\u00a0has quit  \n08:31\u00a0<Denis>\u00a0has joined #xwiki  \n08:33\u00a0<Trefex>\u00a0has joined #xwiki  \n08:38\u00a0<gsmeria>\u00a0has joined #xwiki  \n08:42\u00a0<Trefex>\u00a0has quit  \n08:45\u00a0<tmortagne>\u00a0has joined #xwiki  \n09:03\u00a0<vmassol>\u00a0has joined #xwiki  \n09:16\u00a0<MasterPiece>\u00a0has quit  \n09:19\u00a0<vmassol>\u00a0good morning  \n09:19\u00a0<vmassol>\u00a0something strange: I see on http://playgroundtemplate.xwiki.org/xwiki/bin/view/XWiki/OfficeImporterAdmin that it's empty and non hidden. When I compare with a local version it's different since locally it displays something and it's hidden. Any idea?  \n09:20\u00a0<mflorea>\u00a0has joined #xwiki  \n09:24\u00a0<vmassol>\u00a0fixing testCreateUIInteraction  \n10:01\u00a0<mflorea>\u00a0tmortagne: I just noticed that $services.security.authorization.hasAccess('view', $attachmentReference) returns false. It would have been nice if we were able to pass any type of reference, leaving to the security module the task to find the entity that holds the rights (e.g. the owner document)  \n10:02\u00a0<tmortagne>\u00a0that's how it's supposed to work AFAIK  \n10:02\u00a0<Denis>\u00a0well, not exactly  \n10:02\u00a0<tmortagne>\u00a0it's supposed to move to parent until it find a right  \n10:02\u00a0<mflorea>\u00a0doesn't seem to work for an attachment reference  \n10:03\u00a0<tmortagne>\u00a0Denis: ?  \n10:04\u00a0<Denis>\u00a0it just depends on what answer it will get when it ask for the rules for that reference  \n10:04\u00a0<Ramona2>\u00a0has joined #xwiki  \n10:04\u00a0<Ramona1>\u00a0has quit  \n10:04\u00a0<tmortagne>\u00a0it won't get anything for this reference  \n10:04\u00a0<tmortagne>\u00a0since you can't associate right to an attachment  \n10:04\u00a0<Denis>\u00a0is the document a parent of it ? if it is, it should be used  \n10:05\u00a0<Ramona2>\u00a0has quit  \n10:05\u00a0<Ramona1>\u00a0has joined #xwiki  \n10:05\u00a0<Denis>\u00a0are you sure your setup is the way you expect it  \n10:06\u00a0<Ramona1>\u00a0has quit  \n10:06\u00a0<Ramona1>\u00a0has joined #xwiki  \n10:07\u00a0<Denis>\u00a0what I am sure, is that the security module have no idea you are using a special reference of anything, so if it fails, either the bridge as provided silly response, or you do not have read access on the document  \n10:07\u00a0<mflorea>\u00a0returns true for the document  \n10:08\u00a0<mflorea>\u00a0but false for the attachment (that exista)  \n10:08\u00a0<mflorea>\u00a0exists  \n10:08\u00a0<tmortagne>\u00a0mflorea: is it a full reference ?  \n10:09\u00a0<tmortagne>\u00a0(i.e. does the reference contains the document already, maybe the security module forget to resolve complete reference)  \n10:09\u00a0<mflorea>\u00a0yes, I have this code https://gist.github.com/mflorea/f3b775b76e5818f62744  \n10:09\u00a0<Denis>\u00a0can you use the script from http://jira.xwiki.org/browse/XWIKI-11355 with your reference ?  \n10:09\u00a0<mflorea>\u00a0replace $docRef with $attRef and you get false  \n10:10\u00a0<tmortagne>\u00a0then I guess you can report it since from what I see in your code it looks a lot like a bug  \n10:10\u00a0<tmortagne>\u00a0maybe a cache bug  \n10:13\u00a0<Denis>\u00a0at least, I reproduce, so yes looks like, I am digging quickly...  \n10:15\u00a0<mflorea>\u00a0Denis, looks like that groovy script expects a doc ref. If I used ?doc=xwiki:Sandbox.WebHome@XWikiLogo I see Entity: Document xwiki:[[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \n10:15\u00a0<mflorea>\u00a0so it resolves the given ref as a doc ref  \n10:15\u00a0<Denis>\u00a0yes, the script need improvements  \n10:16\u00a0<Denis>\u00a0and a publication on extensions  \n10:16\u00a0<mflorea>\u00a0yes :)  \n10:16\u00a0<Denis>\u00a0I know that, just lacking time so far  \n10:17\u00a0<Denis>\u00a0is there a way to resolve anyref from the velocity API ?  \n10:19\u00a0<mflorea>\u00a0looks like $services.model has only specialized resolveXXX  \n10:19\u00a0<mflorea>\u00a0a resolve(String, EntityType) can be helpful sometimes  \n10:20\u00a0<Denis>\u00a0maybe I can rely on auto conversion\u2026 let see\u2026  \n10:20\u00a0<sorinello\\_>\u00a0has joined #xwiki  \n10:21\u00a0<Denis>\u00a0http://hastebin.com/kuzuqowixe no luck :(  \n10:22\u00a0<Denis>\u00a0I had never really understand the behavior of these converters  \n10:23\u00a0<Denis>\u00a0oh, but I am stupid, it is groovy code, so I can do what I want :(  \n10:23\u00a0<sorinello>\u00a0has quit  \n10:23\u00a0<tmortagne>\u00a0yep  \n10:23\u00a0<tmortagne>\u00a0what you did would have working in velocity AFAIK  \n10:23\u00a0<tmortagne>\u00a0\\*worked  \n10:25\u00a0<Slashman>\u00a0has joined #xwiki  \n11:05\u00a0<ClemensR>\u00a0has joined #xwiki  \n11:40\u00a0<evalica>\u00a0has joined #xwiki  \n11:49\u00a0<Trefex>\u00a0has joined #xwiki  \n11:56\u00a0<Enygma`>\u00a0has joined #xwiki  \n12:05\u00a0<sorinello\\_>\u00a0has quit  \n12:06\u00a0<sorinello>\u00a0has joined #xwiki  \n12:07\u00a0<Chuguniy>\u00a0has joined #xwiki  \n12:15\u00a0<Trefex>\u00a0has quit  \n12:18\u00a0<Denis>\u00a0tmortagne: it would work if I have prefixed my ref with a entity type  \n12:26\u00a0<Denis>\u00a0and not fully, since it will produce a relative reference  \n12:32\u00a0<Denis>\u00a0tmortagne: I end up with: http://hastebin.com/ibomiwagik  \n12:32\u00a0<Denis>\u00a0is there something easier ?  \n12:32\u00a0<Denis>\u00a0mflorea: I know why you have an issue !  \n12:37\u00a0<vmassol>\u00a0@all: there'll be some maintenance on ci.xwiki.org this afternoon so it may be down for some time  \n12:39\u00a0<Denis>\u00a0mflorea: I have attached the more generic script to the issue, and it shows that now decision is cached for your request, which is probably an issue. Moreover, a creator rule is added, which is maybe another issue.  \n12:44\u00a0<Denis>\u00a0mflorea: after checking the code, if the creator rules were not added, it would have worked properly  \n12:49\u00a0<tmortagne>\u00a0Denis: no need for a prefix for a document which is the default type, as for the relative reference yes you end up with a relative reference but a method that take EntityReference should support it  \n12:49\u00a0<Denis>\u00a0the authorization manager throw an NPE with a relative ref :(  \n12:50\u00a0<tmortagne>\u00a0then it's a bug IMO and it should be fixed  \n12:50\u00a0<tmortagne>\u00a0at the vary least the script service should resolve to full reference  \n12:50\u00a0<tmortagne>\u00a0s/vary/very/  \n12:50\u00a0<tmortagne>\u00a0if not the whole API  \n12:51\u00a0<tmortagne>\u00a0since ContextualAutorizationManager is contextual it should support it  \n12:51\u00a0<tmortagne>\u00a0I guess we could argue a bit more for the AuthorizationManager which is not supposed to know the current context  \n12:52\u00a0<Denis>\u00a0mmm, i have not check the manager in fact, since my script is debugging, it create security ref, and do some more internals, so maybe it works, need to be checked  \n12:52\u00a0<Denis>\u00a0but I am pretty sure it will not behave properly  \n12:52\u00a0<Denis>\u00a0or at least it will say false  \n12:52\u00a0<tmortagne>\u00a0DefaultContextualAuthorizationManager does not seems to resolve anything at least  \n12:52\u00a0<Denis>\u00a0regarding Marius issue, I am puzzled  \n12:53\u00a0<Denis>\u00a0the security rules reader is made to duplicate the rules of document on all ref under it  \n12:53\u00a0<Denis>\u00a0this is probably wrong  \n12:53\u00a0<tmortagne>\u00a0DefaultAuthorizationManager does not seems to resolve anything either  \n12:54\u00a0<tmortagne>\u00a0creating a jira issue for this and adding resolve to DefaultContextualAuthorizationManager since it's obvious for this one at least  \n12:54\u00a0<Denis>\u00a0because, at the same time, it does not seems unsupported reference access are cacheable by the security cache (I wonder why)  \n12:59\u00a0<Denis>\u00a0despite the fact that duplicating rules is useless, I really wonder why it does not store access for attachment anyway. So we probably have a double issue  \n13:00\u00a0<Denis>\u00a0lunch time for me now  \n13:04\u00a0<xwikibot>\u00a0has joined #xwiki  \n13:11\u00a0<Denis>\u00a0has quit  \n13:28\u00a0<Trefex>\u00a0has joined #xwiki  \n13:31\u00a0<Trefex>\u00a0has quit  \n13:43\u00a0<Ramona2>\u00a0has quit  \n13:43\u00a0<Ramona3>\u00a0has joined #xwiki  \n13:46\u00a0<Denis>\u00a0has joined #xwiki  \n13:52\u00a0<mflorea>\u00a0has quit  \n13:52\u00a0<mflorea>\u00a0has joined #xwiki  \n14:15\u00a0<ClemensR>\u00a0has left #xwiki  \n14:27\u00a0<vmassol>\u00a0hmm this could be a real error I guess: \u00a0http://ci.xwiki.org/job/xwiki-enterprise-test-ui/lastCompletedBuild/org.xwiki.enterprise$xwiki-enterprise-test-ui/testReport/org.xwiki.test.ui/LanguageTest/testHeaderCorrectLanguage/ WDYT?  \n14:27\u00a0<vmassol>\u00a0unless we've removed gwt:property (vp.getMetaDataValue(\"gwt:property\")  \n14:28\u00a0<vmassol>\u00a0)  \n14:32\u00a0<vmassol>\u00a0seems it's still there in htmlheader.vm: <meta name=\"gwt:property\" content=\"locale=$!{xcontext.language}\" />  \n15:08\u00a0<msmeria>\u00a0has quit  \n15:10\u00a0<Ramona3>\u00a0has quit  \n16:16\u00a0<mflorea>\u00a0has quit  \n16:16\u00a0<mflorea1>\u00a0has joined #xwiki  \n16:19\u00a0<OSIMasson>\u00a0has quit  \n16:19\u00a0<Ramona2>\u00a0has joined #xwiki  \n16:38\u00a0<Ramona2>\u00a0has quit  \n16:50\u00a0<mflorea1>\u00a0has quit  \n16:52\u00a0<vmassol>\u00a0found a problem with breadcrumb I think  \n16:55\u00a0<vmassol>\u00a0https://www.evernote.com/l/AHd9\\_emgrYZFuoZAaBvkzW4oHMq9RAsDE9M  \n16:55\u00a0<vmassol>\u00a0WDYT?  \n16:57\u00a0<vmassol>\u00a0actually the page exists but it has an empty title  \n16:57\u00a0<vmassol>\u00a0shouldn't we use the page id if the title is empty?  \n16:57\u00a0<vmassol>\u00a0Enygma`, mf   \n16:57\u00a0<vmassol>\u00a0mf = mflorea  \n16:57\u00a0<vmassol>\u00a0:)  \n16:57\u00a0<tmortagne>\u00a0if we don't that could be a bug (and it would be we don't use getRendereredTitle)  \n16:57\u00a0<tmortagne>\u00a0s/could/would/  \n16:58\u00a0<vmassol>\u00a0indeed  \n16:59\u00a0<Enygma`>\u00a0document.translatedDocument.plainTitle  \n16:59\u00a0<vmassol>\u00a0<li><a href=\"$macro.document.getURL()\">$escapetool.xml($macro.document.translatedDocument.plainTitle)</a></li> ?  \n17:00\u00a0<Enygma`>\u00a0yes  \n17:01\u00a0<vmassol>\u00a0getPlainTitle() calls getPlainTitle  \n17:01\u00a0<vmassol>\u00a0err  \n17:01\u00a0<vmassol>\u00a0getPlainTitle() calls getRenderedTitle  \n17:03\u00a0<vmassol>\u00a0strange  \n17:06\u00a0<tmortagne>\u00a0maybe the title is not really empty  \n17:06\u00a0<Enygma`>\u00a0can`t really reproduce  \n17:06\u00a0<tmortagne>\u00a0like a white space or something  \n17:06\u00a0<vmassol>\u00a0this is a page created with:  \n17:06\u00a0<vmassol>\u00a0getUtil().addObject(homeReference, \"FAQCode.FAQHomeClass\", \"description\", \"new FAQ\");  \n17:06\u00a0<Enygma`>\u00a0can reproduce with white space title  \n17:16\u00a0<gsmeria>\u00a0has left #xwiki  \n17:26\u00a0<Pbas>\u00a0has left #xwiki  \n17:34\u00a0<vmassol>\u00a0ok I know  \n17:34\u00a0<vmassol>\u00a0what happens is that this page has a sheet  \n17:35\u00a0<vmassol>\u00a0and this sheet has a title which is: $doc.title  \n17:35\u00a0<vmassol>\u00a0so when displayTitle() is called rawTitle = $doc.title and thus !StringUtils.isEmpty(rawTitle) is true  \n17:35\u00a0<vmassol>\u00a0thus evaluateTitle() returns \"\"  \n17:37\u00a0<vmassol>\u00a0so I just need to remove $doc.title from the sheet and it should work fine  \n17:58\u00a0<vmassol>\u00a0hmm FAQ search is no longer working\u2026 debugging  \n17:59\u00a0<OSIMasson>\u00a0has joined #xwiki  \n18:00\u00a0<vmassol>\u00a0ah no  \n18:00\u00a0<vmassol>\u00a0i's just the test which is missing the dep on the search ui  \n18:00\u00a0<vmassol>\u00a0fixing  \n18:08\u00a0<sdumitriu1>\u00a0has quit  \n18:11\u00a0<vmassol>\u00a0restarting a build on the new ci  \n18:14\u00a0<OSIMasson>\u00a0has quit  \n18:16\u00a0<sdumitriu1>\u00a0has joined #xwiki  \n18:25\u00a0<tmortagne>\u00a0has quit  \n18:28\u00a0<abusenius\\_>\u00a0has joined #xwiki  \n18:44\u00a0<OSIMasson>\u00a0has joined #xwiki  \n18:51\u00a0<Enygma`>\u00a0has quit  \n19:01\u00a0<evalica>\u00a0has quit  \n19:02\u00a0<Denis>\u00a0has quit  \n19:52\u00a0<Denis>\u00a0has joined #xwiki  \n20:36\u00a0<Denis>\u00a0has quit  \n20:51\u00a0<Slashman>\u00a0has quit  \n21:48\u00a0<Ramona1>\u00a0has joined #xwiki  \n21:56\u00a0<Ramona1>\u00a0has quit  \n22:22\u00a0<vmassol>\u00a0has quit  \n23:30\u00a0<OSIMasson>\u00a0has quit  \n23:38\u00a0<vmassol>\u00a0has joined #xwiki\n"}