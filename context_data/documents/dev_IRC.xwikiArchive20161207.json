{"id": "dev:IRC.xwikiArchive20161207", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20161207", "title": "IRC Archive for channel #xwiki on 07 December 2016 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<OSIMasson1>\u00a0has quit  \n06:15\u00a0<lukevers\\_>\u00a0has joined #xwiki  \n06:15\u00a0<M-jsimard>\u00a0has quit  \n06:16\u00a0<Aranjedeath>\u00a0has quit  \n06:16\u00a0<lukevers>\u00a0has quit  \n06:16\u00a0<lukevers\\_>\u00a0is now known as <lukevers>  \n06:25\u00a0<mflorea>\u00a0has joined #xwiki  \n06:28\u00a0<Aranjedeath>\u00a0has joined #xwiki  \n06:28\u00a0<M-mouhb>\u00a0has joined #xwiki  \n06:28\u00a0<M-jsimard>\u00a0has joined #xwiki  \n07:29\u00a0<vmassol>\u00a0has joined #xwiki  \n07:31\u00a0<vmassol>\u00a0has quit  \n07:31\u00a0<vmassol>\u00a0has joined #xwiki  \n07:56\u00a0<tmortagne>\u00a0has joined #xwiki  \n08:14\u00a0<edvorg>\u00a0has joined #xwiki  \n08:21\u00a0<vmassol>\u00a0has quit  \n08:24\u00a0<msmeria>\u00a0has joined #xwiki  \n08:37\u00a0<mflorea>\u00a0has quit  \n09:00\u00a0<tmortagne>\u00a0has quit  \n09:10\u00a0<Aranjedeath>\u00a0has quit  \n09:20\u00a0<edvorg>\u00a0has quit  \n09:21\u00a0<edvorg>\u00a0has joined #xwiki  \n09:33\u00a0<vmassol>\u00a0has joined #xwiki  \n09:37\u00a0<tmortagne>\u00a0has joined #xwiki  \n09:40\u00a0<mflorea>\u00a0has joined #xwiki  \n09:59\u00a0<edvorg>\u00a0has quit  \n10:00\u00a0<gdelhumeau>\u00a0has joined #xwiki  \n10:04\u00a0<vmassol>\u00a0has quit  \n10:05\u00a0<vmassol>\u00a0has joined #xwiki  \n10:11\u00a0<vmassol>\u00a0has quit  \n10:17\u00a0<chandrasekhar>\u00a0has joined #xwiki  \n10:21\u00a0<kwoot>\u00a0has quit  \n10:23\u00a0<kwoot>\u00a0has joined #xwiki  \n10:26\u00a0<vmassol>\u00a0has joined #xwiki  \n10:40\u00a0<vmassol>\u00a0has quit  \n10:41\u00a0<vmassol>\u00a0has joined #xwiki  \n10:48\u00a0<martinus->\u00a0Hi there, is anyone would have a suggestion to do what I'm explaining here : http://lists.xwiki.org/pipermail/users/2016-December/034187.html . In summary, \u00a0I want to attach a PDF file to an user profile (so it's a file only valid for that user) \\*before\\* the user authenticate for the first time (so the profile doesn't exists at that time). Maybe there is a way to create the profile beforehand ?  \n10:59\u00a0<Enygma`>\u00a0has joined #xwiki  \n11:00\u00a0<evalica>\u00a0has joined #xwiki  \n11:16\u00a0<vmassol>\u00a0has quit  \n11:17\u00a0<vmassol>\u00a0has joined #xwiki  \n11:17\u00a0<ol-ow2>\u00a0has joined #xwiki  \n11:19\u00a0<martinus->\u00a0vmassol, maybe there is a way to create a minimal user profile document (XWiki.<user>) which could be completed by xwiki at login time ? What data such a document should contain ?  \n11:19\u00a0<martinus->\u00a0Hi, by the way ;)  \n11:19\u00a0<vmassol>\u00a0has quit  \n11:19\u00a0<ol-ow2>\u00a0We know in advance the future login of this user  \n11:19\u00a0<martinus->\u00a0tmortagne, do you have a clue about this ?  \n11:22\u00a0<vmassol>\u00a0has joined #xwiki  \n11:22\u00a0<martinus->\u00a0hi vmassol,  \n11:22\u00a0<martinus->\u00a0did you have achance to see my previous comment ?  \n11:22\u00a0<vmassol>\u00a0otp  \n11:23\u00a0<tmortagne>\u00a0if you want the LDAP authenticator to reuse an existing XWiki user profile it has to contain an LDAP object with the right uid in it  \n11:23\u00a0<tmortagne>\u00a0otherwise it will create a new one  \n11:24\u00a0<tmortagne>\u00a0you can look at a user profile created by the authenticator to see how this object looks like  \n11:24\u00a0<tmortagne>\u00a0martinus-:  \n11:26\u00a0<ol-ow2>\u00a0hmm  \n11:28\u00a0<martinus->\u00a0tmortagne, but what about the guid ?  \n11:28\u00a0<ol-ow2>\u00a0We're looking for attach a file to a non-existing user profil  \n11:28\u00a0<tmortagne>\u00a0not sure what you means by \"guid\"  \n11:29\u00a0<martinus->\u00a0tmortagne, https://paste.opensides.be/?913026aff367a60a#wxc4D8E5g2NdYGZ2ykr3QVsBUxGAU2Ktu6fSTATdC28=  \n11:29\u00a0<martinus->\u00a0this is the ldap object we're talking about ?  \n11:29\u00a0<martinus->\u00a0there is a guid inside  \n11:29\u00a0<tmortagne>\u00a0martinus-: I meant looking at the UI :) the <guid> element is generated, you don't need to care about that  \n11:30\u00a0<tmortagne>\u00a0the object just need to have the right class and the uid field set  \n11:30\u00a0<tmortagne>\u00a0so you are talking about generating the XML ?  \n11:30\u00a0<martinus->\u00a0tmortagne, that's because I'm using xwiki api  \n11:30\u00a0<tmortagne>\u00a0not crating the profile inside XWiki ?  \n11:31\u00a0<tmortagne>\u00a0the XWiki API don't ask you the guid  \n11:31\u00a0<martinus->\u00a0tmortagne, I need to automate the process of creating a minimal profile , through the API  \n11:31\u00a0<tmortagne>\u00a0then you just need to create a new xobject with the class name and set \"uid\" field  \n11:32\u00a0<tmortagne>\u00a0the profile name can be anything, LDAP does not care as long as the uid matches  \n11:32\u00a0<vmassol>\u00a0has quit  \n11:32\u00a0<tmortagne>\u00a0of course for it to be seen as a user you also need to add XWiki.XWikiUsers xobject too  \n11:33\u00a0<tmortagne>\u00a0you have various #createUser methods in com.xpn.xwiki.XWiki but this class it more Java side, not very Velocity fiendly (you need programming right)  \n11:34\u00a0<tmortagne>\u00a0but even if you don't use it directly you can look at what the method does to know what a minimum XWiki user is and add the LDAP object on top of that  \n11:35\u00a0<tmortagne>\u00a0another possibility is to really import the LDAP user instead of creating a skeleton  \n11:36\u00a0<tmortagne>\u00a0the LDAP module provide some Java APIs, not very Velocity oriented  \n11:38\u00a0<tmortagne>\u00a0you have to setup a XWikiLDAPUtils object (you can look at how XWikiLDAPAuthServiceImpl does it) and then use the method #syncUser  \n11:38\u00a0<tmortagne>\u00a0(if you pass null for the attributes it will seach them)  \n11:39\u00a0<vmassol>\u00a0has joined #xwiki  \n11:42\u00a0<vmassol>\u00a0has quit  \n11:43\u00a0<admin\\_n00b>\u00a0has joined #xwiki  \n11:44\u00a0<martinus->\u00a0okay, there are several ones. I'll check  \n11:47\u00a0<tmortagne>\u00a0martinus-: since you have to know the uid anyway the best would probably be to actually import the LDAP user, unless you don't have access to the LDAP server when you do that  \n11:49\u00a0<tmortagne>\u00a0since the LDAP authenticator is a contrib extension now you can even propose a pull request to add an importUser(String uid) method in the LDAPScriptService \u00a0and it will be released quickly ;)  \n11:50\u00a0<tmortagne>\u00a0unless you are not in a script  \n11:52\u00a0<martinus->\u00a0tmortagne, and thise importUser() would be available from where ? groovy ? velocity ?  \n11:52\u00a0<tmortagne>\u00a0it would be available from $services.ldap.importUser(\"uid\") for velocity and services.ldap.importUser(\"uid\") for groovy  \n11:53\u00a0<vmassol>\u00a0has joined #xwiki  \n11:53\u00a0<tmortagne>\u00a0I'm sure other people would be happy to have this feature  \n11:55\u00a0<martinus->\u00a0tmortagne, well we could do that but we would need to dive more into the java auth code ;) in addition we're running xwiki 6.4.4 atm... But it's indeed a good idea  \n11:55\u00a0<tmortagne>\u00a0right, can't use the new contrib LDAP extension in 6.4.4  \n11:58\u00a0<admin\\_n00b>\u00a0Hi all!  \n11:58\u00a0<admin\\_n00b>\u00a0I am having an issue with an extention (ImportDokuWiki) where it is failing completely. When I upload the data folder, it doesn't find any pages at all.  \n11:58\u00a0<admin\\_n00b>\u00a0I know this is an extension, soyou might not be able to help. But getting this to work will save me hours of work manually transfering hte Wiki pages.  \n12:04\u00a0<vmassol>\u00a0has quit  \n12:05\u00a0<vmassol>\u00a0has joined #xwiki  \n12:25\u00a0<martinus->\u00a0tmortagne, when you say \"then you just need to create a new xobject with the class name and set \"uid\" field\" \u00a0: you mean the uid \\*inside\\* the <class> node \u00a0of LDAPProfileClass ?  \n12:26\u00a0<martinus->\u00a0ah, you meant the UI, at that time sorry :(  \n12:44\u00a0<martinus->\u00a0tmortagne, when using /wikis/{wikiName}/spaces/{spaceName}[/spaces/{nestedSpaceName}]\\*/pages/{pageName}/objects with the restful api; what should be the structure of the xml file ?  \n12:44\u00a0<martinus->\u00a0I'm looking for an example  \n12:45\u00a0<martinus->\u00a0(because I understand I have to put the ldap class object with the uid to the page)  \n12:49\u00a0<vmassol>\u00a0has quit  \n13:01\u00a0<martinus->\u00a0tmortagne, and if I create the Xwiki.<user> page with ldap object inside, \u00a0it should be owner by <user> so it can be modified by xwiki at login time  \n13:11\u00a0<tmortagne>\u00a0martinus-: the right does not matter for the authenticator  \n13:11\u00a0<tmortagne>\u00a0but it does matter if the user need to be able to modify his profile (watchlist, etc.)  \n13:16\u00a0<chandrasekhar>\u00a0has quit  \n13:27\u00a0<chandrasekhar>\u00a0has joined #xwiki  \n13:32\u00a0<acotiuga>\u00a0has joined #xwiki  \n13:50\u00a0<vmassol>\u00a0has joined #xwiki  \n13:54\u00a0<vmassol>\u00a0has quit  \n14:08\u00a0<vmassol>\u00a0has joined #xwiki  \n14:13\u00a0<vmassol>\u00a0has quit  \n14:48\u00a0<vmassol>\u00a0has joined #xwiki  \n14:48\u00a0<vmassol>\u00a0has quit  \n15:04\u00a0<martinus->\u00a0tmortagne, \u00a0I'm not sure to understand \u00a0\"if you want the LDAP authenticator to reuse an existing XWiki user profile it has to contain an LDAP object with the right uid in it\" . If an user already exists and this user try to login with his LDAP credentials the LDAP class will be added and that's all.So the only thing I have to figure out is how to create a (disabled) xwiki user from the restful api  \n15:05\u00a0<tmortagne>\u00a0martinus-: it's not that simple  \n15:05\u00a0<tmortagne>\u00a0what you enter in the login form is the LDAP uid  \n15:05\u00a0<tmortagne>\u00a0so you have no ide what is the XWiki user  \n15:07\u00a0<tmortagne>\u00a0the process followed by the LDAP authenticator is more or less the following:  \n15:07\u00a0<tmortagne>\u00a0\\* if none exist create a new one  \n15:08\u00a0<tmortagne>\u00a0the name of the profile page and the login you enter are two different thing that just happen to be equal in some use cases  \n15:09\u00a0<kwoot>\u00a0has left #xwiki  \n15:22\u00a0<martinus->\u00a0tmortagne, mhh. I feel pretty lost. I'll take a new look at it tomorrow. What I observe In my usecase is simple: when I create an xwiki user (through admin panel) then login with that user with its ldap credentials, it extends the existing profile with the ldap class and that's all. I understand that a login name can have a xwiki profile of any name btw. It seems I'm missing something. Like what is the user unique  \n15:22\u00a0<martinus->\u00a0identifier in user's profile doc (XWiki.user)  \n15:24\u00a0<tmortagne>\u00a0martinus-: does not make much sense to me, the LDAP authenticator is not supposed to reuse existing XWiki user, that would be a big bug  \n15:24\u00a0<tmortagne>\u00a0I'm also pretty sure I have tests for this use case, I will try to reproduce  \n15:26\u00a0<martinus->\u00a0tmortagne, if you create an user within xwiki , like XWiki.testuser (so it happens that XWiki.testuser match the user with xwiki username \"testuser\") \u00a0, then do a LDAP login attempt with \"testuser\" login and ldap password , you'll find the XWiki.testuser document objects now contains the ldap class.  \n15:27\u00a0<martinus->\u00a0and you can still login with both passwords (if xwiki.cfg has try\\_local)  \n15:27\u00a0<tmortagne>\u00a0martinus-: what you describe is an important bug  \n15:28\u00a0<martinus->\u00a0tmortagne, maybe I'm wrong for any reason  \n15:28\u00a0<tmortagne>\u00a0martinus-: trying to reproduce it anyway, we'll see  \n15:28\u00a0<tmortagne>\u00a0anyway you if you add a group with the LDAP uid it it you are sure it will be ok  \n15:32\u00a0<martinus->\u00a0\"anyway you if you add a group with the LDAP uid it it you are sure it will be ok\" I'm not sure what you mean. ok of what ?  \n15:33\u00a0<tmortagne>\u00a0martinus-: are you really sure both have the exact same profile page/URL ?  \n15:38\u00a0<tmortagne>\u00a0martinus-: I don't reproduce what you describe, LDAP create a new <login>\\_1 user profile  \n15:38\u00a0<tmortagne>\u00a0as expected  \n15:39\u00a0<tmortagne>\u00a0so yes you can login with both credentials but it's too different users  \n15:39\u00a0<tmortagne>\u00a0maybe you did not look at the URL and only display name  \n15:41\u00a0<tmortagne>\u00a0now I tested in recent LDAP version, not 6.4.x but I would be surprised this code changed much  \n15:42\u00a0<martinus->\u00a0tmortagne, \u00a0I have double checked on my side, bin/edit/XWiki/testuser?editor=object => \u00a0Initially the user XWiki.testuser have 3 classes \u00a0XWiki.WatchListClass XWiki.XWikiRights \u00a0XWiki.XWikiRights , the after ldap login it now contains a 4th class \u00a0XWiki.LDAPProfileClass. \u00a0(I just reloaded the page at bin/edit/XWiki/testuser?editor=object )  \n15:42\u00a0<martinus->\u00a0( there's a typo in classes above...)  \n15:43\u00a0<martinus->\u00a0so I have a problem here.  \n15:43\u00a0<tmortagne>\u00a0looks like you have a bug yes  \n15:43\u00a0<tmortagne>\u00a0I don't remember fixing a bug like this so it's weird  \n15:44\u00a0<tmortagne>\u00a0in any case if you create a user profile and add the LDAP object in it, the authenticator will find it  \n15:44\u00a0<tmortagne>\u00a0that way you are sure your code will work even when you don't have this bug  \n15:45\u00a0<tmortagne>\u00a0otherwise you might have a big surprise when you upgrade  \n15:46\u00a0<martinus->\u00a0tmortagne, I have an idea from where it could come from. But still I don't understand. Why is it expected to have a testuser\\_1 instead of extending the existing testuser doc ?  \n15:46\u00a0<tmortagne>\u00a0because you the authenticator have no idea what is this existing user, merging it with something that might be totally different could be a breackage  \n15:47\u00a0<tmortagne>\u00a0also LDAP allows things like white spaces why not supported in user profiles and removed when searching for a proper page name  \n15:48\u00a0<tmortagne>\u00a0which means that different LDAP uid could end up with the same XWiki user profile name if we don't make sure it's really the same LDAP uid  \n15:48\u00a0<vmassol>\u00a0has joined #xwiki  \n15:49\u00a0<tmortagne>\u00a0but even with LDAP -> XWiki conversion issue it's not this authenticator decision to merge two users that could be totally different and just happen to have the same default profile page name  \n15:52\u00a0<vmassol>\u00a0has quit  \n15:52\u00a0<edvorg>\u00a0has joined #xwiki  \n15:52\u00a0<edvorg>\u00a0has quit  \n15:54\u00a0<vmassol>\u00a0has joined #xwiki  \n15:55\u00a0<vmassol>\u00a0has quit  \n15:55\u00a0<edvorg>\u00a0has joined #xwiki  \n15:56\u00a0<edvorg>\u00a0has quit  \n16:04\u00a0<chandrasekhar>\u00a0has left #xwiki  \n16:06\u00a0<vmassol>\u00a0has joined #xwiki  \n16:07\u00a0<vmassol>\u00a0has quit  \n16:10\u00a0<vmassol>\u00a0has joined #xwiki  \n16:33\u00a0<Slashman>\u00a0has joined #xwiki  \n16:38\u00a0<msmeria>\u00a0has quit  \n16:41\u00a0<acotiuga>\u00a0has quit  \n17:04\u00a0<OSIMasson1>\u00a0has joined #xwiki  \n17:11\u00a0<vmassol>\u00a0has quit  \n17:13\u00a0<vmassol>\u00a0has joined #xwiki  \n17:16\u00a0<sorinello>\u00a0has quit  \n17:16\u00a0<sorinello>\u00a0has joined #xwiki  \n17:48\u00a0<mflorea>\u00a0has quit  \n18:07\u00a0<admin\\_n00b>\u00a0has quit  \n18:13\u00a0<edvorg>\u00a0has joined #xwiki  \n18:17\u00a0<gdelhumeau>\u00a0has quit  \n18:36\u00a0<vmassol>\u00a0has quit  \n18:37\u00a0<vmassol>\u00a0has joined #xwiki  \n18:37\u00a0<vmassol>\u00a0has quit  \n18:58\u00a0<tmortagne>\u00a0has quit  \n19:09\u00a0<evalica>\u00a0has quit  \n19:12\u00a0<lukevers>\u00a0has quit  \n19:13\u00a0<lukevers>\u00a0has joined #xwiki  \n19:13\u00a0<Enygma`>\u00a0has quit  \n20:13\u00a0<Slashman>\u00a0has quit  \n20:13\u00a0<edvorg>\u00a0has quit  \n22:02\u00a0<vmassol>\u00a0has joined #xwiki  \n22:14\u00a0<vmassol>\u00a0has quit  \n22:15\u00a0<vmassol>\u00a0has joined #xwiki  \n23:04\u00a0<martinus->\u00a0has quit  \n23:05\u00a0<martinus\\_\\_>\u00a0has joined #xwiki  \n23:18\u00a0<vmassol>\u00a0has quit  \n23:19\u00a0<vmassol>\u00a0has joined #xwiki  \n23:31\u00a0<vmassol>\u00a0has quit  \n23:33\u00a0<ol-ow2>\u00a0has quit  \n23:34\u00a0<vmassol>\u00a0has joined #xwiki  \n23:48\u00a0<vmassol>\u00a0has quit\n"}