{"id": "dev:IRC.xwikiArchive20090113", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20090113", "title": "IRC Archive for channel #xwiki on 13 January 2009 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\nasiri - (13/01/2009 09:27): hi, when i call $doc.getAttachmentURL() it returns something like /xwiki/bin/download/Main/WebHome/Test.doc .. is there a way to retrieve the missing http://\\*\\*\\*/ part of the url ?  \nvmassol - (13/01/2009 09:30): hi asiri   \nvmassol - (13/01/2009 09:30): I think you can by using the URL Factory  \nasiri - (13/01/2009 09:31): vincent: thanks, looking into it now :)  \nasyd - (13/01/2009 09:32): hello there  \nvmassol - (13/01/2009 09:33): asiri: context.getURLFactory()  \nvmassol - (13/01/2009 09:33): asyd: hi  \nasiri - (13/01/2009 09:35): vincent: i tried this $context.getURLFactory().getServerURL($context) but didn't work..  \nasiri - (13/01/2009 09:35): http://maven.xwiki.org/site/xwiki-core-parent/xwiki-core/apidocs/com/xpn/xwiki/web/XWikiURLFactory.html  \nvmassol - (13/01/2009 09:36): that's normal  \nvmassol - (13/01/2009 09:37): check the api  \nvmassol - (13/01/2009 09:37): also I wouldn't use this api for your need  \nvmassol - (13/01/2009 09:37): why not use createexternalurl?  \nvmassol - (13/01/2009 09:37): have to go back to my work good luck  \nasiri - (13/01/2009 09:38): vmassol: ok  \nxwikibot - (13/01/2009 11:36): Main.ReleaseNotesXWikiEnterprise18M1 was modified by XWiki.ThomasMortagne - http://www.xwiki.org/xwiki/bin/view/Main/ReleaseNotesXWikiEnterprise18M1  \nxwikibot - (13/01/2009 11:37): Main.ReleaseNotes was modified by XWiki.ThomasMortagne - http://www.xwiki.org/xwiki/bin/view/Main/ReleaseNotes  \nasyd - (13/01/2009 14:02): is there a way to create the xar file from command line, or from a script?  \nlucaa - (13/01/2009 14:07): hi asyd  \nasyd - (13/01/2009 14:08): hello lu   \nlucaa - (13/01/2009 14:08): a .xar is just a zip archive with exported xwiki documents (the .xml files) and a package.xml descriptor file. So, provided that you have the correct exported documents and that you can create a correct package.xml file -- which is really intuitive -- you just .zip it and change extension to .xar  \nlucaa - (13/01/2009 14:08): does this solve your problem?  \nasyd - (13/01/2009 14:09): ah oh  \nasyd - (13/01/2009 14:10): ah hmm, well, that's seem very easy, however I remember the package.xml file is not really simple  \nasyd - (13/01/2009 14:10): let me take a look  \nlucaa - (13/01/2009 14:10): (to see more, just take an existing .xar, unzip it and look inside at the structure / files)  \nasyd - (13/01/2009 14:11): ah hmm my memory is sick, the package xml seem very easy  \nlucaa - (13/01/2009 14:12): it's quite intuitive, happy coding  \nasyd - (13/01/2009 14:13): thanks  \nvmassol - (13/01/2009 14:24): asyd: we have a maven plugin to create the XAR if you're interested  \nludobot - (13/01/2009 14:24): vmassol: asyd: we have a maven plugin to create the XAR if you're interested  \nasyd - (13/01/2009 14:24): ok  \nasyd - (13/01/2009 16:37): hmm, the .doc/.odt import feature is on 1.7 or it's for the next version?  \njvdrean - (13/01/2009 16:46): asyd: 1.8  \njvdrean - (13/01/2009 16:46): the first milestone will be out very soon  \nasyd - (13/01/2009 16:47): ok  \nnpm - (13/01/2009 18:47): FYI, 1.8 rev 15391 is looking quite ready for M1 release ... good work!   \nnpm - (13/01/2009 18:49): i haven't managed to get it to successfully import a .odt or .doc ... it always says \"document not found\" after importing  \nvmassol - (13/01/2009 18:51): npm: we've just found some last minute issues for 1.8M1 so we're postponing the releases to tomorrow  \nnpm - (13/01/2009 18:51): my current main issue is i'm not able to get virtual hosting working  \nvmassol - (13/01/2009 18:51): re the import that's strange, didn't get that  \nvmassol - (13/01/2009 18:51): you did start the openoffice server right?  \nvmassol - (13/01/2009 18:51): :)  \nnpm - (13/01/2009 18:51): oh no, i didn't  \nvmassol - (13/01/2009 18:52): this the command line to start it:  \nvmassol - (13/01/2009 18:52): soffice -headless -accept=\"socket,host=127.0.0.1,port=8100;urp;\" -nofirststartwizard  \nvmassol - (13/01/2009 18:52): (npm)  \nnpm - (13/01/2009 18:53): i just went to the import page directly xwiki/bin/view/Import/ ... thanks for the suggestion.  \nnpm - (13/01/2009 18:54): guess i'll have to reinstall office on my server (i was saying \"why would i ever run open office on a server\" as i yum deleted many 100's of MB of stuff)  \nnpm - (13/01/2009 18:54): i will try it again once i get vhosting working  \nnpm - (13/01/2009 18:55): are there any known issues w/ 1.8 rc1's vhosting?  \nvmassol - (13/01/2009 18:56): you mean multi wiki?  \nnpm - (13/01/2009 18:56): yes  \nvmassol - (13/01/2009 18:56): (XEM)  \nvmassol - (13/01/2009 18:56): not that I know of  \nvmassol - (13/01/2009 18:57): quite the opposite since we now support 2 schemes  \nvmassol - (13/01/2009 18:57): domain-based  \nvmassol - (13/01/2009 18:57): and URL-based  \nnpm - (13/01/2009 18:57): i was actually using XE and following http://platform.xwiki.org/xwiki/bin/view/AdminGuide/Virtualization#HByhand  \nvmassol - (13/01/2009 18:58): that's very old  \nvmassol - (13/01/2009 18:58): some contributor wrote it  \nnpm - (13/01/2009 18:58): oh... so what's the right way?  \nvmassol - (13/01/2009 18:58): npm: the site is http://manager.xwiki.org/xwiki/bin/view/Main/WebHome  \nthomasmortagne - (13/01/2009 18:58): http://platform.xwiki.org/xwiki/bin/view/AdminGuide/Virtualization#HByhand is old but it is still valid I think  \nvmassol - (13/01/2009 18:59): check http://manager.xwiki.org/xwiki/bin/view/AdminGuide/  \nthomasmortagne - (13/01/2009 18:59): but yes it better to go to xem doc  \nvmassol - (13/01/2009 18:59): thomasmortagne: we should move that doc to manager.xwiki.org  \nvmassol - (13/01/2009 18:59): (and update it)  \nthomasmortagne - (13/01/2009 18:59): i'm not sure  \nvmassol - (13/01/2009 18:59): and refer people to there  \nthomasmortagne - (13/01/2009 18:59): multiwiki is platform feature not xem...  \nthomasmortagne - (13/01/2009 19:00): xem just add some ui  \nvmassol - (13/01/2009 19:00): ok then it's needs to be cleaned up and we separate the 2   \nnpm - (13/01/2009 19:00): yes, that's why i was just trying to get it working \"by hand\" and not use XEM  \nnpm - (13/01/2009 19:00): also because i wanted to be running 1.8 and wasn't sure of status of XEM->1.8  \nvmassol - (13/01/2009 19:00): you can transform an XE into a XEM install  \nvmassol - (13/01/2009 19:01): see installation on http://manager.xwiki.org/xwiki/bin/view/AdminGuide/  \nnpm - (13/01/2009 19:01): yeah, i was going to do that if i cant get it working by hand...  \nvmassol - (13/01/2009 19:01): k  \nthomasmortagne - (13/01/2009 19:01): npm what problem do you have when you do it by hand ?  \nnpm - (13/01/2009 19:02): com.xpn.xwiki.XWikiException: Error number 3001 in 3: Cannot load class com.xpn.xwiki.store.migration.hibernate.XWikiHibernateMigrationManager from param xwiki.store.migration.manager.class  \nnpm - (13/01/2009 19:02): Wrapped Exception: Error number 3301 in 3: Exception while switching to database xwiki  \nnpm - (13/01/2009 19:02): Wrapped Exception: Access denied for user 'xwiki'@'127.0.0.1' to database 'Main\\_xe'  \nnpm - (13/01/2009 19:02): but my db is \"main\\_xe\" not \"Main\\_xe\"  \nthomasmortagne - (13/01/2009 19:02): are you using mysql ?  \nnpm - (13/01/2009 19:02): do i have to capitalize the db names?  \nnpm - (13/01/2009 19:02): yes, on fedora 10  \nthomasmortagne - (13/01/2009 19:03): I thought database was ignoring case in mysql  \nnpm - (13/01/2009 19:03): i don't think it does  \nnpm - (13/01/2009 19:04): ROOT-golem-71-/usr/java> mysql -u root -D Mysql  \nnpm - (13/01/2009 19:04): ERROR 1049 (42000): Unknown database 'Mysql'  \nthomasmortagne - (13/01/2009 19:04): hmm so it's a problem since the frist letter of database name is always lower cased in xwiki  \nnpm - (13/01/2009 19:04): but lowercase works: ROOT-golem-72-/usr/java> mysql -u root -D mysql  \nnpm - (13/01/2009 19:04): Reading table information for completion of table and column names  \nnpm - (13/01/2009 19:04): You can turn off this feature to get a quicker startup with -A  \nthomasmortagne - (13/01/2009 19:05): ok  \nnpm - (13/01/2009 19:05): but only when virtual mode is turned on  \nnpm - (13/01/2009 19:05): with xwiki.virtual=0 and xwiki.db=main\\_xe it works fine  \nthomasmortagne - (13/01/2009 19:06): yes it's because in non virtual mode xwiki is using directly hibernate conf  \nnpm - (13/01/2009 19:06): but with xwiki.virtual=1 it dies looking for Main\\_xe  \nthomasmortagne - (13/01/2009 19:06): and never switch database  \nnpm - (13/01/2009 19:06): so for a workaround, should i just create an upper-cased db?  \nthomasmortagne - (13/01/2009 19:06): lower cased you mean ?  \nnpm - (13/01/2009 19:07): currently the actual name is \"main\\_xe\" but xwiki in virt mode is looking for Main\\_xe  \nnpm - (13/01/2009 19:07): so if I mysqdump main\\_xe and reconstitute as Main\\_xe it should work  \nthomasmortagne - (13/01/2009 19:07): ho ok I understood the other way arround, it should not IMO  \nthomasmortagne - (13/01/2009 19:08): as far as I know the database name should be always lower cases in xwiki  \nthomasmortagne - (13/01/2009 19:08): let me look at something  \nnpm - (13/01/2009 19:08): actually i think there's a bug here  \nnpm - (13/01/2009 19:08): Wrapped Exception: Error number 3301 in 3: Exception while switching to database xwiki  \nnpm - (13/01/2009 19:08): but nowhere did i tell it to use that database  \nnpm - (13/01/2009 19:09): and something created an empty db 'xwiki'   \nthomasmortagne - (13/01/2009 19:09): you created a XWiki/XWikiServerMain\\_xe page, right ?  \nnpm - (13/01/2009 19:09): even though i deleted it  \nnpm - (13/01/2009 19:09): yes i created following:  \nthomasmortagne - (13/01/2009 19:09): by defaut virtual mode use xwiki as main database even if you have something else in hibernate conf  \nnpm - (13/01/2009 19:10): XWiki/XWikiServerClass \u00a0XWiki/XWikiServerHost\\_xe\\_JonathanMayer\\_dot\\_info XWiki/XWikiServerHost\\_xe\\_NielsMayer\\_dot\\_com etc  \nnpm - (13/01/2009 19:10): and ... Main\\_xe too  \nthomasmortagne - (13/01/2009 19:12): what append if you rename XWiki/XWikiServerMain\\_xe in XWiki/XWikiServermain\\_xe ?  \nnpm - (13/01/2009 19:14): hmm... that does sound easier than renaming the database in mysql  \nnpm - (13/01/2009 19:14): :-)  \nnpm - (13/01/2009 19:14): i'll try it  \nnpm - (13/01/2009 19:15): but won't i also need to create all the other vhost db's as lowecase too?  \nthomasmortagne - (13/01/2009 19:16): but it's weird anyway the first letter should be lower cased I don't see why it changed  \nnpm - (13/01/2009 19:16): i think there's an underlying assuption that mysql was case insensitive (perhaps it is on windows??)  \nthomasmortagne - (13/01/2009 19:17): no i'm pretty sure I seen databases names lower cased and I always use a upper case for the first letter of the page  \nthomasmortagne - (13/01/2009 19:18): and i'm working on ubuntu  \nthomasmortagne - (13/01/2009 19:18): so if mysql does not ignore case I would have seen it fail a long time ago  \nnpm - (13/01/2009 19:18): hmm... well i'll try lowecasing and resetup for virtual mode and let you know in about 10 mins  \nthomasmortagne - (13/01/2009 19:18): ok thanks  \nthomasmortagne - (13/01/2009 19:19): i'm tracing myself to see if something really changed  \nnpm - (13/01/2009 19:19): small bug: if you click \"add object from this class\" even w/ class set to \"select a class\" it creates XWiki.---[0]:   \nnpm - (13/01/2009 19:20): whereas it should probably fail and give error message  \nnpm - (13/01/2009 19:20): (in \"add an object\" panel of object editor)  \nthomasmortagne - (13/01/2009 19:22): yes not very good  \nthomasmortagne - (13/01/2009 19:22): could you add an issue for that in http://jira.xwiki.org ?  \nnpm - (13/01/2009 19:22): (but probably a 1 line fix :-) )  \nnpm - (13/01/2009 19:23): yes, let me check the vhost first  \nthomasmortagne - (13/01/2009 19:25): i'm have XWiki/XWikiServerEmpty and when I look at the log I see that the database name \"empty\" is used and not \"Empty\"  \nnpm - (13/01/2009 19:28): oh, am i supposed to set xwiki.db.prefix ?  \nthomasmortagne - (13/01/2009 19:28): i see wikiserver = docname.substring(\"XWiki.XWikiServer\".length()).toLowerCase();  \nthomasmortagne - (13/01/2009 19:29): no i'm not using it  \nnpm - (13/01/2009 19:29): if i have the full db name in the XWikiServerXXX instance do i need to set it at all?  \nthomasmortagne - (13/01/2009 19:29): so it should not be possible to have an upper case as first letter  \nnpm - (13/01/2009 19:29): ah so the entire db name must be lowercased?  \nnpm - (13/01/2009 19:29): perhaps that's the problem i'm having  \nthomasmortagne - (13/01/2009 19:29): well it's even not possible to have anything than lower case in fact  \nthomasmortagne - (13/01/2009 19:30): no  \nthomasmortagne - (13/01/2009 19:30): the database name is forced lower case in the code  \nnpm - (13/01/2009 19:31): and unfortunately, i have some other uppercases in my db names, which is the problem  \nthomasmortagne - (13/01/2009 19:31): so I don't understand how you can have database name with upper case in it  \nnpm - (13/01/2009 19:31): so i'll fix that  \nthomasmortagne - (13/01/2009 19:31): i don't understand, you database are lower cased or not ?  \nnpm - (13/01/2009 19:31): you can create db names w/ case like this: mysql -u root -e \"create database host\\_xe\\_NielsMayer\\_dot\\_com\"  \nnpm - (13/01/2009 19:32): what i should do instead is \"create database host\\_xe\\_nielsmayer\\_dot\\_com\"  \nthomasmortagne - (13/01/2009 19:32): yes  \nnpm - (13/01/2009 19:32): and i think that's the problem w/ all my vhost names  \nnpm - (13/01/2009 19:32): thanks for the help!!  \nthomasmortagne - (13/01/2009 19:33): I you think XWiki should support database name (which as think it would be good too) you should add a jira about that  \nthomasmortagne - (13/01/2009 19:33): np :)  \nnpm - (13/01/2009 19:33): right now i have ' \u00a0drwx------ \u00a02 mysql mysql \u00a0\u00a0\u00a0\u00a04096 2009-01-13 01:15 host\\_xe\\_NielsMayer\\_dot\\_com/'  \nthomasmortagne - (13/01/2009 19:33): database name=database name with upper case  \nnpm - (13/01/2009 19:33): jira on that and the very unhelpful error message emitted:  \nxwikibot - (13/01/2009 19:33): Results for jira search [on that and the very unhelpful error message emitted:] (5 results only)  \nxwikibot - (13/01/2009 19:33): Error: Cannot invoke method getJira() on null object  \nnpm - (13/01/2009 19:34): com.xpn.xwiki.XWikiException: Error number 3001 in 3: Cannot load class com.xpn.xwiki.store.migration.hibernate.XWikiHibernateMigrationManager from param xwiki.store.migration.manager.class  \nnpm - (13/01/2009 19:34): Wrapped Exception: Error number 3301 in 3: Exception while switching to database xwiki  \nnpm - (13/01/2009 19:34): Wrapped Exception: Access denied for user 'xwiki'@'127.0.0.1' to database 'Main\\_xe'  \nnpm - (13/01/2009 19:35): and i still think there's a bug in that it's trying to switch to db 'xwiki' and creates that db  \nthomasmortagne - (13/01/2009 19:36): if you don't change the main db using xwiki.cfg the main wiki database is always \"xwiki\"  \nthomasmortagne - (13/01/2009 19:37): the wiki where you have the wikis descriptors  \nnpm - (13/01/2009 19:38): the issue is that i did change the main db name, and it's still falling back to xwiki.... xwiki.db=main\\_xe  \nthomasmortagne - (13/01/2009 19:39): ok  \nthomasmortagne - (13/01/2009 19:39): so yes you should not have any access to xwiki database  \nthomasmortagne - (13/01/2009 19:42): seems to work for me  \nthomasmortagne - (13/01/2009 19:42): can you copy paste the full error ?  \nthomasmortagne - (13/01/2009 19:43): to see which code is trying to access xwiki database, maybe there is some leftover somewhere  \nnpm - (13/01/2009 19:43): sure, i'll put my logfile on a webserver ... one moment  \nnpm - (13/01/2009 19:44): http://nielsmayer.com/main\\_xe.log  \nnpm - (13/01/2009 19:45): never mind the lucene plugin that i haven't installed yet (why not out of box?)  \nthomasmortagne - (13/01/2009 19:45): lucene plugin is distributed in the default XE distribution  \nthomasmortagne - (13/01/2009 19:45): so you should have it i think  \nnpm - (13/01/2009 19:46): well i'll solve that issue next after vhosting, etc.  \nthomasmortagne - (13/01/2009 19:46): ok i know  \nnpm - (13/01/2009 19:46): my list is ever increasing  \nnpm - (13/01/2009 19:46): :-)  \nthomasmortagne - (13/01/2009 19:46): it simply that the message is wrong  \nthomasmortagne - (13/01/2009 19:46): Exception while switching to database xwiki  \nnpm - (13/01/2009 19:47): i guess the \"xwiki\" was part of the error message text itself?  \nthomasmortagne - (13/01/2009 19:47): the replacement of \"xwiki\" by \"main\\_xe\" is done at the last minute just before executing the query  \nthomasmortagne - (13/01/2009 19:48): and where the message is printed it only knows \"xwiki\"  \nthomasmortagne - (13/01/2009 19:48): so it's more \" Exception while switching to wiki xwiki\"  \nthomasmortagne - (13/01/2009 19:48): but you said you have sometihng creating the wiki database ?  \nthomasmortagne - (13/01/2009 19:49): wiki=xwiki  \nnpm - (13/01/2009 19:49): so i'm assuming the right thing to do here is to use an object named /XWiki/XWikiServerhost\\_xe\\_nielsmayer\\_dot\\_com and a database entry 'host\\_xe\\_nielsmayer\\_dot\\_com\"  \nnpm - (13/01/2009 19:49): all lowercase  \nnpm - (13/01/2009 19:50): or should i use XWikiServerHost\\_xe\\_nielsmayer\\_dot\\_com or does the capitalization of the object-name not matter  \nthomasmortagne - (13/01/2009 19:50): but yes you need lowercase database name  \nnpm - (13/01/2009 19:50): as long as the matching db is all lowercase  \nnpm - (13/01/2009 19:50): yep  \nnpm - (13/01/2009 19:50): ok, i have processed the constraints :-)  \nthomasmortagne - (13/01/2009 19:51): XWikiServerHost\\_xe\\_nielsmayer\\_dot\\_com should work yes  \nnpm - (13/01/2009 19:51): ok thanks!  \nnpm - (13/01/2009 19:51): i will attempt to jira all these issues once i get the basic vhosting up and running  \nthomasmortagne - (13/01/2009 19:51): i will add something about database names that has to be lower case in the doc  \nnpm - (13/01/2009 19:51): good idea  \nnpm - (13/01/2009 19:52): thanks  \nthomasmortagne - (13/01/2009 19:52): because it not obvious  \nnpm - (13/01/2009 19:52): very true  \nthomasmortagne - (13/01/2009 19:52): I even I to double check the code ;)  \nxwikibot - (13/01/2009 19:56): AdminGuide.Virtualization was modified by xwiki:XWiki.ThomasMortagne - http://platform.xwiki.org/xwiki/bin/view/AdminGuide/Virtualization  \nxwikibot - (13/01/2009 21:41): XWiki.FADIERJeanMarie was modified by XWiki.FADIERJeanMarie - http://www.xwiki.org/xwiki/bin/view/XWiki/FADIERJeanMarie  \n\n"}