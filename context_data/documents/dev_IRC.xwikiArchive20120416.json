{"id": "dev:IRC.xwikiArchive20120416", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20120416", "title": "IRC Archive for channel #xwiki on 16 April 2012 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n14:19\u00a0<xwikibot>\u00a0has joined #xwiki  \n14:19\u00a0<jvelo>\u00a0has quit  \n14:22\u00a0<+Denis>\u00a0vmassol: sdumitriu is working on it, but I do not know what is the full status right now ? Postgresql should be fixed, Oracle has an unexpected issue with the way hibernate has generated the schema apparently, I also remember sburjan has mention an issue with hsqldb, but I do not have the details, and I do not know if sdumitriu has test it already.  \n14:24\u00a0<vmassol>\u00a0Denis: sburjan` has reported it in jira  \n14:24\u00a0<vmassol>\u00a0http://jira.xwiki.org/jira/browse/XWIKI-7729  \n14:25\u00a0<vmassol>\u00a0you should be able to test that yourself easily  \n14:26\u00a0<vmassol>\u00a0since sdumitriu is working on the oracle issue, it would be great if you could reproduce this and look into it  \n14:29\u00a0<cjd>\u00a0has quit  \n14:32\u00a0<+Denis>\u00a0vmassol: this error is closely related to the one of postgreSQL, this one will require a modification of the recent fix made by Sergui, if I should look at it, I will have to modify exactly the same part of code than the one Sergiu is suppose to also modify for Oracle  \n14:35\u00a0<cjd>\u00a0has joined #xwiki  \n14:44\u00a0<polx>\u00a0has joined #xwiki  \n14:54\u00a0<cjd>\u00a0has quit  \n15:00\u00a0<cjd>\u00a0has joined #xwiki  \n15:14\u00a0<faryshta>\u00a0has quit  \n15:14\u00a0<polx>\u00a0has quit  \n15:17\u00a0<cjd>\u00a0has quit  \n15:18\u00a0<cjd>\u00a0has joined #xwiki  \n15:27\u00a0<nickless>\u00a0has joined #xwiki  \n15:40\u00a0<faryshta>\u00a0has joined #xwiki  \n15:46\u00a0<polx>\u00a0has joined #xwiki  \n15:53\u00a0<pgmjsd>\u00a0has joined #xwiki  \n16:06\u00a0<nickless>\u00a0has quit  \n16:16\u00a0<faryshta>\u00a0has quit  \n16:32\u00a0<faryshta>\u00a0has joined #xwiki  \n16:50\u00a0<lucaa>\u00a0has joined #xwiki  \n17:06\u00a0<+Denis>\u00a0sdumitriu: ping  \n17:06\u00a0<@sdumitriu>\u00a0Pong  \n17:07\u00a0<+Denis>\u00a0I just tried to fix the issue on hsqldb  \n17:07\u00a0<+Denis>\u00a0which was initially that I cannot change to big int while there is a FK constrain on the field  \n17:07\u00a0<+Denis>\u00a0so I have splitted your drop/add to do the change of type in between  \n17:08\u00a0<@sdumitriu>\u00a0For all DBs?  \n17:08\u00a0<+Denis>\u00a0just Postgresql/HSQLDB  \n17:08\u00a0<+Denis>\u00a0but  \n17:08\u00a0<+Denis>\u00a0now I got: Error executing SQL ALTER TABLE xwikilargestrings DROP CONSTRAINT FK6661970F283EE295: user lacks privilege or object not found: FK6661970F283EE295  \n17:09\u00a0<+Denis>\u00a0since my knowledge in hsqldb is very limited, I am stuck  \n17:09\u00a0<+Denis>\u00a0and from what I see the object should exists  \n17:10\u00a0<@sdumitriu>\u00a0Hm...  \n17:11\u00a0<vmassol>\u00a0sdumitriu: guillaume is asking me when we can release 3.5.1  \n17:18\u00a0<mflorea>\u00a0has joined #xwiki  \n17:25\u00a0<+Denis>\u00a0sdumitriu: hem, curious, seems it try to do it twice  \n17:26\u00a0<+Denis>\u00a0a searching deeper now that I figure out how to access the BD  \n17:26\u00a0<+Denis>\u00a0s/a/I am/  \n17:34\u00a0<faryshta>\u00a0mflorea, hi  \n17:34\u00a0<+Denis>\u00a0sdumitriu: seems we get twice the constraint for xwikilargestring !  \n17:41\u00a0<@sdumitriu>\u00a0Denis: Riiight  \n17:41\u00a0<@sdumitriu>\u00a0We're mapping two properties to that table  \n17:42\u00a0<@sdumitriu>\u00a0Large strings and string lists (non-DB)  \n17:43\u00a0<@sdumitriu>\u00a0I'm surprised I didn't get that error on Postgres as well  \n17:44\u00a0<+Denis>\u00a0yes, I just added info to my logs, to notice that  \n17:44\u00a0<+Denis>\u00a0and I really wonder now how it could works with postgresql  \n17:45\u00a0<+Denis>\u00a0I also notice I have the same issue while altering types  \n17:46\u00a0<polx>\u00a0has quit  \n17:47\u00a0<polx>\u00a0has joined #xwiki  \n17:47\u00a0<polx>\u00a0has quit  \n17:47\u00a0<polx>\u00a0has joined #xwiki  \n17:47\u00a0<+Denis>\u00a0sdumitriu: how do you think we should fix this ?  \n17:56\u00a0<@sdumitriu>\u00a0on fail = mark run?  \n17:59\u00a0<+mflorea>\u00a0Hi faryshta  \n18:01\u00a0<faryshta>\u00a0mflorea, how is my proposal going?  \n18:02\u00a0<faryshta>\u00a0http://www.google-melange.com/gsoc/proposal/review/google/gsoc2012/faryshta/3001  \n18:04\u00a0<+mflorea>\u00a0I don't understand what are you asking for. Is is being valuated, and you'll get the result at the end of the evaluation period.  \n18:05\u00a0<faryshta>\u00a0mflorea, thanks, that was what I am asking for. Is there anything you need me to include on the proposal or something?  \n18:07\u00a0<+mflorea>\u00a0well, once the application period ended (6 April) you can't modify the proposal anymore. We're now evaluating the submitted proposals (including yours) and we'll announce the results soon.  \n18:07\u00a0<faryshta>\u00a0thanks  \n18:08\u00a0<+mflorea>\u00a0np  \n18:08\u00a0<faryshta>\u00a0I can STILL edit the proposals, make comments and include mockups.  \n18:09\u00a0<+Denis>\u00a0sdumitriu: do not like that much, creating useless changeset is bad  \n18:10\u00a0<+mflorea>\u00a0the application period ended, so in order to be fair with the rest of the students, you shouldn't modify your proposal  \n18:10\u00a0<@sdumitriu>\u00a0Denis: I know why it worked on Postgres  \n18:10\u00a0<@sdumitriu>\u00a0The changes were paired, so we had two consecutive drop-create, drop-create  \n18:10\u00a0<@sdumitriu>\u00a0Now you separated them, and we have drop, drop, create, create  \n18:11\u00a0<+Denis>\u00a0oh yes, of course :)  \n18:13\u00a0<+Denis>\u00a0things are gettings worse with hsqldb: Error: Error executing SQL ALTER TABLE xwikilists ALTER COLUMN XWL\\_ID BIGINT: is referenced by FOREIGN KEY constraint: PUBLIC.SYS\\_REF\\_FKC0862BA3FB72A11\\_10209 in statement [ALTER TABLE xwikilists ALTER COLUMN XWL\\_ID BIGINT]  \n18:13\u00a0<+Denis>\u00a0I have dropped know FK, and it seems I got others...  \n18:15\u00a0<vmassol>\u00a0sburjan`:  \n18:15\u00a0<vmassol>\u00a0s/sburjan`://  \n18:16\u00a0<mflorea>\u00a0has quit  \n18:40\u00a0<@sdumitriu>\u00a0Denis: I found out why sql-type=integer creates number(38), it's an alias defined in Oracle itself  \n18:41\u00a0<@sdumitriu>\u00a0So the integer type as known by Hibernate gets transformed into NUMBER(10) by the Hibernate Dialect  \n18:41\u00a0<@sdumitriu>\u00a0While the integer sql type is aliased inside Oracle as number(38)  \n18:41\u00a0<+Denis>\u00a0really a poor coding on the hibernate side  \n18:42\u00a0<+Denis>\u00a0so we need some changelog for oracle that fix those  \n18:42\u00a0<@sdumitriu>\u00a0Yes  \n18:42\u00a0<+Denis>\u00a0on my side, I found what is the FK that cause issue, it is a Collection  \n18:42\u00a0<+Denis>\u00a0xwikilistitems for xwikilist  \n18:42\u00a0<@sdumitriu>\u00a0I'll continue working on Oracle  \n18:42\u00a0<+Denis>\u00a0seems, you do not have such FK in postgresql ?  \n18:43\u00a0<@sdumitriu>\u00a0Denis: checking  \n18:43\u00a0<@sdumitriu>\u00a0There is a FK  \n18:43\u00a0<@sdumitriu>\u00a0But I guess that the FK doesn't prevent changing the column type in Postgres  \n18:44\u00a0<+Denis>\u00a0and you do not encouter issue while collection are migrated ?  \n18:44\u00a0<@sdumitriu>\u00a0Maybe I didn't have collections when I tested  \n18:44\u00a0<@sdumitriu>\u00a0I only tested on an empty database, not on the full XE  \n18:45\u00a0<@sdumitriu>\u00a0Well, almost empty, just the mandatory classes created  \n18:45\u00a0<@sdumitriu>\u00a0I should check on a full wiki indeed  \n18:45\u00a0<@sdumitriu>\u00a0vmassol: What should I work on first, Oracle migration for 4.0, or releasing 3.5.1?  \n18:46\u00a0<+Denis>\u00a0well, we really need more in-depth testing, I am really disappointed this has not been conducted as Ludovic initially proposed  \n18:46\u00a0<vmassol>\u00a0sdumitriu: now that there's this REST issue I need to ask Guillaume, give me 5mn  \n18:46\u00a0<vmassol>\u00a0I'm\u00f9 asking  \n18:47\u00a0<+Denis>\u00a0vmassol: I am afraid we have serious issue, and this will obviously delay 4.x final release  \n18:47\u00a0<@sdumitriu>\u00a0Denis: Well, your problem could be fixed if we include xwikilistitems in the list of tables to process, but the problem is that I don't know how to get it from Hibernate, since it doesn't have an actual entity mapping to it  \n18:48\u00a0<+Denis>\u00a0\u00a0I do know  \n18:48\u00a0<+Denis>\u00a0look at getCollectionProperties  \n18:48\u00a0<@sdumitriu>\u00a0Perfect  \n18:48\u00a0<+Denis>\u00a0this is where I look on them to migrate manually the ids  \n18:50\u00a0<vmassol>\u00a0sdumitriu: so, Guillaume is ok to postpone the release of 3.5.1 to Wednesday. By then RESTlet team will have come back to us with an analysis of the issue  \n18:50\u00a0<vmassol>\u00a0we'll then decide on wendesday if we release 3.5.1 or if we postpone by a few days more  \n18:50\u00a0<+Denis>\u00a0sdumitriu: what I do not know, is how to reach their FK  \n18:51\u00a0<vmassol>\u00a0Guillaume says he'd like to have the 3.5.1 release by end of the week  \n18:51\u00a0<vmassol>\u00a0sdumitriu: would you be free to do the 3.5.1 release on wednesday?  \n18:52\u00a0<+Denis>\u00a0mm, seems I could reach them through the collectiontable, let me try that  \n18:53\u00a0<@sdumitriu>\u00a0vmassol: Yes  \n18:53\u00a0<@sdumitriu>\u00a0The release notes are the hardest part  \n18:53\u00a0<@sdumitriu>\u00a0I could use a couple of hands on that...  \n18:53\u00a0<vmassol>\u00a0ok cool, we can prepare the RN \u00a0before that  \n18:53\u00a0<vmassol>\u00a0note that starting wednesday morning I'll be at devoxx  \n18:54\u00a0<vmassol>\u00a0so I won't be able to follow up on this much  \n19:14\u00a0<+sburjan`>\u00a0vmassol: pong, I see you invoked me  \n19:17\u00a0<+sburjan`>\u00a0Denis: you never replied on the thread to organize a testing migrations session, so I did them as I knew  \n19:19\u00a0<+Denis>\u00a0I should have missed it, where it was ?  \n19:21\u00a0<+sburjan`>\u00a0on the [xwiki-devs] [Proposal] Supported Databases Strategy thread in which you proposed it  \n19:22\u00a0<+sburjan`>\u00a0but I am not familiar at all with hibernate and databases, so I don't think I could have helped you more than that I already tested  \n19:23\u00a0<+Denis>\u00a0I have clearly missed it  \n19:23\u00a0<+Denis>\u00a0sorry  \n19:24\u00a0<+Denis>\u00a0if your are still available, at least you may help testing again when we have made all those adaptation we are working on  \n19:24\u00a0<+sburjan`>\u00a0well it's still better we didn't release like this .. so from my POV, we're good  \n19:24\u00a0<+sburjan`>\u00a0yes, I will re-test after you fix them, ofc  \n19:25\u00a0<+Denis>\u00a0it is important to made some testing with real databases, not only empty one  \n19:25\u00a0<+sburjan`>\u00a0well I also test the XAR import in the migrations  \n19:26\u00a0<+sburjan`>\u00a0and I always create a page with some annotations, attachments, comments  \n19:26\u00a0<+sburjan`>\u00a0so I can see if they are available after the migration  \n19:28\u00a0<+Denis>\u00a0nice to have, not sure it is enough, I do not know how much is covered by the base package  \n19:28\u00a0<+Denis>\u00a0anyway, better then nothing  \n19:29\u00a0<+sburjan`>\u00a0it's hard for me to mimic a production XE instance ... maybe if I create some packages that I will import over XE .. with some heavier attachments (10+ MB, etc)  \n19:30\u00a0<vmassol>\u00a0yeah actually Denis has also access to lots of real production DBs so that would help a lot  \n19:31\u00a0<vmassol>\u00a0(for mysql)  \n19:31\u00a0<+Denis>\u00a0yes, I have already extensively tested mysql  \n19:31\u00a0<vmassol>\u00a0hmm then I wonder why sorin found it failing on the first try  \n19:31\u00a0<+sburjan`>\u00a0after you fixed the issue I reported on Friday ?  \n19:31\u00a0<vmassol>\u00a0are you sure you tested upgrades Denis?  \n19:32\u00a0<vmassol>\u00a0got to go swimming , bbl  \n19:32\u00a0<vmassol>\u00a0:)  \n19:32\u00a0<+Denis>\u00a0it was just a warning , the one we had to remove !  \n19:32\u00a0<+Denis>\u00a0and it is about 40001 not 40000  \n19:32\u00a0<+Denis>\u00a0sorin, have you found anything else that I am not aware ?  \n19:33\u00a0<+sburjan`>\u00a0well everything failed to 4.0 RC1 (all db's, including hsqldb) and postgres migration was failing on 3.5.1. This is all I found migration related on friday  \n19:34\u00a0<+Denis>\u00a0note, that all the issue we had now is related to FK constrains, that some database support badly or differently, and that it seems MySQL do not suffer or have  \n19:34\u00a0<+sburjan`>\u00a0now I am waiting so we can fix these, re-test, and want to test the annotations migration to comments  \n19:35\u00a0<+sburjan`>\u00a0I am not familiar with migrators, so I don't know where or why MySQL was failing on friday, but it did  \n19:35\u00a0<+Denis>\u00a0sdumitriu: do you know if we will have FK constraints issue with oracle ?  \n19:36\u00a0<+Denis>\u00a0I am wondering if we should not simply remove FK constraints for all DBs  \n19:36\u00a0<+Denis>\u00a0change types, and add them back with cascade  \n19:37\u00a0<+Denis>\u00a0than filter the tables we made id migration on based on the FK founds  \n19:37\u00a0<+Denis>\u00a0and no more doing special stuffs based on DB product name  \n19:37\u00a0<+Denis>\u00a0sdumitriu: WDYT ?  \n19:39\u00a0<@sdumitriu>\u00a0Sounds good to me  \n19:40\u00a0<+Denis>\u00a0I prepare that  \n20:09\u00a0<+Denis>\u00a0sdumitriu: are you sure we need to manage fk to non-primary keys ? Would not suffice to only work with isReferenceToPrimaryKey() one ?  \n20:10\u00a0<@sdumitriu>\u00a0Nope, but just to be sure, since we have the code for that  \n20:15\u00a0<+Denis>\u00a0just want to focus on what we really need, so I will try to limit on PK reference  \n20:33\u00a0<polx>\u00a0has quit  \n20:55\u00a0<sburjan`>\u00a0has quit  \n20:58\u00a0<lucaa>\u00a0has quit  \n21:49\u00a0<+Denis>\u00a0sdumitriu: got a first working version on hsqldb, now I have to check it is not broken on mysql...  \n22:07\u00a0<polx>\u00a0has joined #xwiki  \n22:07\u00a0<+Denis>\u00a0hem, not really nice, seems mysql with myISAM table implements constrains, but not cascade, and therefore does not work anymore, no error, but a broken DB  \n22:57\u00a0<pgmjsd>\u00a0has quit  \n23:52\u00a0<jvdrean>\u00a0has quit  \n\n"}