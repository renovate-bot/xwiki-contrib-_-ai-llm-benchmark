{
  "id": "xwiki:Documentation.AdminGuide.Attachments",
  "url": "https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments",
  "title": "Attachments",
  "collection": "Eval_fr",
  "mimetype": "text/markdown",
  "language": "fr",
  "content": "**Contenu**\n* [Limite de taille](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HSizeLimit)\n* [Restriction de type MIME](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HMimetypeRestriction)\n* [Versions](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HVersions)\n* [Suppression](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HDeletion)\n* [Stockage des pièces jointes](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HAttachmentStorage)\n\t+ [Stockage des pièces jointes sur le système de fichiers](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HFilesystemAttachmentStore)\n\t\t- [Emplacement du stockage des pièces jointes sur le système de fichiers](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HFilesystemattachmentstorelocation)\n\t\t- [Autres considérations](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HOtherconsiderations)\n\t\t\t* [Nettoyage du répertoire](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HDirectorycleanup)\n\t+ [Stockage des pièces jointes dans la base de données](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HDatabaseAttachmentStore)\n\t\t- [Passer au stockage des pièces jointes dans la base de données](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HSwitchtodatabaseattachmentstore)\n* [Affichage ou téléchargement des pièces jointes](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HAttachmentdisplayordownload)\n* [Résumé de l'upload](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HUploadsummary)\n* [Sécurité](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HSecurity)\n\nLes pièces jointes peuvent être téléchargées soit par l'[action de téléchargement régulière](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/Attachments), [WebDAV](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/WebDAV), [XML-RPC](https://extensions.xwiki.org/xwiki/bin/view/Extension/XML-RPC%20Integration) ou [Rest](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/XWikiRESTfulAPI).  \nEn tant qu'administrateur, vous pouvez définir des limites sur la taille maximale d'une pièce jointe et où les pièces jointes seront stockées.\n\n# Limite de taille\n\nLa taille maximale d'une pièce jointe est limitée par un paramètre de configuration dans le document *XWikiPreferences*. Elle est définie par défaut à 100GB (32MB pour XWiki < 10.9RC1).  \nPour la changer, suivez ces étapes :\n\n1. Allez à *http://<yourwiki>/xwiki/bin/edit/XWiki/XWikiPreferences?editor=object*\n2. Cliquez sur la ligne qui dit XWikiPreferences 0 (juste en dessous de la ligne qui dit Objets de type XWiki.XWikiPreferences (1))\n3. Faites défiler jusqu'au champ qui dit Taille maximale de téléchargement et changez le nombre à la taille souhaitée (elle est exprimée en octets)\n4. Faites défiler jusqu'en bas et cliquez sur \"Enregistrer\"\n5. Répétez pour chaque (sous)wiki pour lequel vous devez augmenter la taille, car actuellement cette configuration doit être définie par wiki\n\nNotez que si vous avez déjà essayé de joindre un fichier et que cela a échoué, pour que le nouveau paramètre de taille soit pris en compte, vous devrez peut-être vider le cache de votre navigateur.\n\n# Restriction de type MIME\n\nVoir [Application de validation des pièces jointes](https://extensions.xwiki.org/xwiki/bin/view/Extension/Attachment/Validation/UI/).\n\n# Versions\n\nLorsqu'un utilisateur télécharge une pièce jointe puis télécharge une autre pièce jointe avec exactement le même nom, vous pouvez décider de conserver ou non un historique des versions des pièces jointes comme vous le faites avec les documents.  \nXWiki stocke par défaut toutes les versions des pièces jointes, ce qui coûte plus d'espace de stockage. Si vous avez besoin uniquement des dernières versions des pièces jointes, vous pouvez désactiver le contrôle de version des pièces jointes en modifiant votre [xwiki.cfg](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Configuration/) et en ajoutant :\n\nxwiki.store.attachment.versioning=0\n\n# Suppression\n\nLes pièces jointes supprimées sont stockées dans une corbeille afin qu'elles puissent être restaurées avec le document lors du retour en arrière ou de la prévisualisation d'une version antérieure où la pièce jointe devrait être visible. Pour désactiver cette fonctionnalité, modifiez [xwiki.cfg](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Configuration/) et ajoutez :\n\nstorage.attachment.recyclebin=0\n\nVous pouvez voir la liste des pièces jointes supprimées dans votre wiki et les supprimer définitivement en allant dans XWiki.DeletedAttachments dans votre wiki.\n\n# Stockage des pièces jointes\n\nXWiki offre des mécanismes de stockage des pièces jointes sous forme de plugins, vous permettant de stocker vos pièces jointes dans la base de données ou directement dans le système de fichiers.\n\nEn général, les métadonnées des pièces jointes et des pièces jointes supprimées restent dans la base de données quel que soit le stockage utilisé pour le contenu. Les métadonnées contiennent le type de stockage utilisé pour le contenu, permettant à chaque pièce jointe de choisir un stockage différent. La conséquence est que ce que vous configurez est le stockage **par défaut** pour une nouvelle pièce jointe et non le stockage utilisé pour toutes les pièces jointes.\n\n## Stockage des pièces jointes sur le système de fichiers\n\nLe défaut depuis 10.5\n\nLe stockage des pièces jointes sur le système de fichiers enregistre vos pièces jointes dans des fichiers dans un arbre de répertoires. Cela signifie que vous aurez une chose de plus à faire lorsque vous sauvegarderez vos données, mais cela signifie également que vous pouvez enregistrer des fichiers plus volumineux (plus d'un gigaoctet). Le stockage des pièces jointes sur le système de fichiers implémente un mécanisme de validation en deux étapes pour maintenir l'intégrité même si la base de données échoue à valider les métadonnées de la pièce jointe.\n\n### Emplacement du stockage des pièces jointes sur le système de fichiers\n\nPar défaut, le stockage sur le système de fichiers est situé dans un sous-dossier (store/file depuis XWiki 11.0 et storage avant) du répertoire permanent (défini avec le paramètre environment.permanentDirectory dans le fichier xwiki.properties). Par défaut, il est défini sur data, qui est un répertoire relatif à l'endroit où le conteneur de servlets Java a été démarré. Il est recommandé de modifier cette valeur pour qu'elle soit absolue afin que vous puissiez démarrer le conteneur de servlets depuis n'importe quel répertoire et que XWiki trouve toujours les pièces jointes situées dans ce répertoire de travail.\n\nPar exemple :\n\nenvironment.permanentDirectory=/opt/tomcat6/data\n\nDepuis 11.4, il est possible de définir l'emplacement du stockage sur le système de fichiers sans modifier le répertoire permanent général en utilisant la propriété store.file.directory du fichier xwiki.properties.\n\nstore.file.directory=/my/custom/location\n\n### Autres considérations\n\nSi vous exécutez un [cluster](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Clustering/), vous devrez avoir un répertoire de stockage synchronisé pour chaque nœud. Vous pouvez utiliser NFS ou d'autres moyens pour monter le disque sur chaque nœud du cluster.\n\n#### Nettoyage du répertoire\n\nDepuis [XWiki 6.0M2](https://www.xwiki.org/xwiki/bin/view/ReleaseNotes/ReleaseNotesXWiki61M2), il est possible de gagner du temps au démarrage en empêchant XWiki de nettoyer les répertoires vides dans le stockage des pièces jointes sur le système de fichiers. Pour ce faire, modifiez xwiki.properties et définissez **store.fsattach.cleanOnStartup** sur false. Si vous faites cela, vous serez responsable du nettoyage des répertoires vides vous-même.\n\n## Stockage des pièces jointes dans la base de données\n\nLe défaut avant 10.5.\n\nCe mécanisme de stockage des pièces jointes stocke vos pièces jointes dans des entrées de base de données dans les tables [xwikiattachment_content](https://www.xwiki.org/xwiki/bin/view/Documentation/DevGuide/DsXWikiAttachmentContent), [xwikiattachment_archive](https://www.xwiki.org/xwiki/bin/view/Documentation/DevGuide/XWikiAttachmentArchive) et [xwikiattrecyclebin](https://www.xwiki.org/xwiki/bin/view/Documentation/DevGuide/DsXwikiRecycleBin). Ce système permet une sauvegarde facile de vos pièces jointes en vidant la base de données et en gardant toutes vos données ensemble, mais la taille des pièces jointes est limitée par la mémoire car le contenu et l'archive de la pièce jointe doivent tous être maintenus en mémoire. En règle générale, les pièces jointes de plus de 30MB ne sont pas possibles.\n\n### Passer au stockage des pièces jointes dans la base de données\n\nCes paramètres doivent être lus comme suit :\n\nxwiki.store.attachment.hint = hibernate  \nxwiki.store.attachment.versioning.hint = hibernate  \nxwiki.store.attachment.recyclebin.content.hint=hibernate  \n  \n# Si vous avez besoin d'utiliser le stockage de la base de données pour les pièces jointes, c'est probablement vrai pour les pièces jointes supprimées  \nxwiki.store.recyclebin.content.hint = hibernate\n\nAssurez-vous également qu'ils ne sont pas commentés.\n\nLorsque vous utilisez ce stockage de pièces jointes avec une base de données MySQL, vous devez définir le max_allowed_packet à environ 3 fois la taille de votre plus grande pièce jointe car la pièce jointe et son historique de version doivent être enregistrés. Voir le [guide d'installation MySQL](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/InstallationMySQL) pour plus d'informations.\n\n# Affichage ou téléchargement des pièces jointes\n\nLorsque cela est possible (voir la [section Sécurité](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Attachments#HSecurity) ci-dessous), les pièces jointes sont affichées directement dans le navigateur lorsqu'elles sont consultées.  \nIl est possible pour les développeurs de forcer le téléchargement d'une pièce jointe en ajoutant le paramètre ?force-download=1 dans l'URL de la pièce jointe.\n\nDepuis XWiki 12.10+, il est possible d'utiliser une propriété dédiée dans xwiki.properties pour toujours forcer le téléchargement de certains types MIME de pièces jointes :\n\n#-# [Depuis 12.10]  \n#-# Définissez le type de pièce jointe que vous souhaitez toujours télécharger et ne jamais afficher en ligne.  \n#-# Par défaut, cette liste est vide, mais vous pouvez spécifier une liste de types MIME (liste de valeurs séparées par des virgules) qui  \n#-# devraient toujours être téléchargés, peu importe qui les a attachés ou quelle est la configuration de la liste blanche/noire.  \n#-#  \n#-# La distinction avec la configuration de la liste noire ci-dessus est que la liste noire n'affectera pas les fichiers attachés par un utilisateur  \n#-# avec des droits de programmation, tandis que cette configuration affecte toute pièce jointe.  \n# attachment.download.forceDownload=\n\n# Résumé de l'upload\n\nDepuis XWiki 16.3.0+, vous pouvez activer les résumés de téléchargement dans xwiki.properties pour permettre aux utilisateurs d'ajouter des descriptions lors des téléchargements de pièces jointes.\n\n#-# [Depuis 16.3.0RC1]  \n#-# Indiquez si les commentaires pour les téléchargements de pièces jointes doivent être définissables depuis l'UI, et affichés chaque fois que les  \n#-# révisions des pièces jointes sont listées. La valeur par défaut est false.  \n# attachment.upload.enableComments=false\n\n# Sécurité\n\nAfin de prévenir les attaques utilisant des pièces jointes, il est possible de contrôler quelles pièces jointes peuvent être directement ouvertes dans le navigateur en fonction de leurs types MIME.  \nDeux propriétés dans xwiki.properties permettent de contrôler cela indépendamment :\n\n#-# [Depuis 5.2M2]  \n#-# Définissez le type de pièce jointe qui peut être affiché en ligne. Vous pouvez soit choisir de le faire via une liste blanche  \n#-# (seuls les types MIME définis dans cette liste seraient affichés en ligne) soit une liste noire (tout type MIME qui n'est pas dans  \n#-# cette liste serait affiché en ligne si possible).  \n#-# Notez qu'une seule configuration est utilisée entre la liste blanche et la liste noire, et la liste blanche a toujours  \n#-# la priorité sur la liste noire. Notez également que ces configurations existent pour des raisons de sécurité, elles n'affectent donc que  \n#-# les pièces jointes ajoutées par des utilisateurs qui n'ont pas de droits de programmation.  \n#-# Si vous souhaitez forcer le téléchargement de certains types de pièces jointes, veuillez vérifier la configuration ci-dessous.  \n#-#  \n#-# Par défaut, nous utilisons la liste blanche suivante (liste de valeurs séparées par des virgules).  \n# attachment.download.whitelist=audio/basic,audio/L24,audio/mp4,audio/mpeg,audio/ogg,audio/vorbis,audio/vnd.rn-realaudio,audio/vnd.wave,audio/webm,image/gif,image/jpeg,image/pjpeg,image/png,image/tiff,text/csv,text/plain,text/xml,text/rtf,video/mpeg,video/ogg,video/quicktime,video/webm,video/x-matroska,video/x-ms-wmv,video/x-flv  \n#-#  \n#-# Si vous préférez utiliser une liste noire à la place, vous pouvez définir les types interdits ici, sous forme de liste de  \n#-# valeurs séparées par des virgules. Nous vous conseillons d'interdire au moins les types MIME suivants : text/html, text/javascript  \n# attachment.download.blacklist=text/html,text/javascript"
}