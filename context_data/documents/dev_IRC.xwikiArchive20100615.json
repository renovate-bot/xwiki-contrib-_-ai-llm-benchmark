{"id": "dev:IRC.xwikiArchive20100615", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20100615", "title": "IRC Archive for channel #xwiki - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\nsdumitriu left at 00:59 (Ping timeout: 265 seconds  \nabusenius left at 01:49 (Ping timeout: 276 seconds  \njvelo joined #xwiki at 01:52  \njvelo left at 03:17 (Quit: Ex-Chat  \nSvenDowideit left at 04:45 (Ping timeout: 258 seconds  \nSvenDowideit\\_ joined #xwiki at 04:45  \nSvenDowideit\\_ is now known as SvenDowideit ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nnpm left at 05:11 (Quit: Leaving.  \nnpm joined #xwiki at 05:16  \nkibahop left at 07:01 (Remote host closed the connection  \nFreud\\_ - (07:02): got the part i needed by request.getRequestURL(), now i'm just gonna output it as a clickable link in the mail...  \nDenis left at 07:04 (Ping timeout: 276 seconds  \nDenis joined #xwiki at 07:09  \nnuvolari left at 07:25 (Excess Flood  \nnuvolari joined #xwiki at 07:26  \nvmassol joined #xwiki at 07:50  \nflorinciu joined #xwiki at 07:58  \nkibahop joined #xwiki at 08:00  \nmflorea joined #xwiki at 08:09  \nsburjan joined #xwiki at 08:20  \nsburjan\\_ joined #xwiki at 08:22  \nplunden joined #xwiki at 08:24  \nsburjan\\_ left at 08:26 (Client Quit  \nsilviar joined #xwiki at 08:29  \nflorinciu left at 08:48 (Read error: Connection reset by peer  \nflorinciu joined #xwiki at 09:11  \nsburjan - (09:36): morning vmassol :)  \nvmassol - (09:37): sburjan: good morning  \nsburjan - (09:37): I am creating right now the section for Printing and Exporting  \nsburjan - (09:38): but I have a question : where is the Print button in Colibri ? i can find the Print Preview, but NOT the Print button  \nevalica joined #xwiki at 09:38  \nvmassol - (09:52): sburjan: as I was saying yesterday there's non  \nvmassol - (09:52): none  \ntmortagne joined #xwiki at 09:53  \nvmassol - (09:53): and you need to ask sergiu why since I don't recall the reason why we removed it  \nvmassol - (09:53): sburjan: ping me when you're completely done and I'll do a review pass  \nsilviar left at 10:01 (Quit: Leaving.  \nsilviar joined #xwiki at 10:03  \nabusenius joined #xwiki at 10:09  \nEnygma` joined #xwiki at 10:33  \nvmassol - (10:34): mflorea: I need to take some time to fully read your draft since it contains lots of information ;)  \nmflorea - (10:35): vmassol: sure, I'll think of use cases where using the container component is difficult  \nsburjan - (10:35): vmassol, : ping  \nmflorea - (10:35): I'll comment on the list asap  \nvmassol - (10:35): sburjan: I'm in a meeting for a few horus, will look after  \nsburjan - (10:36): no hurry  \nmflorea left at 10:37 (Quit: Leaving.  \ntmortagne - (10:44): guys does someone as any idea what simpleedittoolbar.vm is supposed to be ? it looks like wiki editor buttons but that's not it, when i look at the actually wiki editor i don't find the same thing  \ntmortagne - (10:47): actually i was looking at an old version  \ntmortagne - (10:48): i was searching where the translation key \"hrtext\" is used and only hit an old XE distribution that was in a target folder  \njvelociter joined #xwiki at 10:48  \ntmortagne - (10:48): so it looks like it's not used anymore  \ntmortagne - (10:49): and probably the same for all keys near this one  \ntmortagne - (10:49): we really need to find a way to cleanup ApplicationResources.properties  \nvmassol - (10:50): guys we were supposed to release 2.4M2 yesterday  \nvmassol - (10:50): thus we need to define a new date  \nvmassol - (10:51): EOW sounds reasonable to me, wdyt?  \ntmortagne - (10:52): EOW ?  \nvmassol - (10:52): end of week  \ntmortagne - (10:53): ok  \nvmassol - (10:53): (ie release next monday)  \ntmortagne - (10:53): sounds good  \ntmortagne - (10:53): we need to fix all tests before that  \nsdumitriu joined #xwiki at 10:53  \nvmassol - (10:53): yes, I'm in a meeting could soemone send a proposal/vote for the new date?  \nvmassol - (10:54): sdumitriu: could you tell us when you can commit some of the things you're working on for 2.4?  \nvmassol - (10:54): since after M2 we're not supposed to commit big stuff, only stabilization  \ntmortagne - (10:55): vmassol: sending it  \nvmassol - (10:55): ok thanks  \nsilviar - (10:56): sburjan: also for \"Export\" indicate the skin for each printscreen; for \"Delete\" & \"Copy\" make sure you also add printscreens for Toucan and indicate the skin for each image; for \"Move/Rename\" change the order to \"Colibri -> Toucan\" since this is the way you've organized the document so far; Add an image of the \"Rename\" page in Toucan; Display the images in \"Move/Rename\" like you did for Code (grouped by skin)  \nvmassol - (10:56): silviar, sburjan: could you make sure to test this new feature of XE 2.4M2: http://jira.xwiki.org/jira/browse/XWIKI-5237  \nvmassol - (10:57): (adding doc for it would be great too btw ;) - you could get help from jvdrean about it)  \nsburjan - (10:57): silviar : so I should create screens for BOTH skins  \nsburjan - (10:58): vmassol : okay  \nvmassol - (10:59): there's some doc already, let me try to find it  \nsilviar - (11:00): vmassol: yup, we will  \nmariusbutuc joined #xwiki at 11:00  \nvmassol - (11:00): sburjan/silviar: here: http://dev.xwiki.org/xwiki/bin/view/Drafts/DocumentTemplates  \nsilviar - (11:00): sburjan: yes; add images for both screens; this is especially important when we have visible differences between the two  \nvmassol - (11:00): will need to be moved to a proper place  \nvmassol - (11:01): (it's in drafts now)  \nmariusbutuc left at 11:01 (Client Quit  \nsilviar - (11:01): vmassol: yes, I've read the document; will double check it and move it on release day  \nvmassol - (11:01): you can even move it before if you want, you can put a (Since 2.4M2) information on it  \nsilviar - (11:02): ok  \ntmortagne - (11:05): (mail sent)  \njvdrean joined #xwiki at 11:05  \nvmassol - (11:06): jvdrean: is this document up to date, ie does it correspond to the committed code: http://dev.xwiki.org/xwiki/bin/view/Drafts/DocumentTemplates ?  \nlucaa left at 11:06 (Ping timeout: 245 seconds  \nCalebJamesDeLisl - (11:07): Good morning, I have a patch to make the order of 1.0 renderers configurable in xwiki.cfg and I'd also like to commit Alex's revised patch. Any questions/complaints first?  \njvdrean - (11:08): vmassol: yes  \nCalebJamesDeLisl - (11:08): (My 1.0 patch changes xwiki.cfg so groovy is run first. but it's only a change in .cfg)  \nvmassol - (11:08): CalebJamesDeLisl: re the order you got some answers already on the list. Re nested script, I'll defer to thomas ;)  \nvmassol - (11:09): (I'm in a meeting right now)  \nCalebJamesDeLisl - (11:10): Ok.  \ntmortagne - (11:14): CalebJamesDeLisl: i'm ok with nested script protection but there should be a configuration to disable it to not totally block someone that would need it until he migrate properly his application, the important thing is that it's enable by default anyway, if you disable it you know what you do  \ntmortagne - (11:14): (maybe there is a configuration already i did not looked actually)  \ntmortagne - (11:14): also i'm checking the new patch, i did not had the time before  \ntmortagne - (11:15): CalebJamesDeLisl: can you give me the issue number ?  \nCalebJamesDeLisl - (11:15): No. I said something about configuration ans Vincent didn't like the idea.  \ntmortagne - (11:15): CalebJamesDeLisl: i'm not talking about groovy/velocity  \nvmassol - (11:15): yes I don't like that  \nvmassol - (11:15): at all  \ntmortagne - (11:15): i'm talking about nested script  \nvmassol - (11:15): I much prefer a better design  \nvmassol - (11:15): that make it optional  \nvmassol - (11:16): (like a Tx that you can decide to run or not run)  \nvmassol - (11:16): then we can have a config param  \nvmassol - (11:16): but first it should be designed to be not hardcoded IMO  \nCalebJamesDeLisl - (11:16): Hang on, I was running webSecurity and I think it drove my wiki into an infinite loop.  \nabusenius - (11:21): tmortagne: there is no configuration to disable nested scripts check, but I can add that  \ntmortagne - (11:23): abusenius: i think it's safer that way since it's a big change for anyone specifically using it  \nlucaa joined #xwiki at 11:24  \nCalebJamesDeLisl - (11:25): http://jira.xwiki.org/jira/browse/XWIKI-5223  \ntmortagne - (11:25): CalebJamesDeLisl: thanks  \nevalica left at 11:26 (Quit: Leaving.  \nvmassol - (11:28): CalebJamesDeLisl: are you sure you've considered all use cases for your rendering 1.0 change? It's very complex (I remember spending days and nights on it in the past)  \nCalebJamesDeLisl - (11:28): Well if there is a use case that is broken, the user can comment out the line in the .cfg file.  \nvmassol - (11:29): errr  \nCalebJamesDeLisl - (11:29): As far as XE and XEM there is no groovy in syntax 1.0 anyway.  \nvmassol - (11:29): you want to replace a bug by another one?  \nvmassol - (11:29): check all the escaping  \nvmassol - (11:29): it currently works by knowing the order of the rendering passes  \nCalebJamesDeLisl - (11:29): escaping?  \nvmassol - (11:30): I don't recall all the details but there are several places doing it  \nvmassol - (11:30): I have the feeling you'll need to change those to work fine  \nCalebJamesDeLisl - (11:30): Where is this escaping?  \nvmassol - (11:30): my opinion is that you don't know the rendering well enough to be sure it's not going to cause regressions  \nvmassol - (11:30): unless you have really studied it  \nvmassol - (11:31): I don't want us to rush a fix wihtout understanding the consequences  \nCalebJamesDeLisl - (11:31): Ok, then I suppose we can skip applying the patches.  \nvmassol - (11:31): the odl rendering is complex  \nvmassol - (11:31): and work on one premises  \nvmassol - (11:31): that the order of the rendering passes are fixed  \nCalebJamesDeLisl - (11:31): odl?  \nvmassol - (11:31): CalebJamesDeLisl: yes that's why we don't apply a lot of patches on the old core  \nvmassol - (11:32): s/odl/old/  \nvmassol - (11:32): because any change can break lots of stuff  \nvmassol - (11:32): so you need to fully understand what you're doing there  \nvmassol - (11:32): I'm not saying you didn't \u00a0studided it (I don't know that)  \nvmassol - (11:32): just that we need to be careful  \nCalebJamesDeLisl - (11:32): Where is the escaping you are talking about?  \nvmassol - (11:33): there are some in the renderers themselves  \nvmassol - (11:33): I have commtned them luckily  \nvmassol - (11:33): (there were no comments before....)  \nvmassol - (11:33): I'm sitll in a meeting so can't check easily the cde right now  \nCalebJamesDeLisl - (11:33): And they care about velocity running before groovy?  \nvmassol - (11:33): need to listen a bit at teh same time ;)  \nCalebJamesDeLisl - (11:34): Ok.  \nvmassol - (11:34): I'm not sure but I think they do depend  \nvmassol - (11:34): and there's probably no tests for this  \nvmassol - (11:35): CalebJamesDeLisl: the best person to know for sure would be ludovic  \nvmassol - (11:35): since he's the one who wrote this  \nvmassol - (11:36): (but it was a long time ago)  \nCalebJamesDeLisl - (11:36): Where should I go to ask him?  \nflorinciu left at 11:37 (Quit: Leaving.  \nvmassol - (11:37): CalebJamesDeLisl: one place I was thinking about was:  \nsilviar - (11:37): vmassol: wdyt about renaming this page http://platform.xwiki.org/xwiki/bin/view/Features/Forms to \"Document Forms\" instead of \"Document Templates & Forms\" ? This way we prevent any confusion once we link the \"Document Templates\" page from the list of features  \nvmassol - (11:37): \u00a0\u00a0\u00a0\u00a0public String convertMultiLine(String macroname, String params, String data, String allcontent,  \nvmassol - (11:37): \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0XWikiVirtualMacro macro, XWikiContext context)  \nvmassol - (11:38): but it seems it's ok  \nvmassol - (11:38): in XWikiRadeoxRenderer  \nCalebJamesDeLisl - (11:40): That will work ok because macromapping is always first.  \nabusenius - (11:40): tmortagne: should I add the nested scripts config option to xwiki-rendering-api/\\*\\*/Configuration?  \nabusenius - (11:41): or add a new config component to rendering-macro-script?  \ntmortagne - (11:43): abusenius: since it's internal to scrip macro for now it should go in script macro config  \nabusenius - (11:44): ok  \nCalebJamesDeLisl - (11:45): vmassol: The function of escaping velocity and groovy in the code macro is tested here: DefaultXWikiRenderingEngineTest  \nmflorea joined #xwiki at 12:11  \nlucaa left at 12:14 (Ping timeout: 245 seconds  \nsilviar left at 12:15 (Ping timeout: 258 seconds  \nEnygma` left at 12:15 (Ping timeout: 272 seconds  \nmflorea left at 12:16 (Ping timeout: 276 seconds  \nsburjan left at 12:16 (Ping timeout: 264 seconds  \nmflorea joined #xwiki at 12:16  \nflorinciu joined #xwiki at 12:16  \nevalica joined #xwiki at 12:16  \nsilviar joined #xwiki at 12:17  \nkibahop left #xwiki at 12:20  \nsburjan joined #xwiki at 12:29  \nlucaa joined #xwiki at 12:31  \nabusenius - (12:39): updated patch for 5223  \nlucaa left at 12:48 (Ping timeout: 260 seconds  \nsilviar left at 12:50 (Quit: Leaving.  \njvdrean left at 12:59 (Quit: Leaving.  \narkub joined #xwiki at 13:10  \nvmassol - (13:16): fyi wikipedia introduces a \"pending changes\" feature for sensitive pages: http://www.clubic.com/site-internet/actualite-346702-wikipedia-renforce-surveillance-modifications-pages.html  \nmariusbutuc joined #xwiki at 13:23  \nvmassol - (13:24): CalebJamesDeLisl: I've pinged ludovic  \nvmassol - (13:25): he's going to reply  \nCalebJamesDeLisl - (13:25): Thanks. I looked over the code, I don't see anything which looks in danger.  \nCalebJamesDeLisl - (13:25): Selenium tests running now.  \nvmassol - (13:26): ok great  \nvmassol - (13:28): CalebJamesDeLisl: he's answered on the list  \nvmassol - (13:28): he doesn't see a problem  \nvmassol - (13:28): so w're good to go  \nCalebJamesDeLisl - (13:29): All right. That makes me feel much better.  \nvmassol - (13:29): the config param is in the old xwiki.cfg right?  \njvdrean joined #xwiki at 13:29  \nCalebJamesDeLisl - (13:30): Yup.  \nvmassol - (13:30): ok good  \nCalebJamesDeLisl - (13:30): That would be a mess to move it to .properties.  \nvmassol - (13:30): the new propeties is for new code anyway  \nvmassol - (13:30): (ie code written using components)  \nvmassol - (13:31): (well it's easy to call compoennts from old code)  \nvmassol - (13:31): (but we shouldn't do it)  \nvmassol - (13:31): (since we want to drop this old rendering engine as fast as we can :))  \nCalebJamesDeLisl - (13:31): Ok so 1.0 is good. Now you were against the configuration for the nested macros and Thomas was +1.  \nvmassol - (13:31): I'm not against it  \nvmassol - (13:31): I'm against using config as a way to write extensible code  \nvmassol - (13:31): ie as a design pattern  \nvmassol - (13:32): a good design doesn't need config  \nvmassol - (13:32): which means if you write java code  \nvmassol - (13:32): you don't need to set any config  \nvmassol - (13:32): s/don't/shouldn't/  \nvmassol - (13:32): in order to not run the nested filter  \nEnygma` joined #xwiki at 13:32  \nCalebJamesDeLisl - (13:32): \"A good design doesn't need config\" \u00a0Sounds Taoist. :)  \nvmassol - (13:32): :)  \nCalebJamesDeLisl - (13:33): Ok abusenius can you go over why we can't use a transformation which recursively parses and renders until there is nothing left to parse?  \nCalebJamesDeLisl - (13:34): (Recursively parsing and rendering to open up html macros and other black boxes to look inside for further script macros)  \nvmassol - (13:35): I think it would require to replace a script macro block with a proxy script macro block  \nvmassol - (13:35): (what I was brainstomring yesterday)  \nvmassol - (13:35): (but it got lost in the several // threads I think)  \nvmassol - (13:36): it needs to be veirfied if it can work  \nCalebJamesDeLisl - (13:36): script proxy block? Can you elaborate? I know less about rendering2.0 than 1.0.  \nvmassol - (13:37): well the tx would need to run before the MacroTx  \nvmassol - (13:37): (otherwise it's too late)  \nvmassol - (13:37): right?  \nvmassol - (13:38): and since macros are black boxes you need to inject the filter so that it is executed when the macro executes  \nvmassol - (13:38): s/executed/executes/  \nvmassol - (13:38): so basically one idea would be to have a SecureScriptMacro impl  \nvmassol - (13:38): injecetd by the Tx  \nCalebJamesDeLisl - (13:38): Yes otherwise the script macro would have to be put into a ScriptMarkerBlock which can then be recognized.  \nvmassol - (13:38): that would add checks  \nvmassol - (13:38): when the macro executes  \nvmassol - (13:38): so the Tx would do: look for script macro blocks  \nvmassol - (13:39): replace them with a new macro block that will call a secure script macro  \nvmassol - (13:39): (passing the langage as param for ex)  \nvmassol - (13:39): and that SecureScriptMacro would perform the check and delegate execution to the wrapped maro  \nvmassol - (13:39): macro  \nvmassol - (13:39): something like this  \nvmassol - (13:40): the other next best solution is to introduce a specific notion of filter in ScriptMacro  \nCalebJamesDeLisl - (13:40): so it would be like another macro {{nonNestableScript language=velocity}}  \nvmassol - (13:40): (as we have for ex for velocity)  \nvmassol - (13:40): since we already have that notion of content filter for velocity  \nCalebJamesDeLisl - (13:40): filter in velocity?  \nvmassol - (13:40): we could extend it for all script macros  \nvmassol - (13:41): yes let me get the url for the doc  \nvmassol - (13:41): http://code.xwiki.org/xwiki/bin/view/Macros/VelocityMacro  \nvmassol - (13:41): pb is that we would need to modify it for velocity to allow several filters to be executed but that's doable  \nvmassol - (13:41): (http://code.xwiki.org/xwiki/bin/view/Macros/VelocityMacroFilter)  \nCalebJamesDeLisl - (13:42): If we could filter velocity that would be enough. The problem is that we can't ensure that a script macro won't be run.  \nvmassol - (13:42): note: I'm talking generally here, I haven't thought enought o see if this would work or not  \nvmassol - (13:43): yes but using the proxies secure macro, it could look at the resulting XDOM  \nvmassol - (13:43): and replace any script macro with the secure version  \nvmassol - (13:43): before getting out of its execute method  \nCalebJamesDeLisl - (13:43): What about html macros?  \nvmassol - (13:43): same  \nvmassol - (13:44): (with a test for wiki=true)  \nCalebJamesDeLisl - (13:44): You would have to replace all macros inside the velocity with secure macros.  \nvmassol - (13:44): only script macros  \nvmassol - (13:44): not all macros  \nCalebJamesDeLisl - (13:45): So you parse the output from the velocity macro. You see an html macro, you do not change it?  \nvmassol - (13:45): you don't parse  \nvmassol - (13:45): you traverse the dom tree  \nvmassol - (13:45): yes you replace it with a proxy secure macro  \nvmassol - (13:45): (again I haven't fully thought this out)  \nvmassol - (13:46): (I'm in brainstorming mode here)  \nCalebJamesDeLisl - (13:46): Then you parse the html macro, you see a script macro which looks fine because it's just inside of a html macro.  \nCalebJamesDeLisl - (13:46): (a transformation was my first thought too)  \nvmassol - (13:47): I don't know how it's done now (haven't looked at the latest path) but I have the feeling this can be achieved similarly with a Tx  \nvmassol - (13:47): (and a bit of creativity)  \nvmassol - (13:47): (creatibity = possibly the idea of proxies secure macro)  \nvmassol - (13:47): but again I don't know  \nvmassol - (13:47): I would need to sit and think for a few hours  \nvmassol - (13:48): anyway all I'm saying is that I would be more happy if we had a way to separate the security checks from the main code  \nCalebJamesDeLisl - (13:48): The problem as I understand it is that an html macro is a black box, it can contain script macros and you don't know.  \nvmassol - (13:48): all macros are black boxes  \nvmassol - (13:48): it's not reserved to html  \nCalebJamesDeLisl - (13:49): so {{velocity}} {{html}} {{groovy}} .... defeats your Tx solution.  \nCalebJamesDeLisl - (13:49): Because after velocity parses, there are no script macros to be seen.  \nvmassol - (13:49): hmmm  \nvmassol - (13:50): what we need to do actually  \nvmassol - (13:50): is maybe simply have a SecureScriptMacro macro  \nvmassol - (13:50): which extends the ScriptMacro  \nvmassol - (13:50): as a component  \nvmassol - (13:51): and you can decide to register the standard or the secure ones  \nvmassol - (13:51): against the CM  \nvmassol - (13:51): not very flexible  \nCalebJamesDeLisl - (13:51): That sounds ok, how does the 'secure' macro differ from the default?  \nvmassol - (13:51): what does the patch do?  \nvmassol - (13:51): (I'd say the same thing)  \nvmassol - (13:52): maybe the pre/post exec filter solution is better though  \nCalebJamesDeLisl - (13:52): It looks up the tree and looks for script macro marker blocks.  \nvmassol - (13:52): then the secure macro or the fitler could do the same no?  \nvmassol - (13:52): s/fitler/filter/  \nCalebJamesDeLisl - (13:53): Well Alex had to make a change so that marker blocks would implement a new interface if they came from script macros.  \nCalebJamesDeLisl - (13:53): I guess that's easy enough.  \nvmassol - (13:54): I haven't see that code but I don't like that a macro marker block \u00a0would have a notion of script macro  \nvmassol - (13:55): the same could be achieved with a SecureMacroMarkerBlock introduced by a Tx no?  \nCalebJamesDeLisl - (13:55): How about this: Script macro executes, output is parsed, then it's rendered. If the output is still wiki text, it's parsed and rendered again. all inside the NonNestableScriptMacro#evaluate  \nCalebJamesDeLisl - (13:56): So the script macro can run the check recursively, all black boxes are opened.  \nvmassol - (13:56): It hink it doesn' twork  \nvmassol - (13:56): since it forgets about priorities  \nvmassol - (13:56): vs other macros on the page  \nvmassol - (13:57): (ex: include macro and toc macros)  \nCalebJamesDeLisl - (13:57): Oh, the output of the page has to be parsed as one. Hmmm.  \nCalebJamesDeLisl - (13:57): or levels of headers.  \nCalebJamesDeLisl - (13:58): K, so Alex has the right idea then. How do we make this it's own component?  \nvmassol - (13:59): CalebJamesDeLisl: I wish I could psend time on this  \nvmassol - (13:59): but I have to fix 2 bugs before end of the week  \nvmassol - (13:59): I need to get back to them  \nCalebJamesDeLisl - (13:59): Velocity leak?  \nvmassol - (13:59): yes  \nvmassol - (13:59): they're quite importznt  \nvmassol - (13:59): too  \nCalebJamesDeLisl - (13:59): You saw my groovy tool?  \nvmassol - (13:59): which one?  \nvmassol - (13:59): (don't remember)  \nCalebJamesDeLisl - (14:00): I put it in the email in response to Ludovic.  \nCalebJamesDeLisl - (14:00): should be on the dev list.  \nCalebJamesDeLisl - (14:01): This email: Re: [xwiki-devs] Measuring cache memory usage  \nvmassol - (14:02): btw did you see my email about jmx and the velocity cache?  \nvmassol - (14:02): CalebJamesDeLisl: oh it was your tool  \nCalebJamesDeLisl - (14:02): I did, what are you doing? dumping it?  \nvmassol - (14:02): that's what I used  \nvmassol - (14:02): :)  \nvmassol - (14:03): (thought it was done by Ludovic)  \nvmassol - (14:03): dumping?  \nvmassol - (14:03): I have written a JMx Mbean to expose it  \nvmassol - (14:03): (your tool)  \nvmassol - (14:03): so you can now just type jconsole in a shell  \nvmassol - (14:03): and you'll get the info  \nCalebJamesDeLisl - (14:03): Ahh what an honor :)  \nvmassol - (14:04): (jconsole doesn't have the nicest UI but it'll do for now and any jmx console will work)  \nvmassol - (14:04): I apologize that I thought this script was done by Ludovic when it was written by you!  \nCalebJamesDeLisl - (14:05): As soon as this security crap settles down and I have some more changes for invitation, I'll be able to spend some time working on putting the cache where it belongs.  \nvmassol - (14:05): what cache?  \nCalebJamesDeLisl - (14:05): The celocity cache.  \nCalebJamesDeLisl - (14:05): \\*v  \nvmassol - (14:05): I don't understand  \nvmassol - (14:05): the velocity cache is in its right place  \nvmassol - (14:05): ie inside velocity  \nCalebJamesDeLisl - (14:05): Well IMO the macro cache should be stored with the documents so it doesn't grow endlessly.  \nvmassol - (14:06): that's what I'm fixing  \nvmassol - (14:06): but I'm inventing another cache  \nvmassol - (14:06): I'm just fixing our usage of velocitry  \nvmassol - (14:06): which we've used wrongly  \nflorinciu left at 14:06 (Ping timeout: 264 seconds  \nCalebJamesDeLisl - (14:06): Are you going to fix the fact that \\_everything is global\\_  \nvmassol - (14:06): s/inventing/not inventing/  \nCalebJamesDeLisl - (14:06): ?  \nevalica left at 14:06 (Ping timeout: 260 seconds  \nvmassol - (14:06): no not everything is global  \nvmassol - (14:06): that's why it leaks btw  \nvmassol - (14:07): we have:  \nCalebJamesDeLisl - (14:07): everything in 2.0 is global.  \nvmassol - (14:07): yes I'm fixing that one too  \nvmassol - (14:07): again it's a wrong usage  \nvmassol - (14:07): of velocity  \nvmassol - (14:07): (we're passing the same template all the time)  \nmariusbutuc left at 14:07 (Ping timeout: 240 seconds  \nmflorea left at 14:08 (Ping timeout: 252 seconds  \nvmassol - (14:08): that's http://jira.xwiki.org/jira/browse/XWIKI-5278  \nsburjan left at 14:08 (Ping timeout: 260 seconds  \nevalica joined #xwiki at 14:08  \nCalebJamesDeLisl - (14:08): Yup, and interesting things happen when you type #macro(lightbox...  \nEnygma` left at 14:08 (Ping timeout: 276 seconds  \nvmassol - (14:09): to fix this one, I'll introduce a notion of source in the rendering engine  \nvmassol - (14:09): (a generic notion of source)  \nvmassol - (14:09): source as in location  \nCalebJamesDeLisl - (14:09): What I was thinking was to put the macros with the document where they were written.  \nCalebJamesDeLisl - (14:10): Then load all macros from the current document into the context.  \nvmassol - (14:10): yes the template name used will the name of the document where they are written  \nvmassol - (14:10): (this is the source)  \nCalebJamesDeLisl - (14:10): K. If document A includeForm's documentB does documentB get to have documentA's macros?  \nvmassol - (14:11): no  \nmflorea joined #xwiki at 14:11  \nCalebJamesDeLisl - (14:11): And can documentA includeForm documentB and et to have documentB's macros?  \nevalica1 joined #xwiki at 14:11  \nvmassol - (14:12): each velocity macro is registered in velocity using a template name being the name of the xwiki document where the macro is defined  \nevalica left at 14:12 (Ping timeout: 264 seconds  \nEnygma` joined #xwiki at 14:13  \nsburjan joined #xwiki at 14:13  \nCalebJamesDeLisl - (14:13): I think you're going to break stuff then. Not sure but I think there is code relying on the ability to include a document then have it's macros.  \nvmassol - (14:14): yes of course  \nCalebJamesDeLisl - (14:14): What happens if documentA {{include context=same}} document b?  \nvmassol - (14:14): hmmm  \nvmassol - (14:14): you mean  \nCalebJamesDeLisl - (14:15): DocumentB's macros get attached to documentA --> leak.  \nvmassol - (14:15): {{include doc=\"some doc defining a macro}}  \nCalebJamesDeLisl - (14:15): yup.  \nvmassol - (14:15): {{velocity}}use that macro  \nCalebJamesDeLisl - (14:16): You don't even need to use the macro, just including it in the same context I think there is no way to tell that documentB content is not part of documentA  \nvmassol - (14:16): if you're talking about the source notion that's what I'll add  \nCalebJamesDeLisl - (14:17): What I was thinking would be best is to store the macros in the XWikiDocument. Then they go away when the cache expires.  \nCalebJamesDeLisl - (14:17): And when a document is loaded into the context, it;s macros are added to a set of macros in the context.  \nCalebJamesDeLisl - (14:19): The other advantage is you can rely on the cached macros, at the moment, no cached macros are really used except in the cases of #includeForm, and the macros in macros.vm  \nCalebJamesDeLisl - (14:20): \\* I would also do this for the parsed velocity trees which don't seem to be cached at them moment.  \ntmortagne - (14:22): abusenius: why didn't you attached the patch in http://jira.xwiki.org/jira/browse/XWIKI-5275 jira issue since it looks like it's the one for which you did it ?  \ntmortagne - (14:23): also you have a modification in MacroTransformation that is just codestyle  \nsburjan - (14:30): vmassol : what would be the default behavior of DOcument Templates, if one is active on all categories, i create a page using the template, and then I restrict the template only to blog. should be there error preventing me to do this, or the objects from the restricted category created before adding the restriction ?  \nvmassol - (14:30): sburjan: no idea, you should ask jvdrean  \nsburjan - (14:31): okay  \nabusenius - (14:33): tmortagne: well, that issue was the original  \nabusenius - (14:33): the other is a public clone  \ntmortagne - (14:34): the \"original\" seems very generic  \nabusenius - (14:34): well, the actual reported problem  \nabusenius - (14:35): (confidential)  \nabusenius - (14:36): re codestyle - might have overlooked this, the change is based on an olde version of the patch  \ntmortagne - (14:37): btw don't put comment with jira issue number in it, if there is not logical explanation for the code it should not be there. In this case it's more an improvement of what i done for XWIKI-5230 so it's really not directly related to XWIKI-5275  \nabusenius - (14:37): ok  \nCalebJamesDeLisl - (14:38): abusenius: Vincent and I were talking earlier about maybe making your patch into component which could be switched out.  \nabusenius - (14:38): toc macro seems to work as intended tough  \ntmortagne - (14:38): abusenius: not all uses case atually  \nabusenius - (14:38): re marker blocks would implement a new interface, it doesnt, the \\*ScriptMacro implement it, and I'm checking that  \ntmortagne - (14:39): there is a use case where toc macro try to find in which setcion it's located  \ntmortagne - (14:39): to only produce a toc for this section  \nFreud\\_ is now known as dlindgren (3e1476d4@gateway/web/freenode/ip.62.20.118.212  \ntmortagne - (14:39): CalebJamesDeLisl: abusenius's patch has been completely change from the first version  \nabusenius - (14:39): ah, ok, well if it fixes that, then it should better be another issue number  \nCalebJamesDeLisl - (14:40): tmortagne: I have read today's version.  \nCalebJamesDeLisl - (14:40): It might be nice if the user can decide whether to use the nestable script macro component or the non nestable script macro implementation.  \nabusenius - (14:40): CalebJamesDeLisl: I added configuration option an hour ago or so  \nCalebJamesDeLisl - (14:40): K checking the config.  \nabusenius - (14:41): (still reading the discussion)  \ntmortagne - (14:41): CalebJamesDeLisl: that's why i asked abusenius to add configuration for it  \nCalebJamesDeLisl - (14:42): Yup this is what vmassol didn't want.  \nCalebJamesDeLisl - (14:42): I can see the reasoning too.  \nvmassol - (14:43): (it's just object design vs non object design)  \nCalebJamesDeLisl - (14:44): abusenius: Sorry to ask for the 10,000th iteration of the patch but is there any way we can have 2 implementations of script macro, one is the old version and one the new version?  \nCalebJamesDeLisl - (14:45): then the user can simply switch by changing the components-overrides.txt file.  \ntmortagne - (14:45): CalebJamesDeLisl: it's not that simple  \ntmortagne - (14:45): there is not just one scipr macro  \ntmortagne - (14:45): thesere is one macro for each script macro  \ntmortagne - (14:45): groovy, velocity, etc.  \nCalebJamesDeLisl - (14:45): Hmm. good point.  \nabusenius - (14:47): IMO doing it in the base class is the best in this case  \nabusenius - (14:47): it forces all macros to be either nestable or not  \nabusenius - (14:47): (scripting macros)  \nCalebJamesDeLisl - (14:47): Then each macro has to decide what it's going to extend.  \ntmortagne - (14:47): also \"the user can simply switch by changing the components-overrides.txt\", i would not say \"simply\"...  \ntmortagne - (14:48): configuration make more sense here  \ntmortagne - (14:48): user/admin decision=configuration for me  \nCalebJamesDeLisl - (14:48): simply means not unpacking a jar or recompiling. But I am starting to agree.  \nvmassol - (14:51): any if is bad design in an object oriented design  \nvmassol - (14:51): got to go  \nsilviar joined #xwiki at 14:52  \nCalebJamesDeLisl - (14:52): Looking at the source to make sure we're not missing anything.  \ndlindgren left at 14:52 (Quit: Page closed  \nCalebJamesDeLisl - (14:55): Yea, looks like Alex's patch is the only way at this point. If VelocityMacro @Required DefaultScriptMacro we'd be fine but it doesn't.  \nlucaa joined #xwiki at 14:55  \nCalebJamesDeLisl - (14:56): What happens if we apply this patch and then later we find a better way? Is changing out of the question?  \nflorinciu joined #xwiki at 14:57  \nabusenius - (14:58): if we find a better solution we can always refactor/revert it, why not?  \nabusenius - (14:59): removing a restriction is not going to break anything  \nCalebJamesDeLisl - (15:00): I meant we find a better way to prevent nested macros (which are evil) \u00a0Well it will sort of break the configuration but I think we need to be amenable to (especially new) api changing.  \ntmortagne - (15:01): all abusenius did in internal so it's easy to change after (that's why i insisted on that)  \ntmortagne - (15:01): s/in/is/  \nCalebJamesDeLisl - (15:02): Except for the configuration parameter.  \ntmortagne - (15:03): CalebJamesDeLisl: be able to decide if we want nested macro or not has nothing to do with the way to actually do it  \ntmortagne - (15:04): admin will always prefer it to be in the configuration instead of having to play with jar files  \nCalebJamesDeLisl - (15:04): Well Vincent was not in favor of having such a configuration parameter at all. components-overrides.txt would be nice but I don't see a way.  \nsburjan left at 15:06 (Quit: Ex-Chat  \ntmortagne - (15:06): CalebJamesDeLisl: there is always a way, abusenius have an internal component which is used to find if the macro is a nested macro, you can always override it and always return false or something  \nCalebJamesDeLisl - (15:06): Ok. +1 for Alex's patch in it's current form (- code style change which confuses things)  \nCalebJamesDeLisl - (15:07): Do we set \"no recursion\" by default?  \ntmortagne - (15:07): but again saying to an admin \"to enable nested script for backward cmpatibility your have to add a jar file and modify create some components-overrides.txt file\" is not very nice  \ntmortagne - (15:08): CalebJamesDeLisl: yep i think  \nabusenius - (15:08): yes  \ntmortagne - (15:08): otherwise it's pretty useless :)  \nCalebJamesDeLisl - (15:08): +1 yes things should be safe by default.  \nCalebJamesDeLisl - (15:14): abusenius: When you're designing the CSRF token scripts, avoid what ever jira did.  \nabusenius - (15:18): what did they?  \nCalebJamesDeLisl - (15:20): constant \"token expired\" spam.  \nabusenius - (15:22): well, at the moment they don't expire at all :) this is a todo  \nabusenius - (15:24): in my case you would be redirected to a confirmation page  \nabusenius - (15:24): except for ajax requests  \nCalebJamesDeLisl - (15:28): Well as long as it's more than jira's expiration time. 10 seconds should do it ;)  \nplunden left #xwiki at 15:50  \nlucaa left at 16:07 (Quit: Leaving.  \nlucaa joined #xwiki at 16:07  \nlucaa left at 16:42 (Ping timeout: 265 seconds  \nsilviar left at 16:47 (Quit: Leaving.  \nlucaa joined #xwiki at 16:51  \nlucaa - (17:02): hi guys. I have a little question about macros in wiki pages. When are they parsed and registered as macros?  \nlucaa - (17:02): I imported a .xar containing such a macro, tried to view a page that used it and said macro doesn't exist  \nlucaa - (17:03): then I thought to resave the page, and it worked.  \nlucaa - (17:03): It shouldn't be a rights issue, I unchecked import as backup package to import as Admin, and I also looked at the history of the macro and it's only one author, the admin  \nlucaa - (17:03): the default Admin that is, which should have programming rights  \ntmortagne - (17:03): lucaa: it's supposed to be when the page is saved and so also when you import it, if you don't have it it looks like a bug  \nlucaa - (17:03): lemme check again with import as backup, maybe it's an import bug  \ntmortagne - (17:04): could be that the import doe snot send proper page modification event or something also  \nlucaa - (17:04): yes  \ntmortagne - (17:05): but last time i checked it did produce an event (i'm using it in XEM for example to register translations)  \nlucaa - (17:07): also tried with import as backup  \nlucaa - (17:07): still doesn't work  \nlucaa - (17:07): but something is strange  \nlucaa - (17:07): because I have more macros  \nlucaa - (17:07): and it seems somehow it worked for others  \nlucaa - (17:08): hmm... there must be something else  \nvmassol - (17:23): back  \nvmassol - (17:25): tmortagne: since the xwiki rendering should be able to be used outside of xwiki and for any use case I'm not sure it's a good idea to have the nested script restriction hardcoded.Yes we can always change it later.  \nvmassol - (17:26): (if it's only internal then it's good already - thought alex had to modify MacroBlock)  \nlucaa left at 17:26 (Read error: Connection reset by peer  \nflorinciu left at 17:37 (Quit: Leaving.  \nlucaa joined #xwiki at 17:41  \nEnygma` left at 17:48 (Ping timeout: 240 seconds  \nCalebJamesDeLisl - (17:50): Is it ok to say \"The content should be functional without javascript.\" in best practices?  \nCalebJamesDeLisl - (17:51): I \\_think\\_ that's somewhere in the wcag standard.  \nlucaa1 joined #xwiki at 17:54  \nlucaa left at 17:54 (Read error: Connection reset by peer  \nevalica1 left #xwiki at 17:54  \njvelociter - (17:54): what do you mean by content ?  \njvelociter - (17:56): I'd say something like \"The same level of functionality should be offered when JavaScript is not available\"  \njvelociter - (17:56): (CalebJamesDeLisl )  \nCalebJamesDeLisl - (17:57): Yea, words were evading me. It won't be the \"same\" level of functionality.  \nCalebJamesDeLisl - (17:58): Well actually it should. It would just be harder to achieve said functions.  \njvelociter - (17:58): I understand. The hard part to express is that you should be able to produce the same outcomes  \njvelociter - (17:58): exactly  \njvelociter - (17:58): like manipulating strings instead of checking box  \njvelociter - (17:58): or whatever makes it more difficult in the row UI  \njvelociter - (18:00): (and right now we are far from that since we cannot even go to the Administration section when JS is not available)  \njvelociter - (18:00): (although this one is not very hard to fix)  \nCalebJamesDeLisl - (18:01): I keep thinking that we ought to go to CSS layering for the menus but I don't want to even touch the CSS ;)  \nbblfish left at 18:02 (\\*.net \\*.split  \nbblfish joined #xwiki at 18:04  \nDragosRusu joined #xwiki at 18:07  \nCalebJamesDeLisl - (18:18): tmortagne: What happens if a user goes to the administration page without having gone to the search page first? (new import)  \ntmortagne - (18:21): CalebJamesDeLisl: what do you mean ?  \ntmortagne - (18:21): what search page has to do with admin ?  \nCalebJamesDeLisl - (18:21): I copied your method of creating the configuration page on first load.  \nCalebJamesDeLisl - (18:22): In Invitation if you go to the administration page before going to Invitation.WebHome, you don't see the invitation icon.  \nCalebJamesDeLisl - (18:22): Trying to figure out how you worked around that.  \ntmortagne - (18:23): (sorry if i'm not responding quickly i'm on the phone with vmassol)  \nCalebJamesDeLisl - (18:24): No pb.  \ntmortagne - (18:26): CalebJamesDeLisl: search page does not create the configurable configuration page on first load  \ntmortagne - (18:27): what is dynamically created in a page containing the search options  \nvmassol - (18:27): CalebJamesDeLisl: IMO xwiki should work even when there's no xwiki.cfg or xwiki.properties meaning that the default values must be what we want to have as default config  \ntmortagne - (18:27): which is not the same thing than the configuration of the search admin  \nCalebJamesDeLisl - (18:27): tmortagne: Got it.  \ntmortagne - (18:28): the goal is to be able to import search app whihout having to take care of not overriding configuration  \ntmortagne - (18:28): admin configuration is not configuration for me it's extension point for developer  \nCalebJamesDeLisl - (18:29): vmassol: Yesterday we were talking about upgradeability and I thought we decided that default should be the old behavior.  \nCalebJamesDeLisl - (18:29): so that upgrades would maintain exactly the same behavior.  \nvmassol - (18:29): hehe I thought we decided the opposite  \nvmassol - (18:30): oh I see  \nvmassol - (18:30): hmm  \nCalebJamesDeLisl - (18:30): It would be better if the default was the new behavior. If anything breaks then people can change that line.  \nvmassol - (18:31): +1  \nvmassol - (18:31): (needs to in the release notes)  \nvmassol - (18:32): since security should be on by default  \nCalebJamesDeLisl - (18:32): haha release notes. it needs to be in an advisory.  \nvmassol - (18:32): in both yes  \nCalebJamesDeLisl - (18:33): yes. tmortagne: I disagree that the config parameter is not self explanitory, it's in a section under the heading \"Old renderer\"  \nCalebJamesDeLisl - (18:34): Oops, actually it says \"Rendering\" I would ratherchange the heading than the config parameter.  \nvmassol - (18:34): IMO we should follow the existing naming practice whatever it is  \nCalebJamesDeLisl - (18:36): xwiki.render.renderingorder was copying what was there.  \nvmassol - (18:36): yep  \nvmassol - (18:36): so I'm with you on that  \nvmassol - (18:37): +1 for renaming \"Rendering\"  \nvmassol - (18:37): (not sure to what though)  \nvmassol - (18:38): Rendering 1.0 is an option although it has no real significance since we never released a 1.0 version of the rendering  \nvmassol - (18:38): Old Rendering  \nvmassol - (18:38): Radeox-based Rendering maybe  \nCalebJamesDeLisl - (18:39): \"Syntax 1.0 Rendering Engine\" ?  \nvmassol - (18:39): yes that would do  \nCalebJamesDeLisl - (18:39): Ok, committing.  \nvmassol - (18:39): \"XWiki Syntax 1.0 Rendering Engine\"  \nvmassol - (18:39): to be precise  \nvmassol - (18:40): :)  \nvmassol - (18:40): we're gonna have a 2 line sentence soon ;)  \nvmassol - (18:40): Syntax 1.0 Rendering is acceptable  \nvmassol - (18:40): you choose  \nCalebJamesDeLisl - (18:44): Done. What say you about the 2.0 rendering patch?  \nCalebJamesDeLisl - (18:51): bbiab lunch  \nvmassol - (19:07): CalebJamesDeLisl: the build seems to fail on hudson  \nvmassol1 joined #xwiki at 19:16  \nvmassol left at 19:16 (Read error: Connection reset by peer  \nflorinciu joined #xwiki at 19:23  \nlucaa1 left at 19:25 (Ping timeout: 265 seconds  \nabusenius left at 19:25 (Read error: Operation timed out  \narkub left at 19:25 (Ping timeout: 258 seconds  \nlucaa joined #xwiki at 19:50  \njvdrean left at 19:55 (Quit: Leaving.  \nanamarias joined #xwiki at 20:02  \nmflorea left at 20:03 (Quit: Leaving.  \nCalebJamesDeLisl - (20:03): Ahh, that's what I get for not running it first.  \nlucaa left at 20:04 (Ping timeout: 264 seconds  \nabusenius joined #xwiki at 20:30  \nflorinciu left at 20:37 (Quit: Leaving.  \nanamarias left at 21:11 (Quit: anamarias  \nanamarias joined #xwiki at 21:14  \nflorinciu joined #xwiki at 21:16  \nlucaa joined #xwiki at 21:16  \njvdrean joined #xwiki at 21:17  \njvdrean left #xwiki at 21:17  \ntmortagne left at 21:32 (Quit: Leaving.  \nflorinciu left at 21:53 (Ping timeout: 265 seconds  \nmflorea joined #xwiki at 21:56  \nflorinciu joined #xwiki at 22:19  \ndlindgren joined #xwiki at 22:23  \nmflorea left at 22:40 (Quit: Leaving.  \nvmassol1 left at 23:27 (Quit: Leaving.  \nflorinciu left at 23:55 (Quit: Leaving.  \n\n"}