{"id": "dev:IRC.xwikiArchive20100830", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20100830", "title": "IRC Archive for channel #xwiki - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\ncjdelisle - (00:02): neruda: There isn't an official way for hiding spaces but you can add the space to \"blacklistedSpaces\" which is in xwikivars.vm if I'm not mistaken.  \ncjdelisle - (00:02): webapps/xwiki/templates/xwikivars.vm file and you add the spaces to blacklistedSpaces and they won't be shown to non admin users.  \ncjdelisle - (00:03): \\* Not to be considered hidden from a security standpoint.  \nflorinciu left at 00:41 (Read error: Connection reset by peer  \nlucaa joined #xwiki at 00:52  \nneruda - (00:53): cjdelisle: thanks  \nsdumitriu left at 01:00 (Ping timeout: 245 seconds  \nabusenius left at 01:59 (Read error: Connection reset by peer  \nvenkatesh joined #xwiki at 04:38  \nvenkatesh left at 06:31 (Ping timeout: 240 seconds  \nvenkatesh joined #xwiki at 06:47  \nneruda left #xwiki at 06:56  \nvmassol joined #xwiki at 07:44  \nvmassol left at 07:44 (Client Quit  \nvmassol joined #xwiki at 07:45  \nvmassol left at 07:46 (Client Quit  \nsdumitriu joined #xwiki at 08:04  \nsdumitriu left at 08:08 (Ping timeout: 265 seconds  \nsdumitriu joined #xwiki at 08:11  \nsilviar joined #xwiki at 08:21  \nlucaa left at 08:23 (Quit: Leaving.  \nlucaa joined #xwiki at 08:37  \ntmortagne joined #xwiki at 08:52  \nflorinciu joined #xwiki at 09:01  \nlpereira joined #xwiki at 09:04  \nsburjan joined #xwiki at 09:07  \nEnygma` joined #xwiki at 09:18  \nmflorea joined #xwiki at 09:19  \nsilviar1 joined #xwiki at 09:24  \nlucaa1 joined #xwiki at 09:24  \nlucaa left at 09:25 (Read error: Connection reset by peer  \nsilviar2 joined #xwiki at 09:25  \nsilviar left at 09:27 (Ping timeout: 265 seconds  \nsilviar1 left at 09:29 (Ping timeout: 265 seconds  \nevalica joined #xwiki at 09:32  \nasrfel joined #xwiki at 09:34  \narkub joined #xwiki at 09:41  \nsilviar2 left at 09:45 (Quit: Leaving.  \nlucaa1 left at 09:48 (Ping timeout: 272 seconds  \nsilviar joined #xwiki at 09:49  \nlucaa joined #xwiki at 09:52  \nlucaa left at 10:01 (Ping timeout: 264 seconds  \ncjdelisle - (10:06): sdumitriu: http://jira.xwiki.org/jira/browse/XE-702 commented.  \nsdumitriu - (10:12): cjdelisle: Fixed by explicitely listing the allowed values  \ncjdelisle - (10:12): ok  \nlucaa joined #xwiki at 10:13  \nvenkatesh left at 10:14 (Ping timeout: 276 seconds  \nabusenius joined #xwiki at 10:18  \ncjdelisle - (10:19): http://www.cs.virginia.edu/~dgm4d/papers/RadixSortTR.pdf <-- Fast sorting on cuda  \nvenkatesh joined #xwiki at 10:30  \nsilviar - (10:49): Hi sdumitriu ! Are there any \u00a0new features to document for the XE 2.5 M1 release notes in addition to the improved action menus (http://dev.xwiki.org/xwiki/bin/view/Drafts/25NewAndNoteworthy) ?  \nsdumitriu - (10:50): Hi silviar  \nsdumitriu - (10:50): Well, not yet, but I'm preparing some commits for today  \nsilviar - (10:50): ok  \nsilviar - (10:56): sdumitriu: There's an issue I asked your opinion about on Friday, but I don't think you got the chance to see it yet. I add a new attachment (e.g. an image on the Main WebHome) and click on the History tab. This is what the Summary looks like: Upload new image <a href=\"/xwiki/bin/downloadrev/Main/WebHome/ProfileMenu.png?rev=1.1\">ProfileMenu.png</a>  \nsilviar - (10:56): Shouldn't it be \"Upload new image ProfileMenu.png\" ?  \nsilviar - (10:56): Testing on the latest snapshot  \nsdumitriu left at 10:57 (Ping timeout: 264 seconds  \nabusenius - (11:13): hudson builds fail recently for strange reasons and java.io.IOException: Cannot allocate memory in the log  \nsilviar left at 12:11 (Quit: Leaving.  \nsilviar joined #xwiki at 12:35  \nsburjan - (13:45): abusenius, : ping  \nabusenius - (13:46): sburjan: pong  \nsburjan - (13:48): abusenius, : can you add me to the security meeting please ?  \nvenkatesh left at 14:00 (Ping timeout: 240 seconds  \nlucaa - (14:16): guys, it seems there is an issue with the new action menu on browser with smaller fonts. I commented and added a print screen to: http://jira.xwiki.org/jira/browse/XSCOLIBRI-221  \nsburjan` left at 14:27 (Read error: Connection reset by peer  \nsburjan` joined #xwiki at 14:28  \nflaviusolaru joined #xwiki at 15:55  \nsilviar left at 16:03 (Quit: Leaving.  \nlucaa - (16:03): guys, we discovered a pretty nasty bug with attachments, which cannot be saved now and then  \nlucaa - (16:03): I'm investigating to see why  \nsburjan left at 16:11 (Ping timeout: 272 seconds  \nflaviusolaru1 joined #xwiki at 16:29  \nlucaa left at 16:30 (Ping timeout: 240 seconds  \nflaviusolaru left at 16:31 (Ping timeout: 276 seconds  \nlucaa joined #xwiki at 16:33  \nevalica left at 16:45 (Read error: Connection reset by peer  \nevalica joined #xwiki at 16:46  \nflorinciu left at 16:57 (Read error: Connection reset by peer  \ntmortagne left at 16:58 (Quit: Leaving.  \nlpereira left at 17:00 (Quit: Leaving.  \ntmortagne joined #xwiki at 17:00  \nlucaa - (17:01): the attachments issue seems to be caused by an attachment with null content  \nlucaa - (17:02): which gets cloned and then asked isContentDirty() on  \nasrfel left at 17:03 (Quit: Leaving.  \nlucaa - (17:03): I tracked it to the document clone call in upload action XWikiDocument doc = (XWikiDocument) context.getDoc().clone(); where context.getDoc seems to have first attachment with a null content (my document that I get error for has 2 atatchments already)  \nlucaa - (17:03): I am trying to figure out why there is no content for attachment  \ncjdelisle - (17:07): I was just about to make a change to that because adding multiple attachments in one upload causes the first one to be updated to 1.2.  \nlucaa - (17:08): I'm trying with single attachment  \ncjdelisle - (17:09): No content in the attachment?  \ncjdelisle - (17:10): If saving the attachment fails, the document should not be saved and nothing should change, it's all done in one transaction now.  \nKermitTheFragger joined #xwiki at 17:10  \nKermitTheFragger left at 17:11 (Remote host closed the connection  \nKermitTheFragger joined #xwiki at 17:11  \ncjdelisle - (17:12): How new is the version you're using? r30754 fixed an old bug which caused isContentDirty to be completely unreliable.  \nsburjan` left at 17:13 (Ping timeout: 240 seconds  \nlucaa - (17:13): cjdelisle: \u00a0so, I had 2 attachments attached to a page. Then upgraded to the new war (one from today) , then tried to add another attachment. It didn't work at all. I tried again, it didn't work. I took the stack and looked at the stack. This is it http://pastebin.com/snjEqdaC  \nlucaa - (17:13): it also failed for silvia and sorin when they played around with attachments  \nlucaa - (17:14): but the tricky part is that it didn't always reproduce for them, for me it does, for this particular case  \ncjdelisle - (17:16): XWikiAttachment#isContentDirty() checks if the content exists before calling XWikiAttachmentContent#isContentDirty()  \ncjdelisle - (17:17): XWikiHibernateAttachmentStore#saveAttachmentContent skips right to content.isContentDirty which seems like a mistake.  \ncjdelisle - (17:18): Why anyone would want an attachment with no content I don't know but the use case needs to be supported.  \nlucaa - (17:18): cjdelisle: but is this normal? my attachment has content  \ncjdelisle - (17:19): If you download the attachment it shows content still?  \nlucaa - (17:19): lemme check  \nlucaa - (17:20): yep  \ncjdelisle - (17:21): Somehow the content is being removed. Both attachments on that page have content, maybe there is a third \"half attachment\" with no content?  \ncjdelisle - (17:22): It sounds like corruption, in any case I believe the code should try to fix corruption.  \nlucaa - (17:22): as I said above, sburjan and silviar also hit the issue  \nlucaa - (17:23): so if it's corruption, then someone does it, and it should not  \nlucaa - (17:24): also, it doesn't seem to be a third attachment, I can see 2 listed in the page and I can see 2 listed by the java debugger when I am in the upload action at document clone moment  \nlucaa - (17:24): except that the first of them has no content  \ncjdelisle - (17:24): Agreed. core is a pain. The original change I made was only a few lines, I have already exposed one latent bug. I'll have to debug this further to see if it's my fault or it's preexisting.  \ncjdelisle - (17:25): Oh so one of your attachments really has no content?  \nlucaa - (17:26): when debugging its content is null  \nlucaa - (17:26): when I download from the page they both have content  \ncjdelisle - (17:27): Are you using mysql? (don't know if it's important)  \nlucaa - (17:27): yes  \nlucaa - (17:27): sburjan and silviar have reproduced it with the .zip distro, with hsqldb  \ncjdelisle - (17:28): Well problem 1 is that saving an attachment with null content should not cause it to blow up. Problem 2 is to fund out why the content is being nulled.  \ncjdelisle - (17:30): I'm going to get something to eat and I'll be back and start testing.  \ncjdelisle - (17:32): You mind trying once again after restarting your wiki engine, you may be seeing content from the store on the hard disk when no content is actually in the db.  \ncjdelisle - (17:32): err there was supposed to be a '?' in there.  \nlucaa - (17:32): no, I don't want to restart  \nlucaa - (17:32): I want to still be able to reproduce to debug  \ncjdelisle - (17:33): Ok, another option is to try querying for the content in the db.  \nlucaa - (17:33): you're saying my attachment might be on the disc?  \nlucaa - (17:33): where?  \ncjdelisle - (17:34): Temporary space. UploadAction does that.  \ncjdelisle - (17:34): It's the cause of every claim I've heard that that the db is eating attachments.  \ncjdelisle - (17:35): They sit on the disk and don't go in the db, restart the engine and it's gone.  \nlucaa - (17:35): this is for what? for my attachment with null content?  \nlucaa - (17:35): that attachment is at least a week old in there  \nlucaa - (17:36): it was uploaded with an older version, I upgraded today the war, and I get this issue when I try to add another attachment  \ncjdelisle - (17:36): If the engine hasn't been turned off then data will last that long on the disk.  \nlucaa - (17:36): the one which is null is way old  \nlucaa - (17:36): it was  \ncjdelisle - (17:37): Ok. I'd still try querying for tha AttachmentContent  \nlucaa - (17:37): and, as I said, sburjan and silviar reproduced it quite easy  \nlucaa - (17:37): yday and today  \ncjdelisle - (17:37): Is it somethign I could write into a test?  \ncjdelisle - (17:39): bbiab food...  \nlucaa - (17:39): no, we don't know yet how it reproduces  \nlucaa - (17:39): ok, just queried the db, there seems to be quite some content in that attachment  \nlucaa - (17:41): shit, now it's working  \nlucaa - (17:42): I have to go now  \nlucaa - (17:42): ttyl  \nlucaa left at 17:47 (Ping timeout: 265 seconds  \nsdumitriu joined #xwiki at 18:06  \nsdumitriu left at 18:15 (Ping timeout: 240 seconds  \nsdumitriu joined #xwiki at 18:28  \nevalica left at 18:36 (Quit: Leaving.  \nabusenius left at 18:52 (Ping timeout: 272 seconds  \nflaviusolaru1 left at 18:52 (Quit: Leaving.  \nsburjan` joined #xwiki at 19:12  \nflaviusolaru joined #xwiki at 19:36  \ncjdelisle - (19:39): sburjan`: I understand there's a bug in attachments which you were able to reproduce, can you tell me what you did to make it show up?  \nsburjan` - (19:40): cjdelisle: are you refering to the test I sent to you ? or what bug ?  \ncjdelisle - (19:41): lucaa told me that there was an error which happened every once in a while (related to my change in the db driver.)  \nflorinciu joined #xwiki at 19:42  \nsburjan` - (19:44): well .. I got 2 types of error  \nsburjan` - (19:44): 3 actually  \nsburjan` - (19:44): in the console  \nsburjan` - (19:45): one of them, and the only one I was able to fully reproduce was ... adding tags to a page  \nsburjan` - (19:45): the other two were related to ataching files to a page or importing packges (those are the nasty ones)  \ncjdelisle - (19:45): Do you have stack traces of each?  \nsburjan` - (19:46): I added 4 files, and then I wasn't able to delete them. the dissapeared from the panel, but after refreshing the page, they weere still there  \nsburjan` - (19:46): I have, but they are at work  \ncjdelisle - (19:46): That's fine.  \nsburjan` - (19:46): the error were refering to some nasty hibernate errors  \nsburjan` - (19:47): and I got another type regarding Lucene  \ncjdelisle - (19:47): So you click the red x and say yes delete, then reload the page and they're back?  \nsburjan` - (19:47): but what can I say definetley is that upload system is critical blocker  \nsburjan` - (19:47): yes  \nsburjan` - (19:47): they dissaprea on ajax reload, but re-appear on full page reload  \nflorinciu left at 19:47 (Quit: Leaving.  \nsburjan` - (19:48): and I couldn identify a pattern to reproduce  \nsburjan` - (19:48): \\*couldn't  \ncjdelisle - (19:48): Those are the best kind of bugs :/  \nsburjan` - (19:48): but I'm +1 to stop the release of M1 untill we fix this  \nsburjan` - (19:48): yeah, this si the hardest bug I ever found  \ncjdelisle - (19:49): I changed about 3 lines in the attachment code because xmlrpc attachment and a document api didn't work. I have been mopping up messes ever since.  \nsburjan` - (19:49): I will help you investigate asap  \nsburjan` - (19:50): but you can check the att Tag error  \nsburjan` - (19:50): \\*add  \nsburjan` - (19:51): as far as I seen .. the interface reports that the files are attached, but they get stuck somewhere between hibernate and the db .. the UI doesnt break  \ncjdelisle - (19:52): That should have been fixed by my change.  \nsburjan` - (19:52): and lucaa reported some errors when a importing a page that has the # char in title. I didnt have time to investigate this  \nsburjan` - (19:55): can you confirm the Tags bug ?  \ncjdelisle - (19:56): Nope, haven't seen it yet. Rebuilding/updating...  \nsburjan` - (19:56): i tested with todays snapshot  \ncjdelisle - (19:57): I'll look at other real recent revisions, maybe it's not all my fault ;)  \nsburjan` - (19:58): in any case, this is new  \nmflorea left at 19:58 (Ping timeout: 260 seconds  \ncjdelisle - (19:59): Probably is my change (or latent bugs which I exposed)  \nflaviusolaru left at 20:00 (Quit: Leaving.  \ncjdelisle - (20:01): Thanks, I'll investigate more...  \narkub left at 20:07 (Ping timeout: 240 seconds  \nmflorea joined #xwiki at 20:15  \nlucaa joined #xwiki at 20:21  \nmflorea left at 20:34 (Quit: Leaving.  \ntmortagne left at 20:34 (Quit: Leaving.  \ntmortagne joined #xwiki at 20:43  \ntmortagne1 joined #xwiki at 20:43  \ntmortagne left at 20:43 (Read error: Connection reset by peer  \ntmortagne1 left #xwiki at 20:45  \ncjdelisle - (20:49): Looks like I found it. start engine, attach files, turn engine off, restart, try to attach another file.  \nlucaa - (20:52): yes, I think I reproduced it something like that as well  \ncjdelisle - (20:52): Attachments are lazy loaded. Cache makes the behavior very strange indeed.  \nsilviar joined #xwiki at 20:53  \nlucaa - (20:53): now I got a doc with 4-5 attachments and only one is loaded  \ncjdelisle - (20:53): When loadXWikiDoc is called?  \ncjdelisle - (20:54): loadXWikiDoc calls loadAttachmentsList which gets the attachments but not their content so null content in an attachment is normal.  \nlucaa - (20:56): wait, in loadXWikiDoc of the cache store  \nlucaa - (20:56): I still need to debug a bit more  \ncjdelisle - (20:57): That's what tripped us up. Once content is loaded and in the cache, it won'd be null.  \ncjdelisle - (20:57): I appreciate all of your help on this.  \nlucaa - (20:59): wait, I don't understand  \nlucaa - (20:59): it's normal that they are all null?  \ncjdelisle - (20:59): Yes because the content isn't loaded by XHS.loadXWikiDoc.  \nEnygma`1 joined #xwiki at 20:59  \nlucaa - (21:00): and this bug is like how old?  \nlucaa - (21:00): because I am quite surprised that we didn't find it until now...  \nlucaa - (21:00): if it's new, than I don't understand  \nlucaa - (21:00): the XWikiAttachmentStore didn't change, did it?  \ncjdelisle - (21:01): I just made a small change so XHS.saveAttachment called AttachmentStore.saveAttachmentContent.  \ncjdelisle - (21:01): This fixed xmlrps attachments.  \nEnygma` left at 21:01 (Ping timeout: 252 seconds  \ncjdelisle - (21:01): And opened a can (barrel) of worms  \ncjdelisle - (21:02): Some of the code I've seen has been untouched since r1065  \ncjdelisle - (21:04): The null attachment content on it's own is not incorrect (IMO) it saves memory. What's bad is that saveAttachment is now trying to dereference the AttachmentContent  \ncjdelisle - (21:06): XWikiAttachment#getContent(XWikiContext context) loads the content from the db if it's not there already so the api works correctly.  \ncjdelisle - (21:13): At the moment I'm too chicken to fool with AttachmentStore.saveAttachmentContent so I'm going to only call saveAttachmentContent from XHS.saveAttachment IF the content exists and is dirty.  \nlucaa - (21:14): I'm trying to find your changes caleb, to look at them and try to understand what happened  \ncjdelisle - (21:15): r30716  \ncjdelisle - (21:15): r30754 was patching an old bug which I exposed.  \nsburjan` - (21:16): it's good that you figured it out  \nKermitTheFragger left at 21:18 (Quit: Leaving  \nabusenius joined #xwiki at 21:20  \nlucaa - (21:43): cjdelisle: ok, I think I understand how did this happen  \nlucaa - (21:43): now  \nlucaa - (21:43): do you want me to report / reopen / comment on any issue?  \nlucaa - (21:43): are you handling the fix?  \ncjdelisle - (21:45): I have a patch, I'm going to start testing it now.  \nlucaa left at 22:06 (Ping timeout: 265 seconds  \nlucaa1 joined #xwiki at 22:06  \nsburjan` - (22:19): what was the problem ? (I'm just curoius)  \nsburjan` - (22:19): \\*curious  \ncjdelisle - (22:20): When you load a document, it loads the attachments with that document.  \ncjdelisle - (22:20): But it doesn't load the content for the attachments, nust some metadata about them.  \nlucaa1 left at 22:20 (Ping timeout: 240 seconds  \ncjdelisle - (22:21): So there is a field XWikiAttachment.attachment\\_content which is null.  \ncjdelisle - (22:21): If you noticed that \"attachment\\_content\" is improper code style, you are correct, this is very old code.  \ncjdelisle - (22:22): Anyway, there are attachments on the document who's content is null.  \ncjdelisle - (22:22): This is a good thing because it keeps the memory usage down.  \ncjdelisle - (22:22): If you don't need to download an attachment it need not be hauled up into memory.  \ncjdelisle - (22:23): When you save a document, it saves the attachments.  \ncjdelisle - (22:23): The change I made was to make it so it also saves the content of the attachments.  \ncjdelisle - (22:24): The way it used to work is the saveAttachmentContent call was made in the UploadAction which meant UploadAction was the only working way to save attachments.  \nsilviar left at 22:24 (Quit: Leaving.  \ncjdelisle - (22:24): (XML-RPC and Document.addAttachment did not work, they silently failed.)  \n\n"}