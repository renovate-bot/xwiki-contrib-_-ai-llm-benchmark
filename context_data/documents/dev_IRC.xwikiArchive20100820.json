{"id": "dev:IRC.xwikiArchive20100820", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20100820", "title": "IRC Archive for channel #xwiki - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\npenyaskito\\_ joined #xwiki at 00:30  \npenyaskito left at 00:33 (Ping timeout: 252 seconds  \njvelociter left at 00:38 (Quit: jvelociter  \nsdumitriu left at 02:22 (Ping timeout: 260 seconds  \njvelociter joined #xwiki at 02:39  \nabusenius left at 03:15 (Ping timeout: 258 seconds  \nSvenDowideit left at 04:07 (Ping timeout: 240 seconds  \nSvenDowideit joined #xwiki at 04:08  \nsilviar joined #xwiki at 08:40  \nkibahop joined #xwiki at 08:41  \nkibahop left #xwiki at 08:41  \ntmortagne joined #xwiki at 08:49  \nsdumitriu joined #xwiki at 09:08  \nsilviar left at 09:46 (Quit: Leaving.  \nsilviar joined #xwiki at 09:52  \nasrfel joined #xwiki at 09:54  \ntmortagne left at 10:02 (Quit: Leaving.  \ntmortagne joined #xwiki at 10:03  \nsburjan joined #xwiki at 10:08  \nabusenius joined #xwiki at 10:21  \ncjdelisle - (10:34): while [ 1 -eq 1 ]; do top -b -n1 | sed -n -e '8,8 p' >> top.hogs; sleep 1; done;  \ncjdelisle - (10:34): fix that sneaky process that kills my music with 100% cpu for 5 seconds then hides everytime I'm looking at top.  \njbrBridge left at 10:42 (Ping timeout: 265 seconds  \njbrBridge joined #xwiki at 10:43  \nfmancinelli joined #xwiki at 10:43  \nabusenius - (10:43): cjdelisle: hi, so what was your idea for a test?  \ncjdelisle - (10:44): Look for double escaped characters.  \nabusenius - (10:44): ah, ok, that's already on my todo list  \ncjdelisle - (10:45): We can't guarantee that there should never be &amp;amp; in a document but I think if it's in a test it should raise a flag.  \nabusenius - (10:45): yes, we could use the same approach to try all parameters, but look for url(url(test string))  \nabusenius - (10:46): s/url/xml/  \nabusenius - (10:46): (would double the number of tests)  \ncjdelisle - (10:48): only 25 days of uptime and I got processes freaking out. even killed the bridge.  \nabusenius - (10:48): btw, should I sens yet another proposal/vote before actually moving escaping tests? :)  \ncjdelisle - (10:48): maybe just a \"heads up, committing\".  \nabusenius - (10:49): yea, I'll answer to the last proposal  \nabusenius - (10:53): tmortagne: do you have some time?  \ntmortagne - (10:56): abusenius: not yet sorry, give me 1h max  \nnickless joined #xwiki at 10:56  \njbrBridge left at 10:56 (Remote host closed the connection  \njbrBridge joined #xwiki at 10:56  \nlucaa left at 10:57 (Ping timeout: 240 seconds  \nfmancinelli left at 10:58 (Ping timeout: 260 seconds  \nabusenius left at 10:58 (Ping timeout: 252 seconds  \nnickless is now known as abusenius ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \ncjdelisle - (10:58): !shutdown  \njbrBridge left at 10:58 (Remote host closed the connection  \njbrBridge joined #xwiki at 10:59  \nfmancinelli joined #xwiki at 10:59  \nabusenius - (11:01): cjdelisle: do you mind closing http://jira.xwiki.org/jira/browse/XWIKI-4757? it should be fixed by now  \ncjdelisle - (11:02): ahh yes, whenever I assigned myself I found I couldn't close the issue either.  \ncjdelisle - (11:03): integration tested?  \nabusenius - (11:03): I'd say so  \nabusenius - (11:04): (escaping tests)  \ncjdelisle - (11:04): closed.  \nabusenius - (11:04): thx  \ncjdelisle - (11:05): just restarted and forked all processes which were running in terminal. Killed the last terminal and it took like 15sec and freed like 100M of memory.  \nabusenius - (11:07): :)  \ncjdelisle - (11:07): oh right. 20,000 line backscroll.  \nabusenius - (11:07): I also have an impression tht some programs leak memory after several days  \ncjdelisle - (11:08): evince.  \ncjdelisle - (11:08): firefox.  \nabusenius - (11:08): no, I tried restarting almost all of them  \ncjdelisle - (11:08): 1Gb swap space? wipe out all those pdfs.  \nabusenius - (11:08): it must be X or kwin or something like that  \ncjdelisle - (11:10): ff used to be bad. kill that and there goes 800M of ram and 500 of swap.  \nabusenius - (11:10): ff is not that bad for me, but eclipse also tends to eat all my memory  \nabusenius - (11:11): like now, 700M for displaying itself...  \ncjdelisle - (11:12): yea eclipse is huge. FF is much better now. I think it implements it's own \"swap space\" million tabs build up and like 200M of memory?  \nabusenius - (11:14): maybe, + add-ons (especially flash) need a lot  \nabusenius - (11:15): good that nowerdays it is possible to kill flash separately  \ntmortagne - (11:23): abusenius: back  \nabusenius - (11:23): cool  \nabusenius - (11:23): so, I was playing around with events  \nabusenius - (11:23): for refactoring abstract macro  \nabusenius - (11:24): seems to work so far  \ntmortagne - (11:24): ok cool  \nlucaa joined #xwiki at 11:24  \nabusenius - (11:24): now the question is, will 2 different events sent by the same thread be handled in the same thread if there is one listener?  \nabusenius - (11:25): I used threadlocal to store the original class loader  \ntmortagne - (11:26): events are always sent in the thread of the event caller  \ntmortagne - (11:26): also no need to use your own threadlocal  \ntmortagne - (11:26): use the context  \ntmortagne - (11:26): executioncontext  \ntmortagne - (11:26): it's here for that  \nabusenius - (11:26): good  \nabusenius - (11:26): ah, ok  \nabusenius - (11:27): I can upload the patch of the changes so far somewhere if you want to have a look  \nabusenius - (11:28): I basically moved class loader stuff and nested validator to listeners  \nabusenius - (11:28): and added 2 events, script execution starts and script execution finished  \nabusenius - (11:28): the first one is cancelable  \ntmortagne - (11:29): ok sounds good  \nabusenius - (11:29): I'd say validators can be removed, liteners are nicer  \ntmortagne - (11:30): yep i agree  \ntmortagne - (11:30): what do you send with the event starts event ?  \ntmortagne - (11:31): as datas i mean  \ntmortagne - (11:32): s/event starts event/script starts event/  \nabusenius - (11:32): context and macro parameters  \nabusenius - (11:32): (transformation context)  \ntmortagne - (11:32): context is useless  \nabusenius - (11:33): why?  \ntmortagne - (11:33): it's a bad thing that is done in old document events  \ntmortagne - (11:33): because context is already in threadcontext  \ntmortagne - (11:33): any component can access the context  \nabusenius - (11:33): ok, then it is not needed  \ntmortagne - (11:34): so we should not give it as parameter anymore since it was the goal  \ntmortagne - (11:34): to sumurize don't try to mimic document events  \ntmortagne - (11:34): do what make sense for you event  \ntmortagne - (11:35): i'm not sure about macro parameters  \ntmortagne - (11:35): it should maybe be something more generic  \nabusenius - (11:35): class loader code uses them to get the jars  \ntmortagne - (11:35): actually no forget that  \ntmortagne - (11:36): the validation needs macro informations anyway  \ntmortagne - (11:36): to get macro parents etc.  \ntmortagne - (11:37): so it's a macro specific event actually but it's ok I guess  \nabusenius - (11:37): if it stored in thread context, it could take it frome htere  \ntmortagne - (11:39): no it's difficult to know for the listener if it's a script executed by another script or really the content of the macro, i think we should keep it the way you did  \ntmortagne - (11:39): anyway there will be a discussion on the mailing list for it  \nabusenius - (11:39): ok  \nabusenius - (11:40): btw, why does onEvent have Object as data parameters and is not generic instead?  \ntmortagne - (11:40): because a listener can register to several events  \ntmortagne - (11:40): for example remote event manager register to all events  \nabusenius - (11:41): ah, I see  \ntmortagne - (11:44): btw we should use the same thing to check for programming right in script macros other that velocity, i never liked the fact that theses macro depends on this concept at rendering level  \nabusenius - (11:47): right, it would be something like ListeningPremissionChecker  \nabusenius - (11:47): (btw. if you have an idea how to call classes that listent to execution start and finish to set something up for the execution, let me know)  \nabusenius - (11:48): I called them ListeningScriptClassLoader and ListeningNestedScriptMacroValidator  \ntmortagne - (11:51): abusenius: better put \"Listener\" at the end of the class name  \ntmortagne - (11:51): NestedScriptMacroValidatorListener  \nabusenius - (11:51): ok  \nabusenius - (11:52): ScriptClassLoaderListener doesn't sound right though  \ntmortagne - (11:52): that's usually how we name on implementation of an interface  \ntmortagne - (11:52): yep  \ntmortagne - (11:52): let me think  \ntmortagne - (11:54): nop no better name yet  \ntmortagne - (11:56): also i'm think that's maybe not the right way deal with script macros classloader  \ntmortagne - (11:57): i don't really speak about events but more the fact that we put set the classloader which in the same for all script macro at the beginig of each macro  \ntmortagne - (11:57): we should probably set it at the \u00a0beginning of the rendering  \ntmortagne - (11:57): and then when a macro comes with some jar add them to it when needed  \nabusenius - (11:58): so usually, those methods return the same class loader, unless there are custom params?  \ntmortagne - (11:59): there is actually two aspect in this classloader things:  \ntmortagne - (11:59): - inject jars  \ntmortagne - (11:59): - keep the same classloader for all macros to share classes definied in the script with a following one  \ntmortagne - (12:01): so all script macros use the same classloader  \ntmortagne - (12:02): if you look at findClassLoader you will see that the script classloader is stored in the execution context  \nabusenius - (12:03): yea, allready using it instead of threadlocal  \nabusenius - (12:03): naming idea: ScriptClassLoaderChooserListener ?  \nabusenius - (12:03): or Selecter  \ntmortagne - (12:04): selector is better yes  \ntmortagne - (12:04): or Setter maybe  \ntmortagne - (12:04): could be Manager actually  \ntmortagne - (12:05): what do you do in the listener ?  \ntmortagne - (12:05): just the set or also the jar part ?  \ntmortagne - (12:05): ScriptClassLoaderHandlerListener  \nabusenius - (12:05): also the jar stuff  \nabusenius - (12:06): all the private related methods from abstract macro  \nabusenius - (12:06): getClassLoader() uses all of them  \ntmortagne - (12:07): yep, that will be a big cleanup of AbstractScriptMacro  \nabusenius - (12:07): btw, clirr complains if I remove protected getClassLoader(), is it really an issue?  \ntmortagne - (12:08): well he is kind of right, since it's a public class, someone would extends this protected method to provide a diff\u00e9rent classloader in his script macro  \nabusenius - (12:09): I doubt somebody actually did  \ntmortagne - (12:10): usually vmassol put private until he really need protected, maybe velocity macro use it some way ?  \ntmortagne - (12:11): no it does not  \nabusenius - (12:12): maybe it used to, but was allready refactored?  \ntmortagne - (12:12): anyway clirr is right and it's an API breakage, if someone really needs to change the way to deal with classloader for some script macro it will become difficult  \ntmortagne - (12:13): abusenius: i don't think so  \nabusenius - (12:13): so, deprecate, return null by default?  \nabusenius - (12:13): or parent class loader  \ntmortagne - (12:14): deprecate it would not change anything  \ntmortagne - (12:14): since you don't use it anymore in AbstractScriptMacro  \ntmortagne - (12:14): that is what really break the API actually  \ntmortagne - (12:14): better remove it completely that keep it unused  \nabusenius - (12:15): ok, so remove and document  \nabusenius - (12:15): same with canHaveJarsParameters  \ntmortagne - (12:15): at least that way some one that want to migrate his macro for 2.5 would see the method doe snot exist anymore and he have to change something  \nabusenius - (12:15): but they might be used in groovy  \ntmortagne - (12:16): WDYM ?  \nabusenius - (12:16): canHaveJarsParameters() is also used in class loader code only  \nabusenius - (12:17): and is protected  \ntmortagne - (12:17): I meant what do you mean by \"but they might be used in groovy\" ?  \nabusenius - (12:17): they = it, forget it, it is not used :)  \ntmortagne - (12:18): ok  \ntmortagne - (12:19): (groovy macro only exist to declare the \"groovy\" shortcut for what is actually entirely implemented in AbstractJSR223ScriptMacro)  \nabusenius - (12:19): how do I convince clirr that removing those methods is what I want?  \ntmortagne - (12:20): you set in in the core-parent pom.xml  \ntmortagne - (12:20): look at the end  \ntmortagne - (12:21): make me think we need to remove most of it now that 2.4 is released  \nabusenius - (12:21): found  \ntmortagne - (12:21): could you remove then when adding yours ?  \nabusenius - (12:21): shouldn't we change the version to compare to 2.4?  \ntmortagne - (12:21): yep  \nabusenius - (12:21): sure  \ntmortagne - (12:23): the only issue with script class loader listener is that it make it more difficult to understand script macro behavior  \ntmortagne - (12:23): when looking at the code  \nabusenius - (12:26): yes, it is not obvious, maybe I should explain it a bit in the class comment  \nabusenius - (12:28): <!-- Moved internal classes that should have been in the internal package to the internal package -->  \nabusenius - (12:28): should it also go away?  \nabusenius - (12:28): org/xwiki/query/xwql/\\*\\*/\\*<  \ntmortagne - (12:28): that's 2.4 too if i remember well  \nabusenius - (12:32): what about protected fields that are not used any more (but used in subclasses)  \nabusenius - (12:32): ?  \ntmortagne - (12:33): you mean componentmanager ?  \nabusenius - (12:33): document access bridge  \ntmortagne - (12:33): you should probably deprecate it if fix subclasses you know about  \nabusenius - (12:34): for component menager too  \ntmortagne - (12:34): s/if fix /and fix /  \nabusenius - (12:35): ah, component manager is used  \nabusenius - (12:36): and doc access bridge is used in canExecuteScript() in JSR223, it should be moved there imo  \ntmortagne - (12:37): i can't find canExecuteScript in AbstractScriptMacro  \ntmortagne - (12:38): I have in only in JSR223  \nabusenius - (12:38): yes, thats what I meant  \nabusenius - (12:38): getComponentManager() is used to get parser  \ntmortagne - (12:39): ha sorry i missread  \ntmortagne - (12:39): yep document access bridge has nothing to do in AsbtractScriptMacro it seems  \nabusenius - (12:45): what is the reason to deprecate fields, but not methods?  \ntmortagne - (12:47): it's not about methods vs fields  \ntmortagne - (12:47): i did not said you should not deprecate methods  \ntmortagne - (12:48): thee issue with getClassLoader is that a subclass don't use it, it's supposed to overwrite it  \ntmortagne - (12:48): and then it's used by AbstractScriptMacro  \ntmortagne - (12:48): so even if you deprecate it it's still broken  \ntmortagne - (12:49): since abstractscriptmacro does not use it anymore  \ntmortagne - (12:49): so it's better to remove it so that nobody think of overwriting it  \ntmortagne - (12:50): basically you deprecate something when you can make it still work  \ntmortagne - (12:51): otherwise it's a trap  \nabusenius - (12:51): I see  \ntmortagne - (12:51): i have to go  \ntmortagne - (12:51): good luck ;)  \ntmortagne left at 12:52 (Quit: Leaving.  \nsilviar left at 13:07 (Quit: Leaving.  \nsdumitriu - (13:25): abusenius: Can you check now if you can close issues?  \nsdumitriu - (13:26): I think Jira didn't actually save my changes yesterday  \nfmancinelli left at 13:58 (Ping timeout: 240 seconds  \nnickless joined #xwiki at 13:58  \nabusenius left at 13:58 (Ping timeout: 258 seconds  \nfmancinelli joined #xwiki at 13:59  \nnickless is now known as abusenius ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nabusenius - (14:00): ah, seems to work now, thanks  \nabusenius - (14:01): sdumitriu: I guess http://jira.xwiki.org/jira/browse/XWIKI-4756 should be closed now  \nsdumitriu - (14:03): You should run the command from the first comment and see if all the results are escaped  \nabusenius - (14:04): running... (but now there are escaping tests for that doing much better job btw)  \nsdumitriu - (14:05): Yep, I know  \nsdumitriu - (14:05): Just to check \\*that\\* issue  \nabusenius - (14:08): ok, I'll leave it for later, it requires looking at the templates yet again  \nabusenius - (14:08): but I'm quite sure that templates [a-m]\\*.vm are fixed  \nabusenius - (14:09): (with a few know exceptions)  \nsilviar joined #xwiki at 14:31  \nnickless joined #xwiki at 15:08  \nabusenius left at 15:08 (Ping timeout: 272 seconds  \nSvenDowideit is now known as SvenDowide ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nSvenDowide is now known as SvenDowideit ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nnickless is now known as abusenius ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nSvenDowideit left at 15:15 (Changing host  \nSvenDowideit joined #xwiki at 15:15  \nsburjan left at 16:24 (Ping timeout: 252 seconds  \nsilviar left at 16:30 (Quit: Leaving.  \nEnygma` joined #xwiki at 16:33  \nevalica joined #xwiki at 16:48  \nlucaa left at 16:48 (Quit: Leaving.  \nevalica left at 16:49 (Read error: Connection reset by peer  \nasrfel left at 17:13 (Quit: Leaving.  \nfmancinelli left at 17:30 (Ping timeout: 276 seconds  \nabusenius left at 18:39 (Ping timeout: 240 seconds  \nfmancinelli joined #xwiki at 18:53  \nlucaa joined #xwiki at 18:54  \nfmancinelli left at 19:05 (Ping timeout: 246 seconds  \nEnygma`1 joined #xwiki at 19:34  \nEnygma` left at 19:36 (Ping timeout: 264 seconds  \nabusenius joined #xwiki at 19:57  \nlucaa left at 20:39 (Ping timeout: 265 seconds  \nnickless joined #xwiki at 20:50  \nabusenius left at 20:51 (Ping timeout: 245 seconds  \nnickless is now known as abusenius ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nnickless joined #xwiki at 21:24  \nabusenius left at 21:24 (Ping timeout: 272 seconds  \nnickless is now known as abusenius ([[email\u00a0protected]](https://dev.xwiki.org/cdn-cgi/l/email-protection)  \nfmancinelli joined #xwiki at 22:20  \nfmancinelli left at 23:08 (Ping timeout: 252 seconds  \nlucaa joined #xwiki at 23:33  \n\n"}