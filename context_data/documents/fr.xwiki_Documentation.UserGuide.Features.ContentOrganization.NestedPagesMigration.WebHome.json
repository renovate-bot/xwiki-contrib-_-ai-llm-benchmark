{
  "id": "xwiki:Documentation.UserGuide.Features.ContentOrganization.NestedPagesMigration.WebHome",
  "url": "https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/",
  "title": "Migration Guide to Nested Pages",
  "collection": "Eval_fr",
  "mimetype": "text/markdown",
  "language": "fr",
  "content": "**Contenu** \n* [Historique](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HHistory)\n    + [Résumé Exécutif](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HExecutiveSummary)\n    + [Explications Détaillées](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HDetailedExplanations)\n        - [Relation Parent/Enfant](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HParent2FChildrelationship)\n        - [Introduction du concept de Pages Imbriquées](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HTheintroductionoftheNestedPagesconcept)\n        - [Problème avec la relation Parent/Enfant](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HIssuewiththeParent2FChildrelationship)\n* [Migration](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HMigration)\n    + [Corriger la hiérarchie](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HFixthehierarchy)\n    + [Application de Migration des Pages Imbriquées](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HNestedPagesMigratorApplication)\n        - [Options](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HOptions)\n        - [Plan](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HPlan)\n            * [Préférences](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HPreferences)\n            * [Droits](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HRights)\n        - [Exécuter le plan](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HExecutetheplan)\n    + [Quoi d'autre ?](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/#HWhatelse3F)\n\n# Historique\n\n## Résumé Exécutif\n\nJusqu'à XWiki 7.1, il y avait deux façons d'organiser le contenu dans XWiki :\n\n* Wiki > Espace > Page (qui inclut l'héritage des droits et les fonctionnalités d'administration)\n* Page > Page Enfant > Page Enfant de la Page Enfant > ... (utilisé pour la navigation hiérarchique)\n\nNotez que les deux sont indépendants : une page peut avoir une page parent dans un espace/wiki différent du sien.\n\nBien que cela fonctionnait, nous avons constaté que cela pouvait créer de la confusion chez les utilisateurs, menant à des questions telles que :\n\n* Dois-je créer un sous-wiki ou un espace pour mon équipe ?\n* Quelle navigation dois-je mettre sur ma page d'accueil : liste des espaces ou vue arborescente des pages ?\n* Puis-je définir des droits sur une page qui se trouve sous un espace ?\n\nEn même temps, il y a eu de longues discussions sur la liste à propos du futur \"nouveau modèle\" de XWiki, qui inclurait idéalement des espaces imbriqués, offrant les fonctionnalités suivantes :\n\n* Manière unifiée de gérer la navigation hiérarchique (Page > Sous-page > Sous-sous-page > ...)\n* Navigation reflétée dans les URLs (.../PageA/PageB/PageC)\n* Héritage des droits d'accès (les droits sur PageA s'appliquent à PageB et PageC, sauf indication contraire. Les droits sur PageB supplantent ceux sur PageA et s'appliquent également à PageC, et ainsi de suite.)\n\nFinalement, nous avons saisi l'opportunité de passer de l'ancienne manière à cette nouvelle manière d'organiser les pages dans XWiki 7.2.\n\nDans un monde idéal, passer de l'ancien modèle au nouveau impliquerait une réécriture totale du modèle. Cependant, afin de ne pas casser la rétro-compatibilité avec de nombreuses fonctionnalités et applications existantes, nous avons dû conserver les concepts de \"Page\" et \"Espace\" dans XWiki tout en les adaptant pour émuler la fonctionnalité des Pages Imbriquées. Voici ce que nous avons fait pour y parvenir par défaut :\n\n* Nous avons caché la fonctionnalité parent-enfant. Même si elle est cachée, vous pouvez toujours la réactiver si vous en avez besoin pendant que vous migrez votre contenu pour utiliser les Espaces Imbriqués : définissez la propriété core.hierarchyMode à parentchild dans le fichier de configuration xwiki.properties.\n* Lors de la création d'une nouvelle page, le système crée automatiquement Page.WebHome, ce qui crée un espace, bien que cela soit caché dans l'URL (vous ne voyez que .../Page/)\n* Pour les utilisateurs avancés, nous avons ajouté la possibilité de créer des \"Pages Terminales\" qui sont des pages qui ne sont pas des espaces (comme avant). Cela est principalement destiné aux créateurs d'applications.\n\n## Explications Détaillées\n\nAvant l'introduction du concept de Pages Imbriquées (en 7.2), le contenu dans un wiki était organisé comme ceci :\n\n* nous avions des **Espaces**, que vous pouvez conceptuellement considérer comme des \"dossiers\" de système de fichiers\n* à l'intérieur de ces espaces, nous avions des **Pages**, où vous pouviez écrire du contenu ou stocker des entrées d'applications.\n\nÀ cette époque, nous ne pouvions pas avoir des espaces à l'intérieur des espaces, donc toutes les pages étaient placées dans un espace de niveau supérieur. Les pages étaient identifiées comme ceci : NomDeLEspace.NomDeLaPage.\n\nCertaines pages étaient un peu spéciales. Elles étaient les pages \"d'accueil\" d'un espace. Chaque fois qu'un utilisateur voulait atteindre un espace sans spécifier un nom de page précis, il était redirigé vers la page d'accueil de cet espace. Ces pages étaient appelées \"WebHome\" (parce qu'au tout début de XWiki, les \"espaces\" étaient appelés \"web\").\n\n### Relation Parent/Enfant\n\nL'utilisateur pouvait spécifier une page **parent** pour chaque page qu'il avait créée. Ce parent pouvait être n'importe quelle page, par exemple la page Movies.ItsAWonderfulLife pouvait avoir Directors.FrankCapra comme parent. Ensuite, ItsAWonderfulLife était listée comme Enfant de FrankCapra. Cette relation était affichée dans le *fil d'Ariane* en haut de chaque page. L'utilisateur pouvait naviguer à travers cette *hiérarchie*.\n\nCertaines applications utilisaient cette relation parent/enfant pour organiser leurs données. Pour elles, cette relation est cruciale.\n\n### Introduction du concept de Pages Imbriquées\n\nDans XWiki 7.2, en raison des demandes fréquentes des utilisateurs, nous avons introduit la possibilité de créer des espaces sous d'autres espaces. C'est le concept des **Espaces Imbriqués**. Nous avons soudainement eu la possibilité de créer une hiérarchie d'espaces pour organiser le contenu.\n\nMais nous avons également trouvé quelques problèmes. Que se passe-t-il si un espace a le même nom qu'une page ? Quelle entrée devons-nous rendre à l'utilisateur lorsqu'il atteint une URL où deux entités correspondent ? De plus, est-ce que cela a du sens d'avoir une différence entre un espace et une page ? Pourquoi les pages ne pourraient-elles pas avoir des sous-pages à l'intérieur d'elles ?\n\nNous avons alors décidé de passer au concept de **Pages Imbriquées**. En théorie, une page devrait maintenant pouvoir avoir des sous-pages, car nous n'avons pas besoin d'avoir une distinction entre une page et un espace comme nous l'avons entre un fichier et un dossier.\n\nMais ce changement n'était pas possible à faire au niveau de l'API car il aurait nécessité trop de travail que nous ne pouvions pas nous permettre à ce moment-là (et casser la rétro-compatibilité par la même occasion puisqu'il aurait nécessité un changement complet du modèle). Donc, la décision a été prise de s'en tenir à l'implémentation des **Espaces Imbriqués** au niveau de l'API (pour l'instant), mais de proposer les **Pages Imbriquées** au niveau de l'interface utilisateur.\n\nComment cela fonctionne-t-il ?\n\nChaque fois qu'un utilisateur crée une page depuis l'interface utilisateur de XWiki, il crée en réalité un espace (sans le savoir ![emoticon_wink](https://www.xwiki.org/xwiki/resources/icons/silk/emoticon_wink.png?cache-version=1711538036000)) avec sa page WebHome. Cela signifie que toutes les pages créées par l'utilisateur sont appelées WebHome.\n\nEnsuite, lorsque l'utilisateur veut créer une sous-page, par exemple FrankCapra à l'intérieur de la page Directors.WebHome, il crée en réalité un nouvel espace à l'intérieur de l'espace Directors avec sa page WebHome : Directors.FrankCapra.WebHome. C'est ainsi que nous l'émulons.\n\nLa notion d'espace a été supprimée de l'interface utilisateur. Elle n'est plus mentionnée nulle part. Tout semble fonctionner comme si nous créions vraiment des sous-pages, même si sous le capot, nous créons des sous-espaces.\n\nCette émulation devrait être temporaire. À un moment donné, nous aimerions refactoriser le modèle de base de XWiki et supprimer le concept d'espaces pour ne garder que les pages. Ne retenez pas votre souffle cependant, cela pourrait prendre plusieurs années ![emoticon_wink](https://www.xwiki.org/xwiki/resources/icons/silk/emoticon_wink.png?cache-version=1711538036000)\n\nNotez que les utilisateurs ont toujours la possibilité de créer des pages qui ne sont pas nommées WebHome. En conséquence, ces pages (qui ne sont pas le \"WebHome\" de leur espace) ne peuvent pas avoir de sous-pages. Elles sont appelées **Pages Terminales**.\n\n### Problème avec la relation Parent/Enfant\n\nMaintenant, il est clair que nous avons deux hiérarchies différentes dans le wiki. L'une, faite de sous-pages (sous-espaces en réalité), et l'autre faite avec l'ancienne relation parent/enfant. Ensuite, clairement, cela devient confus pour l'utilisateur. Quelle hiérarchie doit être affichée dans le fil d'Ariane ? Quel est le parent d'une page, la page \"conteneur\" ou le parent défini dans le champ ?\n\nLe choix a été fait d'abandonner la notion de relation parent/enfant, puisque nous pouvons maintenant vraiment avoir des pages enfants, implémentées comme des sous-pages (avec des droits hérités, des préférences, etc.).\n\nCela signifie que lorsque l'utilisateur veut changer le parent d'une page, il doit en fait **déplacer** cette page sous le nouveau parent.\n\nCe concept est bon en théorie. Mais, comment pouvez-vous migrer le contenu existant lorsque vous passez à XWiki 7.2+ ?\n\n# Migration\n\nL'idée est de convertir vos pages existantes (la plupart d'entre elles sont des pages terminales) en pages WebHome sous leur propre espace. Nous appelons cela \"convertir les pages terminales en pages imbriquées\". Cela vous permettra ensuite de créer des sous-pages sous toutes les pages converties, ce qui est impossible tant qu'elles sont des pages terminales.\n\nMais ce serait dommage de perdre les relations parent/enfant que les utilisateurs ont créées entre leurs pages. Les utilisateurs pourraient vouloir préserver leurs hiérarchies soigneusement élaborées. Vous pourriez toujours vouloir avoir FrankCapra comme parent de ItsAWonderfulLife.\n\nPour conserver cette information, le principe est de **déplacer toutes les pages sous leurs parents**, de sorte que les liens parent/enfant **deviennent une véritable hiérarchie entre les pages**.\n\n[![example.svg](https://www.xwiki.org/xwiki/bin/download/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/WebHome/example.svg?width=600&rev=1.1)](https://www.xwiki.org/xwiki/bin/download/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/WebHome/example.svg?rev=1.1)\n\nPour effectuer cette conversion, nous avons développé une application appelée [Application de Migration des Pages Imbriquées](https://extensions.xwiki.org/xwiki/bin/view/Extension/Nested%20Pages%20Migrator%20Application).\n\n## Corriger la hiérarchie\n\nCependant, votre hiérarchie de pages actuelle peut être désordonnée. Par exemple, certaines pages à l'intérieur de l'espace Proposal pourraient avoir Main.WebHome comme parent au lieu de Proposal.WebHome, ce qui serait plus logique. Cela se produit lorsque l'utilisateur est invité à créer des pages dans l'espace Proposal directement depuis la page principale.\n\nIl est important d'identifier ces cas avant d'appliquer l'outil de migration, car l'outil ne pourra pas détecter ce genre de hiérarchies indésirables.\n\nDans l'exemple précédent, la solution était de mettre manuellement le parent de toutes les pages de l'espace Proposal qui avaient Main.WebHome comme parent, à Proposal.WebHome. Le script suivant est un exemple qui peut être utilisé pour migrer (vous devrez l'adapter à vos propres besoins) :\n\n#set ($xwql = \"where doc.space in ('Proposal', 'Design', 'Improvements') and doc.parent = 'Main.WebHome'\")  \n#foreach($r in $services.query.xwql($xwql).execute())  \n  #set ($d = $xwiki.getDocument($r))  \n  #set ($discard = $d.setParent('Proposal.WebHome'))  \n  #set ($discard = $d.save())  \n  \\* $r updated  \n#end ## Application de Migration des Pages Imbriquées\n\nPour utiliser l'application de migration, vous devez d'abord mettre à jour votre instance XWiki vers une version récente (7.4.2+). En effet, le migrateur ne peut pas créer de pages imbriquées dans une ancienne instance XWiki où ce concept n'existait pas !\n\n* Nous recommandons absolument de faire une [sauvegarde de votre instance et de vos bases de données](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Backup). Le migrateur modifiera de nombreuses pages existantes et ces modifications ne peuvent pas être annulées. Si quelque chose tourne mal, la seule solution sera de réinstaller votre sauvegarde.\n* Les utilisateurs devraient être invités à ne pas modifier le contenu du wiki pendant l'utilisation du migrateur.\n* Rien n'empêche un autre administrateur de lancer le migrateur en même temps que vous, ce qui pourrait avoir de mauvaises conséquences (collisions d'actions, etc.). Vous devez vous assurer que vous êtes la seule personne à utiliser cet outil pendant toute la durée du processus.\nAllez dans le [Gestionnaire d'Extensions de votre wiki](https://extensions.xwiki.org/xwiki/bin/view/Extension/Extension%20Manager%20Application), et installez l'[Application de Migration des Pages Imbriquées](https://extensions.xwiki.org/xwiki/bin/view/Extension/Nested%20Pages%20Migrator%20Application). Ensuite, allez à la page NestedPagesMigration.WebHome.\n\nVous trouverez la page suivante :\n\n![Migrator1.png](https://www.xwiki.org/xwiki/bin/download/Documentation/UserGuide/Features/ContentOrganization/NestedPagesMigration/WebHome/Migrator1.png?rev=1.1)\n\nIl y a 3 actions :\n\n* **calculer un plan** : la migration génère d'abord un plan d'actions à réaliser. Vous pouvez voir ce que le migrateur propose de faire et désactiver certaines actions, ou modifier les options, par exemple.\n* **exécuter le plan** : lorsqu'un plan a été calculé et si vous êtes d'accord avec son contenu, vous pouvez exécuter le plan : les pages seront déplacées comme proposé.\n* **détecter les ruptures** (depuis 0.7) : détecter les hiérarchies qui sont cassées si vous ne lancez pas le migrateur. [Lisez la page du migrateur pour plus d'informations](https://extensions.xwiki.org/xwiki/bin/view/Extension/Nested%20Pages%20Migrator%20Application#HBreakagesDetection).\n\n### Options\n\nMais d'abord, parlons des options.\n\n| Option | Description | Valeur par défaut (recommandée) |\n| --- | --- | --- |\n| **Exclure les pages cachées** | Cochez cette option si vous souhaitez exclure les pages cachées, contenant généralement des données techniques, de la migration. | **true** |\n| **Exclure les pages ayant une classe** | Cochez cette option pour ne pas convertir les pages contenant une xclass, car cela peut casser les applications basées sur ces xclasses. | **true** |\n| **Ne pas déplacer les enfants** | Convertir les pages en Pages Imbriquées (afin qu'elles puissent avoir des enfants) sans les déplacer sous leur parent. L'ancienne hiérarchie ne sera pas préservée, mais les droits et les préférences resteront les mêmes. | **false** |\n| **Ajouter une redirection** | Ajouter une redirection à l'ancien emplacement. Ainsi, lorsqu'un utilisateur se rend à l'ancienne URL, il sera automatiquement redirigé vers la nouvelle. C'est bien si vous ne voulez pas casser les favoris, par exemple. | **true** |\n| **Convertir les préférences** | En déplaçant les pages sous leurs parents, les préférences héritées peuvent changer. Si cette option est activée, le migrateur copiera les anciennes préférences héritées à la nouvelle localisation. | **true** |\n| **Convertir les droits** | En déplaçant les pages sous leurs parents, les droits hérités peuvent changer. Si cette option est activée, le migrateur essaiera de définir les mêmes droits à la nouvelle localisation. Malheureusement, cette opération est complexe, et l'algorithme actuel est un peu bogué pour le moment. Cette option doit être utilisée pour des raisons de débogage. Vous pouvez toujours calculer un plan avec cette option sans l'exécuter : le plan listera les emplacements où certains droits seront modifiés, et vous devriez alors être en mesure de trouver une solution pour eux manuellement. | **false** |\n| **Exclure les classes** | Exclure les pages contenant certains objets. | Une liste de classes que nous avons identifiées pour être exclues. Elle n'est pas complète, vous devriez ajouter les xclasses de vos propres applications ! |\n| **Exclure les pages** | Exclure une liste de pages. | Une liste de pages que nous avons identifiées pour être excl"
}