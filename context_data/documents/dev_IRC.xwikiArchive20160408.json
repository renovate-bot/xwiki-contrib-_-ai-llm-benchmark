{"id": "dev:IRC.xwikiArchive20160408", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20160408", "title": "IRC Archive for channel #xwiki on 08 April 2016 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<lkrejci>\u00a0has joined #xwiki  \n00:08\u00a0<lkrejci>\u00a0has quit  \n00:27\u00a0<lkrejci>\u00a0has joined #xwiki  \n00:35\u00a0<lkrejci>\u00a0has quit  \n00:37\u00a0<vmassol1>\u00a0has quit  \n01:59\u00a0<Slashman>\u00a0has quit  \n02:49\u00a0<sorinello\\_>\u00a0has joined #xwiki  \n02:52\u00a0<sorinello>\u00a0has quit  \n02:58\u00a0<lkrejci>\u00a0has joined #xwiki  \n03:03\u00a0<lkrejci>\u00a0has quit  \n05:48\u00a0<sorinello\\_>\u00a0has quit  \n05:54\u00a0<sorinello>\u00a0has joined #xwiki  \n05:54\u00a0<sorinello>\u00a0has quit  \n06:08\u00a0<DarkKnightCZ>\u00a0has joined #xwiki  \n06:17\u00a0<DarkKnightCZ>\u00a0has quit  \n07:03\u00a0<DarkKnightCZ>\u00a0has joined #xwiki  \n07:03\u00a0<DarkKnightCZ>\u00a0has quit  \n07:15\u00a0<sdumitriu1>\u00a0has quit  \n07:16\u00a0<mflorea>\u00a0has joined #xwiki  \n07:18\u00a0<mflorea>\u00a0has quit  \n07:50\u00a0<sdumitriu1>\u00a0has joined #xwiki  \n08:14\u00a0<sdumitriu1>\u00a0has quit  \n08:15\u00a0<KermitTheFragger>\u00a0has joined #xwiki  \n08:23\u00a0<sdumitriu1>\u00a0has joined #xwiki  \n08:34\u00a0<vmassol>\u00a0has joined #xwiki  \n08:49\u00a0<acotiuga>\u00a0has joined #xwiki  \n09:25\u00a0<tmortagne>\u00a0has joined #xwiki  \n09:46\u00a0<mflorea>\u00a0has joined #xwiki  \n09:55\u00a0<lkrejci>\u00a0has joined #xwiki  \n10:03\u00a0<cjd>\u00a0has quit  \n10:11\u00a0<evalica>\u00a0has joined #xwiki  \n10:17\u00a0<Enygma`>\u00a0has joined #xwiki  \n10:36\u00a0<xwikiorg\\_guest\\_3>\u00a0has joined #xwiki  \n10:41\u00a0<xwikiorg\\_guest\\_3>\u00a0has quit  \n10:46\u00a0<lkrejci>\u00a0has quit  \n10:46\u00a0<cjd>\u00a0has joined #xwiki  \n11:04\u00a0<acotiuga>\u00a0Hello! Could anyone give me an example of situation when $xwiki.getDocument($doc.documentReference) might fail?  \n11:07\u00a0<vmassol>\u00a0the DB is unplugged for ex  \n11:07\u00a0<vmassol>\u00a0ie problem accessing the DB  \n11:08\u00a0<vmassol>\u00a0(acotiuga)  \n11:08\u00a0<vmassol>\u00a0ie all Hibernate-related issues  \n11:08\u00a0<vmassol>\u00a0you can check loadXWikiDoc() in XWHS  \n11:10\u00a0<tmortagne>\u00a0acotiuga: it fail when hibernate/mysql fail for some reason, no XWiki reason AFAIK  \n11:10\u00a0<vmassol>\u00a0acotiuga: if the wiki addressed doesn't exist too I think  \n11:10\u00a0<vmassol>\u00a0see #setDatabase()  \n11:12\u00a0<tmortagne>\u00a0yes that too  \n11:12\u00a0<acotiuga>\u00a0What I would like to reach is a unit test for this method http://pastebin.com/3AzjC2qj , even if I'm not sure this is needed  \n11:13\u00a0<tmortagne>\u00a0(but it's actually a mysql error :))  \n11:14\u00a0<vmassol>\u00a0acotiuga: that method doesn't look very good for an impl pov ;)  \n11:14\u00a0<vmassol>\u00a0where is it located?  \n11:14\u00a0<vmassol>\u00a0exception-handling doesn't seem correct and it's too generic to be exposed as a SS  \n11:15\u00a0<vmassol>\u00a0if it's a java api it should throw probably an exception  \n11:15\u00a0<vmassol>\u00a0(since it's public)  \n11:16\u00a0<acotiuga>\u00a0it's some local code, preparing for PR  \n11:18\u00a0<vmassol>\u00a0ok, I think the exception-handling can be improved  \n11:18\u00a0<vmassol>\u00a0we can check in the PR  \n11:19\u00a0<acotiuga>\u00a0I already found a good example here  \n11:19\u00a0<acotiuga>\u00a0https://github.com/xwiki/xwiki-platform/blob/3f304c0d8fb3dd23dfc0c65880b259c829cea5c9/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/api/XWiki.java#L177  \n11:21\u00a0<zzeroo>\u00a0has quit  \n11:21\u00a0<zzeroo>\u00a0has joined #xwiki  \n11:25\u00a0<zzeroo>\u00a0has quit  \n11:25\u00a0<zzeroo>\u00a0has joined #xwiki  \n11:26\u00a0<zzeroo>\u00a0has quit  \n11:28\u00a0<zzeroo>\u00a0has joined #xwiki  \n11:51\u00a0<lkrejci>\u00a0has joined #xwiki  \n11:54\u00a0<lkrejci\\_>\u00a0has joined #xwiki  \n11:55\u00a0<lkrejci>\u00a0has quit  \n11:55\u00a0<lkrejci>\u00a0has joined #xwiki  \n11:59\u00a0<lkrejci\\_>\u00a0has quit  \n12:33\u00a0<lkrejci>\u00a0has quit  \n12:33\u00a0<lkrejci>\u00a0has joined #xwiki  \n12:33\u00a0<lkrejci>\u00a0has joined #xwiki  \n12:37\u00a0<cjd>\u00a0has quit  \n13:32\u00a0<lkrejci>\u00a0has quit  \n13:33\u00a0<lkrejci>\u00a0has quit  \n13:58\u00a0<cjd>\u00a0has joined #xwiki  \n14:46\u00a0<DarkKnightCZ>\u00a0has quit  \n15:09\u00a0<mflorea>\u00a0vmassol, tmortagne: quick question, I don't remember, do we have a way to catch in a unit test the messages logged with a static logger LoggerFactory.getLogger(Some.class);  \n15:09\u00a0<tmortagne>\u00a0AllLogRule ?  \n15:10\u00a0<tmortagne>\u00a0org.xwiki.test.AllLogRule  \n15:10\u00a0<mflorea>\u00a0right, thanks  \n15:14\u00a0<vmassol>\u00a0back, yep  \n15:17\u00a0<vmassol>\u00a0(working on some unit tests)  \n15:21\u00a0<mflorea>\u00a0vmassol, tmortagne: are you sure it works with a static logger? (without @Inject)  \n15:23\u00a0<vmassol>\u00a0it should yes  \n15:23\u00a0<tmortagne>\u00a0vmassol know better but AFAIK it's working at logback level so it does not really matter how the logger was created  \n15:23\u00a0<vmassol>\u00a0it's reconfiguring logback  \n15:23\u00a0<tmortagne>\u00a0plus @Inject Logger actually call the static slf4j API being the scene anyway  \n15:24\u00a0<vmassol>\u00a0mflorea: are you using MockitComponentMockingRule?  \n15:24\u00a0<vmassol>\u00a0forget that  \n15:25\u00a0<vmassol>\u00a0(this will mock the loggers but only the @inject ones)  \n15:25\u00a0<mflorea>\u00a0I have a plan junit test, so no MockitComponentMockingRule  \n15:25\u00a0<mflorea>\u00a0s/plan/plain  \n15:25\u00a0<vmassol>\u00a0have you checked examples in our code of using @AllLogrule?  \n15:26\u00a0<mflorea>\u00a0yes  \n15:28\u00a0<vmassol>\u00a0that reminds me that I have a pending proposal to automatically capture logs in unit tests  \n15:28\u00a0<mflorea>\u00a0I get \"There are only 0 messages in the captured logs\" even though the code is logging messages (I can see it while stepping through in debug mode)  \n15:29\u00a0<vmassol>\u00a0trying quickly in a test  \n15:31\u00a0<vmassol>\u00a0works for me  \n15:31\u00a0<vmassol>\u00a0here's my test:  \n15:31\u00a0<mflorea>\u00a0if I use AllLogRule(LogLevel.DEBUG) I get some messages, but it's hard to find the index of the message I want to assert, there are debug logs from other modules..  \n15:32\u00a0<vmassol>\u00a0https://gist.github.com/vmassol/0609acdad40c9ef0ced7b77634cb12ac  \n15:32\u00a0<lkrejci>\u00a0has quit  \n15:32\u00a0<mflorea>\u00a0try logging at debug level  \n15:32\u00a0<vmassol>\u00a0(refreshed)  \n15:32\u00a0<lkrejci>\u00a0has joined #xwiki  \n15:34\u00a0<vmassol>\u00a0ok so you're probably using a config that's not been tested  \n15:34\u00a0<vmassol>\u00a0but it's not related to static slf4j logger  \n15:35\u00a0<vmassol>\u00a0debugging  \n15:35\u00a0<vmassol>\u00a0btw LogLevel is in some deprecated class now  \n15:35\u00a0<vmassol>\u00a0we had LogRule before  \n15:35\u00a0<mflorea>\u00a0whist is stupid, because it is used in AllLogRule  \n15:36\u00a0<vmassol>\u00a0we had both before  \n15:36\u00a0<vmassol>\u00a0AllLogRule was extending Logrule  \n15:36\u00a0<vmassol>\u00a0that's why  \n15:36\u00a0<vmassol>\u00a0then I deprecated LogRule and forgot to refactor this  \n15:36\u00a0<mflorea>\u00a0I know, but when we deprecated LogRule we also deprecated LogLevel which is still used  \n15:37\u00a0<vmassol>\u00a0what should have been done is move LogLevel as a top level class  \n15:37\u00a0<tmortagne>\u00a0note that there is a new org.slf4j.event.Level in slf4j  \n15:37\u00a0<mflorea>\u00a0yes  \n15:37\u00a0<tmortagne>\u00a0you could reuse that instead  \n15:37\u00a0<vmassol>\u00a0k thanks thomas, I'll check it  \n15:38\u00a0<mflorea>\u00a0vmassol: btw, in your example the logger is created after the AllLogRule, have you tried to create the logger as a static field, which will be created before the rule?  \n15:39\u00a0<vmassol>\u00a0trying  \n15:39\u00a0<vmassol>\u00a0indeed that seems to be an issue  \n15:39\u00a0<vmassol>\u00a0debugging  \n15:40\u00a0<mflorea>\u00a0thanks  \n15:40\u00a0<DarkKnightCZ>\u00a0has joined #xwiki  \n15:45\u00a0<vmassol>\u00a0my bad it's working  \n15:45\u00a0<vmassol>\u00a0default loglevel is info  \n15:45\u00a0<vmassol>\u00a0now debugging setting the loglevel to debug  \n16:00\u00a0<vmassol>\u00a0ok I know  \n16:00\u00a0<vmassol>\u00a0wait, still need to check something but I think I know  \n16:01\u00a0<vmassol>\u00a0yep that's it  \n16:01\u00a0<vmassol>\u00a0in xwiki-commons-tool-test-simple we provide a logback config file  \n16:01\u00a0<vmassol>\u00a0which overrides the AllLogRule setup  \n16:01\u00a0<vmassol>\u00a0(mflorea)  \n16:02\u00a0<vmassol>\u00a0by default in there org.xwiki is set to INFO  \n16:02\u00a0<vmassol>\u00a0so when you set DEBUG as the loglevel, in practice it's set back as INFO  \n16:02\u00a0<vmassol>\u00a0which is why you don't have anryingg in the logs  \n16:02\u00a0<lkrejci>\u00a0has quit  \n16:02\u00a0<mflorea>\u00a0ok  \n16:02\u00a0<mflorea>\u00a0I see  \n16:02\u00a0<vmassol>\u00a0I need to figure out how to fix this  \n16:02\u00a0<lkrejci>\u00a0has quit  \n16:03\u00a0<vmassol>\u00a0ofc you can provide a logback-test.xml for your test  \n16:03\u00a0<vmassol>\u00a0but I need to find a simpler solution  \n16:04\u00a0<mflorea>\u00a0only if you have time, I don't need it anymore, I was trying to write a unit test for a fix a made, but apparently the fix is not good so I moved to something else  \n16:04\u00a0<vmassol>\u00a0ok  \n16:04\u00a0<tmortagne>\u00a0vmassol: I don't understand, AllLogRule does not override the configuration programatically ?  \n16:04\u00a0<vmassol>\u00a0it does  \n16:04\u00a0<vmassol>\u00a0but apparently the config is called after  \n16:04\u00a0<vmassol>\u00a0I'm still checking/debugging  \n16:04\u00a0<vmassol>\u00a0it's strange  \n16:06\u00a0<vmassol>\u00a0ah no I know  \n16:06\u00a0<vmassol>\u00a0the root logger is set to the value we pass  \n16:06\u00a0<vmassol>\u00a0but we don't overwrite the children loggers  \n16:06\u00a0<vmassol>\u00a0so they inherit from the logback-test.xml  \n16:07\u00a0<vmassol>\u00a0I also need to overwrite all the children loggers  \n16:07\u00a0<vmassol>\u00a0fixing  \n16:08\u00a0<vmassol>\u00a0or better use setadditive to false as we used to do in LogRule  \n16:08\u00a0<vmassol>\u00a0not sure why I missed that  \n16:13\u00a0<M-cjd>\u00a0has quit  \n16:13\u00a0<M-jsimard>\u00a0has quit  \n16:13\u00a0<M-mouhb>\u00a0has quit  \n16:13\u00a0<M-yflory>\u00a0has quit  \n16:13\u00a0<vmassol>\u00a0actually the issue is that detachAndStopAllAppenders() doesn't seem to do what I think it should do, the children loggers are still there, debugging  \n16:14\u00a0<lkrejci>\u00a0has quit  \n16:16\u00a0<lkrejci>\u00a0has joined #xwiki  \n16:16\u00a0<tmortagne>\u00a0vmassol: instead of modifying the loggers you could set a filter in the other appenders  \n16:16\u00a0<tmortagne>\u00a0see https://github.com/xwiki/xwiki-commons/blob/master/xwiki-commons-core/xwiki-commons-logging/xwiki-commons-logging-logback/src/main/java/org/xwiki/logging/logback/internal/DefaultLoggerManager.java#L87  \n16:16\u00a0<vmassol>\u00a0that won't overwrite logback-test.xml  \n16:17\u00a0<tmortagne>\u00a0a ch.qos.logback.classic.filter.ThresholdFilter probably in your case  \n16:18\u00a0<tmortagne>\u00a0the configuration should be logged when logback initialize  \n16:18\u00a0<acotiuga>\u00a0has quit  \n16:18\u00a0<tmortagne>\u00a0\u00a0s/logged/loaded/  \n16:19\u00a0<tmortagne>\u00a0it does not make much sense to me if you code is executed after the logback init  \n16:19\u00a0<tmortagne>\u00a0s/you/your/  \n16:20\u00a0<tmortagne>\u00a0the moment you ask logback for the root logger it should be initialized already  \n16:23\u00a0<matsimoto>\u00a0has left #xwiki  \n16:23\u00a0<M-cjd>\u00a0has joined #xwiki  \n16:49\u00a0<lucaa>\u00a0has joined #xwiki  \n17:11\u00a0<mflorea>\u00a0has quit  \n17:17\u00a0<vmassol>\u00a0tmortagne:  \n17:17\u00a0<vmassol>\u00a0with \u00a0a turbofilter it works fine  \n17:17\u00a0<vmassol>\u00a0I couldn't make it work with a simple filter though  \n17:17\u00a0<vmassol>\u00a0I don't understand why. I have only 1 appender  \n17:18\u00a0<tmortagne>\u00a0never used turbo filters  \n17:18\u00a0<vmassol>\u00a0basically it's filter at the global level  \n17:18\u00a0<vmassol>\u00a0not tied to an appender  \n17:19\u00a0<Slashman>\u00a0has joined #xwiki  \n17:21\u00a0<tmortagne>\u00a0ok  \n17:21\u00a0<M-cjd>\u00a0has quit  \n17:21\u00a0<vmassol>\u00a0this is actually great since it bypasses everything  \n17:25\u00a0<tmortagne>\u00a0I don't understand, XE is complaining since 3 builds that org.xwiki.platform:xwiki-platform-oldcore:jar:8.0.1-SNAPSHOT does not exist but it does  \n17:25\u00a0<tmortagne>\u00a0http://nexus.xwiki.org/nexus/content/groups/public-snapshots/org/xwiki/platform/xwiki-platform-oldcore/8.0.1-SNAPSHOT/  \n17:28\u00a0<lucaa>\u00a0has quit  \n17:30\u00a0<M-cjd>\u00a0has joined #xwiki  \n17:32\u00a0<lkrejci>\u00a0has quit  \n17:32\u00a0<lkrejci>\u00a0has joined #xwiki  \n17:34\u00a0<tmortagne>\u00a0has quit  \n17:36\u00a0<evalica>\u00a0has quit  \n17:37\u00a0<evalica>\u00a0has joined #xwiki  \n17:39\u00a0<vmassol>\u00a0tm   \n17:39\u00a0<vmassol>\u00a0oops  \n17:45\u00a0<woshilapin>\u00a0has quit  \n17:52\u00a0<lucaa>\u00a0has joined #xwiki  \n18:10\u00a0<evalica>\u00a0has quit  \n18:13\u00a0<evalica>\u00a0has joined #xwiki  \n18:15\u00a0<Aranjedeath>\u00a0has quit  \n18:16\u00a0<lucaa>\u00a0has quit  \n18:19\u00a0<KermitTheFragger>\u00a0has quit  \n18:27\u00a0<Aranjedeath>\u00a0has joined #xwiki  \n18:32\u00a0<M-jsimard>\u00a0has joined #xwiki  \n18:32\u00a0<M-yflory>\u00a0has joined #xwiki  \n18:32\u00a0<lkrejci>\u00a0has quit  \n18:32\u00a0<M-mouhb>\u00a0has joined #xwiki  \n18:32\u00a0<M-vmassol>\u00a0has joined #xwiki  \n18:32\u00a0<lkrejci>\u00a0has joined #xwiki  \n18:40\u00a0<Enygma`>\u00a0has quit  \n18:46\u00a0<evalica>\u00a0has quit  \n19:02\u00a0<lkrejci>\u00a0has quit  \n19:02\u00a0<lkrejci>\u00a0has joined #xwiki  \n19:04\u00a0<Pbas>\u00a0has quit  \n19:44\u00a0<abusenius>\u00a0has joined #xwiki  \n20:09\u00a0<cjd>\u00a0has quit  \n21:00\u00a0<cjd>\u00a0has joined #xwiki  \n21:04\u00a0<Daemoen>\u00a0lo folks  \n21:31\u00a0<lkrejci>\u00a0has quit  \n21:32\u00a0<lkrejci>\u00a0has joined #xwiki  \n22:02\u00a0<lkrejci>\u00a0has quit  \n22:02\u00a0<lkrejci>\u00a0has joined #xwiki  \n22:49\u00a0<vmassol>\u00a0has quit  \n22:52\u00a0<cjd>\u00a0has quit  \n22:56\u00a0<DarkKnightCZ>\u00a0has quit  \n22:56\u00a0<cjd>\u00a0has joined #xwiki  \n23:01\u00a0<lkrejci>\u00a0has quit  \n23:02\u00a0<lkrejci>\u00a0has joined #xwiki\n"}