{"id": "dev:IRC.xwikiArchive20150421", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20150421", "title": "IRC Archive for channel #xwiki on 21 April 2015 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<Enygma`>\u00a0has quit  \n01:04\u00a0<MasterPiece>\u00a0has quit  \n03:44\u00a0<martin-h>\u00a0has quit  \n03:48\u00a0<martin-h>\u00a0has joined #xwiki  \n04:56\u00a0<martin-h>\u00a0has quit  \n05:01\u00a0<martin-h>\u00a0has joined #xwiki  \n05:54\u00a0<martin-h>\u00a0has quit  \n06:01\u00a0<Denis1>\u00a0has joined #xwiki  \n06:02\u00a0<martin-h>\u00a0has joined #xwiki  \n06:03\u00a0<Denis>\u00a0has quit  \n06:39\u00a0<mflorea>\u00a0has joined #xwiki  \n06:59\u00a0<martin-h>\u00a0has quit  \n07:06\u00a0<msmeria>\u00a0has joined #xwiki  \n07:15\u00a0<martin-h>\u00a0has joined #xwiki  \n07:52\u00a0<vmassol1>\u00a0has joined #xwiki  \n08:32\u00a0<silverdrop>\u00a0has joined #xwiki  \n08:38\u00a0<OSIMasson>\u00a0has quit  \n08:43\u00a0<OSIMasson>\u00a0has joined #xwiki  \n09:06\u00a0<KermitTheFragger>\u00a0has joined #xwiki  \n09:08\u00a0<Denis1>\u00a0is now known as <Denis>  \n09:10\u00a0<cjd>\u00a0has joined #xwiki  \n10:01\u00a0<lucaa>\u00a0has joined #xwiki  \n10:10\u00a0<vmassol>\u00a0has joined #xwiki  \n10:11\u00a0<vmassol1>\u00a0has quit  \n10:25\u00a0<martin-h>\u00a0has quit  \n10:33\u00a0<evalica>\u00a0has joined #xwiki  \n10:34\u00a0<martin-h>\u00a0has joined #xwiki  \n10:39\u00a0<gsmeria>\u00a0has joined #xwiki  \n10:41\u00a0<gsmeria>\u00a0has quit  \n10:43\u00a0<martin-h>\u00a0has quit  \n10:44\u00a0<Enygma`>\u00a0has joined #xwiki  \n10:47\u00a0<gsmeria>\u00a0has joined #xwiki  \n10:58\u00a0<martin-h>\u00a0has joined #xwiki  \n11:18\u00a0<vmassol>\u00a0has quit  \n11:18\u00a0<vmassol>\u00a0has joined #xwiki  \n11:25\u00a0<martin-h>\u00a0Hi there. I have a question. I version prior to v7, when we wanted to move a whole wiki to another instance , we used to create a new wiki in the destination instance and hit 'later' in the new wiki distribution wizard so the descriptor was created. Then we restore the dump and we get started with upgrade. How do we do this now in V7 since the DW is not triggered anymore ?  \n11:28\u00a0<cjd>\u00a0I don't know but it seems odd that DM is not starting... Perhaps just proceed as though 'later' had already been pressed ?  \n11:32\u00a0<martin-h>\u00a0We haven't tried to restore any database on V7 so I can't tell if the migration is starting, we just saw that the Distribution Wizard is now included in a job in V7 so we don't get a chance to create the descriptor only  \n11:33\u00a0<cjd>\u00a0ahh note that migrations are done on startup and you will see the message in your log  \n11:33\u00a0<cjd>\u00a0DW is a different thing from migrations, DW will not happen if there is a file called status.xml which contains the right content  \n11:34\u00a0<vmassol>\u00a0cjd: martin-h is talking about wiki creation  \n11:34\u00a0<vmassol>\u00a0martin-h: the wiki descriptors are located on the main wiki, why do you need to recreate them?  \n11:34\u00a0<cjd>\u00a0ahh right, semantics :)  \n11:35\u00a0<martin-h>\u00a0I need to import a whole wiki in a new xwiki v7 farm  \n11:35\u00a0<vmassol>\u00a0you can just export them and import them on the new instance for ex (or recreate them manually)  \n11:35\u00a0<Denis>\u00a0vmassol: he want to move one wiki from a farm to another  \n11:35\u00a0<martin-h>\u00a0Denis, that's right  \n11:35\u00a0<vmassol>\u00a0yes I understood that  \n11:35\u00a0<Denis>\u00a0I used to do like you martin-h  \n11:36\u00a0<martin-h>\u00a0interesting !  \n11:36\u00a0<vmassol>\u00a0and indeed there are 2 parts for this move:  \n11:36\u00a0<vmassol>\u00a01) the subwiki content  \n11:36\u00a0<vmassol>\u00a02) the subwiki descriptor  \n11:36\u00a0<vmassol>\u00a0for 1) you can either export the wiki as a XAR or do it at the DB level  \n11:37\u00a0<vmassol>\u00a0for 2) you can either export the descriptor page as a XAR and reimport it or recreate it manually in the new wiki I guess  \n11:37\u00a0<vmassol>\u00a0s/new wiki/new xwiki instance  \n11:37\u00a0<martin-h>\u00a0how do I create a new descriptor manually ?  \n11:37\u00a0<vmassol>\u00a0you create a page nale XWikiServer<wiki name> and you add a descriptor xobject  \n11:37\u00a0<vmassol>\u00a0s/nale/named  \n11:37\u00a0<martin-h>\u00a0( Denis, how will you do in v7 then :) )  \n11:38\u00a0<Denis>\u00a0martin-h: to continue the way you are used to, I would simply delete the status.xml under workdir/jobs/distributions/<yourwiki> and proceed to a repair  \n11:38\u00a0<vmassol>\u00a0Denis: yes that will work but you'll incur a lot of work for notthing  \n11:38\u00a0<vmassol>\u00a0(all the provisioning)  \n11:38\u00a0<vmassol>\u00a0and you'll need to delete the wiki pages to be sure  \n11:39\u00a0<vmassol>\u00a0(since there can be new wiki pages that are not in your original subwiki content)  \n11:39\u00a0<martin-h>\u00a0vmassol, thanks. Is xwiki interested to document that kind of procedure ? I mean wiki migration process  \n11:39\u00a0<martin-h>\u00a0I'm ok to contribute then  \n11:39\u00a0<vmassol>\u00a0martin-h: sure, we need to figure out what's the best way and improve our tools first I think  \n11:39\u00a0<vmassol>\u00a0if you're interested t help out  \n11:40\u00a0<vmassol>\u00a0I'd recommend you start a thread on the users lists for ex about it  \n11:40\u00a0<vmassol>\u00a0to gather all ideas/recommendations  \n11:40\u00a0<vmassol>\u00a0so that we get a common agreement about what's best for this use case  \n11:40\u00a0<vmassol>\u00a0then we can take it from there and decide to create a jira issue if there are things to improve and document our findings on xwiki.org  \n11:40\u00a0<martin-h>\u00a0vmassol, fyi I have asked the official xwiki support about this and they will take a look as well  \n11:41\u00a0<vmassol>\u00a0\"official\"?  \n11:41\u00a0<vmassol>\u00a0wdym?  \n11:41\u00a0<martin-h>\u00a0support at xwiki.org  \n11:41\u00a0<vmassol>\u00a0this is the official xwiki support!  \n11:41\u00a0<vmassol>\u00a0(this is xwiki.org support ;))  \n11:41\u00a0<vmassol>\u00a0you mean you sent a mail on the list already?  \n11:42\u00a0<martin-h>\u00a0yes we at OW2 have xwiki support contract ;)  \n11:42\u00a0<vmassol>\u00a0\"xwiki\"?  \n11:42\u00a0<vmassol>\u00a0you mean XWiki SAS?  \n11:42\u00a0<martin-h>\u00a0yes, I think so I'm a bit lost in the two  \n11:42\u00a0<vmassol>\u00a0so when you said xwiki.org above you meant xwiki.com? :)  \n11:42\u00a0<martin-h>\u00a0indeed you're right  \n11:43\u00a0<vmassol>\u00a0the name are similar but they are completely different...  \n11:43\u00a0<vmassol>\u00a0xwiki.org is the open source project, community-driven  \n11:43\u00a0<vmassol>\u00a0xwiki.com is one of several companies offering professional support for the xwiki software  \n11:43\u00a0<vmassol>\u00a0(it's not the only one)  \n11:44\u00a0<martin-h>\u00a0thank you for the clarification  \n11:44\u00a0<vmassol>\u00a0but ok I understand now :)  \n11:44\u00a0<martin-h>\u00a0So I can gather infor from both side and make the world better wdyt ? :D  \n11:44\u00a0<vmassol>\u00a0my point above still stand  \n11:44\u00a0<vmassol>\u00a0if you wish to help you could send a mail to the users list  \n11:44\u00a0<vmassol>\u00a0to start a discussion  \n11:45\u00a0<martin-h>\u00a0thanks, I'll do that  \n11:45\u00a0<vmassol>\u00a0ok cool  \n11:45\u00a0<cjd>\u00a0one idea is to \"do it agile\", document a process which is known to work, with all of the steps which are required, then solicit feedback on better processes to replace it with  \n11:46\u00a0<martin-h>\u00a0cjd, yes, I had a process before v7  \n11:46\u00a0<Denis>\u00a0which is now broken by the fact we have made the provisionning mandatory  \n11:46\u00a0<martin-h>\u00a0that's it  \n11:47\u00a0<vmassol>\u00a0I guess the right place is to add information on http://platform.xwiki.org/xwiki/bin/view/AdminGuide/Backup on how to backup/restore a subwiki  \n11:47\u00a0<vmassol>\u00a0right now it only talks about a full xwiki instance AFAIK  \n11:47\u00a0<Denis>\u00a0vmassol: what were the reason to change that provisioning ?  \n11:47\u00a0<ClemensR>\u00a0has joined #xwiki  \n11:47\u00a0<vmassol>\u00a0user experience  \n11:47\u00a0<vmassol>\u00a0(and other reasons)  \n11:47\u00a0<cjd>\u00a0then if you have a process, you can link from the wiki to the mailing list and add a note saying \"there is an ongoing discussion about improving this process\"  \n11:47\u00a0<vmassol>\u00a0like solving the PR issue  \n11:48\u00a0<vmassol>\u00a0(but those other reasons are side effects)  \n11:48\u00a0<martin-h>\u00a0vmassol, that's right, it's not abvious to me why this page doesn't have a word about farm mode  \n11:48\u00a0<vmassol>\u00a0(the main reason being the user experience)  \n11:48\u00a0<vmassol>\u00a0martin-h: yep, we should improve it  \n11:48\u00a0<Denis>\u00a0the PR issue is a better reason IMO  \n11:49\u00a0<martin-h>\u00a0PR?  \n11:49\u00a0<Denis>\u00a0but I am not sure having this mandatory was nice  \n11:49\u00a0<martin-h>\u00a0provisionning  \n11:49\u00a0<Denis>\u00a0martin-h: Programming Right  \n11:49\u00a0<martin-h>\u00a0ok  \n11:50\u00a0<vmassol>\u00a0Denis: too bad you didn't participate to the discussions then. We talked about this for over a year\u2026 ;)  \n11:50\u00a0<vmassol>\u00a0(from the very beginning when we introduced the wiki creation wizard)  \n11:50\u00a0<Denis>\u00a0I should have missed it  \n11:50\u00a0<Denis>\u00a0I am sorry  \n11:50\u00a0<vmassol>\u00a0(always been the plan, we just didn't do it initially for lack of time)  \n11:51\u00a0<Denis>\u00a0but making the provisioning mandatory is bad, since it exclude advanced use case  \n11:51\u00a0<cjd>\u00a0oh if I may drop an off topic thought: suppose we added \"execute\" Right to the rights list, this right exists explicitly for checking if the user is authorized to use certain scripts  \n11:51\u00a0<Denis>\u00a0it is just a matter of having a checkbox to make it optionnal  \n11:52\u00a0<vmassol>\u00a0martin-h: in the mail, would be interesting to explain your use case and why you wish to move only one wiki and not the whole instance  \n11:52\u00a0<Denis>\u00a0It is not too late to add it, wdyt ?  \n11:53\u00a0<Denis>\u00a0vmassol: it is the farm UC, you may want to slip farms, migrated them one wiki at a time, etc...  \n11:53\u00a0<Denis>\u00a0I said it all the time, we are too focus on the workspace use case  \n11:54\u00a0<cjd>\u00a0more wikis, more work to verify upgrades, more downtime ?  \n11:55\u00a0<cjd>\u00a01 at a time -> each of N wikis gets X downtime, \u00a0all at once -> each of N wikis gets (N \\* X) downtime  \n11:55\u00a0<cjd>\u00a0or read-only time depending on how you do it  \n11:56\u00a0<Denis>\u00a0cjd: on my side, I have several Clients in the same farm, and farms by version, migration are not simultaneous, I know this is not common, but it really illustrate a normal way to use farms  \n11:57\u00a0<cjd>\u00a0makes sense to me  \n12:01\u00a0<vmassol>\u00a0so you have a farm 1 on version N of xwiki and you then you install farm 2 with version P of xwiki (where P > N) and you wish to keep some wikis on farm 1 and move others on farm2, is that it?  \n12:02\u00a0<cjd>\u00a0therefore P != NP  \n12:02\u00a0<cjd>\u00a0sounds like contracts with customers to do upgrades occur at different times  \n12:03\u00a0<vmassol>\u00a0Denis, martin-h? is that your use case above?  \n12:04\u00a0<Denis>\u00a0this is mine  \n12:04\u00a0<cjd>\u00a0question for the architects here: I'm going to start implementing permissions in RISCOSS and we have 5 Roles and something like 25 activities drawn into a huge permissions matrix  \n12:05\u00a0<vmassol>\u00a0and then version Q of xwiki comes out and you install farm3 because not all subwiki have been migrated from farm 1 to farm 2  \n12:05\u00a0<vmassol>\u00a0and then...  \n12:05\u00a0<vmassol>\u00a0and then you have 10 farms to maintain :)  \n12:05\u00a0<Denis>\u00a0but more generally, but making wiki provisioning mandatory, you have suddenly remove the flexibility to provision a empty database by hand using very custom XAR (dating before DW)  \n12:05\u00a0<vmassol>\u00a0Denis: no  \n12:05\u00a0<cjd>\u00a0I'd like to implement this using fake documents which the roles are authorized (or not) to do a fake action on (eg: register), and then check these programmatically in scripts. Does anyone have a better idea?  \n12:06\u00a0<vmassol>\u00a0Denis: you choose your flavor  \n12:06\u00a0<cjd>\u00a0fake document -> document with nothing in it  \n12:06\u00a0<Denis>\u00a0better to maintain 10 farms of different wiki version, than one independent server for each wiki (customers)  \n12:06\u00a0<vmassol>\u00a0you can imagine having an empty one  \n12:06\u00a0<Denis>\u00a0oh, we have flavor ?  \n12:06\u00a0<vmassol>\u00a0Denis: I was going to say that.. after some time you have one farm per wiki ;)  \n12:06\u00a0<vmassol>\u00a0yes  \n12:06\u00a0<vmassol>\u00a0for subwikis only ATM  \n12:07\u00a0<martin-h>\u00a0sorry, I was disconnected...  \n12:07\u00a0<Denis>\u00a0and do we have the empty flavor ?  \n12:07\u00a0<martin-h>\u00a0vmassol, \" Denis, martin-h? is that your use case above ? \" => YES !  \n12:08\u00a0<vmassol>\u00a0martin-h: ok cool, I get it  \n12:08\u00a0<vmassol>\u00a0Denis: you can create your flavors in the wiki by using a special xobject, but not sure if we can say \"empty\" jsut now, would need to ask gullaumeD  \n12:08\u00a0<martin-h>\u00a0I'm really in the case of Denus  \n12:08\u00a0<martin-h>\u00a0of Denis  \n12:08\u00a0<vmassol>\u00a0(he's on holidays ATM)  \n12:09\u00a0<vmassol>\u00a0you can certainly use a template though and this tempate can be as empty as you wish but it would be simpler to be able to say \"empty\" I agree  \n12:09\u00a0<martin-h>\u00a0vmassol, that would be awesome  \n12:10\u00a0<vmassol>\u00a0actually wait I'm slightly in advance\u2026  \n12:10\u00a0<martin-h>\u00a0and the part about the constant containers restarts is also very annoying ;)  \n12:11\u00a0<vmassol>\u00a0we have the mechanism in place but Guillaume hasn't moved the UI part in platform yet, it's an external extension ATM  \n12:11\u00a0<vmassol>\u00a0http://extensions.xwiki.org/xwiki/bin/view/Extension/Wiki+Flavor+Application  \n12:11\u00a0<vmassol>\u00a0that part has now been coded by thomas in 7.0  \n12:11\u00a0<vmassol>\u00a0and in 7.1 we're going to expose it throught he UI  \n12:12\u00a0<vmassol>\u00a0\\*through  \n12:12\u00a0<martin-h>\u00a0yes !  \n12:14\u00a0<martin-h>\u00a0vmassol, as cjd as mentioned it already (as far as I understand) is everytime you move a subwiki in, you have to restart the container, meaning restarting all the apps comprising xwiki and every child wikis in it. Which is quite a downtime for only one wiki :)  \n12:14\u00a0<vmassol>\u00a0why?  \n12:14\u00a0<vmassol>\u00a0why do you have to restart xwiki?  \n12:15\u00a0<martin-h>\u00a0when you create a new descriptor and importing the db  \n12:15\u00a0<martin-h>\u00a0usually you have to restart the app  \n12:15\u00a0<martin-h>\u00a0afterwards  \n12:15\u00a0<martin-h>\u00a0so the db upgrade is triggered and so on  \n12:16\u00a0<cjd>\u00a0hmm good point  \n12:16\u00a0<cjd>\u00a0if there are migrations to do, will the migration manager be triggered without a restart?  \n12:16\u00a0<vmassol>\u00a0first you don't have to use the dB  \n12:16\u00a0<vmassol>\u00a0you can import/export  \n12:16\u00a0<vmassol>\u00a0(using XAR)  \n12:17\u00a0<martin-h>\u00a0vmassol, even with very large wiki ?  \n12:17\u00a0<vmassol>\u00a0that will not require any restart  \n12:17\u00a0<vmassol>\u00a0yes  \n12:17\u00a0<cjd>\u00a0assuming you use the db, the answer is then 'yes' ?  \n12:17\u00a0<vmassol>\u00a0you'll loose some info though as described on http://platform.xwiki.org/xwiki/bin/view/AdminGuide/Backup  \n12:17\u00a0<vmassol>\u00a0(activity stream, stats, etc)  \n12:17\u00a0<vmassol>\u00a0the XAR import/export now works with large wikis  \n12:18\u00a0<martin-h>\u00a0vmassol, yes I'm aware of it. But as the xwiki is version 2.7 and the dump is 10GB large I haven't tried this solution  \n12:18\u00a0<martin-h>\u00a0This is a particular scenario here  \n12:18\u00a0<vmassol>\u00a0for older one you can use the large import/export etxensions  \n12:18\u00a0<vmassol>\u00a0gtg, lunch time, bbl  \n12:19\u00a0<martin-h>\u00a0ok thanks vmassol  \n12:19\u00a0<cjd>\u00a010GB -> I personally would use database and accept the pain of restart  \n12:19\u00a0<martin-h>\u00a0cjd, would you ? :)  \n12:20\u00a0<cjd>\u00a0for 200MB I would look at the export which is supposed to scale quite well, for 10GB I would probably not, but that's a personal \"gut feeling\"  \n12:21\u00a0<martin-h>\u00a0the question is... who knows !?  \n12:21\u00a0<martin-h>\u00a0What's the import/export is capable of  \n12:21\u00a0<martin-h>\u00a0with which memory amount  \n12:21\u00a0<martin-h>\u00a0and so on  \n12:21\u00a0<cjd>\u00a0It's supposed to be infinite, I just have personal reservations about those type of things...  \n12:23\u00a0<cjd>\u00a0XWiki SAS Infra upgrades the .war file and keeps the database, then after that import the new .xar with the extension manager  \n12:23\u00a0<raz-iz-nazni\\_>\u00a0has joined #xwiki  \n12:24\u00a0<martin-h>\u00a0cjd, you means they do a xar export before upgrading the .war, then import the xar afterwards  \n12:24\u00a0<cjd>\u00a0no  \n12:24\u00a0<cjd>\u00a0import the default factory .xar to bring new pages with new functionality  \n12:25\u00a0<cjd>\u00a0but then resolve conflicts in configuration related XWikiDocuments  \n12:25\u00a0<martin-h>\u00a0yes yes ok  \n12:26\u00a0<martin-h>\u00a0it's done automatically within the DW once the xwiki has started and the database upgraded  \n12:26\u00a0<raz-iz-nazni\\_>\u00a0has quit  \n12:26\u00a0<martin-h>\u00a0but they do it from the EM  \n12:26\u00a0<cjd>\u00a0ahh ok  \n12:26\u00a0<cjd>\u00a0right  \n12:27\u00a0<martin-h>\u00a0that's not very straight forward for some reasons, a little obscur to me to have a clear mind about all of this  \n12:27\u00a0<cjd>\u00a0it's evolved that way because of lack of tools, years ago  \n12:35\u00a0<woshilapin>\u00a0has quit  \n12:36\u00a0<woshilapin>\u00a0has joined #xwiki  \n13:30\u00a0<cjd>\u00a0has quit  \n13:41\u00a0<cjd>\u00a0has joined #xwiki  \n13:46\u00a0<cjd>\u00a0has quit  \n13:50\u00a0<ClemensR>\u00a0has left #xwiki  \n13:52\u00a0<cjd>\u00a0has joined #xwiki  \n14:12\u00a0<martin-h>\u00a0hey vmassol , we've created the descriptor by hand (works well) then restored the database and restarted xwiki. Here we got the website but there is no document wizard poping up ?  \n14:12\u00a0<martin-h>\u00a0is it expected ?  \n14:13\u00a0<vmassol>\u00a0don't know, maybe check the status.xml file  \n14:13\u00a0<vmassol>\u00a0I would have expected it to pop up  \n14:13\u00a0<martin-h>\u00a0(btw the xar export on v2.7 crashed at 1.7GB)  \n14:14\u00a0<ol-ow2>\u00a0has joined #xwiki  \n14:15\u00a0<vmassol>\u00a0martin-h: yes that's known, you should use the large xar export extension as I mentioned  \n14:15\u00a0<vmassol>\u00a0(for old xwiki versions)  \n14:16\u00a0<martin-h>\u00a0it is the one which is linked on the admin tool page ?  \n14:16\u00a0<vmassol>\u00a0go to extensions.xwiki.org  \n14:16\u00a0<vmassol>\u00a0and filter on \"export\"  \n14:17\u00a0<martin-h>\u00a0vmassol, the wizard are \"completed\" in PermDir/jobs/status/distribution/wiki/ow2/status.xml  \n14:18\u00a0<vmassol>\u00a0for this wiki?  \n14:18\u00a0<vmassol>\u00a0it's not possible since this wiki didn't exist :)  \n14:18\u00a0<martin-h>\u00a0well, we've restored the sql dump file after having created the descriptor, then started xwiki  \n14:19\u00a0<martin-h>\u00a0then here we are  \n14:19\u00a0\\*\u00a0ol-ow2 hi all  \n14:19\u00a0<martin-h>\u00a0could a be a fantom from our previous try...  \n14:19\u00a0<vmassol>\u00a0you're looking at th wrong one I think martin-h  \n14:20\u00a0<vmassol>\u00a0should be in jobs/status/distribution/wiki/\\*  \n14:20\u00a0<vmassol>\u00a0if you're looking at jobs/status/distribution/status.xml then that's the main wiki one  \n14:20\u00a0<vmassol>\u00a0and it's normal it's completed  \n14:20\u00a0<martin-h>\u00a0here the wiki is 'ow2' so I think it's the good one  \n14:20\u00a0<vmassol>\u00a0you're in distribution/wiki/ow2/status.xml?  \n14:21\u00a0<martin-h>\u00a0yes  \n14:21\u00a0<vmassol>\u00a0then I think you did something wrong  \n14:21\u00a0<vmassol>\u00a0as I don't see how this can have existed on a clean xwiki  \n14:21\u00a0<martin-h>\u00a0I'll try again.  \n14:21\u00a0<vmassol>\u00a0and you didn't create a subwiki  \n14:21\u00a0<vmassol>\u00a0so you got this file from a previous install or somerhting  \n14:22\u00a0<vmassol>\u00a0?  \n14:22\u00a0<vmassol>\u00a0you can check somerthing  \n14:22\u00a0<vmassol>\u00a0forget that  \n14:23\u00a0<vmassol>\u00a0now I'm really not an expert in dsitribution wizard  \n14:23\u00a0<martin-h>\u00a0:)  \n14:23\u00a0<vmassol>\u00a0so I really don't know how it works  \n14:23\u00a0<martin-h>\u00a0well we will deploy again  \n14:23\u00a0<martin-h>\u00a0and see  \n14:23\u00a0<vmassol>\u00a0thomas is the expert but he's on holidays too  \n14:24\u00a0<vmassol>\u00a0mflorea might know too  \n14:25\u00a0<vmassol>\u00a0grr seems I broke the build with my dep upgrade, checking  \n14:25\u00a0<OSIMasson>\u00a0has quit  \n14:27\u00a0<vmassol>\u00a0Denis: grrr seems the upgrade to BC 1.52 (from 1.49) is caused some exception in our tests  \n14:28\u00a0<vmassol>\u00a0if you have an idea\u2026 https://gist.githubusercontent.com/vmassol/ac794dcdf9a51e896764/raw/d8bde8f337933dc530993b8a2381dfe99a1925f9/gistfile1.txt  \n14:30\u00a0<Denis>\u00a0vmassol: at first look, they have changed their random source need and the way new key are created. Not worrying, you may want to skip that test for now  \n14:30\u00a0<vmassol>\u00a0there are 2 failing tests  \n14:31\u00a0<vmassol>\u00a0testGenerateWithoutArgument() and testGenerateWithStrengthParameter()  \n14:31\u00a0<vmassol>\u00a0both with ArrayIndexOutOfBoundsException  \n14:31\u00a0<Denis>\u00a0basically, FixedSecureRandom is a fix source of random value, so the test can predict the results of key generation  \n14:31\u00a0<cjd>\u00a0InSecureRandom :)  \n14:32\u00a0<Denis>\u00a0totally non random  \n14:33\u00a0<Denis>\u00a0but still random enough, since the behavior of the algorithm check the quality of the entropy  \n14:33\u00a0<vmassol>\u00a0looks like a BC bug to me, I guessI should revert  \n14:33\u00a0<Denis>\u00a0and, it seems its judgement has changed  \n14:34\u00a0<Denis>\u00a0not necessarily, it could be an improvement  \n14:34\u00a0<cjd>\u00a0why are you checking entropy of SecureRandom ?  \n14:34\u00a0<vmassol>\u00a0so the quesiton is: what are we doing wrong that causes a ArrayIndexOutOfBoundsException downstream?  \n14:34\u00a0<Denis>\u00a0I am not, BC checks, and my fixed source is limited  \n14:35\u00a0<cjd>\u00a0oh that's bizarre  \n14:35\u00a0<Denis>\u00a0it get out of my fixed array of random data  \n14:35\u00a0<vmassol>\u00a0the error is in FixedSecureRandomProvider  \n14:35\u00a0<cjd>\u00a0oh I see  \n14:36\u00a0<Denis>\u00a0it is requesting more random than I have been prepare to give  \n14:36\u00a0<cjd>\u00a0I have a way to solve this I think...  \n14:36\u00a0<vmassol>\u00a0btw you have some commented leftotver in FixedSecureRandomProvider ;)  \n14:36\u00a0<Denis>\u00a0yet, I know, used to debug  \n14:36\u00a0<cjd>\u00a0https://docs.oracle.com/javase/7/docs/api/java/security/SecureRandom.html#SecureRandom(byte[])  \n14:37\u00a0<Denis>\u00a0using secure random for test is very slow  \n14:37\u00a0<vmassol>\u00a0Denis: do you think you could \u00a0have a look to make the 2 tests pass?  \n14:37\u00a0<Denis>\u00a0the issue is that the entropy is insufficient  \n14:37\u00a0<cjd>\u00a0look at the constructor :)  \n14:37\u00a0<vmassol>\u00a0(going to be complex for me to figure out)  \n14:37\u00a0<Denis>\u00a0and so it take long for the test to pass  \n14:38\u00a0<Denis>\u00a0the fixed table I have introduce has a quite nice entropy, but it seems it was quite nice for 1.49 and is no more nice for 1.52  \n14:38\u00a0<cjd>\u00a0I have the same needs in my tests, I \\*seed\\* my prng determinently but I still use a true prng  \n14:39\u00a0<Denis>\u00a0basically, we need either to increase entropy of that table, or we need to increase its length  \n14:39\u00a0<vmassol>\u00a0(there's no javadoc to FixedSecureRandomProvider either so I'm really out of my depth here to understand what it's doing - it's not like it's easy to read :))  \n14:39\u00a0<vmassol>\u00a0some unused code too it seems: MySecureRandom  \n14:39\u00a0<OSIMasson>\u00a0has joined #xwiki  \n14:39\u00a0<cjd>\u00a0you can do it <cheerleader>  \n14:39\u00a0<Denis>\u00a0the issue is not the provider  \n14:40\u00a0<Denis>\u00a0the provider is there to master the random source used by the test  \n14:40\u00a0<vmassol>\u00a0I woudn't want to eb the one to have to maintain this code in the future! :)  \n14:40\u00a0<Denis>\u00a0the issue is in FixedSecureRandom  \n14:40\u00a0<vmassol>\u00a0I don't see any FixedSecureRandom in our code  \n14:41\u00a0<vmassol>\u00a0I see only import org.bouncycastle.crypto.prng.FixedSecureRandom  \n14:42\u00a0<Denis>\u00a0oh sorry, I forgot it was provided by BC  \n14:42\u00a0<Denis>\u00a0so the issue is in FixedSecureRandomProvider which old the table  \n14:43\u00a0\\*\u00a0cjd hands BC the duncecap of shame  \n14:44\u00a0<Denis>\u00a0vmassol: so basically, there is no more enough entropy in RANDOM\\_DATA  \n14:45\u00a0<vmassol>\u00a0Denis: we have 2 choices: rollback the change now or you have a quick look to make the 2 tests pass  \n14:45\u00a0<Denis>\u00a0I agree, it is not an easy one, just because you need a good entropy source, or RANDOM\\_DATA gonna be very big  \n14:46\u00a0<vmassol>\u00a0(if we rollback, I hope Tika 1.8 will still work)  \n14:46\u00a0<vmassol>\u00a0(or I need to roll it back too ;))  \n14:46\u00a0<Denis>\u00a0or you slow down test by a true random source  \n14:46\u00a0<vmassol>\u00a0I could uncomment the tests but it means they're not useful  \n14:46\u00a0<vmassol>\u00a0Denis: I wouldn't even know how to do that  \n14:48\u00a0<Denis>\u00a0just looking at the code, the MySecureRandom, there is all to create a new source of reasonable size :)  \n14:49\u00a0<martin-h>\u00a0vmassol, once the descriptor is created by hand, is it expected to be listed in bin/view/WikiManager/ ?  \n14:49\u00a0<vmassol>\u00a0martin-h: I think so yes  \n14:50\u00a0<vmassol>\u00a0since that livetable must do some HQL to get all descirptors  \n14:54\u00a0<martin-h>\u00a0vmassol, we restarted a xwiki installation from scratch, added the descriptor, which is there but not listed. Very strange  \n14:55\u00a0<Denis>\u00a0vmassol: are you reproducing the issue on the current HEAD ?  \n14:55\u00a0<vmassol>\u00a0martin-h: the code is in WikiManager.WikisLiveTableResults I think  \n14:56\u00a0<vmassol>\u00a0Denis: yes I'm on master  \n14:56\u00a0<Denis>\u00a0BcDSAKeyPairGenerator and BcDSAKeyPairGenerator  \n14:56\u00a0<Denis>\u00a0and BcRSAKeyPairGenerator  \n14:56\u00a0<vmassol>\u00a0martin-h: getAll() should return all but then there's a check  \n14:56\u00a0<Denis>\u00a0?  \n14:57\u00a0<vmassol>\u00a0#if ($xwiki.hasAccessLevel('view', $xcontext.user, $testPageReference) || ($services.wiki.user.getUserScope($wiki.id)!='LOCAL\\_ONLY' &amp;&amp; $services.wiki.user.getMembershipType($wiki.id) != 'INVITE') || $services.wiki.user.hasPendingInvitation($xcontext.userReference, $wiki.id))  \n14:57\u00a0<vmassol>\u00a0Denis: what's the question?  \n14:57\u00a0<Denis>\u00a0the failing tests ?  \n14:57\u00a0<vmassol>\u00a0there are 2  \n14:58\u00a0<vmassol>\u00a02 test methods in BcRSAKeyPairGeneratorTest  \n14:58\u00a0<vmassol>\u00a0rest is passing  \n15:00\u00a0<Denis>\u00a0ok, I finally reproduced  \n15:00\u00a0<vmassol>\u00a0cool  \n15:01\u00a0<msmeria>\u00a0has quit  \n15:03\u00a0<OSIMasson>\u00a0has quit  \n15:03\u00a0<Trefex>\u00a0has joined #xwiki  \n15:07\u00a0<cjd>\u00a0has quit  \n15:14\u00a0<cjd>\u00a0has joined #xwiki  \n15:20\u00a0<lucaa>\u00a0has quit  \n15:21\u00a0<martin-h>\u00a0vmassol, it seems there should be a \u00a0WikiManager.WikiTemplateClass object in the descriptor too  \n15:22\u00a0<vmassol>\u00a0yes possible  \n15:22\u00a0<vmassol>\u00a0isn't this for templates only?  \n15:23\u00a0<ol-ow2>\u00a0it describe if there or not a template  \n15:23\u00a0<martin-h>\u00a0if not present, not listed.  \n15:24\u00a0<vmassol>\u00a0indeed  \n15:24\u00a0<vmassol>\u00a0an improvement could be to list it even if there's no such object  \n15:24\u00a0<vmassol>\u00a0and assume it's not a template if it doesn't exist  \n15:24\u00a0<vmassol>\u00a0you could create a jira issue for this if you want  \n15:24\u00a0<vmassol>\u00a0:)  \n15:34\u00a0<ClemensR>\u00a0has joined #xwiki  \n15:36\u00a0<lucaa>\u00a0has joined #xwiki  \n15:41\u00a0<lucaa>\u00a0has quit  \n15:43\u00a0<Trefex>\u00a0has quit  \n15:49\u00a0<martin-h>\u00a0vmassol, wrong way, it was not only the template. Now we have '2015-04-21 15:30:09,516 [http://main.ow2.org/bin/save/XWiki/XWikiServerOw2] ERROR .o.i.DefaultObservationMana  \n15:49\u00a0<martin-h>\u00a0java.lang.NullPointerException: Null keys are not supported!  \n15:53\u00a0<martin-h>\u00a0vmassol, and I notice the text : \"This page defines how to access the \"wiki.id\" wiki\"  \n15:53\u00a0<martin-h>\u00a0so something is missing in the descriptor, cannot sort what  \n16:00\u00a0<OSIMasson>\u00a0has joined #xwiki  \n16:02\u00a0<silverdrop>\u00a0has quit  \n17:00\u00a0<lucaa>\u00a0has joined #xwiki  \n17:09\u00a0<KermitTheFragger>\u00a0has quit  \n17:11\u00a0<lucaa>\u00a0has quit  \n17:24\u00a0<lucaa>\u00a0has joined #xwiki  \n17:38\u00a0<lucaa1>\u00a0has joined #xwiki  \n17:40\u00a0<lucaa>\u00a0has quit  \n17:45\u00a0<ol-ow2>\u00a0has quit  \n17:48\u00a0<lucaa1>\u00a0has quit  \n17:52\u00a0<woshilapin>\u00a0has quit  \n17:55\u00a0<ClemensR>\u00a0has left #xwiki  \n18:06\u00a0<cjd>\u00a0has quit  \n18:08\u00a0<lucaa>\u00a0has joined #xwiki  \n18:14\u00a0<woshilapin>\u00a0has joined #xwiki  \n18:47\u00a0<lucaa>\u00a0has quit  \n19:10\u00a0<OSIMasson>\u00a0has quit  \n19:12\u00a0<gsmeria>\u00a0has quit  \n19:12\u00a0<vmassol>\u00a0has quit  \n19:16\u00a0<gsmeria>\u00a0has joined #xwiki  \n19:55\u00a0<OSIMasson>\u00a0has joined #xwiki  \n20:06\u00a0<Bugen\\_do>\u00a0has joined #xwiki  \n20:39\u00a0<OSIMasson>\u00a0has quit  \n20:51\u00a0<OSIMasson>\u00a0has joined #xwiki  \n21:02\u00a0<woshilapin>\u00a0has quit  \n21:08\u00a0<evalica>\u00a0has quit  \n21:08\u00a0<Enygma`>\u00a0has quit  \n21:20\u00a0<vmassol>\u00a0has joined #xwiki  \n21:20\u00a0<vmassol>\u00a0Denis: thanks for fixinf the unit tests in commons!  \n21:22\u00a0<vmassol>\u00a0Denis: passing here but it's very long  \n21:22\u00a0<vmassol>\u00a0https://gist.githubusercontent.com/vmassol/442e823b9b01a85ea711/raw/61fade1f784f03897a64b882a65da1e15293c647/gistfile1.txt  \n21:22\u00a0<vmassol>\u00a028 seconds for a unit tests sounds too much  \n21:23\u00a0<gsmeria>\u00a0has quit  \n21:29\u00a0<MasterPiece>\u00a0has joined #xwiki  \n21:31\u00a0<gsmeria>\u00a0has joined #xwiki  \n21:31\u00a0<MasterPiece>\u00a0has quit  \n21:32\u00a0<MasterPiece>\u00a0has joined #xwiki  \n21:35\u00a0<MasterPiece>\u00a0has quit  \n21:35\u00a0<MasterPiece>\u00a0has joined #xwiki  \n21:38\u00a0<MasterPiece>\u00a0has quit  \n21:38\u00a0<MasterPiece>\u00a0has joined #xwiki  \n21:39\u00a0<MasterPiece>\u00a0has quit  \n21:49\u00a0<vmassol>\u00a0has quit  \n21:57\u00a0<Bugen\\_do>\u00a0has quit  \n22:24\u00a0<Denis>\u00a0vmassol: DSA key generation is just long, it is CPU time, I cannot do much to this  \n23:21\u00a0<mflorea>\u00a0has quit  \n23:28\u00a0<OSIMasson>\u00a0has quit\n"}