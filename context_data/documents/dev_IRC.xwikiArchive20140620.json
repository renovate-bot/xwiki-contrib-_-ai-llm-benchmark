{"id": "dev:IRC.xwikiArchive20140620", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20140620", "title": "IRC Archive for channel #xwiki on 20 June 2014 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<lucaa>\u00a0has quit  \n04:30\u00a0<OSIMasson>\u00a0has quit  \n06:03\u00a0<Denis>\u00a0has quit  \n06:06\u00a0<Denis>\u00a0has joined #xwiki  \n07:15\u00a0<mflorea>\u00a0has joined #xwiki  \n07:17\u00a0<msmeria>\u00a0has joined #xwiki  \n07:38\u00a0<mflorea>\u00a0has quit  \n07:59\u00a0<vmassol>\u00a0has joined #xwiki  \n08:20\u00a0<evalica>\u00a0has joined #xwiki  \n08:39\u00a0<cjd>\u00a0has joined #xwiki  \n08:45\u00a0<KermitTheFragger>\u00a0has joined #xwiki  \n08:48\u00a0<tmortagne>\u00a0has joined #xwiki  \n08:55\u00a0<vmassol>\u00a0cjd: good morning  \n08:55\u00a0<vmassol>\u00a0you here?  \n08:57\u00a0<cjd>\u00a0what's up?  \n08:58\u00a0<vmassol>\u00a0Hi, actually I've pinged you skype :)  \n08:58\u00a0<vmassol>\u00a0some potentially security-relaetd issue that I'd rather not explain here  \n09:03\u00a0<cjd>\u00a0ok  \n09:12\u00a0<woshilapin>\u00a0has joined #xwiki  \n09:18\u00a0<lucaa>\u00a0has joined #xwiki  \n09:27\u00a0<Lyes>\u00a0has joined #xwiki  \n09:39\u00a0<ClemensR>\u00a0has joined #xwiki  \n09:42\u00a0<Enygma`>\u00a0has joined #xwiki  \n09:43\u00a0<mflorea>\u00a0has joined #xwiki  \n09:56\u00a0<evalica>\u00a0has quit  \n09:56\u00a0<evalica>\u00a0has joined #xwiki  \n10:28\u00a0<Enygma`>\u00a0has quit  \n10:28\u00a0<Enygma`1>\u00a0has joined #xwiki  \n10:32\u00a0<Slashman>\u00a0has joined #xwiki  \n10:36\u00a0<Enygma`1>\u00a0is now known as <Enygma>  \n10:36\u00a0<Enygma>\u00a0is now known as <Enygma`>  \n10:47\u00a0<Enygma`>\u00a0has quit  \n10:50\u00a0<Enygma`>\u00a0has joined #xwiki  \n10:55\u00a0<ClemensR>\u00a0anyone knowns if there are examples of traversing XDOM in a velocity macro ? (i.e. how do you construct a BlockFilter or such)  \n10:57\u00a0<vmassol>\u00a0ClemensR: we don't have a scripting api for rendering yet  \n10:57\u00a0<vmassol>\u00a0so it's going to be impossible without PR  \n10:57\u00a0<vmassol>\u00a0(groovy, python, ruby)  \n10:57\u00a0<ClemensR>\u00a0ah, ok, thought so, just wanted to ask if I missed soimething  \n10:57\u00a0<ClemensR>\u00a0(velocity macro has PR, it had to)  \n10:57\u00a0<vmassol>\u00a0what's your need? maybe you should write it in a component?  \n10:58\u00a0<ClemensR>\u00a0its the Syntax Guide bug, XWIKI-10462  \n10:58\u00a0<ClemensR>\u00a0did not want to add an api component to the help just for that  \n10:58\u00a0<vmassol>\u00a0FYI it's done here but in groovy: http://dev.xwiki.org/xwiki/bin/view/Community/ReleaseManagerRoster?viewer=code  \n10:59\u00a0<vmassol>\u00a0ah maybe there's some otehr way of doing it  \n11:00\u00a0<ClemensR>\u00a0ah, yes, maybe I should just switch to groovy fir the \"computational\" part .... or use $doc.getTOC() instead ...  \n11:03\u00a0<vmassol>\u00a0if this is bundled in XE then groovy isn't nice  \n11:03\u00a0<vmassol>\u00a0since we have an implicit rule of not using it anywhere  \n11:03\u00a0<vmassol>\u00a0and minimizing the need for PR  \n11:04\u00a0<ClemensR>\u00a0ah, ok, then I struggle on with velocity. Syntax help guide already need PW for its XWQL query, I think ...  \n11:04\u00a0<vmassol>\u00a0that needs to be fixed then  \n11:04\u00a0<vmassol>\u00a0:)  \n11:09\u00a0<ClemensR>\u00a0well, I can use another method from oldcore, like $doc.getTOC, then I need no PR. Or add an xwiki-platform-help-api and move the PR-needing part of the help guide to that, so we need to bundle that api-jar to XE, too. I just hopes to get that bug fixed in a somewhat simpler way (should have fixed it yesterday already ...)  \n11:20\u00a0<ClemensR>\u00a0btw: \u00a0AbstractBlock#hashCode \u00a0\u00a0seems to crate endless loops (I ran into this by doing a \"String + Block\" in some debugging code by accident). Looking at the code of the HashCodeBuilder used there it is written to prevent such loops, but it still happens for me ...  \n11:20\u00a0<vmassol>\u00a0weird...  \n11:22\u00a0<ClemensR>\u00a0maybe it is just in the blocks of my handwritten documents :)  \n11:30\u00a0<tmortagne>\u00a0ClemensR: the difficulty in velocity is creating the BlockMatcher  \n11:31\u00a0<ClemensR>\u00a0tmortagne: \u00a0yes, I agree :) I have not figured out how to do that, now looking into different approaches  \n11:31\u00a0<tmortagne>\u00a0an idea that would cover your use case would to to provide a Converter for BlockMatcher which generate a ClassBlockMatcher  \n11:32\u00a0<tmortagne>\u00a0and you pass the class name as a String  \n11:33\u00a0<tmortagne>\u00a0i.e. $block.getBlocks(\"org.xwiki.rendering.block.WordBlock\", \"DESCENDANT\")  \n11:33\u00a0<tmortagne>\u00a0(there is already a Converter for enums)  \n11:34\u00a0<tmortagne>\u00a0could even support \"WordBlock\" in BlockMatcherConverter by fallbacking on \"org.xwiki.rendering.block\" package when the class is not found  \n11:34\u00a0<tmortagne>\u00a0so that would give $block.getBlocks(\"WordBlock\", \"DESCENDANT\")  \n11:34\u00a0<ClemensR>\u00a0ah, ok, but then this needs much more coding elsewhere ...  \n11:35\u00a0<tmortagne>\u00a0just need to implement a BlockMatcherConverter component  \n11:35\u00a0<tmortagne>\u00a0could be put in rendering-api  \n11:36\u00a0<tmortagne>\u00a0you can look at org.xwiki.properties.internal.converter.LocaleConverter (xwiki-properties) for a simple converter example  \n11:36\u00a0<ClemensR>\u00a0ok, me looking around in the code ....  \n11:37\u00a0<tmortagne>\u00a0there is already a SyntaxConverter in rendering-api  \n11:37\u00a0<tmortagne>\u00a0maybe a better example  \n11:39\u00a0<ClemensR>\u00a0yes, found it! :) \u00a0but I still would need to write a new xwiki-platform-help-api to access that stuff, I guess. I hoped to fix the bug without that much extra code  \n11:40\u00a0<tmortagne>\u00a0no  \n11:40\u00a0<tmortagne>\u00a0that's a XWiki-Velocity feature  \n11:40\u00a0<tmortagne>\u00a0parameters are automatically converted in a velocity unberspector  \n11:40\u00a0<tmortagne>\u00a0you just provide a Converter and you are done  \n11:41\u00a0<tmortagne>\u00a0it avoid script services APIs full of String parameters  \n11:42\u00a0<ClemensR>\u00a0ah, ok, I meant, just to access the DOM I need PR, and vmassol asked me to avoid that  \n11:42\u00a0<ClemensR>\u00a0the XDOM  \n11:43\u00a0<tmortagne>\u00a0here is no Document#getXDOM ?  \n11:43\u00a0<tmortagne>\u00a0\\*there  \n11:44\u00a0<tmortagne>\u00a0if not then that's all you need IMO  \n11:45\u00a0<ClemensR>\u00a0not in the api.Document class as far as I can see  \n11:45\u00a0<ClemensR>\u00a0rechecking (me looked at the SRD, but that is 5.0.x :)  \n11:47\u00a0<tmortagne>\u00a0I can't find it either  \n11:47\u00a0<ClemensR>\u00a0no getXDOM in the latest api document either .... I guess it is not because you can use it to change the XDOM, and i.e. changing PR-macros ?  \n11:48\u00a0<tmortagne>\u00a0calling Document#setContent() is a lot simpler ;)  \n11:48\u00a0<tmortagne>\u00a0it was not here just because it was not easy to use in Velocity IMO, there is no security reason to not do it  \n11:48\u00a0<ClemensR>\u00a0ah, ok, I see  \n11:49\u00a0<ClemensR>\u00a0would it be ok to write the BlockMatcherConverter \u00a0as part of XWIKI-10462 \u00a0or does that need another issue ?  \n11:49\u00a0<tmortagne>\u00a0just make sure you use this.getDoc().getXDOM() to make sure the XWikiDocument is cloned  \n11:49\u00a0<ClemensR>\u00a0need to clone even if I just read it ?  \n11:49\u00a0<tmortagne>\u00a0ClemensR: BlockMatcherConverter should be put in rendering module IMO  \n11:49\u00a0<tmortagne>\u00a0so not the same jira project  \n11:49\u00a0<ClemensR>\u00a0ah, ok, then an XRENDERING issue  \n11:50\u00a0<tmortagne>\u00a0you need to clone to not have the issue you described: allow anyone to modify the cached document XDOM  \n11:51\u00a0<tmortagne>\u00a0like getxWikiClass() for example  \n11:51\u00a0<tmortagne>\u00a0the document is cloned to make sure you will not modify the returned xclass  \n11:52\u00a0<vmassol>\u00a0this clone is costly though, need to explain it in the javadoc for the scirpting api maybe?  \n11:53\u00a0<ClemensR>\u00a0hm, it seems I cannot call $doc.getDoc() in velocity, as it is protected (or because I am doing something stupid)  \n11:54\u00a0<vmassol>\u00a0you need PR for that  \n11:54\u00a0<vmassol>\u00a0it'sn it getDocument()?  \n11:54\u00a0<vmassol>\u00a0(didn't check code)  \n11:54\u00a0<tmortagne>\u00a0ClemensR: why do you want to acess it from Velocity ?  \n11:54\u00a0<tmortagne>\u00a0I was talking about Document#getXDOM() implementation  \n11:55\u00a0<tmortagne>\u00a0you are not supposed to access any instance of XWikiDocument directly in Velocity  \n11:57\u00a0<ClemensR>\u00a0it is in the velocity of the XWiki.XWikiSyntax \u00a0page, where it collects all the section headlines of the subpages. the $doc.getSections() used there does not work sometimes  \n11:57\u00a0<ClemensR>\u00a0maybe I should try another approach anyway, this stitching together of the navigation from the different documents is somewhat messy and brittle anyway  \n12:03\u00a0<tmortagne>\u00a0it's a bit complex yes  \n12:04\u00a0<tmortagne>\u00a0now one document per section would produce quite a lot of documents  \n12:07\u00a0<ClemensR>\u00a0yes, one better could split the all the sections into rich text fields of some objects ... anyway, I guess \u00a0I am slowly getting somewhere here anyway  \n12:41\u00a0<ClemensR>\u00a0tmortagne: if I write a converter for BlockMatcher, would it maybe better to have something like $block.getBlocks(\"class=WordBlock\", \"DESCENDANT\") instead of $block.getBlocks(\"WordBlock\", \"DESCENDANT\"), just in case one day someone wants to use a different BlockMatcher (e.g. the MacroBlockMatcher) ?  \n12:47\u00a0<ClemensR>\u00a0(its not that I want to write a \"BlockMatcherSpecificationParserComponent\" just for that right now, just avoid that we have to support some \"legacy notation\" later on)  \n13:12\u00a0<Lyes>\u00a0has quit  \n13:54\u00a0<Lyes>\u00a0has joined #xwiki  \n13:56\u00a0<woshilapin>\u00a0has quit  \n13:58\u00a0<tmortagne>\u00a0ClemensR: \"class:WordBlock\" looks better  \n14:00\u00a0<ClemensR>\u00a0ok, fine with me too. I was already imagining use cases for the OrBlockMatcher: $block.getBlocks(\"class=WordBlock or macro=box\") ;)  \n14:01\u00a0<ClemensR>\u00a0I am going to push a first attempt in the head, or should I make a feature-branch for it, wiht 6.1RC1 upcoming soon >  \n14:01\u00a0<ClemensR>\u00a0s/>/?/  \n14:04\u00a0<tmortagne>\u00a0for the OrBlockMatcher that would see something more like \"or:class:WordBlock, macro:box\" (to follow constructor)  \n14:04\u00a0<tmortagne>\u00a0but yes it's a bit more technical  \n14:04\u00a0<tmortagne>\u00a0\"class=WordBlock or macro=box\" is difficult to parse  \n14:09\u00a0<ClemensR>\u00a0just kidding on the expression, I will just implement something simple for ClassBlockMatcher and will not write a full parser in any notation  \n14:51\u00a0<woshilapin>\u00a0has joined #xwiki  \n15:12\u00a0<msmeria>\u00a0has quit  \n15:16\u00a0<GuillaumeF>\u00a0has joined #xwiki  \n15:21\u00a0<vmassol>\u00a0guys I'm off starting now (I'll come back from time to time but I'll be mostly unavailable).  \n15:26\u00a0<Denis>\u00a0vmassol: wish a happy birthday to your wife on our behalf :)  \n15:27\u00a0<vmassol>\u00a0haha thanks!  \n15:27\u00a0<vmassol>\u00a0indeed I'm finishing the preparation for the surprise anniversay now :)  \n15:27\u00a0<vmassol>\u00a0(it's tomorrow evening)  \n15:28\u00a0<evalica>\u00a0I hope she won't read the IRC logs :) Happy Birthday for her!  \n15:34\u00a0<vmassol>\u00a0she won't :)  \n15:34\u00a0<vmassol>\u00a0thanks!  \n15:42\u00a0<OSIMasson>\u00a0has joined #xwiki  \n15:58\u00a0<tmortagne>\u00a0Putting myxwiki.org in maintenance mode for max one hour I hope  \n16:03\u00a0<evalica>\u00a0has quit  \n16:07\u00a0<ClemensR>\u00a0has left #xwiki  \n16:08\u00a0<Enygma`>\u00a0has quit  \n16:34\u00a0<ClemensR>\u00a0has joined #xwiki  \n16:44\u00a0<Lyes>\u00a0has quit  \n16:59\u00a0<Denis>\u00a0has quit  \n17:03\u00a0<mflorea>\u00a0has quit  \n17:18\u00a0<tmortagne>\u00a0it might actually take more time  \n17:18\u00a0<tmortagne>\u00a0I will put back access in a few hours  \n17:33\u00a0<tmortagne>\u00a0has quit  \n17:52\u00a0<woshilapin>\u00a0has quit  \n17:53\u00a0<Slashman>\u00a0has quit  \n18:01\u00a0<Slashman>\u00a0has joined #xwiki  \n18:04\u00a0<tmortagne>\u00a0has joined #xwiki  \n18:06\u00a0<tmortagne>\u00a0has quit  \n18:06\u00a0<tmortagne1>\u00a0has joined #xwiki  \n18:31\u00a0<KermitTheFragger>\u00a0has quit  \n19:10\u00a0<ClemensR>\u00a0has quit  \n19:22\u00a0<Slashman>\u00a0has quit  \n19:47\u00a0<GuillaumeF>\u00a0has quit  \n19:49\u00a0<cjd>\u00a0has quit  \n19:52\u00a0<lucaa>\u00a0has quit  \n20:29\u00a0<OSIMasson>\u00a0has quit  \n20:52\u00a0<Slashman>\u00a0has joined #xwiki  \n20:54\u00a0<lucaa>\u00a0has joined #xwiki  \n21:28\u00a0<polx>\u00a0has joined #xwiki  \n22:02\u00a0<lucaa>\u00a0has quit  \n22:25\u00a0<polx>\u00a0has quit  \n22:27\u00a0<vmassol>\u00a0has quit  \n22:27\u00a0<polx>\u00a0has joined #xwiki  \n22:29\u00a0<OSIMasson>\u00a0has joined #xwiki  \n22:54\u00a0<tmortagne1>\u00a0has quit  \n23:02\u00a0<vmassol>\u00a0has joined #xwiki  \n23:03\u00a0<OSIMasson>\u00a0has quit  \n23:15\u00a0<vmassol>\u00a0has quit  \n23:49\u00a0<sdumitriu>\u00a0has quit\n"}