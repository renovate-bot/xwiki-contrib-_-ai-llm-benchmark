{"id": "dev:IRC.xwikiArchive20160203", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20160203", "title": "IRC Archive for channel #xwiki on 03 February 2016 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<cjd>\u00a0has joined #xwiki  \n00:48\u00a0<abusenius>\u00a0has quit  \n05:34\u00a0<mflorea>\u00a0has joined #xwiki  \n07:18\u00a0<msmeria>\u00a0has joined #xwiki  \n07:34\u00a0<vmassol>\u00a0has joined #xwiki  \n08:02\u00a0<mflorea>\u00a0has quit  \n08:24\u00a0<vmassol>\u00a0has quit  \n08:35\u00a0<cjd>\u00a0has quit  \n08:49\u00a0<KermitTheFragger>\u00a0has joined #xwiki  \n08:54\u00a0<tmortagne>\u00a0has joined #xwiki  \n09:01\u00a0<cjd>\u00a0has joined #xwiki  \n09:02\u00a0<vmassol>\u00a0has joined #xwiki  \n09:18\u00a0<vmassol>\u00a0has quit  \n09:27\u00a0<mflorea>\u00a0has joined #xwiki  \n09:38\u00a0<vmassol>\u00a0has joined #xwiki  \n09:45\u00a0<Slashman>\u00a0has joined #xwiki  \n09:55\u00a0<msmeria1>\u00a0has joined #xwiki  \n09:56\u00a0<msmeria>\u00a0has quit  \n10:03\u00a0<evalica>\u00a0has joined #xwiki  \n10:03\u00a0<Enygma`>\u00a0has joined #xwiki  \n10:12\u00a0<woshilapin>\u00a0has joined #xwiki  \n10:19\u00a0<gdelhumeau>\u00a0has joined #xwiki  \n10:59\u00a0<Denis>\u00a0has quit  \n11:00\u00a0<Denis>\u00a0has joined #xwiki  \n11:02\u00a0<vmassol>\u00a0gdelhumeau: gm, do you know what user we use when creating a new subwiki? I'm trying to find the code, do you know where it is?  \n11:03\u00a0<gdelhumeau>\u00a0You mean the provisionning? superadmin  \n11:03\u00a0<vmassol>\u00a0ok thanks, do you know where the code is?  \n11:04\u00a0<gdelhumeau>\u00a0https://github.com/xwiki/xwiki-platform/blob/master/xwiki-platform-core/xwiki-platform-wiki/xwiki-platform-wiki-creationjob/src/main/java/org/xwiki/platform/wiki/creationjob/internal/ExtensionInstaller.java#L70-70  \n11:04\u00a0<vmassol>\u00a0thanks  \n11:05\u00a0<vmassol>\u00a0I'm asking because Ludovic reported some perf issue on some xwiki instance  \n11:05\u00a0<vmassol>\u00a0wiki creation taking very long time (more than 10mn)  \n11:05\u00a0<vmassol>\u00a0and it seems the reason was autowatch on the Admin user  \n11:06\u00a0<vmassol>\u00a0adding all the docs to the autowatch....  \n11:06\u00a0<vmassol>\u00a0I mean watchlist  \n11:06\u00a0<vmassol>\u00a0if it's superadmin I don't see why it would do that  \n11:06\u00a0<vmassol>\u00a0maybe it's an older version  \n11:07\u00a0<vmassol>\u00a0before we installed docs with superadmin  \n11:12\u00a0<vmassol>\u00a0could you check the version of hte groovy jar in WEB-INF/lib?  \n11:14\u00a0<vmassol>\u00a0oops  \n11:14\u00a0<vmassol>\u00a0wrong chat  \n11:14\u00a0<tmortagne>\u00a0\"the reason was autowatch on the Admin user\" wiki are supposed to be created inside folded events not taken into account by autowatch  \n11:16\u00a0<tmortagne>\u00a0I think at some point (before provisionning job system and extension based wiki creation) there was a bug like this but now I don't see how autowatch could react to document imported during wiki creation  \n11:17\u00a0<cjd\\_>\u00a0has joined #xwiki  \n11:17\u00a0<vmassol>\u00a0watchlist is coded to ignore folded events?  \n11:17\u00a0<vmassol>\u00a0answer: yes  \n11:17\u00a0<vmassol>\u00a0(just checked the code)  \n11:18\u00a0<vmassol>\u00a0if (observationContext.isIn(IGNORED\\_EVENTS)) {  \n11:18\u00a0<vmassol>\u00a0}  \n11:18\u00a0<vmassol>\u00a0:)  \n11:18\u00a0<vmassol>\u00a0done in http://jira.xwiki.org/browse/XWIKI-9543 , ie XWiki 5.3M1  \n11:19\u00a0<tmortagne>\u00a0autowatch has been disgned to ignore certain kind of event (before folding event concept existed), I don't know if gdelhumeau refactored it to use the new folded events API  \n11:19\u00a0<cjd>\u00a0has quit  \n11:20\u00a0<gdelhumeau>\u00a0Haven't do anything regarding this  \n11:20\u00a0<tmortagne>\u00a0XWIKI-9543 is activity stream  \n11:20\u00a0<tmortagne>\u00a0not watchlist  \n11:20\u00a0<vmassol>\u00a0ah sorry my bad I mixed the to  \n11:20\u00a0<vmassol>\u00a0\\*two  \n11:20\u00a0<gdelhumeau>\u00a0I beileve EM triggers a Fold Event before it installs pages  \n11:20\u00a0<tmortagne>\u00a0anyway the event produced by XAR import are taken into account by autowatch  \n11:21\u00a0<tmortagne>\u00a0and EM produce XAR import events  \n11:21\u00a0<tmortagne>\u00a0(which also happen to be folded events)  \n11:21\u00a0<tmortagne>\u00a0we need to refactor it to use new folded events API but anyway autowatch ignore import since a very long time  \n11:22\u00a0<vmassol>\u00a0ok  \n11:22\u00a0<tmortagne>\u00a0it also ignore WikiCreatingEvent and JobEvent so it's ignoring whatever a Job is doing  \n11:22\u00a0<vmassol>\u00a0ok  \n11:23\u00a0<Bugendol1>\u00a0has quit  \n11:23\u00a0<vmassol>\u00a0doesn't seem to ignore fold events though  \n11:25\u00a0<vmassol>\u00a0but WikiCreatingEvent should be enough  \n11:27\u00a0<gdelhumeau>\u00a0note: the WikiCreatedEvent is sent just when the wiki is created, not after the provisioning  \n11:27\u00a0<gdelhumeau>\u00a0https://github.com/xwiki/xwiki-platform/blob/master/xwiki-platform-core/xwiki-platform-wiki/xwiki-platform-wiki-default/src/main/java/org/xwiki/wiki/internal/manager/DefaultWikiManager.java#L91-91  \n11:27\u00a0<gdelhumeau>\u00a0The provision step does not send any event by itself  \n11:27\u00a0<tmortagne>\u00a0gdelhumeau: it's a job  \n11:27\u00a0<tmortagne>\u00a0so it's ignored  \n11:28\u00a0<gdelhumeau>\u00a0I'm wrong it sends WikiProvisioningEvent actually  \n11:28\u00a0<gdelhumeau>\u00a0ok  \n11:28\u00a0<cjd\\_>\u00a0is now known as <cjd>  \n11:28\u00a0<tmortagne>\u00a0right now any job is ignored so it covers a lot of long tasks  \n11:29\u00a0<tmortagne>\u00a0but using FoldedEvent API would be cleaner since that's what this API is for  \n11:29\u00a0<tmortagne>\u00a0for example with the new refactoring job we don't autowatch moved or copied document which is not accurate IMO  \n11:32\u00a0<vmassol>\u00a0actually FoldedEvent is not meant to ignore events  \n11:32\u00a0<vmassol>\u00a0it's meant to indicate a group of events  \n11:32\u00a0<vmassol>\u00a0it shouldn't be ignore  \n11:32\u00a0<vmassol>\u00a0\\*ignored  \n11:32\u00a0<vmassol>\u00a0the listeners need to decide what to do with it  \n11:33\u00a0<vmassol>\u00a0ie display only 1 event or all the nested ones  \n11:36\u00a0<evalica>\u00a0has quit  \n11:37\u00a0<Pbas>\u00a0has quit  \n11:43\u00a0<Pbas>\u00a0has joined #xwiki  \n11:44\u00a0<vmassol>\u00a0starting work on XWIKI-13055  \n11:50\u00a0<tmortagne>\u00a0vmassol: the use case that leaded to design \u00a0FoldedEvent was to indicate that event inside should be ignored (not FoldedEvent themself)  \n11:51\u00a0<vmassol>\u00a0not really  \n11:51\u00a0<tmortagne>\u00a0yes really :)  \n11:51\u00a0<vmassol>\u00a0for example the AS should not ignore them  \n11:51\u00a0<vmassol>\u00a0i should group them together but offer the ability to expand them  \n11:51\u00a0<vmassol>\u00a0\\*it  \n11:52\u00a0<vmassol>\u00a0if it was to ignore them it would have been called IgnoredEvent  \n11:52\u00a0<vmassol>\u00a0and not FoldEvent  \n11:52\u00a0<vmassol>\u00a0fold is for \u2026. folding\u2026 :)  \n11:52\u00a0<vmassol>\u00a0not ignoring  \n11:53\u00a0<tmortagne>\u00a0I'm explaining to you what it was designed for when it was introduced, you can reinterpret it if you want to that's another subject  \n11:55\u00a0<tmortagne>\u00a0the goal was to indicate what was the actual action so that AS knows what is a \"sub-action\" (document created during an import, etc.) and ignore it (which it does right now)  \n11:56\u00a0<vmassol>\u00a0I was part of the design so I remember very well :)  \n11:58\u00a0<vmassol>\u00a0you're confusing what it was designed for and how it's been used (which is temporary for AS)  \n12:06\u00a0<evalica>\u00a0has joined #xwiki  \n12:16\u00a0<vmassol>\u00a0mflorea: maybe you can help me. Apparently we have some JS that removes <div class=\"bottombuttons\"> and put some other <div class=\"bottombuttons\"> which makes ConfigurableClass rendering generate the new div outside of the form. Any idea where that could be located?  \n12:16\u00a0<vmassol>\u00a0rings a bell?  \n12:33\u00a0<mflorea>\u00a0vmassol: no, I would check actionbuttons.js first  \n13:02\u00a0<vmassol>\u00a0ok thanks  \n13:03\u00a0<cjd>\u00a0has quit  \n13:28\u00a0<evalica>\u00a0has quit  \n13:32\u00a0<vmassol1>\u00a0has joined #xwiki  \n13:34\u00a0<vmassol>\u00a0has quit  \n13:50\u00a0<evalica>\u00a0has joined #xwiki  \n13:58\u00a0<vmassol1>\u00a0ok found \u00a0the JS I think, it's in a JSX in ConfigurableClass  \n14:07\u00a0<vmassol1>\u00a0wow can't believe how hacky this code is....  \n14:07\u00a0<vmassol1>\u00a0I won't congratulate caleb :) too bad he's not here  \n14:30\u00a0<vmassol1>\u00a0grrr actionButtons.js is minified...  \n14:47\u00a0<vmassol1>\u00a0I need some js expert help :)  \n14:47\u00a0<vmassol1>\u00a0in actionButtons.js we have:  \n14:48\u00a0<vmassol1>\u00a0this.form.action.contains(\"/preview/\")  \n14:48\u00a0<vmassol1>\u00a0I have verified that this.form.action returns a string  \n14:48\u00a0<vmassol1>\u00a0the error I get on this line is: Uncaught TypeError: this.form.action.contains is not a function(\u2026)  \n14:49\u00a0<vmassol1>\u00a0I've checked that contains() doesn't seem to a pure js function  \n14:49\u00a0<vmassol1>\u00a0since this code works on 7.1.x and not on 7.4, I assume that somewhere we've defined the contains() function and added it to String  \n14:49\u00a0<vmassol1>\u00a0is now known as <vmassol>  \n14:50\u00a0<vmassol>\u00a0any idea mflorea or gdelhumeau?  \n14:55\u00a0<mflorea>\u00a0vmassol: it's not part of the standard String API https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global\\_Objects/String and is not provided by Prototype.js either http://api.prototypejs.org/language/String/  \n14:57\u00a0<mflorea>\u00a0I do have this function when I check with the JavaScript console  \n14:57\u00a0<mflorea>\u00a0$('inline').action.contains  \n14:57\u00a0<mflorea>\u00a0(from inline edit mode)  \n14:58\u00a0<vmassol>\u00a0any idea how to find how it's registered?  \n14:58\u00a0<mflorea>\u00a0$('inline').action.contains.toString()  \n14:59\u00a0<mflorea>\u00a0[native code]  \n14:59\u00a0<mflorea>\u00a0so it looks like it is provided by the browser  \n14:59\u00a0<mflorea>\u00a0otherwise you would get the actual function code  \n15:01\u00a0<vmassol>\u00a0if it was provied by the browser then I would get it on all pages right?  \n15:01\u00a0<vmassol>\u00a0trying your example on another page now  \n15:01\u00a0<mflorea>\u00a0$('inline').action.contains is undefined on Chrome  \n15:02\u00a0<mflorea>\u00a0I tried Firefox first  \n15:02\u00a0<vmassol>\u00a0hmmm  \n15:02\u00a0<vmassol>\u00a0I'm on chrome indeed  \n15:02\u00a0<mflorea>\u00a0so it looks like Firefox supports it while Chrome doesn't  \n15:02\u00a0<vmassol>\u00a0however it works on 7.1.x from xwiki.org but fails locally on a 7.4  \n15:02\u00a0<vmassol>\u00a0(both using chrome)  \n15:03\u00a0<vmassol>\u00a0checking  \n15:03\u00a0<mflorea>\u00a0https://github.com/xwiki/xwiki-platform/commit/999b14bece246adfa5b5d9d89c892f45d4bbc437#diff-c96ca895f6b4766e80a3282f4b68203aR209  \n15:04\u00a0<Bugendolf>\u00a0has joined #xwiki  \n15:04\u00a0<mflorea>\u00a0vmassol: is was added by Enygma` recently  \n15:04\u00a0<mflorea>\u00a07.4M2  \n15:04\u00a0<mflorea>\u00a0he probably tested only on Firefox  \n15:04\u00a0<vmassol>\u00a0haha  \n15:05\u00a0<vmassol>\u00a0that explains it  \n15:05\u00a0<vmassol>\u00a0thanks, I can take it from there  \n15:05\u00a0<mflorea>\u00a0in any case, it's an easy fix, replace contains with indexOf  \n15:05\u00a0<vmassol>\u00a0yes  \n15:06\u00a0<msmeria1>\u00a0has quit  \n15:10\u00a0<cjd>\u00a0has joined #xwiki  \n15:15\u00a0<Enygma`>\u00a0bad java habits :)  \n15:16\u00a0<vmassol>\u00a0cost me 2 hours :)  \n15:17\u00a0<Enygma`>\u00a0debugging JS usually does :/  \n15:17\u00a0<cjd>\u00a0it's not js, it's that pseudo-oop prototypejs crap  \n15:17\u00a0<vmassol>\u00a0I'm glad I found the issue and fixed it before 7.4.1  \n15:17\u00a0<vmassol>\u00a0BTW it shows our QA is pretty poor on chrome  \n15:57\u00a0<vmassol>\u00a0gotcha quickbooks!  \n16:04\u00a0<Slashman>\u00a0has quit  \n16:22\u00a0<vmassol>\u00a0has quit  \n16:23\u00a0<tmortagne>\u00a0:)  \n16:25\u00a0<vmassol>\u00a0has joined #xwiki  \n16:35\u00a0<vmassol>\u00a0has quit  \n16:47\u00a0<vmassol>\u00a0has joined #xwiki  \n16:47\u00a0<finstern\\_xwiki>\u00a0good by here  \n16:48\u00a0<finstern\\_xwiki>\u00a0has quit  \n17:15\u00a0<vmassol>\u00a0has quit  \n17:16\u00a0<vmassol>\u00a0has joined #xwiki  \n17:21\u00a0<KermitTheFragger>\u00a0has quit  \n17:35\u00a0<vmassol>\u00a0mflorea: do you think you could add ckeditor to ci.xwikiorg?  \n17:35\u00a0<vmassol>\u00a0(I've been asked for a snapshot for example but it's also useful as a general good practice)  \n17:36\u00a0<mflorea>\u00a0I will try  \n18:07\u00a0<mflorea>\u00a0has quit  \n18:20\u00a0<tmortagne>\u00a0has quit  \n18:20\u00a0<tmortagne>\u00a0has joined #xwiki  \n18:24\u00a0<tmortagne>\u00a0has quit  \n18:28\u00a0<vmassol>\u00a0has quit  \n18:54\u00a0<vmassol>\u00a0has joined #xwiki  \n18:56\u00a0<evalica>\u00a0has quit  \n18:57\u00a0<evalica>\u00a0has joined #xwiki  \n18:57\u00a0<evalica>\u00a0has quit  \n19:02\u00a0<cjd>\u00a0has quit  \n19:02\u00a0<evalica>\u00a0has joined #xwiki  \n19:05\u00a0<evalica>\u00a0has quit  \n19:05\u00a0<Enygma`>\u00a0has quit  \n19:07\u00a0<tmortagne>\u00a0has joined #xwiki  \n19:08\u00a0<vmassol>\u00a0has quit  \n19:48\u00a0<woshilapin>\u00a0has quit  \n19:57\u00a0<tmortagne>\u00a0has quit  \n20:15\u00a0<cjd\\_>\u00a0has joined #xwiki  \n20:15\u00a0<abusenius>\u00a0has joined #xwiki  \n20:35\u00a0<vmassol>\u00a0has joined #xwiki  \n20:42\u00a0<woshilapin>\u00a0has joined #xwiki  \n21:06\u00a0<gdelhumeau>\u00a0has quit  \n22:00\u00a0<mflorea>\u00a0has joined #xwiki  \n22:06\u00a0<mflorea>\u00a0has quit  \n22:17\u00a0<mflorea>\u00a0has joined #xwiki  \n22:22\u00a0<mflorea>\u00a0has quit  \n23:02\u00a0<vmassol>\u00a0has quit\n"}