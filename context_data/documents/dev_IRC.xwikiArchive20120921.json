{"id": "dev:IRC.xwikiArchive20120921", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20120921", "title": "IRC Archive for channel #xwiki on 21 September 2012 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n00:01\u00a0<vmassol>\u00a0has quit  \n00:29\u00a0<jvdrean>\u00a0has quit  \n03:51\u00a0<tekzilla>\u00a0has quit  \n03:53\u00a0<tekzilla>\u00a0has joined #xwiki  \n06:23\u00a0<npm>\u00a0has quit  \n06:23\u00a0<tillo>\u00a0has quit  \n06:24\u00a0<npm>\u00a0has joined #xwiki  \n06:28\u00a0<tillo>\u00a0has joined #xwiki  \n06:28\u00a0<sdumitriu>\u00a0has quit  \n06:31\u00a0<sdumitriu>\u00a0has joined #xwiki  \n07:25\u00a0<vmassol>\u00a0has joined #xwiki  \n07:29\u00a0<vmassol>\u00a0has quit  \n07:34\u00a0<vmassol>\u00a0has joined #xwiki  \n07:34\u00a0<mflorea>\u00a0has joined #xwiki  \n08:03\u00a0<coud>\u00a0has joined #xwiki  \n08:03\u00a0<mflorea>\u00a0has quit  \n08:04\u00a0<mflorea>\u00a0has joined #xwiki  \n08:17\u00a0<mflorea>\u00a0has quit  \n08:20\u00a0<coud>\u00a0has quit  \n08:42\u00a0<Denis>\u00a0has joined #xwiki  \n08:44\u00a0<mflorea>\u00a0has joined #xwiki  \n09:07\u00a0<vmassol>\u00a0Denis: good morning  \n09:08\u00a0<jvdrean>\u00a0has joined #xwiki  \n09:08\u00a0<+Denis>\u00a0vmassol: good morning Vincent  \n09:08\u00a0<+Denis>\u00a0and all  \n09:08\u00a0<vmassol>\u00a0I'm looking at setDatabase() in XWHBS  \n09:09\u00a0<vmassol>\u00a0I'm in debug mode and I see that SET SCHEMA is executed hundreds of times when virtual=1  \n09:09\u00a0<vmassol>\u00a0(for a single reuqest)  \n09:09\u00a0<vmassol>\u00a0I don't see the point  \n09:09\u00a0<vmassol>\u00a0shouldn't we verify that the DB set is != than the context DB and only do a SET SCHEMA in this case?  \n09:10\u00a0<tmortagne>\u00a0has joined #xwiki  \n09:13\u00a0<+Denis>\u00a0vmassol: are we really calling setDatabase uselessly ?  \n09:13\u00a0<+Denis>\u00a0this is not expected  \n09:13\u00a0<vmassol>\u00a0yes I think so  \n09:13\u00a0<@cjd>\u00a0yes, it's been that way since forever IIRC  \n09:14\u00a0<vmassol>\u00a0this is what I see  \n09:14\u00a0<vmassol>\u00a0it's completely unnecessary for me  \n09:14\u00a0<vmassol>\u00a0SET SCHEMA probably odesn't cost much but it still cost the DB calls  \n09:14\u00a0<vmassol>\u00a0and a lot of times  \n09:14\u00a0<jvdrean>\u00a0has quit  \n09:14\u00a0<vmassol>\u00a0unless Hibernate optimize this  \n09:15\u00a0<vmassol>\u00a0need to check the SQL  \n09:15\u00a0<mflorea>\u00a0has quit  \n09:15\u00a0<@cjd>\u00a0I seem to recall it at the beginning of every transaction in mysql logs  \n09:16\u00a0<vmassol>\u00a0hmm I don't see it at all in my hib logs  \n09:16\u00a0<+Denis>\u00a0vmassol: before, we were also doing a schema update, this is why I am surprised  \n09:16\u00a0<vmassol>\u00a0maybe I need a different logging level  \n09:24\u00a0<+Denis>\u00a0I know, it is not the same subject, but closely related, how do you reach the point where session != null and getCurrentDatabase(context) is null ?  \n09:24\u00a0<+Denis>\u00a0(in beginTransaction())  \n09:24\u00a0<vmassol>\u00a0Denis: on this topic we have an issue in virtual mode  \n09:24\u00a0<eshan>\u00a0has joined #xwiki  \n09:24\u00a0<vmassol>\u00a0just discovered yesterday by Jean-Vincent  \n09:25\u00a0<vmassol>\u00a0haven't investigated yet but it's a blocker for RC1  \n09:25\u00a0<eshan>\u00a0has left #xwiki  \n09:25\u00a0<vmassol>\u00a0as soon as you create a subwiki or go to a subwiki we have the error  \n09:25\u00a0<vmassol>\u00a0I need to setup a XEM to debug it \u00a0(I don't have one ATM)  \n09:27\u00a0<+Denis>\u00a0I am wondering since, the check for DB migration is close to the setCurrentDatabase(), and therefore, having a session without a current DB seems that the session is on an unchecked DB  \n09:28\u00a0<+Denis>\u00a0mmm  \n09:28\u00a0<+Denis>\u00a0but this depends on virtual mode !  \n09:28\u00a0<+Denis>\u00a0the DB is not set in non-virtual mode apparently  \n09:29\u00a0<CIA-122>\u00a0tmortagne\u000f master\u000f \\* rf123b76\u000f https://github.com/xwiki/xwiki-platform/commit/f123b76b20ed7c225a9bd514a9ffdf98ea4c107d \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-handlers/xwiki-platform-extension-handler-xar/src/main/java/org/xwiki/extension/xar/internal/handler/packager/xml/DocumentImporterHandler.java :\u000f Bulletproofing - http://git.io/9UfG\\_A  \n09:29\u00a0<+Denis>\u00a0the current db I mean  \n09:30\u00a0<+tmortagne>\u00a0Denis: it is actually if you set the database name in the xwiki.cfg but otherwise yes it's not set in non-virtual AFAIK  \n09:30\u00a0<+tmortagne>\u00a0used to be like this at some point at least  \n09:30\u00a0<vmassol>\u00a0sorry got to go, bb in 20mn  \n09:31\u00a0<+Denis>\u00a0vmassol: but anyway, to be back on your question, in debug, you have a \"Switch database to\" message on DB switch, and I do not recall it to be log too many times, isn't it ?  \n09:31\u00a0<vmassol>\u00a0if you look at setDatabase() you'll see the SET SCHEMA is executed all the time  \n09:32\u00a0<+tmortagne>\u00a0vmassol: it's not supposed to no  \n09:32\u00a0<vmassol>\u00a0so if we have 30 DB calls in one request  \n09:32\u00a0<vmassol>\u00a0then it's exeucted 30 times  \n09:32\u00a0<+tmortagne>\u00a0it's when when the database change  \n09:32\u00a0<vmassol>\u00a0it's all the time  \n09:32\u00a0<vmassol>\u00a0there's no check I can see  \n09:32\u00a0<+tmortagne>\u00a0it's recent then because it was not like this before for sure  \n09:32\u00a0<vmassol>\u00a0(I'm in debug mode)  \n09:32\u00a0<vmassol>\u00a0however  \n09:33\u00a0<vmassol>\u00a0in the hibernate logs (I'm at \"trace\" level) I don't see any requets to the DB for changing the schema  \n09:33\u00a0<+tmortagne>\u00a0the peviously switched database is supposed to be stored in the context to be compared for following requests  \n09:33\u00a0<+tmortagne>\u00a0s/for/to/  \n09:33\u00a0<vmassol>\u00a0tmortagne: see beginTransaction  \n09:33\u00a0<vmassol>\u00a0there's no test  \n09:34\u00a0<vmassol>\u00a0it just calls setDatabase  \n09:34\u00a0<vmassol>\u00a0which does the SET SCHEMA if in virtual mode  \n09:34\u00a0<+tmortagne>\u00a0and what setDatabse do ?  \n09:34\u00a0<vmassol>\u00a0this:  \n09:34\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0stmt = session.connection().createStatement();  \n09:34\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0stmt.execute(\"SET SCHEMA \" + escapedSchemaName);  \n09:34\u00a0<+tmortagne>\u00a0what I described is what used to be done, that's 100% sure  \n09:34\u00a0<+tmortagne>\u00a0maybe you are not looking at the right place  \n09:34\u00a0<vmassol>\u00a0listen:  \n09:34\u00a0<vmassol>\u00a0I have a breakpoint at  \n09:34\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0stmt.execute(\"SET SCHEMA \" + escapedSchemaName);  \n09:35\u00a0<vmassol>\u00a0and when I call a page it gets executed a lot of times  \n09:35\u00a0<vmassol>\u00a0got to go, bbl  \n09:36\u00a0<+tmortagne>\u00a0then it has been broken recently  \n09:42\u00a0<+tmortagne>\u00a0there used to be a test based on getCurrentDatabase and looks like it has been removed  \n09:42\u00a0<cjd>\u00a0has quit  \n09:49\u00a0<+tmortagne>\u00a0vmassol: you removed the test in https://github.com/xwiki/xwiki-platform/commit/798ee8e1eb70a4e7922e1beeacec6a49d4864e97#xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/XWikiHibernateBaseStore.java ...  \n09:49\u00a0<vmassol>\u00a0back  \n09:50\u00a0<vmassol>\u00a0hmm\u2026 that's funny\u2026 I removed it because i thought it was the same test as I put above  \n09:50\u00a0<vmassol>\u00a0let me read it again slowly  \n09:51\u00a0<+tmortagne>\u00a0this test is here to make sur ewe call setDatabase only when needed  \n09:51\u00a0<vmassol>\u00a0yes that's a different test thomas  \n09:51\u00a0<+tmortagne>\u00a0i.e. onlu when it changed  \n09:51\u00a0<vmassol>\u00a0hmm  \n09:51\u00a0<vmassol>\u00a0my test looks the same  \n09:51\u00a0<vmassol>\u00a0ok I'll debug  \n09:52\u00a0<+tmortagne>\u00a0it has nothing to do with what you are supposed to do in your test  \n09:52\u00a0<+tmortagne>\u00a0one is to make sure to call setDatabase only when needed and what you are tryin to do and to forbif switch durring a session  \n09:53\u00a0<vmassol>\u00a0I don't see the difference in https://github.com/xwiki/xwiki-platform/commit/798ee8e1eb70a4e7922e1beeacec6a49d4864e97#xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/XWikiHibernateBaseStore.java  \n09:53\u00a0<+tmortagne>\u00a0s/forbif/forbid/  \n09:54\u00a0<+tmortagne>\u00a0I think you don't understand what getCurrentDatabase is  \n09:54\u00a0<vmassol>\u00a0!StringUtils.equals(context.getDatabase(),\u00a0getCurrentDatabase(context))  \n09:54\u00a0<vmassol>\u00a0!context.getDatabase().equals(getCurrentDatabase(context))  \n09:54\u00a0<+tmortagne>\u00a0getCurrentDatabase is the last database where we called setDatabase  \n09:54\u00a0<vmassol>\u00a0what's the difference between those 2 lines?  \n09:54\u00a0<+tmortagne>\u00a0that's all  \n09:54\u00a0<vmassol>\u00a0I know ofc  \n09:54\u00a0<+tmortagne>\u00a0it does not mean we already called it for this session  \n09:54\u00a0<vmassol>\u00a0I just can't see the diff ATM with these 2 lines  \n09:55\u00a0<+tmortagne>\u00a0it's not because getCurrentDatabase is not null that setDatabase has already been called for the session  \n09:55\u00a0<+tmortagne>\u00a0in your test your throw an exception  \n09:55\u00a0<+tmortagne>\u00a0that's a pretty big difference...  \n09:56\u00a0<+tmortagne>\u00a0your test is forbidding any switch  \n09:56\u00a0<+tmortagne>\u00a0at all  \n09:56\u00a0<+tmortagne>\u00a0from what I understand with what you did it's \u00a0impossible to go to several wiki in the same request  \n09:56\u00a0<+Denis>\u00a0tmortagne: the test introduce by Vincent forbit switching an existing session  \n09:56\u00a0<vmassol>\u00a0yes that's the idea  \n09:56\u00a0<+tmortagne>\u00a0no  \n09:56\u00a0<+tmortagne>\u00a0it does not  \n09:57\u00a0<+tmortagne>\u00a0it check the context  \n09:57\u00a0<+tmortagne>\u00a0I don't see where in this test you know a switch has been done in the same session  \n09:57\u00a0<+Denis>\u00a0because if we have a session and the current database is not the expected context database, we will be switching that session  \n09:58\u00a0<+tmortagne>\u00a0when do you switch then ?  \n09:58\u00a0<+Denis>\u00a0when you do not have a session yet  \n09:58\u00a0<vmassol>\u00a0session == transaction  \n09:58\u00a0<vmassol>\u00a0(for us)  \n09:58\u00a0<+Denis>\u00a0if you have a session, the next test goes out and does not switch anyway  \n09:59\u00a0<+tmortagne>\u00a0ok then you should still put that the test you removed  \n09:59\u00a0<+Denis>\u00a0but the calling code expect to be on the right db  \n09:59\u00a0<+tmortagne>\u00a0because right now the setDatabase is called even when it's useless  \n10:00\u00a0<+tmortagne>\u00a0you can have several sessions in the same request  \n10:03\u00a0<+tmortagne>\u00a0right now without the test if we load 10 document in the same wiki we will call setDatabase 10 times  \n10:03\u00a0<+tmortagne>\u00a0in the same request  \n10:05\u00a0<+tmortagne>\u00a0with the test setDatase was called only when changing database in the same request  \n10:05\u00a0<+Denis>\u00a0I do not see the point, does'nt beginTransaction() already taken care ?  \n10:05\u00a0<vmassol>\u00a0tmortagne: you're talking about execute() here righjt?  \n10:05\u00a0<+tmortagne>\u00a0Denis: i'm talking about request  \n10:06\u00a0<+tmortagne>\u00a0in the same request you have have several transactions  \n10:06\u00a0<vmassol>\u00a0you're talking about these 3 lines in execute():  \n10:06\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0checkHibernate(context);  \n10:06\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0bTransaction = beginTransaction(context);  \n10:06\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return cb.doInHibernate(getSession(context));  \n10:06\u00a0<+tmortagne>\u00a0I just gave you the example of loading 10 documents  \n10:06\u00a0<+Denis>\u00a0tmortagne: are we talking about the line vmassol displayed ? and the test removed there ?  \n10:06\u00a0<vmassol>\u00a0I don't see why adding bazck the test there will change anything  \n10:07\u00a0<vmassol>\u00a0what is missing  \n10:07\u00a0<vmassol>\u00a0is another test in beignTransaction or better in setDatabse() itself  \n10:07\u00a0<+tmortagne>\u00a0Denis: I'm talking about the test removed in https://github.com/xwiki/xwiki-platform/commit/798ee8e1eb70a4e7922e1beeacec6a49d4864e97#xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/XWikiHibernateBaseStore.java  \n10:07\u00a0<vmassol>\u00a0tmortagne: this test was in execute()  \n10:07\u00a0<vmassol>\u00a0not in beginTransaction  \n10:07\u00a0<+Denis>\u00a0and does not do anything, was never true  \n10:08\u00a0<vmassol>\u00a0yep  \n10:08\u00a0<mflorea>\u00a0has joined #xwiki  \n10:08\u00a0<+tmortagne>\u00a0I don't understand what it was doing in execute()  \n10:09\u00a0<vmassol>\u00a0exactly!  \n10:09\u00a0<vmassol>\u00a0that's why I remove that test  \n10:09\u00a0<vmassol>\u00a0but as I said we need another one in setDatabase() IMO  \n10:09\u00a0<vmassol>\u00a0to not do unnecesary schema set  \n10:09\u00a0<+tmortagne>\u00a0Artem added this test in beginTransaction when he instroduced getCurrentDatabase AFAIK  \n10:09\u00a0<vmassol>\u00a0yes I traced it to artem  \n10:09\u00a0<vmassol>\u00a0and to the issue  \n10:10\u00a0<vmassol>\u00a0and the reason I think  \n10:10\u00a0<vmassol>\u00a0it because artem started supporting wiki switching in the same session  \n10:10\u00a0<vmassol>\u00a0but he only coded it for one place  \n10:10\u00a0<vmassol>\u00a0so it couldn't work  \n10:11\u00a0<vmassol>\u00a0so we are ok for me to add a test in setDatabase()?  \n10:12\u00a0<+Denis>\u00a0\u00a0vmassol: if we should test, it should be in beginTransaction, since setDatabase should do its job, whatever the situation IMO, but should not be called uselessly  \n10:12\u00a0<vmassol>\u00a0Denis: yes ideally you're right  \n10:12\u00a0<vmassol>\u00a0just wanted to be on the safe side  \n10:12\u00a0<+tmortagne>\u00a0same as Denis  \n10:12\u00a0<vmassol>\u00a0who knows, maybe there's code calling setDB somewhere else  \n10:12\u00a0<vmassol>\u00a0this is so spaghetti code  \n10:12\u00a0<vmassol>\u00a0....  \n10:12\u00a0<vmassol>\u00a0ok I'll do in beginTransaction  \n10:12\u00a0<+Denis>\u00a0I am pretty sure there is no call to setDatabase anywhere else  \n10:13\u00a0<+tmortagne>\u00a0we should probably make setDatabase private  \n10:13\u00a0<+tmortagne>\u00a0since it's very wrong to call it directly  \n10:13\u00a0<+Denis>\u00a0I agree  \n10:13\u00a0<+tmortagne>\u00a0it can only create issue  \n10:13\u00a0<+tmortagne>\u00a0in that particular case breaking a code that does it it's probably a good thing to do  \n10:14\u00a0<+tmortagne>\u00a0s/it's/is/  \n10:17\u00a0<jvdrean>\u00a0has joined #xwiki  \n10:18\u00a0<vmassol>\u00a0guys, is it safe for me to commit this in RC1? :)  \n10:19\u00a0<tmortagne>\u00a0has quit  \n10:19\u00a0<vmassol>\u00a0(not the private thing, the test)  \n10:20\u00a0<tmortagne>\u00a0has joined #xwiki  \n10:20\u00a0<vmassol>\u00a0I'm adding this:  \n10:20\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Note: we only do database switching if the current database is not the same as the context database  \n10:20\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// since otherwise it's just useless and would take time for nothing.  \n10:20\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (!StringUtils.equals(getCurrentDatabase(context), context.getDatabase())) {  \n10:20\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0setDatabase(session, context);  \n10:20\u00a0<vmassol>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}  \n10:20\u00a0<vmassol>\u00a0tmortagne, Denis: is this safe for RC1?  \n10:21\u00a0<+tmortagne>\u00a0actually  \n10:21\u00a0<vmassol>\u00a0btw just noticed it breaks one test in XWikiHibernateStoreLocksTest, checking why  \n10:21\u00a0<+tmortagne>\u00a0I'm thinking about something  \n10:21\u00a0<+tmortagne>\u00a0all request use the same connection ?  \n10:21\u00a0<+tmortagne>\u00a0requests  \n10:21\u00a0<+tmortagne>\u00a0i.e. all threads  \n10:21\u00a0<vmassol>\u00a0connection pool  \n10:22\u00a0<vmassol>\u00a0the jdbc connections are reused and put back in the pool yes  \n10:22\u00a0<+tmortagne>\u00a0ok but can be have a thread switching the database in a connection potentially used by another one ?  \n10:22\u00a0<vmassol>\u00a0no  \n10:23\u00a0<vmassol>\u00a0connections are acquired by a thread  \n10:23\u00a0<vmassol>\u00a0when it needs to execute somethong on the db  \n10:23\u00a0<+tmortagne>\u00a0ok then it should be ok  \n10:23\u00a0<vmassol>\u00a0and then released  \n10:23\u00a0<+tmortagne>\u00a0hmm  \n10:23\u00a0<+Denis>\u00a0vmassol: to be safe, I would like to be sure we do not have an issue with the null situation, and that we could still rely on the migration check in setDatabase  \n10:24\u00a0<+Denis>\u00a0vmassol: moreover, outside a session, I do not see the point  \n10:24\u00a0<vmassol>\u00a0btw I don't undestand this \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0this.dataMigrationManager.checkDatabase();  \n10:24\u00a0<vmassol>\u00a0inside setDatabase  \n10:24\u00a0<vmassol>\u00a0an there's no comment :)  \n10:25\u00a0<+Denis>\u00a0this is the migration check  \n10:25\u00a0<vmassol>\u00a0why do mirgation when in a setDB?  \n10:25\u00a0<vmassol>\u00a0doesn't make sense to me  \n10:25\u00a0<+Denis>\u00a0you should check before accessing the DB  \n10:25\u00a0<vmassol>\u00a0sure but why in setDB()  \n10:26\u00a0<+Denis>\u00a0this is the only single point in the code to put that check with a confidence you would not access a DB without it being checked  \n10:26\u00a0<+Denis>\u00a0and this is why, I am not sure your check is valid  \n10:26\u00a0<vmassol>\u00a0you just said the opposite above :)  \n10:26\u00a0<vmassol>\u00a0you said that setDB is not called  \n10:26\u00a0<vmassol>\u00a0except by beginTransaction  \n10:27\u00a0<+Denis>\u00a0we should switch DB anytime unless we reuse the same session, so I do not believe our discussion upon useless call to setDB was correct  \n10:28\u00a0<+Denis>\u00a0but setDB is public  \n10:28\u00a0<vmassol>\u00a0Denis: you seem to grasp things more than I do, can I leave it to you to write the test? :)  \n10:29\u00a0<+Denis>\u00a0my first question was: are you sure we call setDB uselessly ?  \n10:29\u00a0<vmassol>\u00a0I'll try again  \n10:29\u00a0<vmassol>\u00a0but yes I'm 99.9999999999% sure ATM  \n10:29\u00a0<+Denis>\u00a0and you seems to believe we do, but I am still not convinced  \n10:29\u00a0<vmassol>\u00a0if you have an environment  \n10:30\u00a0<vmassol>\u00a0just put a breakpoint in setDabatabase  \n10:30\u00a0<vmassol>\u00a0removing my test and retesting  \n10:30\u00a0<+Denis>\u00a0the question is, do we call setDB more than one per session  \n10:31\u00a0<+Denis>\u00a0not per request  \n10:31\u00a0<vmassol>\u00a0ah  \n10:31\u00a0<vmassol>\u00a0i don't know BUT  \n10:31\u00a0<vmassol>\u00a0even if we're in different session  \n10:53\u00a0<xwikibot>\u00a0has joined #xwiki  \n10:54\u00a0<cjd>\u00a0has joined #xwiki  \n10:59\u00a0<CIA-122>\u00a0tmortagne\u000f master\u000f \\* r7f22704\u000f https://github.com/xwiki/xwiki-platform/commit/7f227042ad735962e56bec1174100dc8908a85c6 \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-handlers/xwiki-platform-extension-handler-xar/src/main/java/org/xwiki/extension/xar/internal/handler/packager/xml/DocumentImporterHandler.java :\u000f XWIKI-8229: Extension Manager keep the author and content author of the already existing document instead of taking the one from the XAR  \n11:18\u00a0<CIA-122>\u00a0Jean-Vincent Drean\u000f master\u000f \\* r1fa0d6e\u000f https://github.com/xwiki/xwiki-platform/commit/1fa0d6e3b23c5ee55e99907024d9447b6ab77568 \u000f/ (2 files):\u000f XWIKI-8231 : Remove deprecated property \"type\" from XWiki.ComponentDependencyClass - http://git.io/qrnalA  \n11:32\u00a0<vmassol>\u00a0ok I know what the problem is with HSQLDB and wiki creation  \n11:33\u00a0<+tmortagne>\u00a0vmassol: you do ? that would be nice feature  \n11:34\u00a0<vmassol>\u00a0it's just that CREATE SCHEMA will create a schema but the tables are otcreated so then when we query them later on we get for ex \"user lacks privilege or object not found: XWIKILONGS\"  \n11:34\u00a0<vmassol>\u00a0so create schema and set schema work  \n11:34\u00a0<vmassol>\u00a0but we need to tell hibernate to create the tables  \n11:34\u00a0<+tmortagne>\u00a0well sure I saw that before but did not know why tables were not created  \n11:34\u00a0<+tmortagne>\u00a0hibernate is supposed to create them  \n11:35\u00a0<vmassol>\u00a0when?  \n11:35\u00a0<vmassol>\u00a0I mean do you know where int eh code?  \n11:35\u00a0<+tmortagne>\u00a0was a long time ago and has been refactored since but there was a code in updateDatabase or a name like that for it  \n11:35\u00a0<+tmortagne>\u00a0updateSchema maybe  \n11:36\u00a0<vmassol>\u00a0you call \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xwiki.updateDatabase(targetWiki, true, initClasses, context);  \n11:36\u00a0<vmassol>\u00a0from wiki manager  \n11:36\u00a0<vmassol>\u00a0just after wiki creation  \n11:37\u00a0<vmassol>\u00a0then it calls initializeMandatoryClasses  \n11:37\u00a0<vmassol>\u00a0which calls getPrefsClass  \n11:37\u00a0<vmassol>\u00a0which tries to get the xwiki prefs doc: \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0doc = getDocument(new DocumentReference(context.getDatabase(), SYSTEM\\_SPACE, \"XWikiPreferences\"), context);  \n11:37\u00a0<vmassol>\u00a0and fails  \n11:37\u00a0<+tmortagne>\u00a0tables are supposed to be created when accessing the wiki  \n11:38\u00a0<+tmortagne>\u00a0same for MySQL actually it's not something  \n11:38\u00a0<+tmortagne>\u00a0it has nothing to do with wikimanager  \n11:40\u00a0<+tmortagne>\u00a0XWikiHibernateBaseStore#updateSchema found it it's the same name  \n11:40\u00a0<+tmortagne>\u00a0but it does not seems to be called anymore  \n11:40\u00a0<+tmortagne>\u00a0at least not accoding to eclipse  \n11:41\u00a0<+tmortagne>\u00a0it used to be called automatically and it's probably called since tables are properly created for mysql  \n11:41\u00a0<vmassol>\u00a0it's called by HibernateDataMigrationManager apparently  \n11:41\u00a0<vmassol>\u00a0but that's a different use case probably  \n11:41\u00a0<vmassol>\u00a0but indeed updateSchema(XWikiContext context) is not called  \n11:42\u00a0<+tmortagne>\u00a0whatever the database type the tables are supposed to be created the first time a database is accessed  \n11:42\u00a0<+tmortagne>\u00a0don't know where it moved exactly now  \n11:42\u00a0<+tmortagne>\u00a0but it's working for mysql obviously  \n11:44\u00a0<+tmortagne>\u00a0I guess it's handled by the DataMigrationManager now  \n11:44\u00a0<+tmortagne>\u00a0since Denis's refactoring  \n11:44\u00a0<vmassol>\u00a0ah probably the check denis was mentioning  \n11:44\u00a0<vmassol>\u00a0in setDatabase  \n11:45\u00a0<+tmortagne>\u00a0but it's probably the same as before, for some reason hobernate does not create the tables for hibernate even if it's told to  \n11:45\u00a0<+tmortagne>\u00a0hsqldb  \n11:46\u00a0<+tmortagne>\u00a0\u00a0if (version == null) {  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0try {  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0initNewDB();  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0version = getLatestVersion();  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (DataMigrationException e) {  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0String message = String.format(  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\"The empty database %s seems to be not writable, please check your configuration!\",  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0getXWikiContext().getDatabase());  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0logger.error(message, e);  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw new DataMigrationException(message, e);  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}  \n11:46\u00a0<+tmortagne>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}  \n11:46\u00a0<+tmortagne>\u00a0that's it  \n11:46\u00a0<+tmortagne>\u00a0if no version tables are created  \n11:46\u00a0<vmassol>\u00a0yes  \n11:47\u00a0<+tmortagne>\u00a0and I guess it's the same code as before and Denis just moved it  \n11:47\u00a0<+tmortagne>\u00a0it's supposed to be generic but does not seems to work for all DBs  \n11:49\u00a0<+Denis>\u00a0vmassol: I could help probably, but I do not clearly understand your issue ?  \n11:49\u00a0<+tmortagne>\u00a0Denis: the old hsqldb multiwiki issue  \n11:49\u00a0<+tmortagne>\u00a0vmassol was just looking at it again  \n11:50\u00a0<+Denis>\u00a0ah, the fact that HSQLDB does not support multi-wiki ?  \n11:50\u00a0<+tmortagne>\u00a0well more or less  \n11:50\u00a0<+tmortagne>\u00a0it's more hibernatte+hsqldb  \n11:51\u00a0<+tmortagne>\u00a0hsqldb support schemas and we create new schema since a while but hibernate never create the tables  \n11:51\u00a0<+tmortagne>\u00a0same issue since around XWiki 1.0  \n11:51\u00a0<vmassol>\u00a0I think I know why, checking  \n11:52\u00a0<+Denis>\u00a0I should says that I have introduce some changes in the way it works compare to the past  \n11:52\u00a0<vmassol>\u00a0IMO the reason is:  \n11:52\u00a0<vmassol>\u00a0in HSQLDB when you create a SCHEMA you need to create the table in the same statement  \n11:53\u00a0<vmassol>\u00a0\\*tables  \n11:53\u00a0<+tmortagne>\u00a0Denis: yep plus both hibernate and hsqldb are a lot more recent that's probably a good reason to look again  \n11:53\u00a0<+Denis>\u00a0since before, we were doing many schema updates, far more than needed, and I now limit those to a single update per DB  \n11:53\u00a0<vmassol>\u00a0http://www.hsqldb.org/doc/guide/ch09.html#N11EDC  \n11:54\u00a0<+Denis>\u00a0vmassol: how do you update than ?  \n11:54\u00a0<+tmortagne>\u00a0vmassol: I would be surprise hsqldb does not allow creating table at all  \n11:54\u00a0<vmassol>\u00a0and if you don't then when you create a table you need to prefix it with the schema name  \n11:54\u00a0<vmassol>\u00a0I'll verify this  \n11:54\u00a0<+tmortagne>\u00a0that's noormal  \n11:54\u00a0<+tmortagne>\u00a0and hibernate is supposed to do it since it used to do it for oracle for example  \n11:54\u00a0<+tmortagne>\u00a0which is also shema based and not database based  \n11:56\u00a0<vmassol>\u00a0tmortagne: indeed the update script genertaed by hibernate appends the schema  \n11:56\u00a0<vmassol>\u00a0but maybe hsqldb doesn't support this  \n11:56\u00a0<vmassol>\u00a0checking  \n11:57\u00a0<vmassol>\u00a0ahah I know  \n11:57\u00a0<vmassol>\u00a0:)  \n11:57\u00a0<vmassol>\u00a0the update script generated by hibernate generates this:  \n11:58\u00a0<vmassol>\u00a0create table test5.activitystream\\_events  \n11:58\u00a0<vmassol>\u00a0but this is invalid for hsqldb  \n11:58\u00a0<vmassol>\u00a0it needs quotes  \n11:58\u00a0<vmassol>\u00a0create table \"test5\".activitystream\\_events  \n11:58\u00a0<vmassol>\u00a0I've tested it manually  \n11:58\u00a0<vmassol>\u00a0cool  \n11:58\u00a0<vmassol>\u00a0I can fix this  \n11:59\u00a0<vmassol>\u00a0I'll test it  \n11:59\u00a0<+Denis>\u00a0vmassol: initializeEmptyDB() in HibernateDataMigrationManager is where we do the schema update on an empty DB, and startMigrationsForDatabase() in AbstractDataMigrationManager is where we update it once, when need. In case you wonder.  \n11:59\u00a0<+tmortagne>\u00a0well still sounds like a hibernate bug if it produce invalid hsqldb syntax  \n11:59\u00a0<vmassol>\u00a0yep I'm ok with the code now Denis thanks  \n11:59\u00a0<evalica>\u00a0has joined #xwiki  \n12:00\u00a0<vmassol>\u00a0tmortagne: sure  \n12:00\u00a0<vmassol>\u00a0but we can work around it  \n12:00\u00a0<vmassol>\u00a0I'll test and google a bit more  \n12:00\u00a0<vmassol>\u00a0but I'm quite sure this is the problem  \n12:00\u00a0<vmassol>\u00a0since I can reproduce the issue manually  \n12:01\u00a0<+tmortagne>\u00a0it may be the same kind of issue with shema based pgsql and derby I guess  \n12:05\u00a0<Enygma`>\u00a0has joined #xwiki  \n12:22\u00a0<vmassol>\u00a0Denis: I don't understand something in getDBVersionFromDatabase  \n12:22\u00a0<vmassol>\u00a0it does a (XWikiDBVersion) session.createCriteria(XWikiDBVersion.class).uniqueResult();  \n12:23\u00a0<vmassol>\u00a0and this succeeds for me even though I have context.getDatabsae() == my new wiki name  \n12:23\u00a0<vmassol>\u00a0thus I'm thinking that maybe the SET SCHEMA is not done befoer this db call  \n12:23\u00a0<vmassol>\u00a0wdyt?  \n12:23\u00a0<vmassol>\u00a0(I need to trace it)  \n12:23\u00a0<vmassol>\u00a0(going for lunch now, will trace after)  \n12:25\u00a0<jvdrean1>\u00a0has joined #xwiki  \n12:29\u00a0<+Denis>\u00a0vmassol: getDBVersion could be run on any kind of DB. It use the safe execution path, and could fail silently. It is used to determine all possible cases: 1) an empty (new) DB, 2) a DB without version, but with a schema and some document (so prior the migration system, and 3) a normal DB with a version  \n12:29\u00a0<jvdrean>\u00a0has quit  \n12:30\u00a0<+Denis>\u00a0vmassol: it should returns for 1) null 2) XWikiDBVersion(0) 3) XWikiDBVersion(<currentVersion>)  \n12:31\u00a0<+Denis>\u00a0vmassol: if it don't, you may have found an issue  \n12:34\u00a0<vmassol>\u00a0it doesn't reutnr null for an empty db but I don't know why yet  \n12:34\u00a0<vmassol>\u00a0lunch and then more debugging  \n12:56\u00a0<jvelo>\u00a0has joined #xwiki  \n13:17\u00a0<mflorea>\u00a0has quit  \n13:22\u00a0<silviar>\u00a0has joined #xwiki  \n13:46\u00a0<+Enygma`>\u00a0guys, what`s the status on the release?  \n13:47\u00a0<+Enygma`>\u00a0there are currently 6 opened issues http://jira.xwiki.org/secure/IssueNavigator.jspa?reset=true&jqlQuery=Project+in+%28%22XWiki+Commons%22%2C+%22XWiki+Rendering%22%2C+%22XWiki+Platform%22%2C+%22XWiki+Enterprise%22%2C+%22XWiki+Enterprise+Manager%22%29+and+fixVersion+in+%28%224.2-rc-1%22%29+and+resolution+in+%28%22Unresolved%22%29  \n13:48\u00a0<vmassol>\u00a0Enygma`: on my side there's the issue raised by JV yesterday in multiwiki mode. I don't think there's an issue in jira yet  \n13:48\u00a0<vmassol>\u00a0it's a blocker, it could be fixed for final though but probably best to fix it now  \n13:49\u00a0<vmassol>\u00a0tmortagne: is the distrib wizard working fine for authors and search now?  \n13:49\u00a0<vmassol>\u00a0(for authors I think so seen your commit but not tested it yet)  \n13:49\u00a0<+tmortagne>\u00a0vmassol: search was working well for me yesterday when we talked about it  \n13:49\u00a0<+tmortagne>\u00a0and author has been fixed too  \n13:49\u00a0<vmassol>\u00a0ah yes indeed  \n13:50\u00a0<vmassol>\u00a0what about the warning in the install log about \u00a0ui extension ?  \n13:50\u00a0<vmassol>\u00a0any other stuff remaining that you know of?  \n13:50\u00a0<+tmortagne>\u00a0most of the open issue from mflorea has been fixed, not sure why he did not closed them  \n13:51\u00a0<+tmortagne>\u00a0vmassol: not sure about warnings, I'm working on https://jira.xwiki.org/browse/XWIKI-8006 currently  \n13:51\u00a0<+tmortagne>\u00a0there is a real issue with several core extensions  \n13:54\u00a0<+Enygma`>\u00a0These 2 issues have no commits yet: http://jira.xwiki.org/browse/XWIKI-8203 and http://jira.xwiki.org/browse/XWIKI-8074  \n13:55\u00a0<+Enygma`>\u00a0do we postpone any of them? like http://jira.xwiki.org/browse/XWIKI-8074 ?  \n13:55\u00a0<+tmortagne>\u00a0XWIKI-8074 is not blocker IMO  \n13:56\u00a0<+tmortagne>\u00a0can be moved  \n13:56\u00a0<+tmortagne>\u00a0XWIKI-8203 is fixed  \n13:56\u00a0<+tmortagne>\u00a0mflorea proobably committed under another issue id  \n13:56\u00a0<+tmortagne>\u00a0probably XWIKI-8212  \n14:00\u00a0<+sburjan>\u00a0tmortagne: I confirm. the executable start scripts are now, executable on -mysql too  \n14:00\u00a0<+tmortagne>\u00a0sburjan: ok  \n14:01\u00a0<+sburjan>\u00a0wow, I see the distribution wizard UI is greately improved. Looks nice !  \n14:21\u00a0<+sburjan>\u00a0I get a warning on XEM when installing user interface:  \n14:21\u00a0<+sburjan>\u00a0We couldn't find any extension with id 'org.xwiki.manager:xwiki-manager-ui' and version '4.2-SNAPSHOT'. Make sure you have the right extension repositories configured.  \n14:21\u00a0<+sburjan>\u00a0so basically I can't install the XEM UI  \n14:22\u00a0<+tmortagne>\u00a0do you have the right extension repositories configured ?  \n14:22\u00a0<+sburjan>\u00a0oh wait, I'm on snapshot. true  \n14:22\u00a0<+sburjan>\u00a0where can I find what I need to enable snapshot repo ?  \n14:23\u00a0<+Enygma`>\u00a0sburjan: add this to xwiki.properties  \n14:23\u00a0<+Enygma`>\u00a0extension.repositories=maven-xwiki:maven:http://nexus.xwiki.org/nexus/content/groups/public  \n14:23\u00a0<+Enygma`>\u00a0extension.repositories=extensions.xwiki.org:xwiki:http://extensions.xwiki.org/xwiki/rest/  \n14:23\u00a0<+Enygma`>\u00a0extension.repositories=maven-xwiki-snapshot:maven:http://nexus.xwiki.org/nexus/content/groups/public-snapshots/  \n14:23\u00a0<+tmortagne>\u00a0sburjan: http://extensions.xwiki.org/xwiki/bin/view/Extension/Extension+Module#HConfiguringExtensionRepositories  \n14:24\u00a0<+sburjan>\u00a0thanks Enygma` , tmortagne  \n14:29\u00a0<vmassol>\u00a0tmortagne: I have multiwiki working on hsqldb (with some hacks) :)  \n14:29\u00a0<+tmortagne>\u00a0vmassol: acceptable hacks ?  \n14:29\u00a0<vmassol>\u00a0almost  \n14:30\u00a0<vmassol>\u00a0I mean it's ok but I can maybe make it better  \n14:30\u00a0<+tmortagne>\u00a0committable until we have something better ?  \n14:30\u00a0<vmassol>\u00a0yes  \n14:30\u00a0<+tmortagne>\u00a0great  \n14:30\u00a0<vmassol>\u00a0but  \n14:30\u00a0<vmassol>\u00a0I still have one issue  \n14:31\u00a0<vmassol>\u00a0Denis: I still don't understand why getDBVersionFromDatabase returns 42000 when the subwiki is empty....  \n14:31\u00a0<vmassol>\u00a0right now in debug mode I set version = null to let it continue ;)  \n14:31\u00a0<+tmortagne>\u00a0probably means for some reason it's looking at main scheme  \n14:31\u00a0<vmassol>\u00a0(and it works thereafter)  \n14:31\u00a0<vmassol>\u00a0yes but I don't know why  \n14:31\u00a0<vmassol>\u00a0it does a SET SCHEMA  \n14:32\u00a0<vmassol>\u00a0this is the only part puzzling me  \n14:32\u00a0<vmassol>\u00a0anyway I'm going to debug JV's problem now that I can reproduce it and I'll look at this one a bit after  \n14:38\u00a0<mflorea>\u00a0has joined #xwiki  \n14:39\u00a0<+Denis>\u00a0vmassol: otp :(  \n14:39\u00a0<vmassol>\u00a0np not urgent  \n14:49\u00a0<CIA-122>\u00a0tmortagne\u000f master\u000f \\* r49631e2\u000f https://github.com/xwiki/xwiki-commons/commit/49631e256b504b32933c0858a3124641762ff471 \u000f/ xwiki-commons-core/xwiki-commons-extension/xwiki-commons-extension-api/src/main/java/org/xwiki/extension/repository/internal/core/DefaultCoreExtensionScanner.java :\u000f XWIKI-8006: non-resolved variables in AETHER folder - http://git.io/zpWEXA  \n14:52\u00a0<vmassol>\u00a0Denis: when you have some time I'd like to talk to you about this multiwiki issue since I believe there might be a migration issue  \n14:52\u00a0<+sburjan>\u00a0I have an error when instaling XEM \u00a0UI using the snapsho repository :(  \n14:52\u00a0<+sburjan>\u00a0Could not find extension dependency [org.xwiki.platform:xwiki-platform-sheet-ui-4.2-SNAPSHOT]  \n14:53\u00a0<+sburjan>\u00a0I can giev you the whole stacktrace if you need i  \n14:53\u00a0<+tmortagne>\u00a0sburjan: probably a network issue, you should retry  \n14:53\u00a0<+tmortagne>\u00a0Enygma`: had this isssue several times yesterday  \n14:53\u00a0<+tmortagne>\u00a0on other extensions  \n14:54\u00a0<+Enygma`>\u00a0yes, just retry and pray :)  \n14:54\u00a0<vmassol>\u00a0which means we'll need to implement retry on our side  \n14:54\u00a0<+sburjan>\u00a0ok, fingers crossed :)  \n14:54\u00a0<+Enygma`>\u00a0yes... or we`ll get labeled as prayware :P  \n14:54\u00a0<vmassol>\u00a0:)  \n14:54\u00a0<+sburjan>\u00a0:))  \n14:55\u00a0<vmassol>\u00a0it probably means we have some issue on our nexus though  \n14:55\u00a0<+tmortagne>\u00a0probably, still will look what I can do for retry stuff in AETHER configuration  \n14:59\u00a0<+tmortagne>\u00a0hmm nothing in AETHER it seems, looks like I will have to ask for it  \n15:02\u00a0<vmassol>\u00a0ok I know what the problem is  \n15:03\u00a0<vmassol>\u00a0the main issue is that we do lazy init  \n15:03\u00a0<vmassol>\u00a0so we start with a user request (say on the main wiki)  \n15:03\u00a0<vmassol>\u00a0since it's the first request initXWii is called which leads to getting xwiki preferences doc  \n15:04\u00a0<vmassol>\u00a0which leads to call setDatabase() in XWBS  \n15:04\u00a0<vmassol>\u00a0which has a checkDatabase call  \n15:04\u00a0<vmassol>\u00a0hmm no it shouldn't change db at this point  \n15:04\u00a0<vmassol>\u00a0forge tthis  \n15:04\u00a0<vmassol>\u00a0need to continue digging  \n15:04\u00a0<vmassol>\u00a0:)  \n15:05\u00a0<+sburjan>\u00a0did we fix the conflicting merges ?  \n15:06\u00a0<vmassol>\u00a0arf yes thzat's it  \n15:07\u00a0<vmassol>\u00a0checlDatabse will run migrations for all DBs!!  \n15:07\u00a0<vmassol>\u00a0thus the session issue  \n15:07\u00a0<vmassol>\u00a0so we need to either:  \n15:07\u00a0<vmassol>\u00a01) migrate each db lazily when first called  \n15:08\u00a0<vmassol>\u00a02) migrate all dbs at startup without a user request  \n15:08\u00a0<vmassol>\u00a03) do something else  \n15:08\u00a0<vmassol>\u00a0Denis: let's talk when you're back  \n15:11\u00a0<+tmortagne>\u00a0sburjan: depends which ones, the wrong one has been fixed yes, the normal ones with standard classes no  \n15:11\u00a0<+tmortagne>\u00a0and probably won't be fixed for 4.2, it's not a quickfix and 4.2 and already pretty late to add a dangerous refactoring of the standard XWiki classes initialization  \n15:11\u00a0<+sburjan>\u00a0tmortagne: I'm still getting a lot on XEM, includinc XWikiproperties  \n15:11\u00a0<vmassol>\u00a0or 4) migrate the current DB and migrate the other DBs in initXWiki() when the current DB has finished  \n15:11\u00a0<+tmortagne>\u00a0sburjan: XWikiproperties ?  \n15:12\u00a0<+sburjan>\u00a0tmortagne: ok, I only wanted to make sure we're aware of it  \n15:12\u00a0<+tmortagne>\u00a0you mean XWikiPreferences ?  \n15:12\u00a0<+sburjan>\u00a0yes, sorry  \n15:12\u00a0<vmassol>\u00a0mflorea: not sure you saw my messages of yesteday  \n15:12\u00a0<vmassol>\u00a0the new wizard steps are great. It's missing info about the login though  \n15:13\u00a0<+tmortagne>\u00a0sburjan: in XEM/XE you should get:  \n15:13\u00a0<+tmortagne>\u00a0\\* conflict on standard genrated classes  \n15:13\u00a0<+tmortagne>\u00a0\\* conflict with page which are in several XARs (for example Main.WebHome in XE and XEM)  \n15:13\u00a0<vmassol>\u00a0and possibly info about the issue with generated class merging  \n15:14\u00a0<+sburjan>\u00a0tmortagne: it seems I am getting conflicts o Main.Welcome for each language :) curious if they are overwriting each other  \n15:15\u00a0<+tmortagne>\u00a0sburjan: you have each language in both XE and XEM  \n15:16\u00a0<+tmortagne>\u00a0for standard classes I know what to do but it's too dangerous so late in 4.2 and for pages in several XAR we should probably be able to fix most of them using new UI extension  \n15:18\u00a0<+mflorea>\u00a0vmassol: wdym by \"info about login\"? don't you get the confirmation popup?  \n15:19\u00a0<vmassol>\u00a0mflorea: no  \n15:19\u00a0<vmassol>\u00a0sburjan: did you get it?  \n15:19\u00a0<+mflorea>\u00a0clear your cache before testing  \n15:20\u00a0<+sburjan>\u00a0the redirect to the login page when installing XEM-ui ?  \n15:20\u00a0<vmassol>\u00a0sburjan: when installing XE yes  \n15:20\u00a0<vmassol>\u00a0you have a message  \n15:20\u00a0<vmassol>\u00a0before the login redirect  \n15:20\u00a0<vmassol>\u00a0?  \n15:20\u00a0<+sburjan>\u00a0yes, i got it. I'm on XEM, but I guess it's the same thing  \n15:20\u00a0<vmassol>\u00a0a message that explains what's happening  \n15:20\u00a0<+tmortagne>\u00a0yes it's the same thing  \n15:20\u00a0<+sburjan>\u00a0no, I got no message  \n15:20\u00a0<vmassol>\u00a0could you try clearing your cache too as mflorea suggetsed?  \n15:21\u00a0<+sburjan>\u00a0but let me clear my cache and try again  \n15:21\u00a0<+sburjan>\u00a0yes  \n15:21\u00a0<vmassol>\u00a0(I'm on something else right now and cannot retest this)  \n15:21\u00a0<+sburjan>\u00a0doing now  \n15:21\u00a0<vmassol>\u00a0thanks  \n15:21\u00a0<+sburjan>\u00a0mflorea: the continue button now appears when installing is done.  \n15:21\u00a0<+sburjan>\u00a0so it's cool  \n15:21\u00a0<vmassol>\u00a0we're doing a lot of manual testing\u2026. we'll need to automate this testing too in the future  \n15:22\u00a0<+sburjan>\u00a0Enygma`: I'm at the step of instaling workspaces. Now it seems that the right attachment is there. But I still have the workspace-template-features.xar. is this expected ?  \n15:22\u00a0<+mflorea>\u00a0sburjan: I'm pretty sure it wasn't appearing also because of cache problems. I didn't fix anything related to the Continue button. Please clear cache before testing  \n15:23\u00a0<+sburjan>\u00a0well odd, because yesterday was not working and now it is. and I didn't clear my cache since yesterday. gonna re-test after I clear my cache  \n15:24\u00a0<+Denis>\u00a0vmassol: end of phone call, I read back  \n15:24\u00a0<vmassol>\u00a0Denis: I can explain on sykpe too  \n15:25\u00a0<+Enygma`>\u00a0sburjan: yes, that`s the way it works. You have a workspace-template.xar (you have this by default as the XE xar, but the user can provide a different one) and, on top of that, the workspace-template-features.xar is imported to add the workspace-related features.  \n15:27\u00a0<+Denis>\u00a0vmassol: ok, lets go  \n15:27\u00a0<vmassol>\u00a0Denis: you're offline  \n15:27\u00a0<+Denis>\u00a0you see it so, I am not ;)  \n15:28\u00a0<vmassol>\u00a0I see you offline  \n15:29\u00a0<+sburjan>\u00a0Enygma`: I get this when installing Workspaces http://pastebin.com/bR5VvyQ8  \n15:33\u00a0<+Enygma`>\u00a0sburjan: Is this a blocker in the install process?  \n15:33\u00a0<+sburjan>\u00a0nope. But I will re-test this also  \n15:33\u00a0<+Enygma`>\u00a0from what I see, it's a \u00a0[Lucene Index Updater] error which, AFAIK, happens a lot but it's usually due to bad timing on Lucene`s part or something like that  \n15:34\u00a0<+sburjan>\u00a0now I'm installin a workspace. and it takes more than 5 minutes .. don't know if this is ok. creating a XEM instance while ago was much faster.  \n15:40\u00a0<+sburjan>\u00a0I am getting a lot of these when starting a freshly unpacked wiki.  \n15:40\u00a0<+sburjan>\u00a0[role = [interface org.xwiki.xml.html.filter.HTMLFilter] hint = [list]] tried to overwrite component [org.xwiki.xml.internal.html.filter.ListFilter]. However, no action was taken since both components have the same priority level of [1000].  \n15:40\u00a0<+sburjan>\u00a0anybody has any idea ?  \n15:41\u00a0<+sburjan>\u00a0it's freshly unpacked, database doesn't even exist  \n15:41\u00a0<+tmortagne>\u00a0sounds like you have duplicated jar  \n15:41\u00a0<+tmortagne>\u00a0which is generally \"normal\" with a XEM anspahot  \n15:41\u00a0<+tmortagne>\u00a0snapshot  \n15:41\u00a0<+Enygma`>\u00a0I also get a lot of those sometimes. However, they seem to show up only on snapshots  \n15:42\u00a0<+tmortagne>\u00a0because you have jars in the XE war and get other from XEM dependencies which don't have the same timestamp  \n15:42\u00a0<+tmortagne>\u00a0so not the same file name  \n15:42\u00a0<+tmortagne>\u00a0but you can't have this kind of issue with released version so it's more or less ok  \n15:43\u00a0<+Enygma`>\u00a0why doesn`t maven take care of this when solving dependencies?  \n15:44\u00a0<+tmortagne>\u00a0Enygma`: maven does not have any idea what's in the XE war when building XEM  \n15:44\u00a0<+tmortagne>\u00a0so it merge it with what's coming from XEM dependencies without looking at it too much  \n15:45\u00a0<+tmortagne>\u00a0but when building a release they have the same names so they overwrite each other  \n15:47\u00a0<+Enygma`>\u00a0right, because the war is already packed when XEM processes it...  \n15:47\u00a0<+tmortagne>\u00a0yep  \n15:48\u00a0<+tmortagne>\u00a0there is no easy fix for that except get rid of XEM ;)  \n15:53\u00a0<+sburjan>\u00a0mflorea: so should I get a pop-up window ? javascript alert ?  \n15:53\u00a0<+mflorea>\u00a0a confirmation box  \n15:54\u00a0<vmassol>\u00a0guys after discussing with Denis I'm going to remove my check in XWHBS for RC1 and will put it back later on for 4.3  \n15:55\u00a0<vmassol>\u00a0we know the problem but it's a bit tricky/dangerous to fix it now  \n15:55\u00a0<+sburjan>\u00a0what are the effects of removing this ? what could it break ?  \n15:55\u00a0<vmassol>\u00a0nothing  \n16:01\u00a0<+Denis>\u00a0sburjan: it is a check that verify we do not break the DB session, removing it does not change the functionality  \n16:01\u00a0<+sburjan>\u00a0let's hope it won't break the migration  \n16:01\u00a0<+sburjan>\u00a0that's what worries me  \n16:02\u00a0<+Denis>\u00a0it won't, but the way we check is current not perfect, and migration cause a false positive  \n16:02\u00a0<+Denis>\u00a0there are potentially other case that could as well, so it is better to remove the check for now, and improve it for next release  \n16:02\u00a0<CIA-122>\u00a0Vincent Massol\u000f master\u000f \\* rb14e51e\u000f https://github.com/xwiki/xwiki-platform/commit/b14e51ee6fd92c671f9e3afb683abb9ead70ffa9 \u000f/ xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/XWikiHibernateBaseStore.java :\u000f XWIKI-8172: Fail the query if we find a nested database query within a transaction that operates on a different database - http://git.io/ClfOJA  \n16:03\u00a0<vmassol>\u00a0sburjan: if you want details, see http://jira.xwiki.org/browse/XWIKI-8172?focusedCommentId=72053#comment-72053  \n16:03\u00a0<vmassol>\u00a0done  \n16:04\u00a0<+sburjan>\u00a0so we'll put the code back as it is, or with modifications ?  \n16:11\u00a0<vmassol>\u00a0sburjan: with modifs, otherwise I wouldn't have removed it!  \n16:12\u00a0<vmassol>\u00a0guys wdyt about starting the RC1 branch now?  \n16:12\u00a0<vmassol>\u00a0btw Enygma` I've not had any experience doing the release process on a branch, I don't know how that works, cjd might know  \n16:13\u00a0<vmassol>\u00a0(we used to cerate a branch for RC and release from that branch)  \n16:13\u00a0<+sburjan>\u00a0mflorea: Unauthorized request. Your session has expired or you lost rights while installing or uninstalling an extension. You need to re-login in order to continue. Do you wish to proceed? ?  \n16:14\u00a0<+sburjan>\u00a0so yes, i have your confirmation box  \n16:14\u00a0<+mflorea>\u00a0ok  \n16:14\u00a0<vmassol>\u00a0hmm  \n16:14\u00a0<vmassol>\u00a0the message could be improved I think  \n16:14\u00a0<vmassol>\u00a0it look like some error the way it's stated  \n16:15\u00a0<+mflorea>\u00a0this message is not only for distribution wizard, is generic for extension install  \n16:16\u00a0<vmassol>\u00a0still, it could a little bit more user friendly  \n16:16\u00a0<+mflorea>\u00a0I'm open to suggestions  \n16:19\u00a0<vmassol>\u00a0\"You've installed (or Uninstalled) an Extension that has modified the permissions of your wiki. In order to continue you need to log in again.\" Not sure why you're asking anything. If they don't log in what happens?  \n16:20\u00a0<+Enygma`>\u00a0vmassol: I think I RCs are handled specially in the release scripts (mflorea, tmortagne, please correct me if I`m wrong)  \n16:20\u00a0<vmassol>\u00a0a custom message for the distrib wizard would be even nicer since we could tailor it to be even more precise  \n16:20\u00a0<+mflorea>\u00a0vmassol  \n16:21\u00a0<+mflorea>\u00a0the unauthorized request doesn't happen only if you install/uninstall an extension, it can happen for other reasons, e.g. your session expired  \n16:22\u00a0<+mflorea>\u00a0and having custom message for distribution wizard means duplicating code. The distribution wizard reuses the EM display/install  \n16:23\u00a0<+mflorea>\u00a0plus, any reason for unauthorized request in EM is valid for distribution wizard  \n16:23\u00a0<vmassol>\u00a0put yourself in the shoes of a user. Do you think they care if we duplicate code? :) What they care about is to have somrthing they can understand. Do you think they'll understand this message  \n16:23\u00a0<+mflorea>\u00a0and if you click No you stay on the page. You simply don't continue the install  \n16:23\u00a0<vmassol>\u00a0what we need to do is:  \n16:23\u00a0<vmassol>\u00a0have a proper message when installing what we \\*\\*know\\*\\* will cause the right change  \n16:23\u00a0<vmassol>\u00a0\\*rights  \n16:24\u00a0<+mflorea>\u00a0I obviously think they will understand the message, otherwise I would have chosen a different message  \n16:24\u00a0<vmassol>\u00a0mflorea: the job is aborted?  \n16:24\u00a0<vmassol>\u00a0I think you chose the message to be generic  \n16:25\u00a0<vmassol>\u00a0what the mesage says is=  \n16:25\u00a0<vmassol>\u00a0something wrong has happened  \n16:25\u00a0<vmassol>\u00a0log in again!  \n16:26\u00a0<vmassol>\u00a0I think  \n16:26\u00a0<vmassol>\u00a0for now  \n16:26\u00a0<vmassol>\u00a0we can just drop the \"Unauthorized request\"  \n16:26\u00a0<vmassol>\u00a0which is the most worriying part of the message  \n16:26\u00a0<+tmortagne>\u00a0vmassol: how do you know something will cause the right change ?  \n16:26\u00a0<+mflorea>\u00a0from EM's pov something wrong has happened, an authorized request. But the message is not scary as \u00a0you want to believe  \n16:26\u00a0<vmassol>\u00a0I'm installing xwiki  \n16:26\u00a0<vmassol>\u00a0and then unuathorized request  \n16:26\u00a0<vmassol>\u00a0how can you think this is not scary  \n16:26\u00a0<vmassol>\u00a0!!!  \n16:27\u00a0<vmassol>\u00a0I'm at a loss  \n16:27\u00a0<vmassol>\u00a0seriously  \n16:28\u00a0<vmassol>\u00a0tmortagne: re session expiring there are ways to know it  \n16:29\u00a0<vmassol>\u00a0re xwiki, I can think of an extension property  \n16:29\u00a0<vmassol>\u00a0but you're the expert  \n16:29\u00a0<+mflorea>\u00a0feel free to change the value in ApplicationResources, I'll focus on more important stuff  \n16:29\u00a0<vmassol>\u00a0I'm just providing usability feedback  \n16:30\u00a0<vmassol>\u00a0mflorea: there's nothing more important that usability  \n16:30\u00a0<vmassol>\u00a0you really need to underdtand this  \n16:30\u00a0<vmassol>\u00a0you think like a dveloper  \n16:30\u00a0<vmassol>\u00a0you need to think out of the box  \n16:30\u00a0<vmassol>\u00a0this is the hardest thing to do  \n16:30\u00a0<vmassol>\u00a0but you'll be a better developer if you do  \n16:31\u00a0<vmassol>\u00a0anyway we'll review this later  \n16:31\u00a0<vmassol>\u00a0don't be mad because I'm providing some feedback  \n16:31\u00a0<vmassol>\u00a0what you've done is already awesome, I told you so  \n16:33\u00a0<+mflorea>\u00a0I'm not mad, I just feel you exaggerate and that we spend time with small issues and don't fix the big ones first, like the speed issue  \n16:34\u00a0<vmassol>\u00a0you're planning to fix the speed issue now?  \n16:34\u00a0<+mflorea>\u00a0I'm investigating  \n16:34\u00a0<vmassol>\u00a0I think you're mixing large issues with easy to fix issues (ie low hanging fruits)  \n16:34\u00a0<vmassol>\u00a0but yes fixing speed is also needed  \n16:34\u00a0<vmassol>\u00a0very much  \n16:35\u00a0<vmassol>\u00a0so on your side we're good for rc1 mflorea?  \n16:35\u00a0<+mflorea>\u00a0no  \n16:35\u00a0<vmassol>\u00a0nothing left I mean  \n16:36\u00a0<+mflorea>\u00a0I still have a few issue to fix: (1) cancel/skip first step doesn't affect the entire wizard, (2) limit the height of the progress log (3) clear browser cache after install  \n16:37\u00a0<+mflorea>\u00a0and add translation keys  \n16:38\u00a0<vmassol>\u00a0you need how to do (3)?  \n16:38\u00a0<+tmortagne>\u00a0not sure translation keys are a blocker for 4.2, we won't have any translation anyway  \n16:38\u00a0<vmassol>\u00a0I was brainstorming about ti with tmortagne  \n16:38\u00a0<vmassol>\u00a0s \u00a0/ need/ know  \n16:38\u00a0<+tmortagne>\u00a0is (3) really blocker for a first version ? does not sounds very easy to achieve cleanly  \n16:38\u00a0<+mflorea>\u00a0no, I have to research a bit  \n16:39\u00a0<vmassol>\u00a0and the idea we had was to use a resource version in the URL  \n16:39\u00a0<+mflorea>\u00a0which URL?  \n16:39\u00a0<vmassol>\u00a0the css or js url  \n16:39\u00a0<+tmortagne>\u00a0mflorea: vincent means a big refactoring of XWiki to request resource with version in the URL  \n16:39\u00a0<vmassol>\u00a0so that when a js or css is modified you get a different version  \n16:39\u00a0<vmassol>\u00a0and the browser recaches  \n16:39\u00a0<+tmortagne>\u00a0so nothing for 4.2  \n16:40\u00a0<+mflorea>\u00a0ok  \n16:40\u00a0<vmassol>\u00a0indeed not for 4.2  \n16:40\u00a0<vmassol>\u00a0unless we find a quick hack for 4.2  \n16:40\u00a0<+tmortagne>\u00a0even if we find something it will require some time to find it  \n16:41\u00a0<vmassol>\u00a0yeah  \n16:41\u00a0<vmassol>\u00a0we need to release now  \n16:41\u00a0<vmassol>\u00a0the quick hack could be for 4.2.1 or 4.3  \n16:42\u00a0<vmassol>\u00a0tmortagne: do you have any blocker?  \n16:43\u00a0<+tmortagne>\u00a0vmassol: nop  \n16:43\u00a0<vmassol>\u00a0mflorea's issues he listed are not 100% blocker, they could be left for 4.2.1 or 4.3 IMO (even they would be nice for 4.2 but we're startign to seriously lack tie)  \n16:43\u00a0<vmassol>\u00a0sburjan: any blocker you know of?  \n16:43\u00a0<vmassol>\u00a0Enygma`: ?  \n16:44\u00a0<vmassol>\u00a0I think Enygma` could start start the release  \n16:45\u00a0<vmassol>\u00a0on a branch so that we continue to work on the known issues on master and the merge back on the branch after  \n16:45\u00a0<vmassol>\u00a0wdtyt?  \n16:45\u00a0<vmassol>\u00a0s / the merge/then merge  \n16:46\u00a0<+Enygma`>\u00a0what about the currently opened issues and their commits?  \n16:46\u00a0<vmassol>\u00a0what issues?  \n16:46\u00a0<vmassol>\u00a0could you list them again  \n16:46\u00a0<vmassol>\u00a0?  \n16:46\u00a0<+Enygma`>\u00a0http://jira.xwiki.org/secure/IssueNavigator.jspa?reset=true&jqlQuery=Project+in+%28%22XWiki+Commons%22%2C+%22XWiki+Rendering%22%2C+%22XWiki+Platform%22%2C+%22XWiki+Enterprise%22%2C+%22XWiki+Enterprise+Manager%22%29+and+fixVersion+in+%28%224.2-rc-1%22%29+and+resolution+in+%28%22Unresolved%22%29  \n16:46\u00a0<vmassol>\u00a0mflorea: I think you can close http://jira.xwiki.org/browse/XWIKI-8212  \n16:47\u00a0<vmassol>\u00a0same for http://jira.xwiki.org/browse/XWIKI-8211  \n16:47\u00a0<+Enygma`>\u00a0http://jira.xwiki.org/browse/XWIKI-8203 also seems to be fixed  \n16:47\u00a0<vmassol>\u00a0same for http://jira.xwiki.org/browse/XWIKI-8209  \n16:47\u00a0<+mflorea>\u00a0I need to document some of them  \n16:48\u00a0<vmassol>\u00a0http://jira.xwiki.org/secure/attachment/25326/upgrade2.png is a pity but no time\u2026 something to do for 4.2.1  \n16:48\u00a0<vmassol>\u00a0http://jira.xwiki.org/browse/XWIKI-8073 is done mflorea?  \n16:48\u00a0<vmassol>\u00a0seems so  \n16:49\u00a0<vmassol>\u00a0so Enygma` I think we're good  \n16:49\u00a0<vmassol>\u00a0what's left for these issues is documentation  \n16:50\u00a0<+mflorea>\u00a0is this fixed http://jira.xwiki.org/browse/XWIKI-8211 ? did you test it?  \n16:50\u00a0<+Enygma`>\u00a0ok, but let`s close them first, otherwise it's hard to manage them  \n16:50\u00a0<vmassol>\u00a0mflorea: tmortagne fixed it  \n16:50\u00a0<vmassol>\u00a0I haven't tested it personally  \n16:50\u00a0<+Enygma`>\u00a0and leave the documentation part to be done in paralel  \n16:50\u00a0<vmassol>\u00a0mflorea: can you close them with empty doc/RN fields?  \n16:51\u00a0<vmassol>\u00a0(for now)  \n16:51\u00a0<+mflorea>\u00a0ok  \n16:51\u00a0<vmassol>\u00a0we still have some failing tests...  \n16:51\u00a0<vmassol>\u00a0those false positives are becoming a pain again  \n16:51\u00a0<+tmortagne>\u00a0vmassol: mflorea atually mflorea fixed it and I fixed some other thing that was putting guest only on some pages  \n16:51\u00a0<vmassol>\u00a0ok  \n16:59\u00a0<vmassol>\u00a0has quit  \n17:00\u00a0<vmassol>\u00a0has joined #xwiki  \n17:12\u00a0<CIA-122>\u00a0tmortagne\u000f master\u000f \\* rb3c009e\u000f https://github.com/xwiki/xwiki-platform/commit/b3c009e6a95b28019db2b8794d13c9878cae96bf \u000f/ (4 files in 2 dirs):\u000f XWIKI-8209: Add a welcome step to the distribution wizard to give an overview of the upgrade process - http://git.io/QIEaHQ  \n17:14\u00a0<CIA-122>\u00a0tmortagne\u000f master\u000f \\* rb782c93\u000f https://github.com/xwiki/xwiki-platform/commit/b782c93f574b400d9f94e6e79ca05e5e2cce142d \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-handlers/xwiki-platform-extension-handler-xar/src/main/java/org/xwiki/extension/xar/internal/repository/XarInstalledExtensionRepository.java :\u000f Revert something committed by mistake - http://git.io/6aNtCw  \n17:16\u00a0<silviar>\u00a0has quit  \n17:17\u00a0<+Enygma`>\u00a02 more failing tests: http://ci.xwiki.org/job/xwiki-enterprise-test-extension/org.xwiki.enterprise$xwiki-enterprise-test-extension/1066/testReport/  \n17:22\u00a0<+Enygma`>\u00a0tmortagne: did the latest 2 commits address the failing tests? (asking to know if we need a new build after the one that is currently running to see if all tests pass)  \n17:22\u00a0<+tmortagne>\u00a0I think the first one is a flickering test  \n17:22\u00a0<+tmortagne>\u00a0the second one seems serious  \n17:23\u00a0<+tmortagne>\u00a0mflorea: any idea what this fail mean technically ? will try to reproduce it  \n17:23\u00a0<+tmortagne>\u00a0Enygma`: the last commits are about installer  \n17:23\u00a0<+tmortagne>\u00a0nothing to do with thoses failing tests  \n17:24\u00a0<+Enygma`>\u00a0ok  \n17:28\u00a0<+mflorea>\u00a0I can take a look in a few minutes at ExtensionTest.testAdvancedSearch, I'm documenting the Distribution Wizard now  \n17:41\u00a0<coud>\u00a0has joined #xwiki  \n17:43\u00a0<vmassol>\u00a0tmortagne: found a non hackish way to make it work with hsqldb :)  \n17:43\u00a0<+tmortagne>\u00a0vmassol: the version check ?  \n17:43\u00a0<vmassol>\u00a0no still haven't fixed that one  \n17:43\u00a0<+tmortagne>\u00a0ok  \n17:48\u00a0<coud2>\u00a0has joined #xwiki  \n17:48\u00a0<coud>\u00a0has quit  \n17:49\u00a0<vmassol>\u00a0not everything is working though, I still have issues  \n17:49\u00a0<vmassol>\u00a0what I've succeeded in doing is in creating the tables in the new schema  \n17:54\u00a0<coud>\u00a0has joined #xwiki  \n17:57\u00a0<coud2>\u00a0has quit  \n18:15\u00a0<movement>\u00a0has joined #xwiki  \n18:16\u00a0<movement>\u00a0why would xwiki sometimes decide to use <span> and sometimes <div> from {{code language=\"none\"}}...  \n18:16\u00a0<movement>\u00a0?  \n18:17\u00a0<+mflorea>\u00a0movement: it depends on the content where you use the code macro: inline vs. standalone (or block)  \n18:17\u00a0<+mflorea>\u00a0s/content/context  \n18:17\u00a0<movement>\u00a0what defines that? I have two apparently identical blocks that are different.  \n18:17\u00a0<movement>\u00a0both like this:  \n18:17\u00a0<movement>\u00a0{{code language=\"none\"}}  \n18:17\u00a0<movement>\u00a0some stuff  \n18:17\u00a0<movement>\u00a0one two lines  \n18:17\u00a0<movement>\u00a0{{/code}}  \n18:17\u00a0<+mflorea>\u00a0check for whitespaces before/after {{ and }}  \n18:18\u00a0<+mflorea>\u00a0especially after ending {{/code}}  \n18:18\u00a0<movement>\u00a0great, thank you!  \n18:18\u00a0<movement>\u00a0\" \"  \n18:18 <+mflorea> ![emoticon_wink](https://dev.xwiki.org/xwiki/resources/icons/silk/emoticon_wink.png?cache-version=1727882605000)  \n18:18 <+mflorea> happened to me a few times  \n18:19 <vmassol> would be nice to improve our wiki editor to have the option to display white spaces in a different color or symbol\u2026.  \n18:19 <+mflorea> yeah  \n18:20 <movement> the other thing causing problems: PDF export does not use a monospace font for . as you can imagine, this is not good for ascii art  \n18:23 <vmassol> movement: indeed that's bad, could you please report it in jira?  \n18:24 <vmassol> tmortagne: found the reason for another pb with hsqldb....  \n18:24 <vmassol> atually I can fix the 2 issues I've found so far by forcing the schema name to be always uppercase for hsqldb  \n18:24 <vmassol> I think that's the easiest  \n18:24 <vmassol> the first bug was in our code but this second one is in hibernate and not easy to fix  \n18:25 <vmassol> I think using uppercase schema name is probably acceptable  \n18:25 <vmassol> wdyt?  \n18:25 <vmassol> (the user can type in lowercase but we would just convert to uppercase internally)  \n18:26 <movement> XWiki Enterprise 2.7.1.34853 - how old is this installation?  \n18:27 <vmassol> movement: 2-3 years old, that's pretty old  \n18:27 <movement> ok. might have been fixed then.  \n18:28 <cjd> has quit  \n18:28 <vmassol> yes very possible  \n18:28 <vmassol> we've improved a lot the PDF export  \n18:29 <CIA-122> tmortagne\u000f master\u000f \\* r3f81694\u000f https://github.com/xwiki/xwiki-platform/commit/3f81694452b1f09d5f163bbe61d31d649528200d \u000f/ xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-test-pageobjects/src/main/java/org/xwiki/extension/test/po/SearchResultsPane.java :\u000f Fix test - http://git.io/44Eaaw  \n18:30 <movement> thanks.  \n18:30 <+sburjan> i can say for sure on M3 we didn't have so many conflicts with merge  \n18:30 <tmortagne> has quit  \n18:37 <coud> has quit  \n18:47 <+mflorea> sdumitriu: ping  \n18:49 <+sburjan> vmassol: no blocker on my side. i havetold you about every thing I encountered  \n18:49 <vmassol> ok good  \n18:54 <+sburjan> mflorea: the Skip/Cancel button seems fixed. No I have a continue button without refreshing.  \n18:54 <+mflorea> good  \n18:56 <evalica1> has joined #xwiki  \n18:56 <evalica> has quit  \n19:04 <+sburjan> just measured the time to install workspaces/install a new wiki in XEM: 6.35 minutes  \n19:14 <vmassol> you should create a jira issue for this sburjan  \n19:14 <vmassol> it shouldn't take more than 30 seconds top  \n19:14 <vmassol> (the time to download 2MB)  \n19:16 <evalica1> has quit  \n19:16 <movement> has left #xwiki  \n19:18 <+sburjan> ok, I am going to create. but it would be col for someone to conirm the slowness. because it might be my machine which is slow (not very likely )  \n19:18 <mflorea> has quit  \n19:18 <vmassol> I confirm  \n19:18 <+sburjan> ok. it will be reported :)  \n19:18 <vmassol> didn't try XEM but for sure it's too slow for XE too  \n19:19 <+sburjan> yes, it's slow for XE too. but XEM is even slower :P  \n19:20 <Enygma`> has quit  \n19:50 <vmassol> has quit  \n19:56 <coud> has joined #xwiki  \n21:14 <vmassol> has joined #xwiki  \n21:37 <jvelo> has quit  \n21:50 <jvdrean1> has quit  \n23:39 <coud> has quit  \n23:45 <vmassol> has quit  \n23:57 <pgmjsd1> has quit  \n\n\n\n"}