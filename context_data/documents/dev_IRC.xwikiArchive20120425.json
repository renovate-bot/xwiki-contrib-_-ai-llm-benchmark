{"id": "dev:IRC.xwikiArchive20120425", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20120425", "title": "IRC Archive for channel #xwiki on 25 April 2012 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n01:01\u00a0<jvdrean>\u00a0has quit  \n01:26\u00a0<CIA-160>\u00a0Caleb James DeLisle\u000f master\u000f \\* refe0006\u000f https://github.com/xwiki/xwiki-platform/commit/efe0006e913ce90cbd833eb6786492a72ce80153 \u000f/ (4 files in 4 dirs):\u000f XWIKI-7767 fixed use of XWikiHibernateStore in user creation and logout. - http://git.io/WsPJuA  \n01:45\u00a0<Shaddox>\u00a0has quit  \n02:06\u00a0<rrodriguez>\u00a0has quit  \n02:09\u00a0<jssolichin>\u00a0has joined #xwiki  \n02:13\u00a0<jsolichin>\u00a0has joined #xwiki  \n02:14\u00a0<jsolichin>\u00a0has quit  \n02:15\u00a0<jssolichin>\u00a0has quit  \n02:15\u00a0<jssolichin>\u00a0has joined #xwiki  \n02:55\u00a0<jssolichin>\u00a0has quit  \n03:18\u00a0<CIA-160>\u00a0Caleb James DeLisle\u000f master\u000f \\* r28fa964\u000f https://github.com/xwiki/xwiki-platform/commit/28fa9640ecaf80c273472fb1f0d3031610b9d91b \u000f/ (4 files in 4 dirs):\u000f Pulling this patch until we can understand why it seems to be breaking the build. ...  \n07:02\u00a0<Denis2>\u00a0has joined #xwiki  \n07:02\u00a0<Denis>\u00a0has quit  \n07:34\u00a0<vmassol>\u00a0has joined #xwiki  \n07:56\u00a0<mflorea>\u00a0has joined #xwiki  \n08:13\u00a0<sburjan>\u00a0has joined #xwiki  \n08:15\u00a0<jvelo>\u00a0has quit  \n08:16\u00a0<sburjan`>\u00a0has quit  \n08:16\u00a0<sburjan`>\u00a0has joined #xwiki  \n08:19\u00a0<jvelo>\u00a0has joined #xwiki  \n08:22\u00a0<vmassol>\u00a0has quit  \n08:36\u00a0<rrodriguez>\u00a0has joined #xwiki  \n08:45\u00a0<rrodriguez>\u00a0has quit  \n08:56\u00a0<Denis2>\u00a0is now known as <Denis>  \n09:00\u00a0<+Denis>\u00a0sburjan, sdumitriu: no progress on XWIKI-7763 ?  \n09:01\u00a0<+sburjan>\u00a0not from what I've seen. sdumitriu is still working on it  \n09:01\u00a0<+Denis>\u00a0do you know \u00a0if it has really work on it ?  \n09:01\u00a0<+Denis>\u00a0s/it/he  \n09:03\u00a0<@sdumitriu>\u00a0Sorry, today I got stumped with tax forms  \n09:04\u00a0<@sdumitriu>\u00a0Piece of advice: stay in France, taxes are horrible here  \n09:04\u00a0<+Denis>\u00a0sdumitriu: do you agree with the comment from VIncent ?  \n09:05\u00a0<@sdumitriu>\u00a0Yes  \n09:05\u00a0<+Denis>\u00a0does it means that if a migrator were added in 3.2M1, we would not have the issue ?  \n09:06\u00a0<@sdumitriu>\u00a0Yep  \n09:06\u00a0<@sdumitriu>\u00a0Doing one more test to check that everything works  \n09:08\u00a0<+sburjan>\u00a0I'm trying to reproduce t he issue on postgres ATM  \n09:09\u00a0<+Denis>\u00a0ok, now I better understand, all database created between 3.2M1 and 3.5.1 have a version of 15429, and should not be upgraded, something that is not so easy to know  \n09:11\u00a0<+Denis>\u00a0s/have/may have/  \n09:13\u00a0<+sburjan>\u00a0ok, I get a stacktrace from migrating from 3.5 final to 4.0 RC1 on POstgres, but I'm not sure it is the same thing as the blocking issue  \n09:23\u00a0<+Denis>\u00a0sburjan: if it mention somewhere an issue with lowrite(integer, oid), you got it  \n09:25\u00a0<+sburjan>\u00a0it doesn't ..  \n09:30\u00a0<Shaddox>\u00a0has joined #xwiki  \n09:37\u00a0<@sdumitriu>\u00a0OK, seems to be working  \n09:37\u00a0<@sdumitriu>\u00a0Denis: Do you think this is too ugly?  \n09:37\u00a0<@sdumitriu>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0} catch (BatchUpdateException ex) {  \n09:37\u00a0<@sdumitriu>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if (ex.getNextException() != null  \n09:37\u00a0<@sdumitriu>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0&& ex.getNextException().getMessage().contains(\"function lowrite(integer, oid) does not exist\")) {  \n09:37\u00a0<@sdumitriu>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return;  \n09:37\u00a0<@sdumitriu>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}  \n09:37\u00a0<@sdumitriu>\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0throw ex;  \n09:39\u00a0<+Denis>\u00a0sdumitriu: this will leave a xwa\\_archive2 empty useless column  \n09:41\u00a0<+Denis>\u00a0sdumitriu: would a cast() works and result in a noop at the end ?  \n09:41\u00a0<@sdumitriu>\u00a0I don't think so  \n09:41\u00a0<@sdumitriu>\u00a0The value really is an integer  \n09:42\u00a0<+Denis>\u00a0sburjan: could you pastbin ?  \n09:42\u00a0<@sdumitriu>\u00a0It's the ID of the LOB  \n09:42\u00a0<@sdumitriu>\u00a0Casting it to a string would probably break the attachments, since we'd lose the LOBs and instead have numbers as the attachment contents  \n09:43\u00a0<+Denis>\u00a0I though the issue was the oid, not the interger  \n09:46\u00a0<@sdumitriu>\u00a0Right...  \n09:46\u00a0<@sdumitriu>\u00a0But the OID is still an integer  \n09:46\u00a0<+sburjan>\u00a0Denis: http://pastebin.com/tw5MM7yh  \n09:46\u00a0<+Denis>\u00a0sure what I wonder if a cast of it would be more intelligent ?  \n09:47\u00a0<+Denis>\u00a0sburjan: have you enable migrations ?  \n09:48\u00a0<@sdumitriu>\u00a0sburjan: Don't get the error displayed in the browser  \n09:48\u00a0<@sdumitriu>\u00a0Get the first error you see in the logs  \n09:49\u00a0<+Denis>\u00a0maybe, but I am puzzled you do not get a migration fail in the browser at least  \n09:50\u00a0<+Denis>\u00a0sdumitriu: regarding your solution, what is bad, is that the message may change  \n09:51\u00a0<vmassol>\u00a0has joined #xwiki  \n09:51\u00a0<+Denis>\u00a0at least, I would limit the match to lowrite(integer,oid)  \n09:51\u00a0<@sdumitriu>\u00a0Denis: I know  \n09:53\u00a0<+Denis>\u00a0with some flexibility for spaces  \n09:53\u00a0<+Denis>\u00a0that should stay in the message  \n09:54\u00a0<+Denis>\u00a0and this would be, let say, the less worse solution  \n09:54\u00a0<+Denis>\u00a0do not forget a big comment !  \n09:55\u00a0<+sburjan>\u00a0Denis, sdumitriu : too bad I can't see the logs only on stdout, I have to use >> logs.txt to get them  \n09:55\u00a0<+Denis>\u00a0why ?  \n09:55\u00a0<+Denis>\u00a0a limitation of your terminal ?  \n09:55\u00a0<+sburjan>\u00a0because the stacktrace is so huge that I can't see its beginning  \n09:55\u00a0<tmortagne>\u00a0has joined #xwiki  \n09:55\u00a0<+sburjan>\u00a0I scroll up, but I don't hav ethe beginning  \n09:56\u00a0<+Denis>\u00a0ok, \u00a0a limitation of the terminal thatn  \n09:56\u00a0<+Denis>\u00a0s/thatn/then  \n09:56\u00a0<+sburjan>\u00a0maybe there is some trick to see stuff even above the termina;  \n09:56\u00a0<@sdumitriu>\u00a0sburjan: The scrollback size should be configurable  \n09:56\u00a0<@sdumitriu>\u00a0At least it is in Konsole  \n09:57\u00a0<+Denis>\u00a0it is in Terminal for Mac, and I think there is some hidden props for the command window of Windows as well, but anyway, there is always a limit :-)  \n10:01\u00a0<@sdumitriu>\u00a0Yes, in Konsole it's the amount of free disk space...  \n10:02\u00a0<+sburjan>\u00a0sdumitriu, Denis : I get the oid message  \n10:02\u00a0<+sburjan>\u00a0I used ./start\\_xwiki.sh >> log.txt  \n10:04\u00a0<CIA-160>\u00a0Marius Dumitru Florea\u000f master\u000f \\* r7ad106d\u000f https://github.com/xwiki/xwiki-platform/commit/7ad106df317344d2bcc7e9cb83f5b4a4ab37237d \u000f/ (2 files in 2 dirs):\u000f XWIKI-7768: XWiki.LiveTableResultsMacros \\_images column includes unscaled thumbnails with <img> having width set to 50 - http://git.io/aOROTQ  \n10:05\u00a0<CIA-160>\u00a0Marius Dumitru Florea\u000f stable-4.0.x\u000f \\* r7ac6308\u000f https://github.com/xwiki/xwiki-platform/commit/7ac6308cba30cff1380bcafcbb3ab6abd8f2b3e5 \u000f/ (2 files in 2 dirs):\u000f XWIKI-7768: XWiki.LiveTableResultsMacros \\_images column includes unscaled thumbnails with <img> having width set to 50 ...  \n10:10\u00a0<@sdumitriu>\u00a0Ah, Denis, good news, since we're in a transaction, the extra column isn't created  \n10:10\u00a0<+sburjan>\u00a0what I don't understand is... if hibernate is so clever in translating and \"talking\" with so many databases, why do we need custom mapping files ?  \n10:11\u00a0<@sdumitriu>\u00a0Because every database is different  \n10:11\u00a0<@sdumitriu>\u00a0Although they're all supposed to follow the standard, in reality there are two problems  \n10:12\u00a0<@sdumitriu>\u00a01. The standard is too complex to be implemented in full, and they add new features for each new update of the standard  \n10:13\u00a0<@sdumitriu>\u00a02. They mostly implement the insert/update/delete/select parts, implementing the meta-statements in their own way  \n10:13\u00a0<@sdumitriu>\u00a0And by meta-statements I mean the create/alter/describe table commands  \n10:13\u00a0<@sdumitriu>\u00a0For example, to get the definition of a table, I've seen three completely different ways recently  \n10:14\u00a0<@sdumitriu>\u00a0In MySQL there's \"desc table\"  \n10:14\u00a0<@sdumitriu>\u00a0In PostreSQL there's \\d  \n10:14\u00a0<+sburjan>\u00a0yes .. these are basic commands, I knew Hibernate knows there ...  \n10:15\u00a0<+sburjan>\u00a0\\*them  \n10:15\u00a0<@sdumitriu>\u00a0And in Oracle you actually have to \"select \\* from user\\_tables\" to get some data about the tables  \n10:15\u00a0<+sburjan>\u00a0I mean.. I'm not familiar at all, but is our database schema a complex one ? I mean I know we have 44 tables, but we usually use 1-to-1 relations between tables, right ? so nothing like multiset or what other types of relations arethere  \n10:15\u00a0<@sdumitriu>\u00a0Well, we're not using Hibernate properly  \n10:15\u00a0<+sburjan>\u00a0and hibernate doesn't do db normalization afaik  \n10:15\u00a0<@sdumitriu>\u00a0The HBM files aren't supposed to be used  \n10:16\u00a0<@sdumitriu>\u00a0But when XWiki started, we were supporting Java 1.4 which didn't have support for annotations  \n10:16\u00a0<@sdumitriu>\u00a0We should upgrade at some point from HBM files to annotations  \n10:16\u00a0<@sdumitriu>\u00a0But nobody has the guts to do that  \n10:17\u00a0<@sdumitriu>\u00a0Plus, we  \n10:17\u00a0<@sdumitriu>\u00a0Plus, we're not using relations  \n10:17\u00a0<@sdumitriu>\u00a0We manually join docs, objects and properties  \n10:17\u00a0<+sburjan>\u00a0wdym ? I'veseen some primary foreign keys, aren't those relations ?  \n10:18\u00a0<@sdumitriu>\u00a0Normally those would be simple one-to-many relations and Hibernate should take care of the rest  \n10:18\u00a0<+sburjan>\u00a0I guess this contributes also to XWiki being slow  \n10:19\u00a0<@sdumitriu>\u00a0And this would mean that we wouldn't have to specify \" BaseObject as obj, StringProperty as prop\" all the time, just \"where doc.object.propery.name = 'abc'\"  \n10:19\u00a0<+sburjan>\u00a0not just the code part . and the lifecycle of a request  \n10:30\u00a0<+Denis>\u00a0sdumitriu: ok, you rollback the script, and succeed the migration, and it works properly, very nice  \n10:30\u00a0<@sdumitriu>\u00a0Here goes:  \n10:31\u00a0<CIA-160>\u00a0Sergiu Dumitriu\u000f stable-3.5.x\u000f \\* r1b72c7b\u000f https://github.com/xwiki/xwiki-platform/commit/1b72c7bc9b63b8fabe8e8c55689eb76b11b1dc36 \u000f/ xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/migration/hibernate/R35100XWIKI7564DataMigration.java :\u000f XWIKI-7763: Database migration (upgrade) fails from 3.5 to 4.0 with PostgreSQL ...  \n10:32\u00a0<CIA-160>\u00a0Sergiu Dumitriu\u000f master\u000f \\* rd28a9d2\u000f https://github.com/xwiki/xwiki-platform/commit/d28a9d26e73a452290ba4361558aced3929ad6f0 \u000f/ xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/migration/hibernate/R35100XWIKI7564DataMigration.java :\u000f XWIKI-7763: Database migration (upgrade) fails from 3.5 to 4.0 with PostgreSQL ...  \n10:32\u00a0<CIA-160>\u00a0Sergiu Dumitriu\u000f stable-4.0.x\u000f \\* r8bdd413\u000f https://github.com/xwiki/xwiki-platform/commit/8bdd4130ac1cd648d6bc39b435fd4edd570775dd \u000f/ xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/migration/hibernate/R35100XWIKI7564DataMigration.java :\u000f XWIKI-7763: Database migration (upgrade) fails from 3.5 to 4.0 with PostgreSQL ...  \n11:03\u00a0<vmassol>\u00a0guys, I'm about to send proposal for 4.1 with proposed dates. Who wants to be RM for 4.1?  \n11:04\u00a0<vmassol>\u00a0dates I'd like to propose:  \n11:04\u00a0<vmassol>\u00a0- 4.1 dates (start from 16th of apr):  \n11:04\u00a0<vmassol>\u00a0-- M1: 7th of May  \n11:04\u00a0<vmassol>\u00a0-- M2: 28th of May  \n11:04\u00a0<vmassol>\u00a0-- RC1: 11th of June  \n11:04\u00a0<vmassol>\u00a0-- Final: 18th of June  \n11:04\u00a0<vmassol>\u00a0anyone who's available at those dates to be the RM?  \n11:07\u00a0<vmassol>\u00a0(we could also change RM at each minor release, we don't have to use the same RM for all minor releases)  \n11:07\u00a0<vmassol>\u00a0AndreasJonsson: wiling to try it?  \n11:08\u00a0<vmassol>\u00a0jvelo?  \n11:08\u00a0<vmassol>\u00a0cjd?  \n11:09\u00a0<@sdumitriu>\u00a0Count me in as a fallback  \n11:10\u00a0<vmassol>\u00a0I'm not there on 7th (holidays) but I could try doing one, the 28th of May one for ex, to learn the new process  \n11:22\u00a0<fmancinelli>\u00a0has joined #xwiki  \n11:29\u00a0<jvelo>\u00a0has quit  \n11:30\u00a0<jvelo>\u00a0has joined #xwiki  \n11:33\u00a0<CIA-160>\u00a0tmortagne\u000f master\u000f \\* r7cd2489\u000f https://github.com/xwiki/xwiki-platform/commit/7cd2489a2c4c1d7173716ea67f119ba9fd86ded4 \u000f/ (2 files in 2 dirs):\u000f XWIKI-7761: The string merging is not very good during XAR merge ...  \n12:06\u00a0<jvdrean>\u00a0has joined #xwiki  \n12:09\u00a0<sburjan>\u00a0has quit  \n12:17\u00a0<sdumitriu>\u00a0has quit  \n12:27\u00a0<sburjan>\u00a0has joined #xwiki  \n\n"}