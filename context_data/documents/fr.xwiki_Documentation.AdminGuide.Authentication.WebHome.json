{
  "id": "xwiki:Documentation.AdminGuide.Authentication.WebHome",
  "url": "https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/",
  "title": "User Authentication",
  "collection": "Eval_fr",
  "mimetype": "text/markdown",
  "language": "fr",
  "content": "**Contenu**\n\n* [Choisir l'authentificateur](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HChoosetheauthenticator)\n* [Types d'authentification](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HAuthenticationTypes)\n\t+ [Authentification par formulaire](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HFormAuthentication)\n\t+ [Authentification de base](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HBasicAuthentication)\n\t+ [Authentification par conteneur](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HContainerAuthentication)\n\t+ [Authentification OpenId Connect](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HOpenIdConnectAuthentication)\n\t+ [Active Directory](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HActiveDirectory)\n\t+ [LDAP](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HLDAP)\n\t+ [Authentification personnalisée](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HCustomAuthentication)\n\t\t- [Authentification personnalisée en utilisant un script Groovy dans une page wiki](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HCustomAuthenticationusingaGroovyscriptinawikipage)\n* [Configuration](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HConfiguration)\n\t+ [Paramètres d'authentification](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HAuthenticationparameters)\n\t+ [Sécurité](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HSecurity)\n* [Authentification Kerberos SSO](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HKerberosSSOAuthentication)\n* [Modèles de courriel](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HMailTemplates)\n\nXWiki prend en charge plusieurs mécanismes d'authentification différents pour authentifier les utilisateurs.\n\nActuellement, XWiki ne permet d'activer qu'une seule méthode d'authentification à la fois. Cela sera probablement amélioré à l'avenir.\n\nNotez également que XWiki nécessite que les cookies soient activés afin de suivre votre session et de vous maintenir connecté entre les pages.\n\n# Choisir l'authentificateur\n\nHistoriquement, l'authentificateur à utiliser dans XWiki est contrôlé par la propriété xwiki.authentication.authclass dans le fichier xwiki.properties.\n\nXWiki 15.3+ Pour les authentificateurs qui le supportent, il est possible de choisir l'authentificateur à utiliser dans l'administration du wiki.\n\n![authserviceadmin.png](https://www.xwiki.org/xwiki/bin/download/Documentation/AdminGuide/Authentication/WebHome/authserviceadmin.png?rev=1.1)\n\n# Types d'authentification\n\n## Authentification par formulaire\n\nL'authentification par formulaire est la méthode par défaut pour s'authentifier dans un Wiki. Elle nécessite un utilisateur et un mot de passe.\n\n## Authentification de base\n\nXWiki prend en charge [l'authentification d'accès de base](https://en.wikipedia.org/wiki/Basic_access_authentication), une méthode conçue pour permettre à un navigateur web ou à d'autres programmes clients de fournir des informations d'identification - sous la forme d'un nom d'utilisateur et d'un mot de passe - lors de la réalisation d'une requête. Vous pouvez vous authentifier sur un serveur XWiki avec le protocole d'authentification de base en utilisant le schéma d'URL suivant :\n\nhttps://username:password@mywiki.xwiki.com/xwiki/bin/view/Main/WebHome?basicauth=1  \nSoyez prudent, car si vous utilisez le protocole HTTP, votre mot de passe sera envoyé en clair sur le réseau et sera donc très peu sécurisé. Lorsque vous utilisez l'authentification de base, vous devez vous assurer que votre wiki est configuré pour utiliser HTTPS.\n\n## Authentification par conteneur\n\nDélègue l'authentification au conteneur Servlet. Si elle échoue, elle revient à l'authentification standard de XWiki.\n\nPour configurer XWiki pour l'utiliser, spécifiez :\n\nxwiki.authentication.authclass=com.xpn.xwiki.user.impl.xwiki.AppServerTrustedAuthServiceImplPour que les utilisateurs soient réellement créés et non simplement définis comme utilisateur de contexte, vous devez définir dans le fichier de configuration xwiki.cfg (si la propriété n'existe pas déjà, créez-la) :\n\nxwiki.authentication.createuser=empty\n\n## Authentification OpenId Connect\n\nVoir l'[extension OpenId Connect Authenticator](https://extensions.xwiki.org/xwiki/bin/view/Extension/OpenID%20Connect/OpenID%20Connect%20Authenticator/).\n\n## Active Directory\n\nSi vous cherchez à connecter XWiki à un serveur Active Directory, vous avez actuellement 2 options :\n\n* Utiliser l'approche manuelle et générique en utilisant l'[extension LDAP Authenticator](https://extensions.xwiki.org/xwiki/bin/view/Extension/LDAP/Authenticator/)\n* Utiliser l'[application Active Directory](https://store.xwiki.com/xwiki/bin/view/Extension/ActiveDirectoryApplication) dédiée, qui est une application payante dédiée à la simplification de l'intégration d'Active Directory avec XWiki. L'application Active Directory vous permet de connecter facilement votre serveur Active Directory à XWiki en utilisant un **éditeur visuel**, de mettre à jour les paramètres de **configuration avancée** sans redémarrer le serveur d'applications, et de bénéficier d'un **support technique** fourni par [XWiki SAS](https://xwiki.com/), etc.\n\n## LDAP\n\nVoir l'[extension LDAP Authenticator](https://extensions.xwiki.org/xwiki/bin/view/Extension/LDAP/Authenticator/).\n\nL'authentificateur LDAP de base obsolète (pour XWiki < 7.4) peut être trouvé sur [OldLDAPAuthenticator](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/OldLDAPAuthenticator/).\n\n## Authentification personnalisée\n\nVous pouvez créer votre propre authentification personnalisée en suivant le tutoriel [Créer un authentificateur personnalisé](https://www.xwiki.org/xwiki/bin/view/Documentation/DevGuide/Tutorials/Create%20a%20Custom%20Authenticator/).\n\nNotez qu'il est également possible de personnaliser le système de gestion des droits, voir le [module de sécurité](https://extensions.xwiki.org/xwiki/bin/view/Extension/Security%20Module) pour plus de détails.\n\n### Authentification personnalisée en utilisant un script Groovy dans une page wiki\n\nCommencez par spécifier que vous souhaitez utiliser l'authentificateur Groovy :\n\nxwiki.authentication.authclass = com.xpn.xwiki.user.impl.xwiki.GroovyAuthServiceImplPuis ajoutez un autre paramètre de configuration pour spécifier dans quelle page wiki se trouve l'authentificateur :\n\nxwiki.authentication.groovy.pagename = MySpace.MyPageEnsuite, mettez du code Groovy dans une page wiki qui retourne un objet XWikiAuthService.\n\n# Configuration\n\n## Paramètres d'authentification\n\nVous pouvez définir chacun de ces paramètres en définissant :\n\nxwiki.authentication.<nom_param>=<valeur_param>\n\n| Nom | Optionnel | Valeurs autorisées | Valeur par défaut | Description |\n| --- | --- | --- | --- | --- |\n| encryptionKey | Non(1)/XWiki 15.9+, 15.5.4+, 14.10.19+ Oui | ? | n/a | Définir la clé de chiffrement utilisée pour créer une clé secrète, la clé secrète est transmise à l'objet Cipher pour être utilisée lors du chiffrement et du déchiffrement des valeurs des cookies. |\n| validationKey | Non(2)/XWiki 15.9+, 15.5.4+, 14.10.19+ Oui | ? | n/a | Définir la clé de validation utilisée pour générer une valeur de hachage ; la valeur de hachage est stockée avec le cookie et utilisée pour vérifier que le cookie n'a pas été altéré. |\n| cookiedomains | Oui | String | Nom d'hôte du serveur | À quel(s) hôte(s) vos cookies doivent être envoyés ; à utiliser uniquement si vous souhaitez partager des cookies entre domaines, sinon doit être commenté |\n| cookielife | Oui | Nombre | 14 | Nombre de jours avant l'expiration des cookies |\n| cookiepath | Oui | String | / | Le chemin de l'application web auquel les cookies XWiki doivent être envoyés ; si vous avez autre chose en cours d'exécution sur votre serveur web, cela doit être défini sur */xwiki* |\n| default_page | Oui | String | /bin/view/ Main/WebHome | Page vers laquelle rediriger si le paramètre xredirect n'est pas défini |\n| encryptionalgorithm | Oui | ? | ? | Définir l'algorithme de chiffrement utilisé pour chiffrer et déchiffrer les cookies |\n| encryptionmode | Oui | ? | ? | Définir le mode de chiffrement utilisé pour chiffrer et déchiffrer les cookies |\n| encryptionpadding | Oui | ? | ? | Définir le remplissage de chiffrement utilisé pour chiffrer et déchiffrer les cookies |\n| errorpage | Oui | String | /bin/loginerror/ XWiki/XWikiLogin | Page vers laquelle rediriger en cas d'erreur de connexion |\n| loginpage | Oui | String | /bin/login/ XWiki/XWikiLogin | Page vers laquelle rediriger lorsqu'on n'est pas connecté |\n| loginsubmitpage | Oui | String | /loginsubmit/ XWiki/XWikiLogin | L'URL où le nom d'utilisateur et le mot de passe sont envoyés lors de la connexion. |\n| logoutpage | Oui | String | /bin/logout/ XWiki/XWikiLogout | Page vers laquelle rediriger après la déconnexion |\n| realmname | Oui | String | XWiki | Définit le nom du domaine |\n| protection | Oui | all, validation, encryption, none | all | Niveau de protection pour la fonctionnalité de cookie \"se souvenir de moi\" |\n| useip | Oui | true / false | true | Spécifiez si l'adresse IP doit être utilisée lors du chiffrement des données du cookie ; si l'adresse IP change, il faudra se reconnecter. |\n\n1. Nécessaire uniquement si protection = encryption ou all (par défaut)\n2. Nécessaire uniquement si protection = validation ou all (par défaut)\n\n## Sécurité\n\nÀ partir de XWiki 11.6RC1, nous fournissons des stratégies d'authentification qui sont déclenchées si un utilisateur échoue plusieurs fois de suite à se connecter.  \nVous pouvez configurer ces stratégies et quand elles doivent être déclenchées dans Administration > Authentification.\n\n![authentication-security-administration.png](https://www.xwiki.org/xwiki/bin/download/Documentation/AdminGuide/Authentication/WebHome/authentication-security-administration.png?rev=1.1)\n\nPour plus d'informations, voir la [documentation du module de sécurité d'authentification](https://extensions.xwiki.org/xwiki/bin/view/Extension/Authentication%20Security%20Module/).\n\n# Authentification Kerberos SSO\n\nCette implémentation de SSO est actuellement en cours de révision, voir : <https://jira.xwiki.org/browse/XWIKI-2496>. La classe décrite dans ce segment de documentation, AppServerTrustedKerberosAuthServiceImpl, ne fait pas partie de la distribution par défaut de XWiki !\n\nVoici un exemple de **mod_auth_kerb** pour Apache utilisé pour implémenter facilement l'authentification XWiki des utilisateurs via HTTP Negotiate sur un serveur Linux. Cet exemple suppose que vous avez déjà une configuration fonctionnelle d'Apache2 HTTPD et d'Apache Tomcat avec mod_jk.\n\nTout d'abord, vous devez créer un principal et un keytab pour le serveur web :\n\n# kadmin  \nkadmin> addprinc -randkey HTTP/wiki.example.com  \nkadmin> ktadd -k /etc/apache2/ssl/wiki.keytab HTTP/wiki.example.com  \nkadmin> quitAssurez-vous que le keytab a les bonnes permissions et la bonne propriété :\n\nchown www-data:www-data /etc/apache2/ssl/wiki.keytab  \nchmod 400 /etc/apache2/ssl/wiki.keytabInstallez **mod_auth_kerb** dans votre installation Linux. Sur Debian ou Ubuntu, cela se fait en exécutant :\n\naptitude install libapache2-mod-auth-kerbBien sûr, la procédure d'installation varie selon la distribution Linux.\n\nSi votre installation xwiki est montée dans Apache HTTPD sous /xwiki, ajoutez ce qui suit à la configuration de l'hôte virtuel :\n\n<Location \"/xwiki\">  \n  AuthType Kerberos  \n  AuthName \"Kerberos Login\"  \n  KrbAuthRealms EXAMPLE.COM  \n  Krb5Keytab \"/etc/apache2/ssl/wiki.keytab\"  \n  KrbMethodK5Passwd off  \n  KrbMethodNegotiate on  \n  KrbSaveCredentials on  \n  require valid-user  \n</Location>Assurez-vous qu'Apache Tomcat utilise l'authentification effectuée par Apache HTTPD avec la propriété \"tomcatAuthentication\" dans la description du connecteur (qui se trouve dans le fichier **server.xml** d'Apache Tomcat) :\n\n<Connector port=\"8009\" address=\"127.0.0.1\" enableLookups=\"false\" tomcatAuthentication=\"false\" redirectPort=\"8443\" protocol=\"AJP/1.3\" ></Connector>Placez le fichier **authkerb.jar** dans le répertoire WEB-INF/lib de XWiki dans Apache Tomcat.\n\nFaites en sorte que Xwiki utilise le module d'authentification en modifiant la propriété \"xwiki.authentication.authclass\" dans le fichier WEB-INF/lib/xwiki.cfg.\n\nxwiki.authentication.authclass=com.xpn.xwiki.user.impl.xwiki.AppServerTrustedKerberosAuthServiceImplSi vous utilisez Firefox, n'oubliez pas de mettre en liste blanche l'URL de xwiki pour HTTP Negotiate dans about:config avec la propriété \"network.negotiate-auth.trusted-uris\". Les valeurs possibles pour cette propriété incluent : *https://* pour toutes les connexions sécurisées ou **example.com** pour tous les sous-domaines de example.com.\n\nLorsque j'ai utilisé JBoss SPNEGO (Kerberos en combinaison avec LDAP), j'ai modifié le code de **XWikiLDAPAuthServiceImpl** pour pouvoir détecter l'utilisateur sso. L'authentification s'est déjà produite en utilisant le module SPNEGO (JAAS). Après cela, j'utilise la fonctionnalité de synchronisation ldap pour m'assurer que l'utilisateur est à jour. La combinaison conduit à une connexion automatique dans XWiki et les droits de l'utilisateur sont contrôlés dans le serveur Active Directory. J'espère que vous pourrez adopter ce code ou que vous pourrez l'utiliser pour vos propres projets.\n\nLa configuration de ldap :\n\nxwiki.authentication.authclass=com.wiki.sso.SSOLdapAuthenicationImpl  \nxwiki.authentication.ldap=1  \nxwiki.authentication.ldap.server=<ad-server>  \nxwiki.authentication.ldap.port=389  \nxwiki.authentication.ldap.base_DN=<OU=Users,...............>  \n#utiliser un utilisateur fixe pour se connecter à la base de données ldap,  \n#le mot de passe n'est pas fourni avec SSOLdapAuthenicationImpl  \nxwiki.authentication.ldap.bind_DN=<domain>\\\\<user>  \nxwiki.authentication.ldap.bind_pass=<password>  \n#Configuration de Microsoft AD  \nxwiki.authentication.ldap.UID_attr=sAMAccountName  \nxwiki.authentication.ldap.fields_mapping=name=sAMAccountName,last_name=sn,first_name=givenName,fullname=displayName,mail=mail,ldap_dn=dn  \nxwiki.authentication.ldap.group_memberfields=member,uniqueMember  \n#Mappage des groupes LDAP  \nxwiki.authentication.ldap.group_mapping=XWiki.XWikiAdminGroup=CN=WIKI_Admin,............|\\  \n                                        XWiki.XWikiAllGroup=CN=WIKI_User,...........\n\nLe code Java :\n\n```java\npackage com.wiki.sso;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\n\nimport com.xpn.xwiki.XWikiContext;\nimport com.xpn.xwiki.XWikiException;\nimport com.xpn.xwiki.user.api.XWikiUser;\nimport com.xpn.xwiki.user.impl.LDAP.XWikiLDAPAuthServiceImpl;\n\nimport java.security.Principal;\n\npublic class SSOLdapAuthenicationImpl extends XWikiLDAPAuthServiceImpl {\n    /**\n     * Outil de journalisation.\n     */\n    private static final Log LOG = LogFactory.getLog(SSOLdapAuthenicationImpl.class);\n\n    public XWikiUser checkAuth(XWikiContext context) throws XWikiException {\n        String user = getRemoteUser(context);\n        if ((user != null) || !user.equals(\"\")) {\n            if (LOG.isInfoEnabled())\n                LOG.info(\"Lancement de la création de l'utilisateur pour \" + user);\n            if (authenticate(user, context) != null) {\n                if (LOG.isInfoEnabled())\n                    LOG.info(\"Création de l'utilisateur terminée pour \" + user);\n                user = \"XWiki.\" + user;\n                context.setUser(user);\n                System.out.println(\"Utilisateur défini sur : \" + user);\n                return new XWikiUser(user);\n            } else {\n                LOG.error(\"L'utilisateur \" + user + \" ne peut pas être authentifié contre ldap\");\n            }\n        }\n        return super.checkAuth(context);\n    }\n\n    /**\n     * Nous ne pouvons pas authentifier localement car nous devons faire confiance au serveur d'applications pour l'authentification\n     *\n     * @param username\n     * @param password\n     * @param context\n     * @return\n     * @throws XWikiException\n     */\n    public XWikiUser checkAuth(String username, String password,\n                               String rememberme, XWikiContext context) throws XWikiException {\n        String user = getRemoteUser(context);\n        if ((user == null) || user.equals(\"\")) {\n            return super.checkAuth(username, password, rememberme, context);\n        }\n        return checkAuth(context);\n    }\n\n    private String getRemoteUser(XWikiContext context) {\n        String userName = context.getRequest().getHttpServletRequest()\n                .getRemoteUser();\n        if (userName != null) {\n            // ne prendre que le début du username@domain\n            String[] elements = userName.split(\"@\", 2);\n            userName = elements[0];\n        }\n        return userName;\n    }\n\n    public Principal authenticate(String login, XWikiContext context) throws XWikiException {\n        if (LOG.isTraceEnabled()) {\n            LOG.trace(\"Début de l'authentification LDAP\");\n        }\n\n        /*\n         * TODO: Mettre les 4 \"if\""
}