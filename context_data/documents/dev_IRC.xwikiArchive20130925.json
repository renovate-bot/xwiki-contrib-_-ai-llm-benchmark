{"id": "dev:IRC.xwikiArchive20130925", "url": "https://dev.xwiki.org/xwiki/bin/view/IRC/xwikiArchive20130925", "title": "IRC Archive for channel #xwiki on 25 September 2013 - XWiki", "collection": "Eval-Large", "mimetype": "text/markdown", "language": "en", "content": "\n<tekzilla>\u00a0has quit  \n01:23\u00a0<sdumitriu1>\u00a0has quit  \n01:47\u00a0<sburjan`>\u00a0has quit  \n01:47\u00a0<Inge->\u00a0has quit  \n01:47\u00a0<bouquetf>\u00a0has quit  \n01:54\u00a0<Inge->\u00a0has joined #xwiki  \n01:54\u00a0<kstuart1>\u00a0has joined #xwiki  \n01:54\u00a0<kstuart>\u00a0has quit  \n05:51\u00a0<Denis>\u00a0has quit  \n06:47\u00a0<mflorea>\u00a0has joined #xwiki  \n07:52\u00a0<vmassol>\u00a0has joined #xwiki  \n07:57\u00a0<tmortagne>\u00a0has joined #xwiki  \n08:04\u00a0<sdumitriu>\u00a0has quit  \n08:09\u00a0<sdumitriu>\u00a0has joined #xwiki  \n08:17\u00a0<Denis>\u00a0has joined #xwiki  \n08:51\u00a0<sburjan>\u00a0has joined #xwiki  \n09:04\u00a0<sburjan>\u00a0vmassol: good morning. I am going to test migrations on psql  \n09:05\u00a0<vmassol>\u00a0sburjan: ok  \n09:05\u00a0<vmassol>\u00a0make sure you retest workspaces and XEM upgrades too  \n09:05\u00a0<vmassol>\u00a0since this is supposed to be fixed and working perfectly well  \n09:08\u00a0<sburjan>\u00a0vmassol: let's just hope I will be able to figure out if the migrations are ok or not, because the migration issue was reported by guillaume, not by me  \n09:08\u00a0<sburjan>\u00a0I omly reported the bad merge issue, panels and translations  \n09:09\u00a0<sburjan>\u00a0i'll do my best :)  \n09:20\u00a0<fmancinelli>\u00a0has joined #xwiki  \n09:35\u00a0<vmassol>\u00a0has quit  \n09:36\u00a0<vmassol>\u00a0has joined #xwiki  \n09:40\u00a0<fmancinelli>\u00a0has quit  \n09:58\u00a0<KermitTheFragger>\u00a0has joined #xwiki  \n10:27\u00a0<gdelhumeau>\u00a0has joined #xwiki  \n10:33\u00a0<mflorea>\u00a0vmassol, gdelhumeau: [reminder] you have issues assigned that have been closed for 5.2RC1 without documentation links.  \n10:34\u00a0<vmassol>\u00a0mflorea: link?  \n10:34\u00a0<mflorea>\u00a0http://jira.xwiki.org/browse/XWIKI-9473  \n10:35\u00a0<mflorea>\u00a0XWIKI-9490 and XWIKI-9456 for gdelhumeau  \n10:35\u00a0<vmassol>\u00a0ah yes I had done that as a reminder to myself  \n10:35\u00a0<vmassol>\u00a0but I've documented it in the meantime, setting N/A  \n10:35\u00a0<mflorea>\u00a0ok  \n10:38\u00a0<vmassol>\u00a0mflorea: finishing someting and I'll resume debugging the jenkins vnc issue, at worse we can put back what was there before (a bit of work)  \n10:38\u00a0<mflorea>\u00a0vmassol: I fixed it  \n10:38\u00a0<vmassol>\u00a0really? :)  \n10:38\u00a0<vmassol>\u00a0what was the problem?  \n10:39\u00a0<gdelhumeau>\u00a0still?  \n10:39\u00a0<gdelhumeau>\u00a0ok  \n10:40\u00a0<mflorea>\u00a0I don't know exactly, first I tried with an empty vnc line, so that the default config is used, and then I added to the default line use by Jenkins some of the parameter we were using, the ones I though were really useful. I didn't add all so some of them might cause the problem  \n10:40\u00a0<UCC>\u00a0has joined #xwiki  \n10:40\u00a0<mflorea>\u00a0we can investigate more after 5.2RC1 release  \n10:41\u00a0<vmassol>\u00a0mflorea: I actually copied the line we were using from before  \n10:42\u00a0<vmassol>\u00a0ah yes  \n10:42\u00a0<vmassol>\u00a0actually I used xvnc and not vncserver I think  \n10:42\u00a0<vmassol>\u00a0anyway if it works it's great :)  \n10:42\u00a0<vmassol>\u00a0thanks for helping out  \n10:42\u00a0<mflorea>\u00a0np  \n10:59\u00a0<sburjan>\u00a0mflorea: in step 3 in DW (wiki upgrade): for workspaces the package to be upgraded is \u00a0XWiki Enterprise - UI - Wiki \u00a0and for old style subwikis the package to be upgraded is XWiki Enterprise - UI - Common \u00a0?  \n11:00\u00a0<gdelhumeau>\u00a0yes  \n11:00\u00a0<mflorea>\u00a0sburjan: gdelhumeau should know the answer  \n11:00\u00a0<sburjan>\u00a0thanks !  \n11:01\u00a0<gdelhumeau>\u00a0Maybe we should document it, but I don't know where  \n11:01\u00a0<gdelhumeau>\u00a0In the workspaces application?  \n11:02\u00a0<mflorea>\u00a0vmassol: platform quality job fails because of https://issues.jenkins-ci.org/browse/JENKINS-18108 , precisely, because of the spaces in job/folder name. Can we rename it? i.e. replace the space with \\_ or - or anything else that doesn't cause problems with folder names  \n11:02\u00a0<sburjan>\u00a0too bad these package names are not suggestive. at least for me  \n11:02\u00a0<sburjan>\u00a0and if they are not suggestive for me, I'm sure they won't be suggestive for the end user either  \n11:03\u00a0<sburjan>\u00a0especially XWiki Enterprise - UI - Common  \n11:03\u00a0<gdelhumeau>\u00a0Yes  \n11:03\u00a0<sburjan>\u00a0when I see common I think of something like a base template, a thing which all the wikis have  \n11:03\u00a0<gdelhumeau>\u00a0It's because is is really a common package between the main wiki et the \"workspaces\" wiki  \n11:04\u00a0<gdelhumeau>\u00a0The old \"subwiki\" has only the common part of main wiki & subwikis: no WorkspacesManager and no Workspace features  \n11:04\u00a0<sburjan>\u00a0yes but the name doesn't tell anything to the user. maybe from a technical POV it is correct, but ...  \n11:04\u00a0<gdelhumeau>\u00a0It's logical from a developer perspective  \n11:04\u00a0<gdelhumeau>\u00a0but maybe not for the user ;)  \n11:04\u00a0<sburjan>\u00a0yes, but it will be soon contain Wiki Manager, starting with 5.3, right ?  \n11:05\u00a0<sburjan>\u00a0so it won't be that common anymore  \n11:05\u00a0<gdelhumeau>\u00a0in 5.3, there will be no distinction between old subwiki & workspaces  \n11:05\u00a0<gdelhumeau>\u00a0the common packahe will only be used internally  \n11:05\u00a0<tmortagne>\u00a0sburjan: you are supposed to also have the description in the UI  \n11:05\u00a0<tmortagne>\u00a0not only the name  \n11:05\u00a0<tmortagne>\u00a0maybe the description can be improved if it's not clear enough  \n11:15\u00a0<xwikibot>\u00a0has joined #xwiki  \n11:29\u00a0<UCC>\u00a0has quit  \n12:07\u00a0<vmassol>\u00a0mflorea: there's still a space in the name for http://ci.xwiki.org/job/xwiki-platform%20Sonar/  \n12:07\u00a0<vmassol>\u00a0what did you change?  \n12:07\u00a0<mflorea>\u00a0I changed only the quality job  \n12:07\u00a0<vmassol>\u00a0ah yes  \n12:07\u00a0<mflorea>\u00a0sonar is not critical for the release  \n12:08\u00a0<vmassol>\u00a0but it'll fail for the same reason?  \n12:08\u00a0<mflorea>\u00a0yes  \n12:08\u00a0<vmassol>\u00a0ok fixing then  \n12:08\u00a0<mflorea>\u00a0so it should be changed also  \n12:09\u00a0<vmassol>\u00a0gdelhumeau: hi  \n12:10\u00a0<vmassol>\u00a0I think we should implement a UI extension (using the header extension point) for multiwiki so that if the user is admin a banner is displayed explaning that multiwiki needs to be setup in the admin before it can be used, wdyt?  \n12:10\u00a0<vmassol>\u00a0this could be done easily for 5.2 final  \n12:10\u00a0<vmassol>\u00a0right now I think it's hard for someone who installs XE to understand that  \n12:11\u00a0<vmassol>\u00a0hmm OTOH it means he'll see this banner all the time which isn't nice if he doesn't want to use multiwiki  \n12:11\u00a0<vmassol>\u00a0so not perfect...  \n12:11\u00a0<vmassol>\u00a0the real soltuion is to create the template automatically  \n12:12\u00a0<gdelhumeau>\u00a0vmassol: not very good if the MySQL user don't have the CREATE DATABASE right  \n12:12\u00a0<vmassol>\u00a0has left #xwiki  \n12:12\u00a0<vmassol>\u00a0has joined #xwiki  \n12:13\u00a0<vmassol>\u00a0if they don't have mysql persmission  \n12:13\u00a0<vmassol>\u00a0what will happen in the admin ui?  \n12:13\u00a0<vmassol>\u00a0it'll be the same problem no?  \n12:13\u00a0<vmassol>\u00a0it'll fail  \n12:13\u00a0<gdelhumeau>\u00a0It will fail at the template creation phase, yes  \n12:14\u00a0<gdelhumeau>\u00a0but at least the user can use the wiki as a single wiki  \n12:14\u00a0<vmassol>\u00a0ah ok but that doesn't change anything  \n12:14\u00a0<vmassol>\u00a0if the user does't have the permission then it won't be created obviously  \n12:14\u00a0<vmassol>\u00a0that doesn't prevent the wiki from working in single wiki mode  \n12:15\u00a0<vmassol>\u00a0the real issue for automatic creation for me ATM is more the time it takes to create a template  \n12:15\u00a0<vmassol>\u00a0(which is way too long)  \n12:16\u00a0<vmassol>\u00a0so if we automated creation at first request that comes in, then the wiki will not respond for a few seconds more (like 10 more) than what it already does  \n12:16\u00a0<gdelhumeau>\u00a0it's more than 10 seconds  \n12:17\u00a0<vmassol>\u00a0that's something we should look into  \n12:17\u00a0<gdelhumeau>\u00a0I think we should do it in a thread  \n12:17\u00a0<vmassol>\u00a0it shouldn't take more than a few milliseocnds  \n12:17\u00a0<vmassol>\u00a0no  \n12:17\u00a0<vmassol>\u00a0we should fix the speed  \n12:17\u00a0<gdelhumeau>\u00a0and also, the create wiki action should be done in ajax...  \n12:17\u00a0<vmassol>\u00a0hiding under the carpet is never a good solution IMO :)  \n12:17\u00a0<vmassol>\u00a0DB access is very very fast  \n12:18\u00a0<vmassol>\u00a0I don't understand why it's so slow, w're probbaly using a few not performant way  \n12:18\u00a0<vmassol>\u00a0s/few/very  \n12:18\u00a0<vmassol>\u00a0and thread creation is always horrible  \n12:18\u00a0<vmassol>\u00a0because you need sync points  \n12:19\u00a0<gdelhumeau>\u00a0I like the idea to create a template at the first start  \n12:19\u00a0<vmassol>\u00a0(ie what happens when the user tries to create a wiki before it's finished or if the user doesn't see the add>wiki option)  \n12:19\u00a0<vmassol>\u00a0yes it's easy to do but first we need to fix speed  \n12:23\u00a0<vmassol>\u00a017 seconds locally on hsqldb (just counted)  \n12:27\u00a0<sburjan>\u00a0gdelhumeau: only one question. I am in a old style subwiki. The thing is, how do I get back to the main wiki from the URL ?  \n12:27\u00a0<sburjan>\u00a0\\*without modifying the URL  \n12:27\u00a0<gdelhumeau>\u00a0how do you do it before?  \n12:28\u00a0<gdelhumeau>\u00a0I mean, I have not added a link like that in the subwiki ui  \n12:28\u00a0<gdelhumeau>\u00a0because I think it wasn't there before too  \n12:34\u00a0<sburjan>\u00a0gdelhumeau: it's a migration issue. I am creating a JIRA ticket  \n12:34\u00a0<sburjan>\u00a0DW upgrade  \n12:52\u00a0<sburjan>\u00a0gdelhumeau: something is clearly wrong  \n12:54\u00a0<sburjan>\u00a0actually, no, I was expecting the top menu to be the same on workspaces and subwikis, but seems it not. AFAIK this is known  \n12:56\u00a0<gdelhumeau>\u00a0Yes, the \"home menu\" is only there for \"workspaces\"  \n13:01\u00a0<sburjan>\u00a0gdelhumeau: I have reported http://jira.xwiki.org/browse/XWIKI-9500  \n13:04\u00a0<gdelhumeau>\u00a0sburjan: OK, I have commented  \n13:04\u00a0<sburjan>\u00a0gdelhumeau: is it also normal that after creating a workspace to have 2 users as member ? I have Administrator twice, once from the global wiki and once from the subwiki  \n13:05\u00a0<gdelhumeau>\u00a0do you mean you have myworkspace:XWiki.Admin?  \n13:07\u00a0<polx>\u00a0has joined #xwiki  \n13:07\u00a0<sburjan>\u00a0yes  \n13:08\u00a0<sburjan>\u00a0in the right side panel  \n13:08\u00a0<gdelhumeau>\u00a0the document exists?  \n13:09\u00a0<sburjan>\u00a0nope  \n13:10\u00a0<gdelhumeau>\u00a0ok, so I guess it is only on the AllGroup  \n13:10\u00a0<sburjan>\u00a0should I report this ?  \n13:10\u00a0<gdelhumeau>\u00a0is it after an upgrade or in a new instance?  \n13:13\u00a0<sburjan>\u00a0new instance  \n13:14\u00a0<sburjan>\u00a0the ones upgraded are ok (funny)  \n13:14\u00a0<gdelhumeau>\u00a0you have created the wiki with Add>Wiki?  \n13:16\u00a0<sburjan>\u00a0yes  \n13:17\u00a0<sburjan>\u00a0but again, I am on a migrated main wiki, so it's not 100% vanilla/clean  \n13:21\u00a0<gdelhumeau>\u00a0from which version did you upgrade?  \n13:21\u00a0<vmassol>\u00a0mflorea: you didn't rename http://ci.xwiki.org/view/Commons/job/xwiki-commons%20Quality%20Checks/ is that normal? The issue is only with vnc?  \n13:24\u00a0<sburjan>\u00a0gdelhumeau: 4.5.4 -> 5.2-SNAP (from today)  \n13:24\u00a0<gdelhumeau>\u00a0did you upgrade workspacetemplate?  \n13:25\u00a0<sburjan>\u00a0gdelhumeau: yes, using DW  \n13:27\u00a0<gdelhumeau>\u00a0what is the content of workspacetemplate:XWiki.XWikiAllGroup  \n13:39\u00a0<sburjan>\u00a0gdelhumeau: Administrator (xwiki:XWiki.Admin) and Admin (XWiki.Admin)  \n13:39\u00a0<gdelhumeau>\u00a0it's not normal :/  \n13:40\u00a0<gdelhumeau>\u00a0maybe when DB proposed you to merge XWIki.Admin, you have clicked on \"Use new version\"  \n13:41\u00a0<gdelhumeau>\u00a0anyway, that shows us that it's a problem to have XWiki.Admin in the xwiki-platform-administration-ui module  \n13:41\u00a0<gdelhumeau>\u00a0it should be only in xwiki-enterprise--ui-mainwiki  \n13:41\u00a0<gdelhumeau>\u00a0WDYT?  \n13:42\u00a0<vmassol>\u00a0yes I agree, the Admin user shouldn't be installed in subwikis  \n13:42\u00a0<vmassol>\u00a0defintiely  \n13:43\u00a0<vmassol>\u00a0because to create a subwiki you need a user already so that user will exist and will be able to log in the subwiki  \n13:43\u00a0<gdelhumeau>\u00a0actually, it is removed from the workspacetemplate via WorkspaceManager.Install  \n13:43\u00a0<vmassol>\u00a0why have it in the XAR?  \n13:43\u00a0<vmassol>\u00a0(subwiki XAR)  \n13:43\u00a0<gdelhumeau>\u00a0But it is still there in xwiki-enterprise-ui-wiki  \n13:43\u00a0<gdelhumeau>\u00a0because it's not easy to remove  \n13:44\u00a0<vmassol>\u00a0why not?  \n13:44\u00a0<gdelhumeau>\u00a0XWiki.Admin is in xwiki-platfrom-adminsitration-ui  \n13:44\u00a0<gdelhumeau>\u00a0and xwiki-ui depends on it  \n13:44\u00a0<vmassol>\u00a02 options  \n13:44\u00a0<mflorea>\u00a0vmassol: yes, only with vnc, so commons quality job is not affected  \n13:44\u00a0<vmassol>\u00a01) option 1: add it only in XE main XAR  \n13:44\u00a0<vmassol>\u00a02) option 2: add some exclude param to the XAR plugin  \n13:45\u00a0<gdelhumeau>\u00a0can we?  \n13:45\u00a0<gdelhumeau>\u00a0(option 2)  \n13:45\u00a0<vmassol>\u00a0(by option 1 I mean don't add Admin user page in xwiki-platfrom-adminsitration-ui)  \n13:46\u00a0<vmassol>\u00a0by option 2, it means to modify the plugin to add this feature (not hard)  \n13:46\u00a0<gdelhumeau>\u00a0in the all-in-one xar, I know, I have made it on a local branch  \n13:46\u00a0<sburjan>\u00a0gdelhumeau: I did not clicked use new version. All I did was to click on the continue button  \n13:46\u00a0<vmassol>\u00a0I wonder if option 1 isn't the best one, functional tests would need to be modified, would need to be proposed on the list  \n13:47\u00a0<gdelhumeau>\u00a0sburjan: because DW is supposed to know that XWIki.Admin has been removed and then it should not import it  \n13:48\u00a0<gdelhumeau>\u00a0no  \n13:48\u00a0<sburjan>\u00a0really ? DW should know about this ? Interesting. Didn't know this  \n13:48\u00a0<gdelhumeau>\u00a0actually it does, but te problem is only on XWiki.XWikiAllGroup  \n13:49\u00a0<gdelhumeau>\u00a0which is badly merged because I don't to add XWiki.Admin in the group...  \n13:50\u00a0<gdelhumeau>\u00a0sburjan: you can report it, and specify that you have upgraded workspacetemplate from a previous version  \n13:50\u00a0<sburjan>\u00a0gdelhumeau: ok, reporting  \n13:51\u00a0<mflorea>\u00a0has quit  \n13:51\u00a0<gdelhumeau>\u00a0thanks :)  \n13:53\u00a0<sburjan>\u00a0gdelhumeau: http://jira.xwiki.org/browse/XWIKI-9501  \n13:58\u00a0<gdelhumeau>\u00a0vmassol: I'm interested by option 1  \n13:58\u00a0<gdelhumeau>\u00a0I have to eat, i'll be back in 1 hour  \n13:58\u00a0<sburjan>\u00a0gdelhumeau: this means that it wil lbe hard to merge in one package (xar) workspaces and subwikis ... since one needs Admin the other doesn't  \n14:28\u00a0<fmancinelli>\u00a0has joined #xwiki  \n14:33\u00a0<gdelhumeau>\u00a0back  \n14:33\u00a0<gdelhumeau>\u00a0sooner than expected  \n14:36\u00a0<mflorea>\u00a0has joined #xwiki  \n15:00\u00a0<sdumitriu>\u00a0has quit  \n15:00\u00a0<sdumitriu>\u00a0has joined #xwiki  \n15:04\u00a0<mflorea>\u00a0vmassol, tmortagne: I commented on http://jira.xwiki.org/browse/XWIKI-9499 . Should I send a mail on devs? WDYT? It blocks the release (since the CI looks good for master branch)  \n15:05\u00a0<tmortagne>\u00a0mflorea: application panel hasn't been introduce in 5.2 so it does not really block the release IMO  \n15:05\u00a0<vmassol>\u00a0mflorea: I replied, I agree with you  \n15:06\u00a0<vmassol>\u00a0tmortagne: it does for me  \n15:06\u00a0<vmassol>\u00a0because 5.2 is about multiwiki creation  \n15:06\u00a0<vmassol>\u00a0(and deletion)  \n15:06\u00a0<tmortagne>\u00a0it was possible to create wiki before...  \n15:06\u00a0<vmassol>\u00a0it's the focus of that release  \n15:06\u00a0<vmassol>\u00a0sure but it's now even easier  \n15:07\u00a0<vmassol>\u00a0I played 15 minutes with xwiki 5.2 and got this issue  \n15:07\u00a0<vmassol>\u00a0so you can be sure people will get it too often  \n15:07\u00a0<vmassol>\u00a0because now people will try it  \n15:07\u00a0<vmassol>\u00a0create a wiki to see what it does  \n15:07\u00a0<vmassol>\u00a0remove it  \n15:07\u00a0<tmortagne>\u00a0installing an extension in a wiki then delete it and recreate the exact same one is not exactly something anyone would do  \n15:07\u00a0<vmassol>\u00a0it's still more important now than before  \n15:08\u00a0<vmassol>\u00a0if it can be fixed it's better for 5.2  \n15:08\u00a0<mflorea>\u00a0adding the WikiDeletingEvent is easy, I just want to know you agree  \n15:08\u00a0<mflorea>\u00a0vmassol is ok  \n15:08\u00a0<vmassol>\u00a0it's a good thing to have anyway IMO  \n15:12\u00a0<tmortagne>\u00a0checking something  \n15:14\u00a0<tmortagne>\u00a0mflorea: I don't see why we can't do 2  \n15:14\u00a0<tmortagne>\u00a0this does not require any change to ComponentManager  \n15:14\u00a0<mflorea>\u00a0WikiComponentManager  \n15:15\u00a0<tmortagne>\u00a0we don't need to touch it either  \n15:15\u00a0<tmortagne>\u00a0you are not even supposed to now about WikiComponentManager  \n15:16\u00a0<mflorea>\u00a0that's what DefaultWikiComponentManagerEventListener uses to register/unregister components  \n15:16\u00a0<mflorea>\u00a0the problem is there  \n15:17\u00a0<tmortagne>\u00a0actually it has nothing to do with wiki components  \n15:17\u00a0<tmortagne>\u00a0the ComponentManager associated to the deleted wiki should be automatically removed  \n15:17\u00a0<mflorea>\u00a0DefaultWikiComponentManagerEventListener needs to either listen to WikiDeletedEvent and use WikiComponentManager API to unregister all components from the deleted wiki (solution 2) or listen to WikiDeletingEvent and use the WikiComponentBuilder to search for components in the deleted wiki and unregister them (solution 1)  \n15:18\u00a0<tmortagne>\u00a0then those components won't be registered anymore  \n15:18\u00a0<tmortagne>\u00a0the real fix for me is to get rid of this CM and I'm supprised it's not already the case  \n15:18\u00a0<mflorea>\u00a0I don't think that will fix the issue completely since WikiComponentManager holds a list of registered wiki components  \n15:19\u00a0<tmortagne>\u00a0it's not it's job  \n15:19\u00a0<mflorea>\u00a0let me see why it keeps this list  \n15:20\u00a0<tmortagne>\u00a0wait  \n15:20\u00a0<tmortagne>\u00a0if you are talking about org.xwiki.component.internal.WikiComponentManager then of course it has the component  \n15:21\u00a0<tmortagne>\u00a0this is the component manager associated to the wiki  \n15:21\u00a0<tmortagne>\u00a0this class has nothing to do with wiki components  \n15:21\u00a0<mflorea>\u00a0I'm talking about org.xwiki.component.wiki.internal.DefaultWikiComponentManager  \n15:22\u00a0<mflorea>\u00a0and ofc about org.xwiki.component.wiki.WikiComponentManager  \n15:22\u00a0<tmortagne>\u00a0then yes storing components is not DefaultWikiComponentManager job  \n15:22\u00a0<mflorea>\u00a0so wiki components, not the general CM  \n15:22\u00a0<mflorea>\u00a0well, it keeps the list of registered wiki components to unregister them \"quickly\"  \n15:23\u00a0<mflorea>\u00a0the alternative is to iterate over all components, and check which ones are wiki compoments  \n15:24\u00a0<mflorea>\u00a0(using the general CM)  \n15:25\u00a0<tmortagne>\u00a0you probably don't have that CM anymore when receiving WikiDeletedEvent  \n15:26\u00a0<mflorea>\u00a0now, I don't understand something  \n15:26\u00a0<tmortagne>\u00a0making sure if the wiki CM is removed when received the wiki deleted event since it needs to be anyway  \n15:27\u00a0<mflorea>\u00a0I think that will fix this issue  \n15:29\u00a0<mflorea>\u00a0because DefaultWikiComponentManager uses the list of registered wiki components only to ease its job of unregistering components, so it isn't use for lookup, thus it can't affect the fact that the UI Extension (Ideas icon in Applications Panel) is still found after the wiki is deleted  \n15:29\u00a0<tmortagne>\u00a0so the wiki CM does not seems to be deleted and yes it will fix http://jira.xwiki.org/browse/XWIKI-9499  \n15:30\u00a0<tmortagne>\u00a0but there will still be this crappy list of components in DefaultWikiComponentManager  \n15:30\u00a0<mflorea>\u00a0yep  \n15:30\u00a0<mflorea>\u00a0which will accumulate stale wiki components from deleted wikis  \n15:30\u00a0<tmortagne>\u00a0working on removing the wiki CM for now, creating an issue for it  \n15:52\u00a0<gdelhumeau>\u00a0[ERROR] Failed to execute goal org.xwiki.platform:xwiki-platform-tool-xmldoc-update-plugin:5.2-SNAPSHOT:attach (attach-template-features-xar) on project xwiki-platform-workspace-ui: Execution attach-template-features-xar of goal org.xwiki.platform:xwiki-platform-tool-xmldoc-update-plugin:5.2-SNAPSHOT:attach failed: Plugin org.xwiki.platform:xwiki-platform-tool-xmldoc-update-plugin:5.2-SNAPSHOT or one of its dependencies  \n15:52\u00a0<gdelhumeau>\u00a0r:2.0-alpha-1-SNAPSHOT-500, uk.ac.ed.ph.snuggletex:snuggletex-core:jar:1.1.0, uk.ac.ed.ph.snuggletex:snuggletex-jeuclid:jar:1.1.0, org.artofsolving.jodconverter:jodconverter-core:jar:3.0-beta-4-xwiki-20110822, de.l3s.boilerpipe:boilerpipe:jar:1.2.0-xwiki: Could not find artifact info.informatica:css4j:jar:0.13 in central (http://repo.maven.apache.org/maven2) -> [Help 1]  \n15:52\u00a0<gdelhumeau>\u00a0What does it mean?  \n16:28\u00a0<tmortagne>\u00a0gdelhumeau: do you have those artifacts in your local repository ?  \n16:28\u00a0<gdelhumeau>\u00a0I have cleaned everything  \n16:28\u00a0<gdelhumeau>\u00a0my repo  \n16:28\u00a0<tmortagne>\u00a0according to the error it cannot find a bunch of artifacts, maybe nexus has some issues  \n16:29\u00a0<tmortagne>\u00a0do you see maven trying to download those artifact in the log ?  \n16:29\u00a0<Denis>\u00a0has quit  \n16:35\u00a0<evalica>\u00a0has joined #xwiki  \n16:37\u00a0<gdelhumeau>\u00a0well, it's fixed now -\\_-  \n16:37\u00a0<gdelhumeau>\u00a0maybe a temporary problem on nexus  \n16:59\u00a0<tmortagne>\u00a0mflorea, vmassol: should be better now, what's left (the crappy map in DefaultWikiComponentManager) even if not very clean should not cause any issue  \n17:00\u00a0<tmortagne>\u00a0it also probably fixed the exact same issue with wiki macros which does not listen to wikideletedevent as far as I can see in the code  \n17:01\u00a0<tmortagne>\u00a0and same for any other dynamic component except for extension manager which probably take care of that  \n17:01\u00a0<mflorea>\u00a0tmortagne: ok thanks  \n17:02\u00a0<vmassol>\u00a0thanks tmortagne  \n17:02\u00a0<tmortagne>\u00a0DefaultWikiComponentManager still need to be improved but from what I understand it just mean that it will try to unregister a component which is not registered so probably some log or something and that's pretty much all  \n17:02\u00a0<vmassol>\u00a0did you test it?  \n17:02\u00a0<vmassol>\u00a0(retest my use case I mean)  \n17:02\u00a0<tmortagne>\u00a0not the application panel use case no  \n17:02\u00a0<mflorea>\u00a0[all] hold your commits for the rest of the day (unless it's a critical fix) so that the CI runs all jobs and I can start the release  \n17:03\u00a0<tmortagne>\u00a0but I wrote test about components associated to a wiki  \n17:03\u00a0<vmassol>\u00a0ok I'll retest  \n17:03\u00a0<vmassol>\u00a0ouch memory: http://ci.xwiki.org/job/xwiki-commons%20Quality%20Checks/370/console  \n17:04\u00a0<tmortagne>\u00a0note that it required some changes in both commons-component-default and xwiki-platform-component-multi  \n17:05\u00a0<vmassol>\u00a0mflorea: why is http://ci.xwiki.org/view/Platform/job/xwiki-platform/configure restricted to agent5, any idea?  \n17:05\u00a0<vmassol>\u00a0ah no, it says all except a5  \n17:05\u00a0<vmassol>\u00a0not sure why  \n17:05\u00a0<mflorea>\u00a0I noticed that too and removed it.. I guess i forgot to save  \n17:05\u00a0<vmassol>\u00a0ok  \n17:06\u00a0<mflorea>\u00a0I don't remember any issue with agent-5  \n17:06\u00a0<vmassol>\u00a0memory used is currnetly: -Xmx1536m -XX:MaxPermSize=512m -Xms256m  \n17:06\u00a0<vmassol>\u00a0it seems not enough for http://ci.xwiki.org/job/xwiki-commons%20Quality%20Checks/370/console  \n17:06\u00a0<vmassol>\u00a0strange  \n17:06\u00a0<vmassol>\u00a0because that shouldn't eat that much memory (commons + sonar)  \n17:07\u00a0<mflorea>\u00a0http://ci.xwiki.org/job/xwiki-commons/1068/console  \n17:07\u00a0<mflorea>\u00a0Exception in thread \"Job Manager daemon thread\" java.lang.OutOfMemoryError: GC overhead limit exceeded  \n17:07\u00a0<vmassol>\u00a0ok so it's not sonar  \n17:08\u00a0<vmassol>\u00a0tmortagne: could it be related to your commits?  \n17:08\u00a0<vmassol>\u00a0I don't remember seeing memory issue before in commons  \n17:08\u00a0<mflorea>\u00a0(was about to ask the same :) )  \n17:08\u00a0<tmortagne>\u00a0vmassol: I don't see how  \n17:09\u00a0<vmassol>\u00a0yes but I don't see any other explanation ATM :)  \n17:09\u00a0<vmassol>\u00a0all past builds were ok  \n17:09\u00a0<tmortagne>\u00a0my only change is in EmbeddableComponentManager#dispose() which is called only at the end  \n17:09\u00a0<tmortagne>\u00a0when XWiki is stopped  \n17:09\u00a0<tmortagne>\u00a0so no I really don't see how it could be related  \n17:10\u00a0<vmassol>\u00a0yes but maybe the tests call this too  \n17:11\u00a0<tmortagne>\u00a0yes it calls it when it's done  \n17:11\u00a0<vmassol>\u00a0several times  \n17:11\u00a0<vmassol>\u00a0casuing some memory leak to accumulate  \n17:11\u00a0<tmortagne>\u00a0dispose() does not create any object  \n17:11\u00a0<tmortagne>\u00a0it just empty a map  \n17:12\u00a0<tmortagne>\u00a0there is nothing to accumulate  \n17:15\u00a0<tmortagne>\u00a0my change actually save a bit of memory since the elements were not removed from the map before...  \n17:18\u00a0<vmassol>\u00a0stopping the commons build and trigging again  \n17:19\u00a0<vmassol>\u00a0let's see if it was a fluke  \n17:19\u00a0<vmassol>\u00a0there's still something eating lots of memory that we should check though  \n17:26\u00a0<tmortagne>\u00a0DefaultJobManagerTest failing test does not seems to be a flickering, checking why it fail  \n17:29\u00a0<tmortagne>\u00a0it's because AbstractMockingComponentTestCase register a mock over itself so it destroy itself...  \n17:30\u00a0<tmortagne>\u00a0it was not visible before because it was just calling dispose() on all components that were not initialized but now they are also removed  \n17:30\u00a0<tmortagne>\u00a0AbstractMockingComponentTestCase should not do it this way  \n17:30\u00a0<vmassol>\u00a0ok cool you found the reason  \n17:31\u00a0<tmortagne>\u00a0it's not the reason for the memory  \n17:31\u00a0<tmortagne>\u00a0there was a failing test  \n17:31\u00a0<tmortagne>\u00a0I don't know what is the reason for the memory  \n17:31\u00a0<tmortagne>\u00a0http://ci.xwiki.org/job/xwiki-commons/1068/org.xwiki.commons$xwiki-commons-job/testReport/junit/org.xwiki.job.internal/DefaultJobManagerTest/testGetJobStatusForUnexistingJob/  \n17:33\u00a0<vmassol>\u00a0ok  \n17:33\u00a0<vmassol>\u00a0same memory problem after restart: http://ci.xwiki.org/job/xwiki-commons/1069/console  \n17:33\u00a0<vmassol>\u00a0let's try locally now  \n17:34\u00a0<vmassol>\u00a0errr what is this: \u00a0-Dcommons.rendering.profile ?  \n17:35\u00a0<vmassol>\u00a0on http://ci.xwiki.org/job/xwiki-commons/configure we have:  \n17:35\u00a0<vmassol>\u00a0\"clean deploy -Plegacy,integration-tests -e -U -Dcommons.rendering.profile\"  \n17:43\u00a0<mflorea>\u00a0I've no idea  \n17:47\u00a0<fmancinelli>\u00a0has quit  \n17:49\u00a0<vmassol>\u00a0tmortagne: you're fixing the unit test ATM?  \n17:49\u00a0<vmassol>\u00a0Tests in error:  \n17:49\u00a0<vmassol>\u00a0\u00a0\u00a0DefaultJobManagerTest.testGetJobStatusForUnexistingJob:64->AbstractMockingComponentTestCase.getMockedComponent:134->AbstractMockingComponentTestCase.getMockedComponent:146 ? ComponentLookup  \n17:50\u00a0<vmassol>\u00a0I wanted to test the memory pb locally but I can't reach it, I get this test failing first :)  \n18:07\u00a0<mflorea>\u00a0has quit  \n18:11\u00a0<evalica>\u00a0has quit  \n18:13\u00a0<Denis>\u00a0has joined #xwiki  \n18:14\u00a0<evalica>\u00a0has joined #xwiki  \n18:21\u00a0<tmortagne>\u00a0vmassol: test framework CM does dispose itself anymore and it fixed related tests but the memory issue is still there  \n18:31\u00a0<tmortagne>\u00a0hmm actually the last build did not had my commit it seems  \n18:31\u00a0<tmortagne>\u00a0lets see  \n18:32\u00a0<vmassol>\u00a0ok  \n18:38\u00a0<sburjan>\u00a0has quit  \n18:53\u00a0<KermitTheFragger>\u00a0has quit  \n19:00\u00a0<tmortagne>\u00a0has quit  \n19:09\u00a0<gdelhumeau>\u00a0has quit  \n19:37\u00a0<xwikibot>\u00a0has joined #xwiki  \n19:38\u00a0<polx>\u00a0has quit  \n20:28\u00a0<Slashman>\u00a0has joined #xwiki  \n22:10\u00a0<evalica>\u00a0has quit  \n22:45\u00a0<vmassol>\u00a0has quit\n"}